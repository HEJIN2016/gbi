function clone(j){var i;if(typeof j=="object"){if(j===null){i=null}else{if(j instanceof Array){i=[];for(var k=0,h=j.length;k<h;k++){i.push(clone(j[k]))}}else{i={};for(var g in j){i[g]=clone(j[g])}}}}else{i=j}return i}var Kline=function(b){this.element="#kline_container";this.chartMgr=null;this.G_HTTP_REQUEST=null;this.timer=null;this.buttonDown=false;this.init=false;this.requestParam="";this.data={};this.width=1200;this.height=650;this.symbol="";this.symbolName="";this.range=null;this.url="";this.limit=1000;this.type="poll";this.subscribePath="";this.sendPath="";this.socketClient=null;this.intervalTime=5000;this.debug=true;this.language="zh-cn";this.theme="dark";this.ranges=["1w","1d","1h","30m","15m","5m","1m","line"];this.showTrade=true;this.tradeWidth=250;this.socketConnected=false;this.enableSockjs=true;this.reverseColor=false;this.isSized=false;this.paused=false;this.periodMap={"01w":7*86400*1000,"03d":3*86400*1000,"01d":86400*1000,"12h":12*3600*1000,"06h":6*3600*1000,"04h":4*3600*1000,"02h":2*3600*1000,"01h":3600*1000,"30m":30*60*1000,"15m":15*60*1000,"05m":5*60*1000,"03m":3*60*1000,"01m":60*1000,"line":60*1000};this.tagMapPeriod={"1w":"01w","3d":"03d","1d":"01d","12h":"12h","6h":"06h","4h":"04h","2h":"02h","1h":"01h","30m":"30m","15m":"15m","5m":"05m","3m":"03m","1m":"01m","line":"line"};if(Object.assign){Object.assign(this,b)}else{$.extend(this,b)}};Kline.prototype={draw:function(){draw(this)},resize:function(c,d){this.width=c;this.height=d;on_size(this.width,this.height)},setSymbol:function(c,d){KlineIns.symbol=c;KlineIns.symbolName=d;switch_symbol(c);KlineIns.onSymbolChange(c,d)},setTheme:function(b){KlineIns.theme=b;switch_theme(b)},setLanguage:function(b){KlineIns.language=b;chart_switch_language(b)},setShowTrade:function(b){this.showTrade=b;if(b){$(".trade_container").show()}else{$(".trade_container").hide()}on_size(this.width,this.height)},toggleTrade:function(){if(!this.showTrade){this.showTrade=true;$(".trade_container").show()}else{this.showTrade=false;$(".trade_container").hide()}on_size(this.width,this.height)},setIntervalTime:function(b){this.intervalTime=b;if(this.debug){console.log("DEBUG: interval time changed to "+b)}},pause:function(){if(this.debug){console.log("DEBUG: kline paused")}this.paused=true},resend:function(){if(this.debug){console.log("DEBUG: kline continue")}this.paused=false;RequestData(true)},connect:function(){if(this.type!="socket"){if(this.debug){console.log("DEBUG: this is for socket type")}return}socketConnect()},disconnect:function(){if(this.type!="socket"){if(this.debug){console.log("DEBUG: this is for socket type")}return}if(this.socketClient){this.socketClient.disconnect();KlineIns.socketConnected=false}if(this.debug){console.log("DEBUG: socket disconnected")}},onResize:function(c,d){if(this.debug){console.log("DEBUG: chart resized to width: "+c+" height: "+d)}},onLangChange:function(b){if(this.debug){console.log("DEBUG: language changed to "+b)}},onSymbolChange:function(c,d){if(this.debug){console.log("DEBUG: symbol changed to "+c+" "+d)}},onThemeChange:function(b){if(this.debug){console.log("DEBUG: theme changed to : "+b)}},onRangeChange:function(b){if(this.debug){console.log("DEBUG: range changed to "+b)}}};var KlineIns=null;var KlineTrade=function(b){this.browerState=0;this.tradeDate=new Date();this.tradesLimit=20;this.lastDepth=null;this.depthShowSize=15;this.priceDecimalDigits=6;this.amountDecimalDigits=4;this.symbol=null;this.curPrice=null;this.title="";if(Object.assign){Object.assign(this,b)}else{$.extend(this,b)}};KlineTrade.prototype={reset:function(b){this.symbol=b;this.lastDepth=null;this.curPrice=null;this.klineTradeInit=false;$("#trades .trades_list").empty();$("#gasks .table").empty();$("#gbids .table").empty();$("#asks .table").empty();$("#bids .table").empty()},pushTrades:function(j){var p=$("#trades .trades_list");var w="";for(var t=0;t<j.length;t++){var i=j[t];if(t>=j.length-this.tradesLimit){this.tradeDate.setTime(i.time);var v=this.dateFormatTf(this.tradeDate.getHours())+":"+this.dateFormatTf(this.tradeDate.getMinutes())+":"+this.dateFormatTf(this.tradeDate.getSeconds());var s=(i.amount.toFixed(4)+"").split(".");var q=i.price;if(q>1){q=q.toFixed(2)}if(q<1&&q>0.00001){q=q.toFixed(4)}if(q<0.00001){q=q.toFixed(6)}if(this.klineTradeInit){w="<ul class='newul'><li class='tm'>"+v+"</li><li class='pr-"+(i.type=="buy"?"green":"red")+"'>"+q+"</li><li class='vl'>"+s[0]+"<g>"+(s.length>1?"."+s[1]:"")+"</g></li></ul>"+w}else{w="<ul><li class='tm'>"+v+"</li><li class='pr-"+(i.type=="buy"?"green":"red")+"'>"+q+"</li><li class='vl'>"+s[0]+"<g>"+(s.length>1?"."+s[1]:"")+"</g></li></ul>"+w}}}var u=0;var o=this;if(this.klineTradeInit){clearInterval(r);var r=setInterval(function(){var a=j[u];var b=Number(a.price);if(b>1){b=b.toFixed(2)}if(b<1&&b>0.0001){b=b.toFixed(4)}if(b<0.0001){b=b.toFixed(6)}o.curPrice=b;$("div#price").attr("class",a.type=="buy"?"green":"red").text(b);u++;if(u>=j.length){clearInterval(r)}},100)}else{if(j.length>0){var q=Number(j[j.length-1].price);
if(q>1){q=q.toFixed(2)}if(q<1&&q>0.0001){q=q.toFixed(4)}if(q<0.0001){q=q.toFixed(6)}o.curPrice=q;$("div#price").attr("class",j[j.length-1].type=="buy"?"green":"red").text(q)}}if(this.klineTradeInit){p.prepend(w)}else{p.append(w)}w=null;p.find("ul.newul").slideDown(1000,function(){$(this).removeClass("newul")});p.find("ul:gt("+(this.tradesLimit-1)+")").remove()},updateDepth:function(m){window._set_current_depth(m);if(!m){return}$("#gasks .table").html(this.getgview(this.getgasks(m.asks)));$("#gbids .table").html(this.getgview(this.getgbids(m.bids)));if(this.lastDepth==null){this.lastDepth={};this.lastDepth.asks=this.getAsks(m.asks,this.depthShowSize);this.depthInit(this.lastDepth.asks,$("#asks .table"));this.lastDepth.bids=this.getBids(m.bids,this.depthShowSize);this.depthInit(this.lastDepth.bids,$("#bids .table"))}else{var i=$("#asks .table");i.find("div.remove").remove();i.find("div.add").removeClass("add");var l=this.getAsks(m.asks,this.depthShowSize);var j=this.lastDepth.asks;this.lastDepth.asks=l;this.asksAndBids(l.slice(0),j,i);var n=$("#bids .table");n.find("div.remove").remove();n.find("div.add").removeClass("add");var k=this.getBids(m.bids,this.depthShowSize);var o=this.lastDepth.bids;this.lastDepth.bids=k;this.asksAndBids(k.slice(0),o,$("#bids .table"))}},depthInit:function(n,l){l.empty();if(n&&n.length>0){var m,i="";for(var o=0;o<n.length;o++){var k=(n[o][0]+"").split(".");var p=this.getPrice(k,m);m=k[0];k=(n[o][1]+"").split(".");var q=this.getAmount(k);i+="<div class='row'><span class='price'>"+p[0]+"<g>"+p[1]+"</g></span> <span class='amount'>"+q[0]+"<g>"+q[1]+"</g></span></div>"}l.append(i);i=null}},asksAndBids:function(z,y,r){for(var v=0;v<y.length;v++){var j=false;for(var x=0;x<z.length;x++){if(y[v][0]==z[x][0]){j=true;if(y[v][1]!=z[x][1]){var A=r.find("div:eq("+v+") .amount");A.addClass(y[v][1]>z[x][1]?"red":"green");var u=this.getAmount((z[x][1]+"").split("."));setTimeout((function(a,b){return function(){a.html(b[0]+"<g>"+b[1]+"</g>");a.removeClass("red").removeClass("green");a=null;b=null}})(A,u),500)}z.splice(x,1);break}}if(!j){r.find("div:eq("+v+")").addClass("remove");y[v][2]=-1}}for(var x=0;x<y.length;x++){for(var v=0;v<z.length;v++){if(z[v][0]>y[x][0]){var s=(z[v][1]+"").split(".");var u=this.getAmount(s);r.find("div:eq("+x+")").before("<div class='row add'><span class='price'></span> <span class='amount'>"+u[0]+"<g>"+u[1]+"</g></span></div>");y.splice(x,0,z[v]);z.splice(v,1);break}}}var t="";for(var v=0;v<z.length;v++){y.push(z[v]);var s=(z[v][1]+"").split(".");var u=this.getAmount(s);t+="<div class='row add'><span class='price'></span> <span class='amount'>"+u[0]+"<g>"+u[1]+"</g></span></div>"}if(t.length>0){r.append(t)}t=null;var q;for(var v=0;v<y.length;v++){var i=r.find("div:eq("+v+")");if(!(y[v].length>=3&&y[v][2]==-1)){var s=(y[v][0]+"").split(".");var w=this.getPrice(s,q);q=s[0];i.find(".price").html(w[0]+"<g>"+w[1]+"</g>")}}z=null;y=null;r.find("div.add").slideDown(800);setTimeout((function(b,a){return function(){b.slideUp(500,function(){$(this).remove()});a.removeClass("add")}})(r.find("div.remove"),r.find("div.add")),1000)},getAsks:function(c,d){if(c.length>d){c.splice(0,c.length-d)}return c},getBids:function(c,d){if(c.length>d){c.splice(d,c.length-1)}return c},getgview:function(k){var j="";var i;for(var g=0;g<k.length;g++){var h=k[g][0].split(".");if(h.length==1||h[0]!=i){j+="<div class='row'><span class='price'>"+k[g][0]+"</span> <span class='amount'>"+k[g][1]+"</span></div>";i=h[0]}else{j+="<div class='row'><span class='price'><h>"+h[0]+".</h>"+h[1]+"</span> <span class='amount'>"+k[g][1]+"</span></div>"}}return j},getgasks:function(m){if(m.length<2){return[]}var i=m[m.length-1][0];var q=m[0][0];var u=q-i;var r=this.getBlock(u,100);var t=Math.abs(Number(Math.log(r)/Math.log(10))).toFixed(0);if(u/r<2){r=r/2;t++}if(r>=1){(t=0)}i=parseInt(i/r)*r;q=parseInt(q/r)*r;var n=[];var o=0;for(var p=m.length-1;p>=0;p--){if(m[p][0]>i){var s=parseInt(o,10);if(s>0){n.unshift([Number(i).toFixed(t),s])}if(i>=q){break}i+=r}o+=m[p][1]}return n},getgbids:function(m){if(m.length<2){return[]}var i=m[m.length-1][0];var q=m[0][0];var u=q-i;var r=this.getBlock(u,100);var t=Math.abs(Number(Math.log(r)/Math.log(10))).toFixed(0);if(u/r<2){r=r/2;t++}if(r>=1){(t=0)}i=parseInt(i/r)*r;q=parseInt(q/r)*r;var n=[];var o=0;for(var p=0;p<m.length;p++){if(m[p][0]<q){var s=parseInt(o,10);if(s>0){n.push([Number(q).toFixed(t),s])}if(q<=i){break}q-=r}o+=m[p][1]}return n},getBlock:function(b,d){if(b>d||b<=0){return d}else{d=d/10;return this.getBlock(b,d)}},getZeros:function(c){var d="";while(c>0){c--;d+="0"}return d},getPrice:function(g,h){var i=g[0];if(h==i){i="<h>"+i+".</h>"}else{i+="."}var f="";if(g.length==1){i+="0";f=this.getZeros(this.priceDecimalDigits-1)}else{i+=g[1];f=this.getZeros(this.priceDecimalDigits-g[1].length)}return[i,f]},getAmount:function(g){var i=g[0];var f="";var h=this.amountDecimalDigits-i.length+1;if(h>0){f=".";if(g.length==1){f+=this.getZeros(h)}else{if(h>g[1].length){f+=g[1]+this.getZeros(h-g[1].length)
}else{if(h==g[1].length){f+=g[1]}else{f+=g[1].substring(0,h)}}}}return[i,f]},dateFormatTf:function(b){return(b<10?"0":"")+b},};var KlineTradeIns=null;var classId=0;function create_class(){var k=arguments.length;var o=function(){};var p;if(k){p=arguments[0];for(var i in p.prototype){o.prototype[i]=p.prototype[i]}}for(var q=1;q<k;q++){var f=arguments[q];var n=f.prototype.__construct;if(n){if(!o.prototype.__featureConstructors){o.prototype.__featureConstructors=[]}o.prototype.__featureConstructors.push(n);delete f.prototype.__construct}for(var i in f.prototype){o.prototype[i]=f.prototype[i]}if(n){f.prototype.__construct=n}}var m=function(){if(this.__construct){this.__construct.apply(this,arguments)}if(this.__featureConstructors){var c=this.__featureConstructors;var b,a=c.length;for(b=0;b<a;b++){c[b].apply(this,arguments)}}};o.prototype.__classId=classId++;if(p!=undefined){m.__super=p.prototype;o.prototype.__super=p}m.prototype=new o();return m}function is_instance(i,g){var f=g.prototype.__classId;if(i.__classId==f){return true}var h=i.__super;while(h!=undefined){if(h.prototype.__classId==f){return true}h=h.prototype.__super}return false}var MEvent=create_class();MEvent.prototype.__construct=function(){this._handlers=[]};MEvent.prototype.addHandler=function(c,d){if(this._indexOf(c,d)<0){this._handlers.push({obj:c,func:d})}};MEvent.prototype.removeHandler=function(g,d){var f=this._indexOf(g,d);if(f>=0){this._handlers.splice(f,1)}};MEvent.prototype.raise=function(l,i){var a=this._handlers;var g,m,c=a.length;for(m=0;m<c;m++){g=a[m];g.func.call(g.obj,l,i)}};MEvent.prototype._indexOf=function(f,l){var a=this._handlers;var i,m,c=a.length;for(m=0;m<c;m++){i=a[m];if(f==i.obj&&l==i.func){return m}}return -1};String.fromFloat=function(g,i){var h=g.toFixed(i);for(var f=h.length-1;f>=0;f--){if(h[f]=="."){return h.substring(0,f)}if(h[f]!="0"){return h.substring(0,f+1)}}};var ExprEnv=create_class();ExprEnv.get=function(){return ExprEnv.inst};ExprEnv.set=function(b){ExprEnv.inst=b};ExprEnv.prototype.getDataSource=function(){return this._ds};ExprEnv.prototype.setDataSource=function(b){return this._ds=b};ExprEnv.prototype.getFirstIndex=function(){return this._firstIndex};ExprEnv.prototype.setFirstIndex=function(b){return this._firstIndex=b};var Expr=create_class();Expr.prototype.__construct=function(){this._rid=0};Expr.prototype.execute=function(b){};Expr.prototype.reserve=function(d,c){};Expr.prototype.clear=function(){};var OpenExpr=create_class(Expr);var HighExpr=create_class(Expr);var LowExpr=create_class(Expr);var CloseExpr=create_class(Expr);var VolumeExpr=create_class(Expr);OpenExpr.prototype.execute=function(b){return ExprEnv.get()._ds.getDataAt(b).open};HighExpr.prototype.execute=function(b){return ExprEnv.get()._ds.getDataAt(b).high};LowExpr.prototype.execute=function(b){return ExprEnv.get()._ds.getDataAt(b).low};CloseExpr.prototype.execute=function(b){return ExprEnv.get()._ds.getDataAt(b).close};VolumeExpr.prototype.execute=function(b){return ExprEnv.get()._ds.getDataAt(b).volume};var ConstExpr=create_class(Expr);ConstExpr.prototype.__construct=function(b){ConstExpr.__super.__construct.call(this);this._value=b};ConstExpr.prototype.execute=function(b){return this._value};var ParameterExpr=create_class(Expr);ParameterExpr.prototype.__construct=function(f,i,h,g){ParameterExpr.__super.__construct.call(this);this._name=f;this._minValue=i;this._maxValue=h;this._value=this._defaultValue=g};ParameterExpr.prototype.execute=function(b){return this._value};ParameterExpr.prototype.getMinValue=function(){return this._minValue};ParameterExpr.prototype.getMaxValue=function(){return this._maxValue};ParameterExpr.prototype.getDefaultValue=function(){return this._defaultValue};ParameterExpr.prototype.getValue=function(){return this._value};ParameterExpr.prototype.setValue=function(b){if(b==0){this._value=0}else{if(b<this._minValue){this._value=this._minValue}else{if(b>this._maxValue){this._value=this._maxValue}else{this._value=b}}}};var OpAExpr=create_class(Expr);var OpABExpr=create_class(Expr);var OpABCExpr=create_class(Expr);var OpABCDExpr=create_class(Expr);OpAExpr.prototype.__construct=function(a){OpAExpr.__super.__construct.call(this);this._exprA=a};OpAExpr.prototype.reserve=function(d,c){if(this._rid<d){this._rid=d;this._exprA.reserve(d,c)}};OpAExpr.prototype.clear=function(){this._exprA.clear()};OpABExpr.prototype.__construct=function(a,b){OpABExpr.__super.__construct.call(this);this._exprA=a;this._exprB=b};OpABExpr.prototype.reserve=function(d,c){if(this._rid<d){this._rid=d;this._exprA.reserve(d,c);this._exprB.reserve(d,c)}};OpABExpr.prototype.clear=function(){this._exprA.clear();this._exprB.clear()};OpABCExpr.prototype.__construct=function(b,c,a){OpABCExpr.__super.__construct.call(this);this._exprA=b;this._exprB=c;this._exprC=a};OpABCExpr.prototype.reserve=function(d,c){if(this._rid<d){this._rid=d;this._exprA.reserve(d,c);this._exprB.reserve(d,c);this._exprC.reserve(d,c)}};OpABCExpr.prototype.clear=function(){this._exprA.clear();
this._exprB.clear();this._exprC.clear()};OpABCDExpr.prototype.__construct=function(c,d,a,b){OpABCDExpr.__super.__construct.call(this);this._exprA=c;this._exprB=d;this._exprC=a;this._exprD=b};OpABCDExpr.prototype.reserve=function(d,c){if(this._rid<d){this._rid=d;this._exprA.reserve(d,c);this._exprB.reserve(d,c);this._exprC.reserve(d,c);this._exprD.reserve(d,c)}};OpABCDExpr.prototype.clear=function(){this._exprA.clear();this._exprB.clear();this._exprC.clear();this._exprD.clear()};var NegExpr=create_class(OpAExpr);NegExpr.prototype.__construct=function(a){NegExpr.__super.__construct.call(this,a)};NegExpr.prototype.execute=function(b){return -(this._exprA.execute(b))};var AddExpr=create_class(OpABExpr);var SubExpr=create_class(OpABExpr);var MulExpr=create_class(OpABExpr);var DivExpr=create_class(OpABExpr);AddExpr.prototype.__construct=function(a,b){AddExpr.__super.__construct.call(this,a,b)};SubExpr.prototype.__construct=function(a,b){SubExpr.__super.__construct.call(this,a,b)};MulExpr.prototype.__construct=function(a,b){MulExpr.__super.__construct.call(this,a,b)};DivExpr.prototype.__construct=function(a,b){DivExpr.__super.__construct.call(this,a,b)};AddExpr.prototype.execute=function(b){return this._exprA.execute(b)+this._exprB.execute(b)};SubExpr.prototype.execute=function(b){return this._exprA.execute(b)-this._exprB.execute(b)};MulExpr.prototype.execute=function(b){return this._exprA.execute(b)*this._exprB.execute(b)};DivExpr.prototype.execute=function(a){var b=this._exprA.execute(a);var g=this._exprB.execute(a);if(b==0){return b}if(g==0){return(b>0)?1000000:-1000000}return b/g};var GtExpr=create_class(OpABExpr);var GeExpr=create_class(OpABExpr);var LtExpr=create_class(OpABExpr);var LeExpr=create_class(OpABExpr);var EqExpr=create_class(OpABExpr);GtExpr.prototype.__construct=function(a,b){GtExpr.__super.__construct.call(this,a,b)};GeExpr.prototype.__construct=function(a,b){GeExpr.__super.__construct.call(this,a,b)};LtExpr.prototype.__construct=function(a,b){LtExpr.__super.__construct.call(this,a,b)};LeExpr.prototype.__construct=function(a,b){LeExpr.__super.__construct.call(this,a,b)};EqExpr.prototype.__construct=function(a,b){EqExpr.__super.__construct.call(this,a,b)};GtExpr.prototype.execute=function(b){return this._exprA.execute(b)>this._exprB.execute(b)?1:0};GeExpr.prototype.execute=function(b){return this._exprA.execute(b)>=this._exprB.execute(b)?1:0};LtExpr.prototype.execute=function(b){return this._exprA.execute(b)<this._exprB.execute(b)?1:0};LeExpr.prototype.execute=function(b){return this._exprA.execute(b)<=this._exprB.execute(b)?1:0};EqExpr.prototype.execute=function(b){return this._exprA.execute(b)==this._exprB.execute(b)?1:0};var MaxExpr=create_class(OpABExpr);MaxExpr.prototype.__construct=function(a,b){MaxExpr.__super.__construct.call(this,a,b)};MaxExpr.prototype.execute=function(b){return Math.max(this._exprA.execute(b),this._exprB.execute(b))};var AbsExpr=create_class(OpAExpr);AbsExpr.prototype.__construct=function(a){AbsExpr.__super.__construct.call(this,a)};AbsExpr.prototype.execute=function(b){return Math.abs(this._exprA.execute(b))};var RefExpr=create_class(OpABExpr);RefExpr.prototype.__construct=function(a,b){RefExpr.__super.__construct.call(this,a,b);this._offset=-1};RefExpr.prototype.execute=function(c){if(this._offset<0){this._offset=this._exprB.execute(c);if(this._offset<0){throw"offset < 0"}}c-=this._offset;if(c<0){throw"index < 0"}var d=this._exprA.execute(c);if(isNaN(d)){throw"NaN"}return d};var AndExpr=create_class(OpABExpr);var OrExpr=create_class(OpABExpr);AndExpr.prototype.__construct=function(a,b){AndExpr.__super.__construct.call(this,a,b)};OrExpr.prototype.__construct=function(a,b){OrExpr.__super.__construct.call(this,a,b)};AndExpr.prototype.execute=function(b){return(this._exprA.execute(b)!=0)&&(this._exprB.execute(b)!=0)?1:0};OrExpr.prototype.execute=function(b){return(this._exprA.execute(b)!=0)||(this._exprB.execute(b)!=0)?1:0};var IfExpr=create_class(OpABCExpr);IfExpr.prototype.__construct=function(b,c,a){IfExpr.__super.__construct.call(this,b,c,a)};IfExpr.prototype.execute=function(b){return this._exprA.execute(b)!=0?this._exprB.execute(b):this._exprC.execute(b)};var AssignExpr=create_class(OpAExpr);AssignExpr.prototype.__construct=function(d,a){AssignExpr.__super.__construct.call(this,a);this._name=d;this._buf=[]};AssignExpr.prototype.getName=function(){return this._name};AssignExpr.prototype.execute=function(b){return this._buf[b]};AssignExpr.prototype.assign=function(b){this._buf[b]=this._exprA.execute(b);if(ExprEnv.get()._firstIndex>=0){if(isNaN(this._buf[b])&&!isNaN(this._buf[b-1])){throw this._name+".assign("+b+"): NaN"}}};AssignExpr.prototype.reserve=function(f,c){if(this._rid<f){for(var g=c;g>0;g--){this._buf.push(NaN)}}AssignExpr.__super.reserve.call(this,f,c)};AssignExpr.prototype.clear=function(){AssignExpr.__super.clear.call(this);this._buf=[]};var OutputStyle={None:0,Line:1,VolumeStick:2,MACDStick:3,SARPoint:4};var OutputExpr=create_class(AssignExpr);OutputExpr.prototype.__construct=function(h,a,g,i){OutputExpr.__super.__construct.call(this,h,a);
this._style=(g===undefined)?OutputStyle.Line:g;this._color=i};OutputExpr.prototype.getStyle=function(){return this._style};OutputExpr.prototype.getColor=function(){return this._color};var RangeOutputExpr=create_class(OutputExpr);RangeOutputExpr.prototype.__construct=function(h,a,g,i){RangeOutputExpr.__super.__construct.call(this,h,a,g,i)};RangeOutputExpr.prototype.getName=function(){return this._name+this._exprA.getRange()};var RangeExpr=create_class(OpABExpr);RangeExpr.prototype.__construct=function(a,b){RangeExpr.__super.__construct.call(this,a,b);this._range=-1;this._buf=[]};RangeExpr.prototype.getRange=function(){return this._range};RangeExpr.prototype.initRange=function(){this._range=this._exprB.execute(0)};RangeExpr.prototype.execute=function(f){if(this._range<0){this.initRange()}var g=this._buf[f].resultA=this._exprA.execute(f);var d=this._buf[f].result=this.calcResult(f,g);return d};RangeExpr.prototype.reserve=function(f,c){if(this._rid<f){for(var g=c;g>0;g--){this._buf.push({resultA:NaN,result:NaN})}}RangeExpr.__super.reserve.call(this,f,c)};RangeExpr.prototype.clear=function(){RangeExpr.__super.clear.call(this);this._range=-1;this._buf=[]};var HhvExpr=create_class(RangeExpr);var LlvExpr=create_class(RangeExpr);HhvExpr.prototype.__construct=function(a,b){HhvExpr.__super.__construct.call(this,a,b)};LlvExpr.prototype.__construct=function(a,b){LlvExpr.__super.__construct.call(this,a,b)};HhvExpr.prototype.calcResult=function(i,l){if(this._range==0){return NaN}var o=ExprEnv.get()._firstIndex;if(o<0){return l}if(i>o){var m=this._range;var k=l;var n=i-m+1;var q=Math.max(o,n);for(;q<i;q++){var p=this._buf[q];if(k<p.resultA){k=p.resultA}}return k}else{return l}};LlvExpr.prototype.calcResult=function(i,l){if(this._range==0){return NaN}var o=ExprEnv.get()._firstIndex;if(o<0){return l}if(i>o){var m=this._range;var k=l;var n=i-m+1;var q=Math.max(o,n);for(;q<i;q++){var p=this._buf[q];if(k>p.resultA){k=p.resultA}}return k}else{return l}};var CountExpr=create_class(RangeExpr);CountExpr.prototype.__construct=function(a,b){CountExpr.__super.__construct.call(this,a,b)};CountExpr.prototype.calcResult=function(h,i){if(this._range==0){return NaN}var k=ExprEnv.get()._firstIndex;if(k<0){return 0}if(h>=k){var j=this._range-1;if(j>h-k){j=h-k}var g=0;for(;j>=0;j--){if(this._buf[h-j].resultA!=0){g++}}return g}else{return 0}};var SumExpr=create_class(RangeExpr);SumExpr.prototype.__construct=function(a,b){SumExpr.__super.__construct.call(this,a,b)};SumExpr.prototype.calcResult=function(g,h){var f=ExprEnv.get()._firstIndex;if(f<0){return h}if(g>f){var i=this._range;if(i==0||i>=g+1-f){return this._buf[g-1].result+h}return this._buf[g-1].result+h-this._buf[g-i].resultA}else{return h}};var StdExpr=create_class(RangeExpr);StdExpr.prototype.__construct=function(a,b){StdExpr.__super.__construct.call(this,a,b)};StdExpr.prototype.calcResult=function(i,k){if(this._range==0){return NaN}var j=this._stdBuf[i];var m=ExprEnv.get()._firstIndex;if(m<0){j.resultMA=k;return 0}if(i>m){var l=this._range;if(l>=i+1-m){l=i+1-m;j.resultMA=this._stdBuf[i-1].resultMA*(1-1/l)+(k/l)}else{j.resultMA=this._stdBuf[i-1].resultMA+(k-this._buf[i-l].resultA)/l}var n=0;for(var o=i-l+1;o<=i;o++){n+=Math.pow(this._buf[o].resultA-j.resultMA,2)}return Math.sqrt(n/l)}j.resultMA=k;return 0};StdExpr.prototype.reserve=function(f,c){if(this._rid<f){for(var g=c;g>0;g--){this._stdBuf.push({resultMA:NaN})}}StdExpr.__super.reserve.call(this,f,c)};StdExpr.prototype.clear=function(){StdExpr.__super.clear.call(this);this._stdBuf=[]};var MaExpr=create_class(RangeExpr);MaExpr.prototype.__construct=function(a,b){MaExpr.__super.__construct.call(this,a,b)};MaExpr.prototype.calcResult=function(g,h){if(this._range==0){return NaN}var f=ExprEnv.get()._firstIndex;if(f<0){return h}if(g>f){var i=this._range;if(i>=g+1-f){i=g+1-f;return this._buf[g-1].result*(1-1/i)+(h/i)}return this._buf[g-1].result+(h-this._buf[g-i].resultA)/i}else{return h}};var EmaExpr=create_class(RangeExpr);EmaExpr.prototype.__construct=function(a,b){EmaExpr.__super.__construct.call(this,a,b)};EmaExpr.prototype.initRange=function(){EmaExpr.__super.initRange.call(this);this._alpha=2/(this._range+1)};EmaExpr.prototype.calcResult=function(g,h){if(this._range==0){return NaN}var i=ExprEnv.get()._firstIndex;if(i<0){return h}if(g>i){var f=this._buf[g-1];return this._alpha*(h-f.result)+f.result}return h};var ExpmemaExpr=create_class(EmaExpr);ExpmemaExpr.prototype.__construct=function(a,b){ExpmemaExpr.__super.__construct.call(this,a,b)};ExpmemaExpr.prototype.calcResult=function(h,i){var k=ExprEnv.get()._firstIndex;if(k<0){return i}if(h>k){var j=this._range;var g=this._buf[h-1];if(j>=h+1-k){j=h+1-k;return g.result*(1-1/j)+(i/j)}return this._alpha*(i-g.result)+g.result}return i};var SmaExpr=create_class(RangeExpr);SmaExpr.prototype.__construct=function(b,c,a){SmaExpr.__super.__construct.call(this,b,c);this._exprC=a;this._mul};SmaExpr.prototype.initRange=function(){SmaExpr.__super.initRange.call(this);this._mul=this._exprC.execute(0)
};SmaExpr.prototype.calcResult=function(g,h){if(this._range==0){return NaN}var f=ExprEnv.get()._firstIndex;if(f<0){return h}if(g>f){var i=this._range;if(i>g+1-f){i=g+1-f}return((i-1)*this._buf[g-1].result+h*this._mul)/i}return h};var SarExpr=create_class(OpABCDExpr);SarExpr.prototype.__construct=function(c,d,a,b){SarExpr.__super.__construct.call(this,c,d,a,b);this._buf=[];this._range=-1;this._min;this._step;this._max};SarExpr.prototype.execute=function(l){if(this._range<0){this._range=this._exprA.execute(0);this._min=this._exprB.execute(0)/100;this._step=this._exprC.execute(0)/100;this._max=this._exprD.execute(0)/100}var r=this._buf[l];var h=ExprEnv.get();var o=h._firstIndex;if(o<0){r.longPos=true;r.sar=h._ds.getDataAt(l).low;r.ep=h._ds.getDataAt(l).high;r.af=0.02}else{var s=h._ds.getDataAt(l).high;var i=h._ds.getDataAt(l).low;var t=this._buf[l-1];r.sar=t.sar+t.af*(t.ep-t.sar);if(t.longPos){r.longPos=true;if(s>t.ep){r.ep=s;r.af=Math.min(t.af+this._step,this._max)}else{r.ep=t.ep;r.af=t.af}if(r.sar>i){r.longPos=false;var q=l-this._range+1;for(q=Math.max(q,o);q<l;q++){var p=h._ds.getDataAt(q).high;if(s<p){s=p}}r.sar=s;r.ep=i;r.af=0.02}}else{r.longPos=false;if(i<t.ep){r.ep=i;r.af=Math.min(t.af+this._step,this._max)}else{r.ep=t.ep;r.af=t.af}if(r.sar<s){r.longPos=true;var q=l-this._range+1;for(q=Math.max(q,o);q<l;q++){var u=h._ds.getDataAt(q).low;if(i>u){i=u}}r.sar=i;r.ep=s;r.af=0.02}}}return r.sar};SarExpr.prototype.reserve=function(f,c){if(this._rid<f){for(var g=c;g>0;g--){this._buf.push({longPos:true,sar:NaN,ep:NaN,af:NaN})}}SarExpr.__super.reserve.call(this,f,c)};SarExpr.prototype.clear=function(){SarExpr.__super.clear.call(this);this._range=-1};var Indicator=create_class();Indicator.prototype.__construct=function(){this._exprEnv=new ExprEnv();this._rid=0;this._params=[];this._assigns=[];this._outputs=[]};Indicator.prototype.addParameter=function(b){this._params.push(b)};Indicator.prototype.addAssign=function(b){this._assigns.push(b)};Indicator.prototype.addOutput=function(b){this._outputs.push(b)};Indicator.prototype.getParameterCount=function(){return this._params.length};Indicator.prototype.getParameterAt=function(b){return this._params[b]};Indicator.prototype.getOutputCount=function(){return this._outputs.length};Indicator.prototype.getOutputAt=function(b){return this._outputs[b]};Indicator.prototype.clear=function(){this._exprEnv.setFirstIndex(-1);var c,d;d=this._assigns.length;for(c=0;c<d;c++){this._assigns[c].clear()}d=this._outputs.length;for(c=0;c<d;c++){this._outputs[c].clear()}};Indicator.prototype.reserve=function(g){this._rid++;var d,f;f=this._assigns.length;for(d=0;d<f;d++){this._assigns[d].reserve(this._rid,g)}f=this._outputs.length;for(d=0;d<f;d++){this._outputs[d].reserve(this._rid,g)}};Indicator.prototype.execute=function(j,h){if(h<0){return}this._exprEnv.setDataSource(j);ExprEnv.set(this._exprEnv);try{var k,g;g=this._assigns.length;for(k=0;k<g;k++){this._assigns[k].assign(h)}g=this._outputs.length;for(k=0;k<g;k++){this._outputs[k].assign(h)}if(this._exprEnv.getFirstIndex()<0){this._exprEnv.setFirstIndex(h)}}catch(i){if(this._exprEnv.getFirstIndex()>=0){alert(i);throw i}}};Indicator.prototype.getParameters=function(){var g=[];var d,f=this._params.length;for(d=0;d<f;d++){g.push(this._params[d].getValue())}return g};Indicator.prototype.setParameters=function(c){if((c instanceof Array)&&c.length==this._params.length){for(var d in this._params){this._params[d].setValue(c[d])}}};var HLCIndicator=create_class(Indicator);HLCIndicator.prototype.__construct=function(){HLCIndicator.__super.__construct.call(this);var b=new ParameterExpr("M1",2,1000,60);this.addParameter(b);this.addOutput(new OutputExpr("HIGH",new HighExpr(),OutputStyle.None));this.addOutput(new OutputExpr("LOW",new LowExpr(),OutputStyle.None));this.addOutput(new OutputExpr("CLOSE",new CloseExpr(),OutputStyle.Line,Theme.Color.Indicator0));this.addOutput(new RangeOutputExpr("MA",new MaExpr(new CloseExpr(),b),OutputStyle.Line,Theme.Color.Indicator1))};HLCIndicator.prototype.getName=function(){return"CLOSE"};var MAIndicator=create_class(Indicator);MAIndicator.prototype.__construct=function(){MAIndicator.__super.__construct.call(this);var j=new ParameterExpr("M1",2,1000,7);var k=new ParameterExpr("M2",2,1000,30);var l=new ParameterExpr("M3",2,1000,0);var m=new ParameterExpr("M4",2,1000,0);var h=new ParameterExpr("M5",2,1000,0);var i=new ParameterExpr("M6",2,1000,0);this.addParameter(j);this.addParameter(k);this.addParameter(l);this.addParameter(m);this.addParameter(h);this.addParameter(i);this.addOutput(new RangeOutputExpr("MA",new MaExpr(new CloseExpr(),j)));this.addOutput(new RangeOutputExpr("MA",new MaExpr(new CloseExpr(),k)));this.addOutput(new RangeOutputExpr("MA",new MaExpr(new CloseExpr(),l)));this.addOutput(new RangeOutputExpr("MA",new MaExpr(new CloseExpr(),m)));this.addOutput(new RangeOutputExpr("MA",new MaExpr(new CloseExpr(),h)));this.addOutput(new RangeOutputExpr("MA",new MaExpr(new CloseExpr(),i)))};MAIndicator.prototype.getName=function(){return"MA"
};var EMAIndicator=create_class(Indicator);EMAIndicator.prototype.__construct=function(){EMAIndicator.__super.__construct.call(this);var j=new ParameterExpr("M1",2,1000,7);var k=new ParameterExpr("M2",2,1000,30);var l=new ParameterExpr("M3",2,1000,0);var m=new ParameterExpr("M4",2,1000,0);var h=new ParameterExpr("M5",2,1000,0);var i=new ParameterExpr("M6",2,1000,0);this.addParameter(j);this.addParameter(k);this.addParameter(l);this.addParameter(m);this.addParameter(h);this.addParameter(i);this.addOutput(new RangeOutputExpr("EMA",new EmaExpr(new CloseExpr(),j)));this.addOutput(new RangeOutputExpr("EMA",new EmaExpr(new CloseExpr(),k)));this.addOutput(new RangeOutputExpr("EMA",new EmaExpr(new CloseExpr(),l)));this.addOutput(new RangeOutputExpr("EMA",new EmaExpr(new CloseExpr(),m)));this.addOutput(new RangeOutputExpr("EMA",new EmaExpr(new CloseExpr(),h)));this.addOutput(new RangeOutputExpr("EMA",new EmaExpr(new CloseExpr(),i)))};EMAIndicator.prototype.getName=function(){return"EMA"};var VOLUMEIndicator=create_class(Indicator);VOLUMEIndicator.prototype.__construct=function(){VOLUMEIndicator.__super.__construct.call(this);var g=new ParameterExpr("M1",2,500,5);var f=new ParameterExpr("M2",2,500,10);this.addParameter(g);this.addParameter(f);var d=new OutputExpr("VOLUME",new VolumeExpr(),OutputStyle.VolumeStick,Theme.Color.Text4);this.addOutput(d);this.addOutput(new RangeOutputExpr("MA",new MaExpr(d,g),OutputStyle.Line,Theme.Color.Indicator0));this.addOutput(new RangeOutputExpr("MA",new MaExpr(d,f),OutputStyle.Line,Theme.Color.Indicator1))};VOLUMEIndicator.prototype.getName=function(){return"VOLUME"};var MACDIndicator=create_class(Indicator);MACDIndicator.prototype.__construct=function(){MACDIndicator.__super.__construct.call(this);var m=new ParameterExpr("SHORT",2,200,12);var l=new ParameterExpr("LONG",2,200,26);var i=new ParameterExpr("MID",2,200,9);this.addParameter(m);this.addParameter(l);this.addParameter(i);var h=new OutputExpr("DIF",new SubExpr(new EmaExpr(new CloseExpr(),m),new EmaExpr(new CloseExpr(),l)));this.addOutput(h);var j=new OutputExpr("DEA",new EmaExpr(h,i));this.addOutput(j);var k=new OutputExpr("MACD",new MulExpr(new SubExpr(h,j),new ConstExpr(2)),OutputStyle.MACDStick);this.addOutput(k)};MACDIndicator.prototype.getName=function(){return"MACD"};var DMIIndicator=create_class(Indicator);DMIIndicator.prototype.__construct=function(){DMIIndicator.__super.__construct.call(this);var u=new ParameterExpr("N",2,90,14);var p=new ParameterExpr("MM",2,60,6);this.addParameter(u);this.addParameter(p);var n=new AssignExpr("MTR",new ExpmemaExpr(new MaxExpr(new MaxExpr(new SubExpr(new HighExpr(),new LowExpr()),new AbsExpr(new SubExpr(new HighExpr(),new RefExpr(new CloseExpr(),new ConstExpr(1))))),new AbsExpr(new SubExpr(new RefExpr(new CloseExpr(),new ConstExpr(1)),new LowExpr()))),u));this.addAssign(n);var m=new AssignExpr("HD",new SubExpr(new HighExpr(),new RefExpr(new HighExpr(),new ConstExpr(1))));this.addAssign(m);var t=new AssignExpr("LD",new SubExpr(new RefExpr(new LowExpr(),new ConstExpr(1)),new LowExpr()));this.addAssign(t);var w=new AssignExpr("DMP",new ExpmemaExpr(new IfExpr(new AndExpr(new GtExpr(m,new ConstExpr(0)),new GtExpr(m,t)),m,new ConstExpr(0)),u));this.addAssign(w);var q=new AssignExpr("DMM",new ExpmemaExpr(new IfExpr(new AndExpr(new GtExpr(t,new ConstExpr(0)),new GtExpr(t,m)),t,new ConstExpr(0)),u));this.addAssign(q);var v=new OutputExpr("PDI",new MulExpr(new DivExpr(w,n),new ConstExpr(100)));this.addOutput(v);var o=new OutputExpr("MDI",new MulExpr(new DivExpr(q,n),new ConstExpr(100)));this.addOutput(o);var r=new OutputExpr("ADX",new ExpmemaExpr(new MulExpr(new DivExpr(new AbsExpr(new SubExpr(o,v)),new AddExpr(o,v)),new ConstExpr(100)),p));this.addOutput(r);var s=new OutputExpr("ADXR",new ExpmemaExpr(r,p));this.addOutput(s)};DMIIndicator.prototype.getName=function(){return"DMI"};var DMAIndicator=create_class(Indicator);DMAIndicator.prototype.__construct=function(){DMAIndicator.__super.__construct.call(this);var k=new ParameterExpr("N1",2,60,10);var g=new ParameterExpr("N2",2,250,50);var i=new ParameterExpr("M",2,100,10);this.addParameter(k);this.addParameter(g);this.addParameter(i);var h=new OutputExpr("DIF",new SubExpr(new MaExpr(new CloseExpr(),k),new MaExpr(new CloseExpr(),g)));this.addOutput(h);var j=new OutputExpr("DIFMA",new MaExpr(h,i));this.addOutput(j)};DMAIndicator.prototype.getName=function(){return"DMA"};var TRIXIndicator=create_class(Indicator);TRIXIndicator.prototype.__construct=function(){TRIXIndicator.__super.__construct.call(this);var j=new ParameterExpr("N",2,100,12);var i=new ParameterExpr("M",2,100,9);this.addParameter(j);this.addParameter(i);var k=new AssignExpr("MTR",new EmaExpr(new EmaExpr(new EmaExpr(new CloseExpr(),j),j),j));this.addAssign(k);var g=new OutputExpr("TRIX",new MulExpr(new DivExpr(new SubExpr(k,new RefExpr(k,new ConstExpr(1))),new RefExpr(k,new ConstExpr(1))),new ConstExpr(100)));this.addOutput(g);var h=new OutputExpr("MATRIX",new MaExpr(g,i));this.addOutput(h)
};TRIXIndicator.prototype.getName=function(){return"TRIX"};var BRARIndicator=create_class(Indicator);BRARIndicator.prototype.__construct=function(){BRARIndicator.__super.__construct.call(this);var h=new ParameterExpr("N",2,120,26);this.addParameter(h);var i=new AssignExpr("REF_CLOSE_1",new RefExpr(new CloseExpr(),new ConstExpr(1)));this.addAssign(i);var f=new OutputExpr("BR",new MulExpr(new DivExpr(new SumExpr(new MaxExpr(new ConstExpr(0),new SubExpr(new HighExpr(),i)),h),new SumExpr(new MaxExpr(new ConstExpr(0),new SubExpr(i,new LowExpr())),h)),new ConstExpr(100)));this.addOutput(f);var g=new OutputExpr("AR",new MulExpr(new DivExpr(new SumExpr(new SubExpr(new HighExpr(),new OpenExpr()),h),new SumExpr(new SubExpr(new OpenExpr(),new LowExpr()),h)),new ConstExpr(100)));this.addOutput(g)};BRARIndicator.prototype.getName=function(){return"BRAR"};var VRIndicator=create_class(Indicator);VRIndicator.prototype.__construct=function(){VRIndicator.__super.__construct.call(this);var m=new ParameterExpr("N",2,100,26);var l=new ParameterExpr("M",2,100,6);this.addParameter(m);this.addParameter(l);var o=new AssignExpr("REF_CLOSE_1",new RefExpr(new CloseExpr(),new ConstExpr(1)));this.addAssign(o);var p=new AssignExpr("TH",new SumExpr(new IfExpr(new GtExpr(new CloseExpr(),o),new VolumeExpr(),new ConstExpr(0)),m));this.addAssign(p);var j=new AssignExpr("TL",new SumExpr(new IfExpr(new LtExpr(new CloseExpr(),o),new VolumeExpr(),new ConstExpr(0)),m));this.addAssign(j);var n=new AssignExpr("TQ",new SumExpr(new IfExpr(new EqExpr(new CloseExpr(),o),new VolumeExpr(),new ConstExpr(0)),m));this.addAssign(n);var k=new OutputExpr("VR",new MulExpr(new DivExpr(new AddExpr(new MulExpr(p,new ConstExpr(2)),n),new AddExpr(new MulExpr(j,new ConstExpr(2)),n)),new ConstExpr(100)));this.addOutput(k);var q=new OutputExpr("MAVR",new MaExpr(k,l));this.addOutput(q)};VRIndicator.prototype.getName=function(){return"VR"};var OBVIndicator=create_class(Indicator);OBVIndicator.prototype.__construct=function(){OBVIndicator.__super.__construct.call(this);var i=new ParameterExpr("M",2,100,30);this.addParameter(i);var j=new AssignExpr("REF_CLOSE_1",new RefExpr(new CloseExpr(),new ConstExpr(1)));this.addAssign(j);var k=new AssignExpr("VA",new IfExpr(new GtExpr(new CloseExpr(),j),new VolumeExpr(),new NegExpr(new VolumeExpr())));this.addAssign(k);var h=new OutputExpr("OBV",new SumExpr(new IfExpr(new EqExpr(new CloseExpr(),j),new ConstExpr(0),k),new ConstExpr(0)));this.addOutput(h);var g=new OutputExpr("MAOBV",new MaExpr(h,i));this.addOutput(g)};OBVIndicator.prototype.getName=function(){return"OBV"};var EMVIndicator=create_class(Indicator);EMVIndicator.prototype.__construct=function(){EMVIndicator.__super.__construct.call(this);var k=new ParameterExpr("N",2,90,14);var j=new ParameterExpr("M",2,60,9);this.addParameter(k);this.addParameter(j);var l=new AssignExpr("VOLUME",new DivExpr(new MaExpr(new VolumeExpr(),k),new VolumeExpr()));this.addAssign(l);var h=new AssignExpr("MID",new MulExpr(new DivExpr(new SubExpr(new AddExpr(new HighExpr(),new LowExpr()),new RefExpr(new AddExpr(new HighExpr(),new LowExpr()),new ConstExpr(1))),new AddExpr(new HighExpr(),new LowExpr())),new ConstExpr(100)));this.addAssign(h);var i=new OutputExpr("EMV",new MaExpr(new DivExpr(new MulExpr(h,new MulExpr(l,new SubExpr(new HighExpr(),new LowExpr()))),new MaExpr(new SubExpr(new HighExpr(),new LowExpr()),k)),k));this.addOutput(i);var m=new OutputExpr("MAEMV",new MaExpr(i,j));this.addOutput(m)};EMVIndicator.prototype.getName=function(){return"EMV"};var RSIIndicator=create_class(Indicator);RSIIndicator.prototype.__construct=function(){RSIIndicator.__super.__construct.call(this);var i=new ParameterExpr("N1",2,120,6);var g=new ParameterExpr("N2",2,250,12);var h=new ParameterExpr("N3",2,500,24);this.addParameter(i);this.addParameter(g);this.addParameter(h);var j=new AssignExpr("LC",new RefExpr(new CloseExpr(),new ConstExpr(1)));this.addAssign(j);var k=new AssignExpr("CLOSE_LC",new SubExpr(new CloseExpr(),j));this.addAssign(k);this.addOutput(new OutputExpr("RSI1",new MulExpr(new DivExpr(new SmaExpr(new MaxExpr(k,new ConstExpr(0)),i,new ConstExpr(1)),new SmaExpr(new AbsExpr(k),i,new ConstExpr(1))),new ConstExpr(100))));this.addOutput(new OutputExpr("RSI2",new MulExpr(new DivExpr(new SmaExpr(new MaxExpr(k,new ConstExpr(0)),g,new ConstExpr(1)),new SmaExpr(new AbsExpr(k),g,new ConstExpr(1))),new ConstExpr(100))));this.addOutput(new OutputExpr("RSI3",new MulExpr(new DivExpr(new SmaExpr(new MaxExpr(k,new ConstExpr(0)),h,new ConstExpr(1)),new SmaExpr(new AbsExpr(k),h,new ConstExpr(1))),new ConstExpr(100))))};RSIIndicator.prototype.getName=function(){return"RSI"};var WRIndicator=create_class(Indicator);WRIndicator.prototype.__construct=function(){WRIndicator.__super.__construct.call(this);var l=new ParameterExpr("N",2,100,10);var o=new ParameterExpr("N1",2,100,6);this.addParameter(l);this.addParameter(o);var k=new AssignExpr("HHV",new HhvExpr(new HighExpr(),l));this.addAssign(k);var q=new AssignExpr("HHV1",new HhvExpr(new HighExpr(),o));
this.addAssign(q);var j=new AssignExpr("LLV",new LlvExpr(new LowExpr(),l));this.addAssign(j);var m=new AssignExpr("LLV1",new LlvExpr(new LowExpr(),o));this.addAssign(m);var n=new OutputExpr("WR1",new MulExpr(new DivExpr(new SubExpr(k,new CloseExpr()),new SubExpr(k,j)),new ConstExpr(100)));this.addOutput(n);var p=new OutputExpr("WR2",new MulExpr(new DivExpr(new SubExpr(q,new CloseExpr()),new SubExpr(q,m)),new ConstExpr(100)));this.addOutput(p)};WRIndicator.prototype.getName=function(){return"WR"};var SARIndicator=create_class(Indicator);SARIndicator.prototype.__construct=function(){SARIndicator.__super.__construct.call(this);var h=new ConstExpr(4);var f=new ConstExpr(2);var g=new ConstExpr(2);var i=new ConstExpr(20);this.addOutput(new OutputExpr("SAR",new SarExpr(h,f,g,i),OutputStyle.SARPoint))};SARIndicator.prototype.getName=function(){return"SAR"};var KDJIndicator=create_class(Indicator);KDJIndicator.prototype.__construct=function(){KDJIndicator.__super.__construct.call(this);var n=new ParameterExpr("N",2,90,9);var q=new ParameterExpr("M1",2,30,3);var r=new ParameterExpr("M2",2,30,3);this.addParameter(n);this.addParameter(q);this.addParameter(r);var k=new AssignExpr("HHV",new HhvExpr(new HighExpr(),n));this.addAssign(k);var o=new AssignExpr("LLV",new LlvExpr(new LowExpr(),n));this.addAssign(o);var p=new AssignExpr("RSV",new MulExpr(new DivExpr(new SubExpr(new CloseExpr(),o),new SubExpr(k,o)),new ConstExpr(100)));this.addAssign(p);var m=new OutputExpr("K",new SmaExpr(p,q,new ConstExpr(1)));this.addOutput(m);var s=new OutputExpr("D",new SmaExpr(m,r,new ConstExpr(1)));this.addOutput(s);var l=new OutputExpr("J",new SubExpr(new MulExpr(m,new ConstExpr(3)),new MulExpr(s,new ConstExpr(2))));this.addOutput(l)};KDJIndicator.prototype.getName=function(){return"KDJ"};var ROCIndicator=create_class(Indicator);ROCIndicator.prototype.__construct=function(){ROCIndicator.__super.__construct.call(this);var j=new ParameterExpr("N",2,120,12);var i=new ParameterExpr("M",2,60,6);this.addParameter(j);this.addParameter(i);var h=new AssignExpr("REF_CLOSE_N",new RefExpr(new CloseExpr(),j));this.addAssign(h);var g=new OutputExpr("ROC",new MulExpr(new DivExpr(new SubExpr(new CloseExpr(),h),h),new ConstExpr(100)));this.addOutput(g);var k=new OutputExpr("MAROC",new MaExpr(g,i));this.addOutput(k)};ROCIndicator.prototype.getName=function(){return"ROC"};var MTMIndicator=create_class(Indicator);MTMIndicator.prototype.__construct=function(){MTMIndicator.__super.__construct.call(this);var i=new ParameterExpr("N",2,120,12);var h=new ParameterExpr("M",2,60,6);this.addParameter(i);this.addParameter(h);var f=new OutputExpr("MTM",new SubExpr(new CloseExpr(),new RefExpr(new CloseExpr(),i)));this.addOutput(f);var g=new OutputExpr("MTMMA",new MaExpr(f,h));this.addOutput(g)};MTMIndicator.prototype.getName=function(){return"MTM"};var BOLLIndicator=create_class(Indicator);BOLLIndicator.prototype.__construct=function(){BOLLIndicator.__super.__construct.call(this);var i=new ParameterExpr("N",2,120,20);this.addParameter(i);var j=new AssignExpr("STD_CLOSE_N",new StdExpr(new CloseExpr(),i));this.addAssign(j);var h=new OutputExpr("BOLL",new MaExpr(new CloseExpr(),i));this.addOutput(h);var g=new OutputExpr("UB",new AddExpr(h,new MulExpr(new ConstExpr(2),j)));this.addOutput(g);var k=new OutputExpr("LB",new SubExpr(h,new MulExpr(new ConstExpr(2),j)));this.addOutput(k)};BOLLIndicator.prototype.getName=function(){return"BOLL"};var PSYIndicator=create_class(Indicator);PSYIndicator.prototype.__construct=function(){PSYIndicator.__super.__construct.call(this);var i=new ParameterExpr("N",2,100,12);var h=new ParameterExpr("M",2,100,6);this.addParameter(i);this.addParameter(h);var f=new OutputExpr("PSY",new MulExpr(new DivExpr(new CountExpr(new GtExpr(new CloseExpr(),new RefExpr(new CloseExpr(),new ConstExpr(1))),i),i),new ConstExpr(100)));this.addOutput(f);var g=new OutputExpr("PSYMA",new MaExpr(f,h));this.addOutput(g)};PSYIndicator.prototype.getName=function(){return"PSY"};var STOCHRSIIndicator=create_class(Indicator);STOCHRSIIndicator.prototype.__construct=function(){STOCHRSIIndicator.__super.__construct.call(this);var n=new ParameterExpr("N",3,100,14);var l=new ParameterExpr("M",3,100,14);var k=new ParameterExpr("P1",2,50,3);var m=new ParameterExpr("P2",2,50,3);this.addParameter(n);this.addParameter(l);this.addParameter(k);this.addParameter(m);var o=new AssignExpr("LC",new RefExpr(new CloseExpr(),new ConstExpr(1)));this.addAssign(o);var p=new AssignExpr("CLOSE_LC",new SubExpr(new CloseExpr(),o));this.addAssign(p);var q=new AssignExpr("RSI",new MulExpr(new DivExpr(new SmaExpr(new MaxExpr(p,new ConstExpr(0)),n,new ConstExpr(1)),new SmaExpr(new AbsExpr(p),n,new ConstExpr(1))),new ConstExpr(100)));this.addAssign(q);var j=new OutputExpr("STOCHRSI",new MulExpr(new DivExpr(new MaExpr(new SubExpr(q,new LlvExpr(q,l)),k),new MaExpr(new SubExpr(new HhvExpr(q,l),new LlvExpr(q,l)),k)),new ConstExpr(100)));this.addOutput(j);this.addOutput(new RangeOutputExpr("MA",new MaExpr(j,m)))
};STOCHRSIIndicator.prototype.getName=function(){return"StochRSI"};var Chart=create_class();Chart.strPeriod={"zh-cn":{"line":"(分时)","1min":"(1分钟)","5min":"(5分钟)","15min":"(15分钟)","30min":"(30分钟)","1hour":"(1小时)","1day":"(日线)","1week":"(周线)","3min":"(3分钟)","2hour":"(2小时)","4hour":"(4小时)","6hour":"(6小时)","12hour":"(12小时)","3day":"(3天)"},"en-us":{"line":"(Line)","1min":"(1m)","5min":"(5m)","15min":"(15m)","30min":"(30m)","1hour":"(1h)","1day":"(1d)","1week":"(1w)","3min":"(3m)","2hour":"(2h)","4hour":"(4h)","6hour":"(6h)","12hour":"(12h)","3day":"(3d)"},"zh-tw":{"line":"(分時)","1min":"(1分鐘)","5min":"(5分鐘)","15min":"(15分鐘)","30min":"(30分鐘)","1hour":"(1小時)","1day":"(日線)","1week":"(周線)","3min":"(3分鐘)","2hour":"(2小時)","4hour":"(4小時)","6hour":"(6小時)","12hour":"(12小時)","3day":"(3天)"}};Chart.prototype.__construct=function(){this._data=null;this._charStyle="CandleStick";this._depthData={array:null,asks_count:0,bids_count:0,asks_si:0,asks_ei:0,bids_si:0,bids_ei:0};this._range=KlineIns.range;this._symbol=KlineIns.symbol};Chart.prototype.setTitle=function(){var c=ChartManager.getInstance().getLanguage();var d=KlineIns.symbolName;d+=" ";d+=this.strIsLine?Chart.strPeriod[c]["line"]:Chart.strPeriod[c][this._range];d+=(this._contract_unit+"/"+this._money_type).toUpperCase();ChartManager.getInstance().setTitle("frame0.k0",d)};Chart.prototype.setSymbol=function(b){this._symbol=b;this.updateDataAndDisplay()};Chart.prototype.updateDataAndDisplay=function(){KlineIns.symbol=this._symbol;KlineIns.range=this._range;ChartManager.getInstance().setCurrentDataSource("frame0.k0",this._symbol+"."+this._range);ChartManager.getInstance().setNormalMode();var b=KlineIns.chartMgr.getDataSource("frame0.k0").getLastDate();$(".symbol-title>a").text(KlineIns.symbolName);if(b==-1){KlineIns.requestParam=setHttpRequestParam(KlineIns.symbol,KlineIns.range,KlineIns.limit,null);RequestData(true)}else{KlineIns.requestParam=setHttpRequestParam(KlineIns.symbol,KlineIns.range,null,b.toString());RequestData()}ChartManager.getInstance().redraw("All",false)};Chart.prototype.setCurrentContractUnit=function(b){this._contract_unit=b;this.updateDataAndDisplay()};Chart.prototype.setCurrentMoneyType=function(b){this._money_type=b;this.updateDataAndDisplay()};Chart.prototype.setCurrentPeriod=function(b){this._range=KlineIns.periodMap[b];this.updateDataAndDisplay();KlineIns.onRangeChange(this._range)};Chart.prototype.updateDataSource=function(b){this._data=b;ChartManager.getInstance().updateData("frame0.k0",this._data)};Chart.prototype.updateDepth=function(h){if(h==null){this._depthData.array=[];ChartManager.getInstance().redraw("All",false);return}if(!h.asks||!h.bids||h.asks==""||h.bids==""){return}var f=this._depthData;f.array=[];for(var g=0;g<h.asks.length;g++){var i={};i.rate=h.asks[g][0];i.amount=h.asks[g][1];f.array.push(i)}for(var g=0;g<h.bids.length;g++){var i={};i.rate=h.bids[g][0];i.amount=h.bids[g][1];f.array.push(i)}f.asks_count=h.asks.length;f.bids_count=h.bids.length;f.asks_si=f.asks_count-1;f.asks_ei=0;f.bids_si=f.asks_count;f.bids_ei=f.asks_count+f.bids_count-1;for(var g=f.asks_si;g>=f.asks_ei;g--){if(g==f.asks_si){f.array[g].amounts=f.array[g].amount}else{f.array[g].amounts=f.array[g+1].amounts+f.array[g].amount}}for(var g=f.bids_si;g<=f.bids_ei;g++){if(g==f.bids_si){f.array[g].amounts=f.array[g].amount}else{f.array[g].amounts=f.array[g-1].amounts+f.array[g].amount}}ChartManager.getInstance().redraw("All",false)};Chart.prototype.setMainIndicator=function(b){this._mainIndicator=b;if(b=="NONE"){ChartManager.getInstance().removeMainIndicator("frame0.k0")}else{ChartManager.getInstance().setMainIndicator("frame0.k0",b)}ChartManager.getInstance().redraw("All",true)};Chart.prototype.setIndicator=function(d,f){if(f=="NONE"){var d=2;if(Template.displayVolume==false){d=1}var g=ChartManager.getInstance().getIndicatorAreaName("frame0.k0",d);if(g!=""){ChartManager.getInstance().removeIndicator(g)}}else{var d=2;if(Template.displayVolume==false){d=1}var g=ChartManager.getInstance().getIndicatorAreaName("frame0.k0",d);if(g==""){Template.createIndicatorChartComps("frame0.k0",f)}else{ChartManager.getInstance().setIndicator(g,f)}}ChartManager.getInstance().redraw("All",true)};Chart.prototype.addIndicator=function(b){ChartManager.getInstance().addIndicator(b);ChartManager.getInstance().redraw("All",true)};Chart.prototype.removeIndicator=function(d){var c=ChartManager.getInstance().getIndicatorAreaName(2);ChartManager.getInstance().removeIndicator(c);ChartManager.getInstance().redraw("All",true)};var CName=create_class();CName.prototype.__construct=function(g){this._names=[];this._comps=[];if(g instanceof CName){this._names=g._names;this._comps=g._comps}else{var h=g.split(".");var i=h.length-1;if(i>0){this._comps=h;this._names.push(h[0]);for(var f=1;f<=i;f++){this._names.push(this._names[f-1]+"."+h[f])}}else{this._comps.push(g);this._names.push(g)}}};CName.prototype.getCompAt=function(b){if(b>=0&&b<this._comps.length){return this._comps[b]}return""};CName.prototype.getName=function(b){if(b<0){if(this._names.length>0){return this._names[this._names.length-1]
}}else{if(b<this._names.length){return this._names[b]}}return""};var NamedObject=create_class();NamedObject.prototype.__construct=function(b){this._name=b;this._nameObj=new CName(b)};NamedObject.prototype.getFrameName=function(){return this._nameObj.getName(0)};NamedObject.prototype.getDataSourceName=function(){return this._nameObj.getName(1)};NamedObject.prototype.getAreaName=function(){return this._nameObj.getName(2)};NamedObject.prototype.getName=function(){return this._nameObj.getName(-1)};NamedObject.prototype.getNameObject=function(){return this._nameObj};var ChartArea=create_class(NamedObject);ChartArea.prototype.__construct=function(b){ChartArea.__super.__construct.call(this,b);this._left=0;this._top=0;this._right=0;this._bottom=0;this._changed=false;this._highlighted=false;this._pressed=false;this._selected=false;this.Measuring=new MEvent()};ChartArea.DockStyle={Left:0,Top:1,Right:2,Bottom:3,Fill:4};ChartArea.prototype.getDockStyle=function(){return this._dockStyle};ChartArea.prototype.setDockStyle=function(b){this._dockStyle=b};ChartArea.prototype.getLeft=function(){return this._left};ChartArea.prototype.getTop=function(){return this._top};ChartArea.prototype.setTop=function(b){if(this._top!=b){this._top=b;this._changed=true}};ChartArea.prototype.getRight=function(){return this._right};ChartArea.prototype.getBottom=function(){return this._bottom};ChartArea.prototype.setBottom=function(b){if(this._bottom!=b){this._bottom=b;this._changed=true}};ChartArea.prototype.getCenter=function(){return(this._left+this._right)>>1};ChartArea.prototype.getMiddle=function(){return(this._top+this._bottom)>>1};ChartArea.prototype.getWidth=function(){return this._right-this._left};ChartArea.prototype.getHeight=function(){return this._bottom-this._top};ChartArea.prototype.getRect=function(){return{X:this._left,Y:this._top,Width:this._right-this._left,Height:this._bottom-this._top}};ChartArea.prototype.contains=function(d,c){if(d>=this._left&&d<this._right){if(c>=this._top&&c<this._bottom){return[this]}}return null};ChartArea.prototype.getMeasuredWidth=function(){return this._measuredWidth};ChartArea.prototype.getMeasuredHeight=function(){return this._measuredHeight};ChartArea.prototype.setMeasuredDimension=function(c,d){this._measuredWidth=c;this._measuredHeight=d};ChartArea.prototype.measure=function(d,g,f){this._measuredWidth=0;this._measuredHeight=0;this.Measuring.raise(this,{Width:g,Height:f});if(this._measuredWidth==0&&this._measuredHeight==0){this.setMeasuredDimension(g,f)}};ChartArea.prototype.layout=function(i,j,k,h,g){i<<=0;if(this._left!=i){this._left=i;this._changed=true}j<<=0;if(this._top!=j){this._top=j;this._changed=true}k<<=0;if(this._right!=k){this._right=k;this._changed=true}h<<=0;if(this._bottom!=h){this._bottom=h;this._changed=true}if(g){this._changed=true}};ChartArea.prototype.isChanged=function(){return this._changed};ChartArea.prototype.setChanged=function(b){this._changed=b};ChartArea.prototype.isHighlighted=function(){return this._highlighted};ChartArea.prototype.getHighlightedArea=function(){return this._highlighted?this:null};ChartArea.prototype.highlight=function(b){this._highlighted=(this==b);return this._highlighted?this:null};ChartArea.prototype.isPressed=function(){return this._pressed};ChartArea.prototype.setPressed=function(b){this._pressed=b};ChartArea.prototype.isSelected=function(){return this._selected};ChartArea.prototype.getSelectedArea=function(){return this._selected?this:null};ChartArea.prototype.select=function(b){this._selected=(this==b);return this._selected?this:null};ChartArea.prototype.onMouseMove=function(d,c){return null};ChartArea.prototype.onMouseLeave=function(d,c){};ChartArea.prototype.onMouseDown=function(d,c){return null};ChartArea.prototype.onMouseUp=function(d,c){return null};var MainArea=create_class(ChartArea);MainArea.prototype.__construct=function(b){MainArea.__super.__construct.call(this,b);this._dragStarted=false;this._oldX=0;this._oldY=0;this._passMoveEventToToolManager=true};MainArea.prototype.onMouseMove=function(f,g){var d=ChartManager.getInstance();if(d._capturingMouseArea==this){if(this._dragStarted==false){if(Math.abs(this._oldX-f)>1||Math.abs(this._oldY-g)>1){this._dragStarted=true}}}if(this._dragStarted){d.hideCursor();if(d.onToolMouseDrag(this.getFrameName(),f,g)){return this}d.getTimeline(this.getDataSourceName()).move(f-this._oldX);return this}if(this._passMoveEventToToolManager&&d.onToolMouseMove(this.getFrameName(),f,g)){d.hideCursor();return this}switch(d._drawingTool){case ChartManager.DrawingTool.Cursor:d.showCursor();break;case ChartManager.DrawingTool.CrossCursor:if(d.showCrossCursor(this,f,g)){d.hideCursor()}else{d.showCursor()}break;default:d.hideCursor();break}return this};MainArea.prototype.onMouseLeave=function(d,c){this._dragStarted=false;this._passMoveEventToToolManager=true};MainArea.prototype.onMouseDown=function(f,g){var d=ChartManager.getInstance();d.getTimeline(this.getDataSourceName()).startMove();this._oldX=f;this._oldY=g;this._dragStarted=false;
if(d.onToolMouseDown(this.getFrameName(),f,g)){this._passMoveEventToToolManager=false}return this};MainArea.prototype.onMouseUp=function(g,h){var i=ChartManager.getInstance();var f=null;if(this._dragStarted){this._dragStarted=false;f=this}if(i.onToolMouseUp(this.getFrameName(),g,h)){f=this}this._passMoveEventToToolManager=true;return f};var IndicatorArea=create_class(ChartArea);IndicatorArea.prototype.__construct=function(b){IndicatorArea.__super.__construct.call(this,b);this._dragStarted=false;this._oldX=0;this._oldY=0};IndicatorArea.prototype.onMouseMove=function(f,g){var d=ChartManager.getInstance();if(d._capturingMouseArea==this){if(this._dragStarted==false){if(this._oldX!=f||this._oldY!=g){this._dragStarted=true}}}if(this._dragStarted){d.hideCursor();d.getTimeline(this.getDataSourceName()).move(f-this._oldX);return this}switch(d._drawingTool){case ChartManager.DrawingTool.CrossCursor:if(d.showCrossCursor(this,f,g)){d.hideCursor()}else{d.showCursor()}break;default:d.showCursor();break}return this};IndicatorArea.prototype.onMouseLeave=function(d,c){this._dragStarted=false};IndicatorArea.prototype.onMouseDown=function(f,g){var d=ChartManager.getInstance();d.getTimeline(this.getDataSourceName()).startMove();this._oldX=f;this._oldY=g;this._dragStarted=false;return this};IndicatorArea.prototype.onMouseUp=function(d,c){if(this._dragStarted){this._dragStarted=false;return this}return null};var MainRangeArea=create_class(ChartArea);MainRangeArea.prototype.__construct=function(b){MainRangeArea.__super.__construct.call(this,b)};MainRangeArea.prototype.onMouseMove=function(d,c){ChartManager.getInstance().showCursor();return this};var IndicatorRangeArea=create_class(ChartArea);IndicatorRangeArea.prototype.__construct=function(b){IndicatorRangeArea.__super.__construct.call(this,b)};IndicatorRangeArea.prototype.onMouseMove=function(d,c){ChartManager.getInstance().showCursor();return this};var TimelineArea=create_class(ChartArea);TimelineArea.prototype.__construct=function(b){TimelineArea.__super.__construct.call(this,b)};TimelineArea.prototype.onMouseMove=function(d,c){ChartManager.getInstance().showCursor();return this};var ChartAreaGroup=create_class(ChartArea);ChartAreaGroup.prototype.__construct=function(b){ChartAreaGroup.__super.__construct.call(this,b);this._areas=[];this._highlightedArea=null;this._selectedArea=null};ChartAreaGroup.prototype.contains=function(a,i){var l;var m,j,k=this._areas.length;for(j=0;j<k;j++){m=this._areas[j];l=m.contains(a,i);if(l!=null){l.push(this);return l}}return ChartAreaGroup.__super.contains(a,i)};ChartAreaGroup.prototype.getAreaCount=function(){return this._areas.length};ChartAreaGroup.prototype.getAreaAt=function(b){if(b<0||b>=this._areas.length){return null}return this._areas[b]};ChartAreaGroup.prototype.addArea=function(b){this._areas.push(b)};ChartAreaGroup.prototype.removeArea=function(g){var d,f=this._areas.length;for(d=0;d<f;d++){if(g==this._areas[d]){this._areas.splice(d);this.setChanged(true);break}}};ChartAreaGroup.prototype.getGridColor=function(){return this._gridColor};ChartAreaGroup.prototype.setGridColor=function(b){this._gridColor=b};ChartAreaGroup.prototype.getHighlightedArea=function(){if(this._highlightedArea!=null){return this._highlightedArea.getHighlightedArea()}return null};ChartAreaGroup.prototype.highlight=function(i){this._highlightedArea=null;var h,f,g=this._areas.length;for(f=0;f<g;f++){h=this._areas[f].highlight(i);if(h!=null){this._highlightedArea=h;return this}}return null};ChartAreaGroup.prototype.getSelectedArea=function(){if(this._selectedArea!=null){return this._selectedArea.getSelectedArea()}return null};ChartAreaGroup.prototype.select=function(i){this._selectedArea=null;var h,f,g=this._areas.length;for(f=0;f<g;f++){h=this._areas[f].select(i);if(h!=null){this._selectedArea=h;return this}}return null};ChartAreaGroup.prototype.onMouseLeave=function(g,h){var i,f=this._areas.length;for(i=0;i<f;i++){this._areas[i].onMouseLeave(g,h)}};ChartAreaGroup.prototype.onMouseUp=function(a,h){var k,i,j=this._areas.length;for(i=0;i<j;i++){k=this._areas[i].onMouseUp(a,h);if(k!=null){return k}}return null};var TableLayout=create_class(ChartAreaGroup);TableLayout.prototype.__construct=function(b){TableLayout.__super.__construct.call(this,b);this._nextRowId=0;this._focusedRowIndex=-1};TableLayout.prototype.getNextRowId=function(){return this._nextRowId++};TableLayout.prototype.measure=function(ao,R,ae){this.setMeasuredDimension(R,ae);var ai,ab=0,M=0;var L,ag;var ad=[];var N,P=this._areas.length;for(N=0;N<P;N+=2){ai=this._areas[N].getHeight();if(ai==0){if(N==0){ag=(P+1)>>1;var T=(ag*2)+5;var al=((ae/T)*2)<<0;L=ae;for(N=ag-1;N>0;N--){ad.unshift(al);L-=al}ad.unshift(L);break}else{if(N==2){ai=ab/3}else{ai=ab}}}M+=ai;ab=ai;ad.push(ai)}if(M>0){var i=ae/M;ag=(P+1)>>1;L=ae;for(N=ag-1;N>0;N--){ad[N]*=i;L-=ad[N]}ad[0]=L}var O=8;var ac=64;var an=Math.min(240,R>>1);var aj=ac;var n=ChartManager.getInstance();var ak=n.getTimeline(this.getDataSourceName());if(ak.getFirstIndex()>=0){var af=[];
for(aj=ac;aj<an;aj+=O){af.push(ak.calcFirstIndex(ak.calcColumnCount(R-aj)))}var h=ak.getLastIndex();var Z=[".main",".secondary"];var V=new Array(af.length);var X,ah;for(X=0,ah=0,aj=ac;X<this._areas.length&&ah<af.length;X+=2){var aa=this._areas[X];var Q=n.getPlotter(aa.getName()+"Range.main");for(var Y in Z){var W=n.getDataProvider(aa.getName()+Z[Y]);if(W==undefined){continue}W.calcRange(af,h,V,null);while(ah<af.length){var S=Q.getRequiredWidth(ao,V[ah].min);var U=Q.getRequiredWidth(ao,V[ah].max);if(Math.max(S,U)<aj){break}ah++;aj+=O}}}}for(N=1;N<this._areas.length;N+=2){this._areas[N].measure(ao,aj,ad[N>>1])}var am=R-aj;for(N=0;N<this._areas.length;N+=2){this._areas[N].measure(ao,am,ad[N>>1])}};TableLayout.prototype.layout=function(r,o,i,w,u){TableLayout.__super.layout.call(this,r,o,i,w,u);if(this._areas.length<1){return}var t;var v=r+this._areas[0].getMeasuredWidth();var b=o,p;if(!u){u=this.isChanged()}var q,s=this._areas.length;for(q=0;q<s;q++){t=this._areas[q];p=b+t.getMeasuredHeight();t.layout(r,b,v,p,u);q++;t=this._areas[q];t.layout(v,b,this.getRight(),p,u);b=p}this.setChanged(false)};TableLayout.prototype.drawGrid=function(k){if(this._areas.length<1){return}var j=ChartManager.getInstance();var i=j.getTheme(this.getFrameName());k.fillStyle=i.getColor(Theme.Color.Grid1);k.fillRect(this._areas[0].getRight(),this.getTop(),1,this.getHeight());var g,h=this._areas.length-2;for(g=0;g<h;g+=2){k.fillRect(this.getLeft(),this._areas[g].getBottom(),this.getWidth(),1)}if(!j.getCaptureMouseWheelDirectly()){for(g=0,h+=2;g<h;g+=2){if(this._areas[g].isSelected()){k.strokeStyle=i.getColor(Theme.Color.Indicator1);k.strokeRect(this.getLeft()+0.5,this.getTop()+0.5,this.getWidth()-1,this.getHeight()-1);break}}}};TableLayout.prototype.highlight=function(i){this._highlightedArea=null;var h,f,g=this._areas.length;for(f=0;f<g;f++){h=this._areas[f];if(h==i){f&=~1;h=this._areas[f];h.highlight(h);this._highlightedArea=h;f++;h=this._areas[f];h.highlight(null);h.highlight(h)}else{h.highlight(null)}}return this._highlightedArea!=null?this:null};TableLayout.prototype.select=function(i){this._selectedArea=null;var h,f,g=this._areas.length;for(f=0;f<g;f++){h=this._areas[f];if(h==i){f&=~1;h=this._areas[f];h.select(h);this._selectedArea=h;f++;h=this._areas[f];h.select(h)}else{h.select(null)}}return this._selectedArea!=null?this:null};TableLayout.prototype.onMouseMove=function(d,i){if(this._focusedRowIndex>=0){var b=this._areas[this._focusedRowIndex];var s=this._areas[this._focusedRowIndex+2];var r=i-this._oldY;if(r==0){return this}var p=this._oldUpperBottom+r;var q=this._oldLowerTop+r;if(p-b.getTop()>=60&&s.getBottom()-q>=60){b.setBottom(p);s.setTop(q)}return this}var t,u=this._areas.length-2;for(t=0;t<u;t+=2){var o=this._areas[t].getBottom();if(i>=o-4&&i<o+4){ChartManager.getInstance().showCursor("n-resize");return this}}return null};TableLayout.prototype.onMouseLeave=function(d,c){this._focusedRowIndex=-1};TableLayout.prototype.onMouseDown=function(k,h){var i,j=this._areas.length-2;for(i=0;i<j;i+=2){var b=this._areas[i].getBottom();if(h>=b-4&&h<b+4){this._focusedRowIndex=i;this._oldY=h;this._oldUpperBottom=b;this._oldLowerTop=this._areas[i+2].getTop();return this}}return null};TableLayout.prototype.onMouseUp=function(g,i){if(this._focusedRowIndex>=0){this._focusedRowIndex=-1;var j,k=this._areas.length;var h=[];for(j=0;j<k;j+=2){h.push(this._areas[j].getHeight())}ChartSettings.get().charts.areaHeight=h;ChartSettings.save()}return this};var DockableLayout=create_class(ChartAreaGroup);DockableLayout.prototype.__construct=function(b){DockableLayout.__super.__construct.call(this,b)};DockableLayout.prototype.measure=function(k,j,h){DockableLayout.__super.measure.call(this,k,j,h);j=this.getMeasuredWidth();h=this.getMeasuredHeight();for(var g in this._areas){var i=this._areas[g];i.measure(k,j,h);switch(i.getDockStyle()){case ChartArea.DockStyle.left:case ChartArea.DockStyle.Right:j-=i.getMeasuredWidth();break;case ChartArea.DockStyle.Top:case ChartArea.DockStyle.Bottom:h-=i.getMeasuredHeight();break;case ChartArea.DockStyle.Fill:j=0;h=0;break}}};DockableLayout.prototype.layout=function(p,m,h,s,r){DockableLayout.__super.layout.call(this,p,m,h,s,r);p=this.getLeft();m=this.getTop();h=this.getRight();s=this.getBottom();var i,n;if(!r){r=this.isChanged()}for(var o in this._areas){var q=this._areas[o];switch(q.getDockStyle()){case ChartArea.DockStyle.left:i=q.getMeasuredWidth();q.layout(p,m,p+i,s,r);p+=i;break;case ChartArea.DockStyle.Top:n=q.getMeasuredHeight();q.layout(p,m,h,m+n,r);m+=n;break;case ChartArea.DockStyle.Right:i=q.getMeasuredWidth();q.layout(h-i,m,h,s,r);h-=i;break;case ChartArea.DockStyle.Bottom:n=q.getMeasuredHeight();q.layout(p,s-n,h,s,r);s-=n;break;case ChartArea.DockStyle.Fill:q.layout(p,m,h,s,r);p=h;m=s;break}}this.setChanged(false)};DockableLayout.prototype.drawGrid=function(q){var i=ChartManager.getInstance();var o=i.getTheme(this.getFrameName());var p=this.getLeft();var m=this.getTop();var l=this.getRight();var s=this.getBottom();
q.fillStyle=o.getColor(this._gridColor);for(var n in this._areas){var r=this._areas[n];switch(r.getDockStyle()){case ChartArea.DockStyle.Left:q.fillRect(r.getRight(),m,1,s-m);p+=r.getWidth();break;case ChartArea.DockStyle.Top:q.fillRect(p,r.getBottom(),l-p,1);m+=r.getHeight();break;case ChartArea.DockStyle.Right:q.fillRect(r.getLeft(),m,1,s-m);l-=r.getWidth();break;case ChartArea.DockStyle.Bottom:q.fillRect(p,r.getTop(),l-p,1);s-=r.getHeight();break}}};var ChartManager=create_class();ChartManager.DrawingTool={Cursor:0,CrossCursor:1,DrawLines:2,DrawFibRetrace:3,DrawFibFans:4,SegLine:5,StraightLine:6,ArrowLine:7,RayLine:8,HoriStraightLine:9,HoriRayLine:10,HoriSegLine:11,VertiStraightLine:12,PriceLine:13,BiParallelLine:14,BiParallelRayLine:15,TriParallelLine:16,BandLine:17};ChartManager._instance=null;ChartManager.getInstance=function(){if(ChartManager._instance==null){ChartManager._instance=new ChartManager()}return ChartManager._instance};ChartManager.prototype.__construct=function(){this._dataSources={};this._dataSourceCache={};this._dataProviders={};this._frames={};this._areas={};this._timelines={};this._ranges={};this._plotters={};this._themes={};this._titles={};this._frameMousePos={};this._dsChartStyle={};this._dragStarted=false;this._oldX=0;this._fakeIndicators={};this._captureMouseWheelDirectly=true;this._chart={};this._chart.defaultFrame=new Chart();this._drawingTool=ChartManager.DrawingTool["CrossCursor"];this._beforeDrawingTool=this._drawingTool;this._language="zh-cn";this._mainCanvas=null;this._overlayCanvas=null;this._mainContext=null;this._overlayContext=null};ChartManager.prototype.redraw=function(d,c){if(d==undefined||c){d="All"}if(d=="All"||d=="MainCanvas"){if(c){this.getFrame("frame0").setChanged(true)}this.layout(this._mainContext,"frame0",0,0,this._mainCanvas.width,this._mainCanvas.height);this.drawMain("frame0",this._mainContext)}if(d=="All"||d=="OverlayCanvas"){this._overlayContext.clearRect(0,0,this._overlayCanvas.width,this._overlayCanvas.height);this.drawOverlay("frame0",this._overlayContext)}};ChartManager.prototype.bindCanvas=function(c,d){if(c=="main"){this._mainCanvas=d;this._mainContext=d.getContext("2d")}else{if(c=="overlay"){this._overlayCanvas=d;this._overlayContext=d.getContext("2d");if(this._captureMouseWheelDirectly){$(this._overlayCanvas).bind("mousewheel",mouseWheel)}}}};ChartManager.prototype.getCaptureMouseWheelDirectly=function(){return this._captureMouseWheelDirectly};ChartManager.prototype.setCaptureMouseWheelDirectly=function(b){this._captureMouseWheelDirectly=b;if(b){$(this._overlayCanvas).bind("mousewheel",mouseWheel)}else{$(this._overlayCanvas).unbind("mousewheel")}};ChartManager.prototype.getChart=function(b){return this._chart["defaultFrame"]};ChartManager.prototype.init=function(){delete this._ranges["frame0.k0.indic1"];delete this._ranges["frame0.k0.indic1Range"];delete this._areas["frame0.k0.indic1"];delete this._areas["frame0.k0.indic1Range"];DefaultTemplate.loadTemplate("frame0.k0","");this.redraw("All",true)};ChartManager.prototype.setCurrentDrawingTool=function(b){this._drawingTool=ChartManager.DrawingTool[b];this.setRunningMode(this._drawingTool)};ChartManager.prototype.getLanguage=function(){return this._language};ChartManager.prototype.setLanguage=function(b){this._language=b};ChartManager.prototype.setThemeName=function(f,d){if(d==undefined){d="Dark"}var g;switch(d){case"Light":g=new LightTheme();break;default:d="Dark";g=new DarkTheme();break}this._themeName=d;this.setTheme(f,g);this.getFrame(f).setChanged(true)};ChartManager.prototype.getChartStyle=function(c){var d=this._dsChartStyle[c];if(d==undefined){return"CandleStick"}return d};ChartManager.prototype.setChartStyle=function(m,o){if(this._dsChartStyle[m]==o){return}var k=m+".main";var i=k+".main";var j=k+".main";var l,n;switch(o){case"CandleStick":case"CandleStickHLC":case"OHLC":l=this.getDataProvider(i);if(l==undefined||!is_instance(l,MainDataProvider)){l=new MainDataProvider(i);this.setDataProvider(i,l);l.updateData()}this.setMainIndicator(m,ChartSettings.get().charts.mIndic);switch(o){case"CandleStick":n=new CandlestickPlotter(j);break;case"CandleStickHLC":n=new CandlestickHLCPlotter(j);break;case"OHLC":n=new OHLCPlotter(j);break}this.setPlotter(j,n);n=new MinMaxPlotter(k+".decoration");this.setPlotter(n.getName(),n);break;case"Line":l=new IndicatorDataProvider(i);this.setDataProvider(l.getName(),l);l.setIndicator(new HLCIndicator());this.removeMainIndicator(m);n=new IndicatorPlotter(j);this.setPlotter(j,n);this.removePlotter(k+".decoration");break}this.getArea(n.getAreaName()).setChanged(true);this._dsChartStyle[m]=o};ChartManager.prototype.setNormalMode=function(){this._drawingTool=this._beforeDrawingTool;$(".chart_dropdown_data").removeClass("chart_dropdown-hover");$("#chart_toolpanel .chart_toolpanel_button").removeClass("selected");$("#chart_CrossCursor").parent().addClass("selected");if(this._drawingTool==ChartManager.DrawingTool.Cursor){this.showCursor();$("#mode a").removeClass("selected");
$("#chart_toolpanel .chart_toolpanel_button").removeClass("selected");$("#chart_Cursor").parent().addClass("selected")}else{this.hideCursor()}};ChartManager.prototype.setRunningMode=function(d){var g=this.getDataSource("frame0.k0");var f=g.getCurrentToolObject();if(f!=null&&f.state!=CToolObject.state.AfterDraw){g.delToolObject()}if(g.getToolObjectCount()>10){this.setNormalMode();return}this._drawingTool=d;if(d==ChartManager.DrawingTool.Cursor){this.showCursor()}else{}switch(d){case ChartManager.DrawingTool.Cursor:this._beforeDrawingTool=d;break;case ChartManager.DrawingTool.ArrowLine:g.addToolObject(new CArrowLineObject("frame0.k0"));break;case ChartManager.DrawingTool.BandLine:g.addToolObject(new CBandLineObject("frame0.k0"));break;case ChartManager.DrawingTool.BiParallelLine:g.addToolObject(new CBiParallelLineObject("frame0.k0"));break;case ChartManager.DrawingTool.BiParallelRayLine:g.addToolObject(new CBiParallelRayLineObject("frame0.k0"));break;case ChartManager.DrawingTool.CrossCursor:this._beforeDrawingTool=d;break;case ChartManager.DrawingTool.DrawFibFans:g.addToolObject(new CFibFansObject("frame0.k0"));break;case ChartManager.DrawingTool.DrawFibRetrace:g.addToolObject(new CFibRetraceObject("frame0.k0"));break;case ChartManager.DrawingTool.DrawLines:g.addToolObject(new CStraightLineObject("frame0.k0"));break;case ChartManager.DrawingTool.HoriRayLine:g.addToolObject(new CHoriRayLineObject("frame0.k0"));break;case ChartManager.DrawingTool.HoriSegLine:g.addToolObject(new CHoriSegLineObject("frame0.k0"));break;case ChartManager.DrawingTool.HoriStraightLine:g.addToolObject(new CHoriStraightLineObject("frame0.k0"));break;case ChartManager.DrawingTool.PriceLine:g.addToolObject(new CPriceLineObject("frame0.k0"));break;case ChartManager.DrawingTool.RayLine:g.addToolObject(new CRayLineObject("frame0.k0"));break;case ChartManager.DrawingTool.SegLine:g.addToolObject(new CSegLineObject("frame0.k0"));break;case ChartManager.DrawingTool.StraightLine:g.addToolObject(new CStraightLineObject("frame0.k0"));break;case ChartManager.DrawingTool.TriParallelLine:g.addToolObject(new CTriParallelLineObject("frame0.k0"));break;case ChartManager.DrawingTool.VertiStraightLine:g.addToolObject(new CVertiStraightLineObject("frame0.k0"));break}};ChartManager.prototype.getTitle=function(b){return this._titles[b]};ChartManager.prototype.setTitle=function(c,d){this._titles[c]=d};ChartManager.prototype.setCurrentDataSource=function(h,g){var f=this.getCachedDataSource(g);if(f!=null){this.setDataSource(h,f,true)}else{var i=this.getDataSource(h);if(i!=null){if(is_instance(i,MainDataSource)){f=new MainDataSource(g)}else{if(is_instance(i,CLiveOrderDataSource)){f=new CLiveOrderDataSource(g)}else{if(is_instance(i,CLiveTradeDataSource)){f=new CLiveTradeDataSource(g)}}}this.setDataSource(h,f,true);this.setCachedDataSource(g,f)}}};ChartManager.prototype.getDataSource=function(b){return this._dataSources[b]};ChartManager.prototype.setDataSource=function(f,d,g){this._dataSources[f]=d;if(g){this.updateData(f,null)}};ChartManager.prototype.getCachedDataSource=function(b){return this._dataSourceCache[b]};ChartManager.prototype.setCachedDataSource=function(d,c){this._dataSourceCache[d]=c};ChartManager.prototype.getDataProvider=function(b){return this._dataProviders[b]};ChartManager.prototype.setDataProvider=function(d,c){this._dataProviders[d]=c};ChartManager.prototype.removeDataProvider=function(b){delete this._dataProviders[b]};ChartManager.prototype.getFrame=function(b){return this._frames[b]};ChartManager.prototype.setFrame=function(d,c){this._frames[d]=c};ChartManager.prototype.removeFrame=function(b){delete this._frames[b]};ChartManager.prototype.getArea=function(b){return this._areas[b]};ChartManager.prototype.setArea=function(d,c){this._areas[d]=c};ChartManager.prototype.removeArea=function(b){delete this._areas[b]};ChartManager.prototype.getTimeline=function(b){return this._timelines[b]};ChartManager.prototype.setTimeline=function(d,c){this._timelines[d]=c};ChartManager.prototype.removeTimeline=function(b){delete this._timelines[b]};ChartManager.prototype.getRange=function(b){return this._ranges[b]};ChartManager.prototype.setRange=function(c,d){this._ranges[c]=d};ChartManager.prototype.removeRange=function(b){delete this._ranges[b]};ChartManager.prototype.getPlotter=function(b){return this._plotters[b]};ChartManager.prototype.setPlotter=function(d,c){this._plotters[d]=c};ChartManager.prototype.removePlotter=function(b){delete this._plotters[b]};ChartManager.prototype.getTheme=function(b){return this._themes[b]};ChartManager.prototype.setTheme=function(d,c){this._themes[d]=c};ChartManager.prototype.getFrameMousePos=function(c,d){if(this._frameMousePos[c]!=undefined){d.x=this._frameMousePos[c].x;d.y=this._frameMousePos[c].y}else{d.x=-1;d.y=-1}};ChartManager.prototype.setFrameMousePos=function(d,g,f){this._frameMousePos[d]={x:g,y:f}};ChartManager.prototype.drawArea=function(o,n,l){var k=n.getNameObject().getCompAt(2);if(k=="timeline"){if(n.getHeight()<20){return
}}else{if(n.getHeight()<30){return}}if(n.getWidth()<30){return}k=n.getName();var m;var i,j=l.length;for(i=0;i<j;i++){m=this._plotters[k+l[i]];if(m!=undefined){m.Draw(o)}}};ChartManager.prototype.drawAreaMain=function(g,f){var i=this._dataSources[f.getDataSourceName()];var h;if(i.getDataCount()<1){h=[".background"]}else{h=[".background",".grid",".main",".secondary"]}this.drawArea(g,f,h);f.setChanged(false)};ChartManager.prototype.drawAreaOverlay=function(g,f){var i=this._dataSources[f.getDataSourceName()];var h;if(i.getDataCount()<1){h=[".selection"]}else{h=[".decoration",".selection",".info",".tool"]}this.drawArea(g,f,h)};ChartManager.prototype.drawMain=function(i,m){var j=false;if(!j){for(var l in this._areas){if(this._areas[l].getFrameName()==i&&!is_instance(this._areas[l],ChartAreaGroup)){this.drawAreaMain(m,this._areas[l])}}}var k;for(var h in this._timelines){k=this._timelines[h];if(k.getFrameName()==i){k.setUpdated(false)}}for(var h in this._ranges){k=this._ranges[h];if(k.getFrameName()==i){k.setUpdated(false)}}for(var h in this._areas){k=this._areas[h];if(k.getFrameName()==i){k.setChanged(false)}}};ChartManager.prototype.drawOverlay=function(g,f){for(var h in this._areas){var i=this._areas[h];if(is_instance(i,ChartAreaGroup)){if(i.getFrameName()==g){i.drawGrid(f)}}}for(var h in this._areas){var i=this._areas[h];if(is_instance(i,ChartAreaGroup)==false){if(i.getFrameName()==g){this.drawAreaOverlay(f,i)}}}};ChartManager.prototype.updateData=function(u,o){var r=this.getDataSource(u);if(r==undefined){return}if(o!=null){if(!r.update(o)){return false}if(r.getUpdateMode()==DataSource.UpdateMode.DoNothing){return true}}else{r.setUpdateMode(DataSource.UpdateMode.Refresh)}var m=this.getTimeline(u);if(m!=undefined){m.update()}if(r.getDataCount()<1){return true}var i=[".main",".secondary"];var t,n;for(var s in this._areas){t=this._areas[s];if(is_instance(t,ChartAreaGroup)){continue}if(t.getDataSourceName()!=u){continue}n=t.getName();for(var p=0;p<i.length;p++){var q=this.getDataProvider(n+i[p]);if(q!=undefined){q.updateData()}}}return true};ChartManager.prototype.updateRange=function(u){var r=this.getDataSource(u);if(r.getDataCount()<1){return}var i=[".main",".secondary"];var t,n;for(var s in this._areas){t=this._areas[s];if(is_instance(t,ChartAreaGroup)){continue}if(t.getDataSourceName()!=u){continue}n=t.getName();for(var p=0;p<i.length;p++){var q=this.getDataProvider(n+i[p]);if(q!=undefined){q.updateRange()}}var m=this.getTimeline(u);if(m!=undefined&&m.getMaxItemCount()>0){var o=this.getRange(n);if(o!=undefined){o.update()}}}};ChartManager.prototype.layout=function(r,n,o,l,k,s){var q=this.getFrame(n);q.measure(r,k-o,s-l);q.layout(o,l,k,s);for(var p in this._timelines){var m=this._timelines[p];if(m.getFrameName()==n){m.onLayout()}}for(var p in this._dataSources){if(p.substring(0,n.length)==n){this.updateRange(p)}}};ChartManager.prototype.SelectRange=function(h,j){var m;for(var i in this._ranges){var k=this._ranges[i].getAreaName();var l=h.getName();if(k==l){this._ranges[i].selectAt(j)}else{this._ranges[i].unselect()}}};ChartManager.prototype.scale=function(f){if(this._highlightedFrame==null){return}var g=this._highlightedFrame.getHighlightedArea();if(this.getRange(g.getName())!=undefined){var h=g.getDataSourceName();var i=this.getTimeline(h);if(i!=null){i.scale(f);this.updateRange(h)}}};ChartManager.prototype.showCursor=function(b){if(b===undefined){b="default"}this._mainCanvas.style.cursor=b;this._overlayCanvas.style.cursor=b};ChartManager.prototype.hideCursor=function(){this._mainCanvas.style.cursor="none";this._overlayCanvas.style.cursor="none"};ChartManager.prototype.showCrossCursor=function(f,g,h){var i=this.getRange(f.getName());if(i!=undefined){i.selectAt(h);i=this.getTimeline(f.getDataSourceName());if(i!=undefined){if(i.selectAt(g)){return true}}}return false};ChartManager.prototype.hideCrossCursor=function(f){if(f!=null){for(var g in this._timelines){var d=this._timelines[g];if(d!=f){d.unselect()}}}else{for(var g in this._timelines){this._timelines[g].unselect()}}for(var g in this._ranges){this._ranges[g].unselect()}};ChartManager.prototype.clearHighlight=function(){if(this._highlightedFrame!=null){this._highlightedFrame.highlight(null);this._highlightedFrame=null}};ChartManager.prototype.onToolMouseMove=function(h,i,j){var m=false;h+=".";for(var k in this._dataSources){if(k.indexOf(h)==0){var l=this._dataSources[k];if(is_instance(l,MainDataSource)){if(l.toolManager.acceptMouseMoveEvent(i,j)){m=true}}}}return m};ChartManager.prototype.onToolMouseDown=function(h,i,j){var m=false;h+=".";for(var k in this._dataSources){if(k.indexOf(h)==0){var l=this._dataSources[k];if(is_instance(l,MainDataSource)){if(l.toolManager.acceptMouseDownEvent(i,j)){m=true}}}}return m};ChartManager.prototype.onToolMouseUp=function(h,i,j){var m=false;h+=".";for(var k in this._dataSources){if(k.indexOf(h)==0){var l=this._dataSources[k];if(is_instance(l,MainDataSource)){if(l.toolManager.acceptMouseUpEvent(i,j)){m=true}}}}return m};ChartManager.prototype.onToolMouseDrag=function(h,i,j){var m=false;
h+=".";for(var k in this._dataSources){if(k.indexOf(h)==0){var l=this._dataSources[k];if(is_instance(l,MainDataSource)){if(l.toolManager.acceptMouseDownMoveEvent(i,j)){m=true}}}}return m};ChartManager.prototype.onMouseMove=function(o,a,m,n){var r=this.getFrame(o);if(r===undefined){return}this.setFrameMousePos(o,a,m);this.hideCrossCursor();if(this._highlightedFrame!=r){this.clearHighlight()}if(this._capturingMouseArea!=null){this._capturingMouseArea.onMouseMove(a,m);return}var s=r.contains(a,m);if(s==null){return}var i,p,q=s.length;for(p=q-1;p>=0;p--){i=s[p];i=i.onMouseMove(a,m);if(i!=null){if(!is_instance(i,ChartAreaGroup)){r.highlight(i);this._highlightedFrame=r}return}}};ChartManager.prototype.onMouseLeave=function(k,h,i,g){var j=this.getFrame(k);if(j==undefined){return}this.setFrameMousePos(k,h,i);this.hideCrossCursor();this.clearHighlight();if(this._capturingMouseArea!=null){this._capturingMouseArea.onMouseLeave(h,i);this._capturingMouseArea=null}this._dragStarted=false};ChartManager.prototype.onMouseDown=function(p,a,i){var l=this.getFrame(p);if(l==undefined){return}var o=l.contains(a,i);if(o==null){return}var q,m,n=o.length;for(m=n-1;m>=0;m--){q=o[m];q=q.onMouseDown(a,i);if(q!=null){this._capturingMouseArea=q;return}}};ChartManager.prototype.onMouseUp=function(f,g,h){var i=this.getFrame(f);if(i==undefined){return}if(this._capturingMouseArea){if(this._capturingMouseArea.onMouseUp(g,h)==null&&this._dragStarted==false){if(this._selectedFrame!=null&&this._selectedFrame!=i){this._selectedFrame.select(null)}if(this._capturingMouseArea.isSelected()){if(!this._captureMouseWheelDirectly){$(this._overlayCanvas).unbind("mousewheel")}i.select(null);this._selectedFrame=null}else{if(this._selectedFrame!=i){if(!this._captureMouseWheelDirectly){$(this._overlayCanvas).bind("mousewheel",mouseWheel)}}i.select(this._capturingMouseArea);this._selectedFrame=i}}this._capturingMouseArea=null;this._dragStarted=false}};ChartManager.prototype.deleteToolObject=function(){var d=this.getDataSource("frame0.k0");var g=d.getSelectToolObjcet();if(g!=null){d.delSelectToolObject()}var f=d.getCurrentToolObject();if(f!=null&&f.getState()!=CToolObject.state.AfterDraw){d.delToolObject()}this.setNormalMode()};ChartManager.prototype.unloadTemplate=function(f){var d=this.getFrame(f);if(d==undefined){return}for(var g in this._dataSources){if(g.match(f+".")){delete this._dataSources[g]}}for(var g in this._dataProviders){if(this._dataProviders[g].getFrameName()==f){delete this._dataProviders[g]}}delete this._frames[f];for(var g in this._areas){if(this._areas[g].getFrameName()==f){delete this._areas[g]}}for(var g in this._timelines){if(this._timelines[g].getFrameName()==f){delete this._timelines[g]}}for(var g in this._ranges){if(this._ranges[g].getFrameName()==f){delete this._ranges[g]}}for(var g in this._plotters){if(this._plotters[g].getFrameName()==f){delete this._plotters[g]}}delete this._themes[f];delete this._frameMousePos[f]};ChartManager.prototype.createIndicatorAndRange=function(i,h,k){var j,g;switch(h){case"MA":j=new MAIndicator();g=new PositiveRange(i);break;case"EMA":j=new EMAIndicator();g=new PositiveRange(i);break;case"VOLUME":j=new VOLUMEIndicator();g=new ZeroBasedPositiveRange(i);break;case"MACD":j=new MACDIndicator();g=new ZeroCenteredRange(i);break;case"DMI":j=new DMIIndicator();g=new PercentageRange(i);break;case"DMA":j=new DMAIndicator();g=new Range(i);break;case"TRIX":j=new TRIXIndicator();g=new Range(i);break;case"BRAR":j=new BRARIndicator();g=new Range(i);break;case"VR":j=new VRIndicator();g=new Range(i);break;case"OBV":j=new OBVIndicator();g=new Range(i);break;case"EMV":j=new EMVIndicator();g=new Range(i);break;case"RSI":j=new RSIIndicator();g=new PercentageRange(i);break;case"WR":j=new WRIndicator();g=new PercentageRange(i);break;case"SAR":j=new SARIndicator();g=new PositiveRange(i);break;case"KDJ":j=new KDJIndicator();g=new PercentageRange(i);break;case"ROC":j=new ROCIndicator();g=new Range(i);break;case"MTM":j=new MTMIndicator();g=new Range(i);break;case"BOLL":j=new BOLLIndicator();g=new Range(i);break;case"PSY":j=new PSYIndicator();g=new Range(i);break;case"StochRSI":j=new STOCHRSIIndicator();g=new PercentageRange(i);break;default:return null}if(!k){j.setParameters(ChartSettings.get().indics[h])}return{"indic":j,"range":g}};ChartManager.prototype.setMainIndicator=function(o,k){var l=o+".main";var m=this.getDataProvider(l+".main");if(m==undefined||!is_instance(m,MainDataProvider)){return false}var n;switch(k){case"MA":n=new MAIndicator();break;case"EMA":n=new EMAIndicator();break;case"BOLL":n=new BOLLIndicator();break;case"SAR":n=new SARIndicator();break;default:return false}n.setParameters(ChartSettings.get().indics[k]);var q=l+".secondary";var j=this.getDataProvider(q);if(j==undefined){j=new IndicatorDataProvider(q);this.setDataProvider(j.getName(),j)}j.setIndicator(n);var p=this.getPlotter(q);if(p==undefined){p=new IndicatorPlotter(q);this.setPlotter(p.getName(),p)}this.getArea(l).setChanged(true);return true};ChartManager.prototype.setIndicator=function(l,k){var p=this.getArea(l);
if(p==undefined||p.getNameObject().getCompAt(2)=="main"){return false}var m=this.getDataProvider(l+".secondary");if(m==undefined||!is_instance(m,IndicatorDataProvider)){return false}var q=this.createIndicatorAndRange(l,k);if(q==null){return false}var n=q.indic;var j=q.range;this.removeDataProvider(l+".main");this.removePlotter(l+".main");this.removeRange(l);this.removePlotter(l+"Range.decoration");m.setIndicator(n);this.setRange(l,j);j.setPaddingTop(20);j.setPaddingBottom(4);j.setMinInterval(20);if(is_instance(n,VOLUMEIndicator)){var o=new LastVolumePlotter(l+"Range.decoration");this.setPlotter(o.getName(),o)}else{if(is_instance(n,BOLLIndicator)||is_instance(n,SARIndicator)){var m=new MainDataProvider(l+".main");this.setDataProvider(m.getName(),m);m.updateData();var o=new OHLCPlotter(l+".main");this.setPlotter(o.getName(),o)}}return true};ChartManager.prototype.removeMainIndicator=function(i){var h=i+".main";var f=h+".secondary";var g=this.getDataProvider(f);if(g==undefined||!is_instance(g,IndicatorDataProvider)){return}this.removeDataProvider(f);this.removePlotter(f);this.getArea(h).setChanged(true)};ChartManager.prototype.removeIndicator=function(k){var i=this.getArea(k);if(i==undefined||i.getNameObject().getCompAt(2)=="main"){return}var l=this.getDataProvider(k+".secondary");if(l==undefined||!is_instance(l,IndicatorDataProvider)){return}var o=k+"Range";var j=this.getArea(o);if(j==undefined){return}var m=this.getArea(i.getDataSourceName()+".charts");if(m==undefined){return}m.removeArea(i);this.removeArea(k);m.removeArea(j);this.removeArea(o);for(var n in this._dataProviders){if(this._dataProviders[n].getAreaName()==k){this.removeDataProvider(n)}}for(var n in this._ranges){if(this._ranges[n].getAreaName()==k){this.removeRange(n)}}for(var n in this._plotters){if(this._plotters[n].getAreaName()==k){this.removePlotter(n)}}for(var n in this._plotters){if(this._plotters[n].getAreaName()==o){this.removePlotter(n)}}};ChartManager.prototype.getIndicatorParameters=function(i){var j=this._fakeIndicators[i];if(j==undefined){var h=this.createIndicatorAndRange("",i);if(h==null){return null}this._fakeIndicators[i]=j=h.indic}var k=[];var l,m=j.getParameterCount();for(l=0;l<m;l++){k.push(j.getParameterAt(l))}return k};ChartManager.prototype.setIndicatorParameters=function(i,m){var j,k;for(j in this._dataProviders){var l=this._dataProviders[j];if(is_instance(l,IndicatorDataProvider)==false){continue}k=l.getIndicator();if(k.getName()==i){k.setParameters(m);l.refresh();this.getArea(l.getAreaName()).setChanged(true)}}k=this._fakeIndicators[i];if(k==undefined){var h=this.createIndicatorAndRange("",i,true);if(h==null){return}this._fakeIndicators[i]=k=h.indic}k.setParameters(m)};ChartManager.prototype.getIndicatorAreaName=function(i,g){var h=this.getArea(i+".charts");var f=h.getAreaCount()>>1;if(g<0||g>=f){return""}return h.getAreaAt(g<<1).getName()};var Timeline=create_class(NamedObject);Timeline._ItemWidth=[1,3,3,5,5,7,9,11,13,15,17,19,21,23,25,27,29];Timeline._SpaceWidth=[1,1,2,2,3,3,3,3,3,3,5,5,5,5,7,7,7];Timeline.PADDING_LEFT=4;Timeline.PADDING_RIGHT=8;Timeline.prototype.__construct=function(b){Timeline.__super.__construct.call(this,b);this._updated=false;this._innerLeft=0;this._innerWidth=0;this._firstColumnLeft=0;this._scale=3;this._lastScale=-1;this._maxItemCount=0;this._maxIndex=0;this._firstIndex=-1;this._selectedIndex=-1;this._savedFirstIndex=-1};Timeline.prototype.isLatestShown=function(){return this.getLastIndex()==this._maxIndex};Timeline.prototype.isUpdated=function(){return this._updated};Timeline.prototype.setUpdated=function(b){this._updated=b};Timeline.prototype.getItemWidth=function(){return Timeline._ItemWidth[this._scale]};Timeline.prototype.getSpaceWidth=function(){return Timeline._SpaceWidth[this._scale]};Timeline.prototype.getColumnWidth=function(){return this.getSpaceWidth()+this.getItemWidth()};Timeline.prototype.getInnerWidth=function(){return this._innerWidth};Timeline.prototype.getItemLeftOffset=function(){return this.getSpaceWidth()};Timeline.prototype.getItemCenterOffset=function(){return this.getSpaceWidth()+(this.getItemWidth()>>1)};Timeline.prototype.getFirstColumnLeft=function(){return this._firstColumnLeft};Timeline.prototype.getMaxItemCount=function(){return this._maxItemCount};Timeline.prototype.getFirstIndex=function(){return this._firstIndex};Timeline.prototype.getLastIndex=function(){return Math.min(this._firstIndex+this._maxItemCount,this._maxIndex)};Timeline.prototype.getSelectedIndex=function(){return this._selectedIndex};Timeline.prototype.getMaxIndex=function(){return this._maxIndex};Timeline.prototype.calcColumnCount=function(b){return Math.floor(b/this.getColumnWidth())<<0};Timeline.prototype.calcFirstColumnLeft=function(b){return this._innerLeft+this._innerWidth-(this.getColumnWidth()*b)};Timeline.prototype.calcFirstIndexAlignRight=function(g,f,d){return Math.max(0,g+Math.max(f,1)-Math.max(d,1))};Timeline.prototype.calcFirstIndex=function(b){return this.validateFirstIndex(this.calcFirstIndexAlignRight(this._firstIndex,this._maxItemCount,b),b)
};Timeline.prototype.updateMaxItemCount=function(){var f=this.calcColumnCount(this._innerWidth);var g;if(this._maxItemCount<1){g=this.calcFirstIndex(f)}else{if(this._lastScale==this._scale){g=this.validateFirstIndex(this._firstIndex-(f-this._maxItemCount))}else{var d=(this._selectedIndex>=0)?this._selectedIndex:this.getLastIndex()-1;g=this.validateFirstIndex(d-Math.round((d-this._firstIndex)*f/this._maxItemCount))}}this._lastScale=this._scale;if(this._firstIndex!=g){if(this._selectedIndex==this._firstIndex){this._selectedIndex=g}this._firstIndex=g;this._updated=true}if(this._maxItemCount!=f){this._maxItemCount=f;this._updated=true}this._firstColumnLeft=this.calcFirstColumnLeft(f)};Timeline.prototype.validateFirstIndex=function(f,g){if(this._maxIndex<1){return -1}if(f<0){return 0}var d=Math.max(0,this._maxIndex-1);if(f>d){return d}return f};Timeline.prototype.validateSelectedIndex=function(){if(this._selectedIndex<this._firstIndex){this._selectedIndex=-1}else{if(this._selectedIndex>=this.getLastIndex()){this._selectedIndex=-1}}};Timeline.prototype.onLayout=function(){var g=ChartManager.getInstance();var d=g.getArea(this.getDataSourceName()+".main");if(d!=null){this._innerLeft=d.getLeft()+Timeline.PADDING_LEFT;var f=Math.max(0,d.getWidth()-(Timeline.PADDING_LEFT+Timeline.PADDING_RIGHT));if(this._innerWidth!=f){this._innerWidth=f;this.updateMaxItemCount()}}};Timeline.prototype.toIndex=function(b){return this._firstIndex+this.calcColumnCount(b-this._firstColumnLeft)};Timeline.prototype.toColumnLeft=function(b){return this._firstColumnLeft+(this.getColumnWidth()*(b-this._firstIndex))};Timeline.prototype.toItemLeft=function(b){return this.toColumnLeft(b)+this.getItemLeftOffset()};Timeline.prototype.toItemCenter=function(b){return this.toColumnLeft(b)+this.getItemCenterOffset()};Timeline.prototype.selectAt=function(b){this._selectedIndex=this.toIndex(b);this.validateSelectedIndex();return(this._selectedIndex>=0)};Timeline.prototype.unselect=function(){this._selectedIndex=-1};Timeline.prototype.update=function(){var k=ChartManager.getInstance();var g=k.getDataSource(this.getDataSourceName());var j=this._maxIndex;this._maxIndex=g.getDataCount();switch(g.getUpdateMode()){case DataSource.UpdateMode.Refresh:if(this._maxIndex<1){this._firstIndex=-1}else{this._firstIndex=Math.max(this._maxIndex-this._maxItemCount,0)}this._selectedIndex=-1;this._updated=true;break;case DataSource.UpdateMode.Append:var i=this.getLastIndex();var h=g.getErasedCount();if(i<j){if(h>0){this._firstIndex=Math.max(this._firstIndex-h,0);if(this._selectedIndex>=0){this._selectedIndex-=h;this.validateSelectedIndex()}this._updated=true}}else{if(i==j){this._firstIndex+=(this._maxIndex-j);if(this._selectedIndex>=0){this._selectedIndex-=h;this.validateSelectedIndex()}this._updated=true}}break}};Timeline.prototype.move=function(b){if(this.isLatestShown()){ChartManager.getInstance().getArea(this.getDataSourceName()+".mainRange").setChanged(true)}this._firstIndex=this.validateFirstIndex(this._savedFirstIndex-this.calcColumnCount(b),this._maxItemCount);this._updated=true;if(this._selectedIndex>=0){this.validateSelectedIndex()}};Timeline.prototype.startMove=function(){this._savedFirstIndex=this._firstIndex};Timeline.prototype.scale=function(b){this._scale+=b;if(this._scale<0){this._scale=0}else{if(this._scale>=Timeline._ItemWidth.length){this._scale=Timeline._ItemWidth.length-1}}this.updateMaxItemCount();if(this._selectedIndex>=0){this.validateSelectedIndex()}};var Range=create_class(NamedObject);Range.prototype.__construct=function(b){Range.__super.__construct.call(this,b);this._updated=true;this._minValue=Number.MAX_VALUE;this._maxValue=-Number.MAX_VALUE;this._outerMinValue=Number.MAX_VALUE;this._outerMaxValue=-Number.MAX_VALUE;this._ratio=0;this._top=0;this._bottom=0;this._paddingTop=0;this._paddingBottom=0;this._minInterval=36;this._selectedPosition=-1;this._selectedValue=-Number.MAX_VALUE;this._gradations=[]};Range.prototype.isUpdated=function(){return this._updated};Range.prototype.setUpdated=function(b){this._updated=b};Range.prototype.getMinValue=function(){return this._minValue};Range.prototype.getMaxValue=function(){return this._maxValue};Range.prototype.getRange=function(){return this._maxValue-this._minValue};Range.prototype.getOuterMinValue=function(){return this._outerMinValue};Range.prototype.getOuterMaxValue=function(){return this._outerMaxValue};Range.prototype.getOuterRange=function(){return this._outerMaxValue-this._outerMinValue};Range.prototype.getHeight=function(){return Math.max(0,this._bottom-this._top)};Range.prototype.getGradations=function(){return this._gradations};Range.prototype.getMinInterval=function(){return this._minInterval};Range.prototype.setMinInterval=function(b){this._minInterval=b};Range.prototype.getSelectedPosition=function(){if(this._selectedPosition>=0){return this._selectedPosition}if(this._selectedValue>-Number.MAX_VALUE){return this.toY(this._selectedValue)}return -1};Range.prototype.getSelectedValue=function(){if(this._selectedValue>-Number.MAX_VALUE){return this._selectedValue
}var c=ChartManager.getInstance();var d=c.getArea(this.getAreaName());if(d==null){return -Number.MAX_VALUE}if(this._selectedPosition<d.getTop()+12||this._selectedPosition>=d.getBottom()-4){return -Number.MAX_VALUE}return this.toValue(this._selectedPosition)};Range.prototype.setPaddingTop=function(b){this._paddingTop=b};Range.prototype.setPaddingBottom=function(b){this._paddingBottom=b};Range.prototype.toValue=function(b){return this._maxValue-(b-this._top)/this._ratio};Range.prototype.toY=function(b){if(this._ratio>0){return this._top+Math.floor((this._maxValue-b)*this._ratio+0.5)}return this._top};Range.prototype.toHeight=function(b){return Math.floor(b*this._ratio+1.5)};Range.prototype.update=function(){var o=Number.MAX_VALUE;var j=-Number.MAX_VALUE;var m=ChartManager.getInstance();var k,l=[".main",".secondary"];for(var i=0;i<l.length;i++){k=m.getDataProvider(this.getName()+l[i]);if(k!=null){o=Math.min(o,k.getMinValue());j=Math.max(j,k.getMaxValue())}}var n={"min":o,"max":j};this.preSetRange(n);this.setRange(n.min,n.max)};Range.prototype.select=function(b){this._selectedValue=b;this._selectedPosition=-1};Range.prototype.selectAt=function(b){this._selectedPosition=b;this._selectedValue=-Number.MAX_VALUE};Range.prototype.unselect=function(){this._selectedPosition=-1;this._selectedValue=-Number.MAX_VALUE};Range.prototype.preSetRange=function(b){if(b.min==b.max){b.min=-1;b.max=1}};Range.prototype.setRange=function(l,j){var m=ChartManager.getInstance();var h=m.getArea(this.getAreaName());if(this._minValue==l&&this._maxValue==j&&!h.isChanged()){return}this._updated=true;this._minValue=l;this._maxValue=j;this._gradations=[];var k=h.getTop()+this._paddingTop;var i=h.getBottom()-(this._paddingBottom+1);if(k>=i){this._minValue=this._maxValue;return}this._top=k;this._bottom=i;if(this._maxValue>this._minValue){this._ratio=(i-k)/(this._maxValue-this._minValue)}else{this._ratio=1}this._outerMinValue=this.toValue(h.getBottom());this._outerMaxValue=this.toValue(h.getTop());this.updateGradations()};Range.prototype.calcInterval=function(){var m=this.getHeight();var l=this.getMinInterval();if((m/l)<=1){l=m>>1}var i=this.getRange();var c=0;while(c>-2&&Math.floor(i)<i){i*=10;c--}var d,h;for(;;c++){h=Math.pow(10,c);d=h;if(this.toHeight(d)>l){break}d=2*h;if(this.toHeight(d)>l){break}d=5*h;if(this.toHeight(d)>l){break}}return d};Range.prototype.updateGradations=function(){this._gradations=[];var c=this.calcInterval();if(c<=0){return}var d=Math.floor(this.getMaxValue()/c)*c;do{this._gradations.push(d);d-=c}while(d>this.getMinValue())};var PositiveRange=create_class(Range);PositiveRange.prototype.__construct=function(b){PositiveRange.__super.__construct.call(this,b)};PositiveRange.prototype.preSetRange=function(b){if(b.min<0){b.min=0}if(b.max<0){b.max=0}};var ZeroBasedPositiveRange=create_class(Range);ZeroBasedPositiveRange.prototype.__construct=function(b){ZeroBasedPositiveRange.__super.__construct.call(this,b)};ZeroBasedPositiveRange.prototype.preSetRange=function(b){b.min=0;if(b.max<0){b.max=0}};var MainRange=create_class(Range);MainRange.prototype.__construct=function(b){MainRange.__super.__construct.call(this,b)};MainRange.prototype.preSetRange=function(t){var c=ChartManager.getInstance();var a=c.getTimeline(this.getDataSourceName());var u=a.getMaxIndex()-a.getLastIndex();if(u<25){var s=c.getDataSource(this.getDataSourceName());var q=s.getDataAt(s.getDataCount()-1);var p=((t.max-t.min)/4)*(1-(u/25));t.min=Math.min(t.min,Math.max(q.low-p,0));t.max=Math.max(t.max,q.high+p)}if(t.min>0){var d=t.max/t.min;if(d<1.016){var r=(t.max+t.min)/2;var m=(d-1)*1.5;t.max=r*(1+m);t.min=r*(1-m)}else{if(d<1.048){var r=(t.max+t.min)/2;t.max=r*1.024;t.min=r*0.976}}}if(t.min<0){t.min=0}if(t.max<0){t.max=0}};var ZeroCenteredRange=create_class(Range);ZeroCenteredRange.prototype.__construct=function(b){ZeroCenteredRange.__super.__construct.call(this,b)};ZeroCenteredRange.prototype.calcInterval=function(h){var f=this.getMinInterval();if(h.getHeight()/f<2){return 0}var i=this.getRange();var g;for(g=3;;g+=2){if(this.toHeight(i/g)<=f){break}}g-=2;return i/g};ZeroCenteredRange.prototype.updateGradations=function(){this._gradations=[];var h=ChartManager.getInstance();var i=h.getArea(this.getAreaName());var f=this.calcInterval(i);if(f<=0){return}var g=f/2;do{this._gradations.push(g);this._gradations.push(-g);g+=f}while(g<=this.getMaxValue())};ZeroCenteredRange.prototype.preSetRange=function(c){var d=Math.max(Math.abs(c.min),Math.abs(c.max));c.min=-d;c.max=d};var PercentageRange=create_class(Range);PercentageRange.prototype.__construct=function(b){PercentageRange.__super.__construct.call(this,b)};PercentageRange.prototype.updateGradations=function(){this._gradations=[];var i=ChartManager.getInstance();var j=i.getArea(this.getAreaName());var g=10;var k=Math.floor(this.toHeight(g));if((k<<2)>j.getHeight()){return}var h=Math.ceil(this.getMinValue()/g)*g;if(h==0){h=0}if((k<<2)<24){if((k<<1)<8){return}do{if(h==20||h==80){this._gradations.push(h)}h+=g}while(h<this.getMaxValue())
}else{do{if(k<8){if(h==20||h==50||h==80){this._gradations.push(h)}}else{if(h==0||h==20||h==50||h==80||h==100){this._gradations.push(h)}}h+=g}while(h<this.getMaxValue())}};var DataSource=create_class(NamedObject);DataSource.prototype.__construct=function(b){DataSource.__super.__construct.call(this,b)};DataSource.UpdateMode={DoNothing:0,Refresh:1,Update:2,Append:3};DataSource.prototype.getUpdateMode=function(){return this._updateMode};DataSource.prototype.setUpdateMode=function(b){this._updateMode=b};DataSource.prototype.getCacheSize=function(){return 0};DataSource.prototype.getDataCount=function(){return 0};var MainDataSource=create_class(DataSource);MainDataSource.prototype.__construct=function(b){MainDataSource.__super.__construct.call(this,b);this._erasedCount=0;this._dataItems=[];this._decimalDigits=0;this.toolManager=new CToolManager(b)};MainDataSource.prototype.getCacheSize=function(){return this._dataItems.length};MainDataSource.prototype.getDataCount=function(){return this._dataItems.length};MainDataSource.prototype.getUpdatedCount=function(){return this._updatedCount};MainDataSource.prototype.getAppendedCount=function(){return this._appendedCount};MainDataSource.prototype.getErasedCount=function(){return this._erasedCount};MainDataSource.prototype.getDecimalDigits=function(){return this._decimalDigits};MainDataSource.prototype.calcDecimalDigits=function(f){var g=""+f;var d=g.indexOf(".");if(d<0){return 0}return(g.length-1)-d};MainDataSource.prototype.getLastDate=function(){var b=this.getDataCount();if(b<1){return -1}return this.getDataAt(b-1).date};MainDataSource.prototype.getDataAt=function(b){return this._dataItems[b]};MainDataSource.prototype.update=function(q){this._updatedCount=0;this._appendedCount=0;this._erasedCount=0;var n=this._dataItems.length;if(n>0){var o=n-1;var d=this._dataItems[o];var m,p,r=q.length;for(p=0;p<r;p++){m=q[p];if(m[0]==d.date){if(d.open==m[1]&&d.high==m[2]&&d.low==m[3]&&d.close==m[4]&&d.volume==m[5]){this.setUpdateMode(DataSource.UpdateMode.DoNothing)}else{this.setUpdateMode(DataSource.UpdateMode.Update);this._dataItems[o]={date:m[0],open:m[1],high:m[2],low:m[3],close:m[4],volume:m[5]};this._updatedCount++}p++;if(p<r){this.setUpdateMode(DataSource.UpdateMode.Append);for(;p<r;p++,this._appendedCount++){m=q[p];this._dataItems.push({date:m[0],open:m[1],high:m[2],low:m[3],close:m[4],volume:m[5]})}}return true}}if(r<KlineIns.limit){this.setUpdateMode(DataSource.UpdateMode.DoNothing);return false}}this.setUpdateMode(DataSource.UpdateMode.Refresh);this._dataItems=[];var i,s,m,p,r=q.length;for(p=0;p<r;p++){m=q[p];for(s=1;s<=4;s++){i=this.calcDecimalDigits(m[s]);if(this._decimalDigits<i){this._decimalDigits=i}}this._dataItems.push({date:m[0],open:m[1],high:m[2],low:m[3],close:m[4],volume:m[5]})}return true};MainDataSource.prototype.select=function(b){this.toolManager.selecedObject=b};MainDataSource.prototype.unselect=function(){this.toolManager.selecedObject=-1};MainDataSource.prototype.addToolObject=function(b){this.toolManager.addToolObject(b)};MainDataSource.prototype.delToolObject=function(){this.toolManager.delCurrentObject()};MainDataSource.prototype.getToolObject=function(b){return this.toolManager.getToolObject(b)};MainDataSource.prototype.getToolObjectCount=function(){return this.toolManager.toolObjects.length};MainDataSource.prototype.getCurrentToolObject=function(){return this.toolManager.getCurrentObject()};MainDataSource.prototype.getSelectToolObjcet=function(){return this.toolManager.getSelectedObject()};MainDataSource.prototype.delSelectToolObject=function(){this.toolManager.delSelectedObject()};var DataProvider=create_class(NamedObject);DataProvider.prototype.__construct=function(b){DataProvider.__super.__construct.call(this,b);this._minValue=0;this._maxValue=0;this._minValueIndex=-1;this._maxValueIndex=-1};DataProvider.prototype.getMinValue=function(){return this._minValue};DataProvider.prototype.getMaxValue=function(){return this._maxValue};DataProvider.prototype.getMinValueIndex=function(){return this._minValueIndex};DataProvider.prototype.getMaxValueIndex=function(){return this._maxValueIndex};DataProvider.prototype.calcRange=function(n,r,v,q){var u=Number.MAX_VALUE;var i=-Number.MAX_VALUE;var p=-1;var x=-1;var w={};var t=r-1;var y=n.length-1;for(;y>=0;y--){var s=n[y];if(t<s){v[y]={"min":u,"max":i}}else{for(;t>=s;t--){if(this.getMinMaxAt(t,w)==false){continue}if(u>w.min){u=w.min;p=t}if(i<w.max){i=w.max;x=t}}v[y]={"min":u,"max":i}}if(q!=null){q[y]={"minIndex":p,"maxIndex":x}}}};DataProvider.prototype.updateRange=function(){var i=ChartManager.getInstance();var k=i.getTimeline(this.getDataSourceName());var g=[k.getFirstIndex()];var j=[{}];var h=[{}];this.calcRange(g,k.getLastIndex(),j,h);this._minValue=j[0].min;this._maxValue=j[0].max;this._minValueIndex=h[0].minIndex;this._maxValueIndex=h[0].maxIndex};var MainDataProvider=create_class(DataProvider);MainDataProvider.prototype.__construct=function(b){MainDataProvider.__super.__construct.call(this,b);this._candlestickDS=null
};MainDataProvider.prototype.updateData=function(){var c=ChartManager.getInstance();var d=c.getDataSource(this.getDataSourceName());if(!is_instance(d,MainDataSource)){return}this._candlestickDS=d};MainDataProvider.prototype.getMinMaxAt=function(f,d){var g=this._candlestickDS.getDataAt(f);d.min=g.low;d.max=g.high;return true};var IndicatorDataProvider=create_class(DataProvider);IndicatorDataProvider.prototype.getIndicator=function(){return this._indicator};IndicatorDataProvider.prototype.setIndicator=function(b){this._indicator=b;this.refresh()};IndicatorDataProvider.prototype.refresh=function(){var j=ChartManager.getInstance();var k=j.getDataSource(this.getDataSourceName());if(k.getDataCount()<1){return}var i=this._indicator;var h,g=k.getDataCount();i.clear();i.reserve(g);for(h=0;h<g;h++){i.execute(k,h)}};IndicatorDataProvider.prototype.updateData=function(){var m=ChartManager.getInstance();var n=m.getDataSource(this.getDataSourceName());if(n.getDataCount()<1){return}var k=this._indicator;var l=n.getUpdateMode();switch(l){case DataSource.UpdateMode.Refresh:this.refresh();break;case DataSource.UpdateMode.Append:k.reserve(n.getAppendedCount());case DataSource.UpdateMode.Update:var i,o=n.getDataCount();var j=n.getUpdatedCount()+n.getAppendedCount();for(i=o-j;i<o;i++){k.execute(n,i)}break}};IndicatorDataProvider.prototype.getMinMaxAt=function(h,j){j.min=Number.MAX_VALUE;j.max=-Number.MAX_VALUE;var i,k=false;var l,m=this._indicator.getOutputCount();for(l=0;l<m;l++){i=this._indicator.getOutputAt(l).execute(h);if(isNaN(i)==false){k=true;if(j.min>i){j.min=i}if(j.max<i){j.max=i}}}return k};var theme_color_id=0;var theme_font_id=0;var Theme=create_class();Theme.prototype.getColor=function(b){return this._colors[b]};Theme.prototype.getFont=function(b){return this._fonts[b]};Theme.Color={Positive:theme_color_id++,Negative:theme_color_id++,PositiveDark:theme_color_id++,NegativeDark:theme_color_id++,Unchanged:theme_color_id++,Background:theme_color_id++,Cursor:theme_color_id++,RangeMark:theme_color_id++,Indicator0:theme_color_id++,Indicator1:theme_color_id++,Indicator2:theme_color_id++,Indicator3:theme_color_id++,Indicator4:theme_color_id++,Indicator5:theme_color_id++,Grid0:theme_color_id++,Grid1:theme_color_id++,Grid2:theme_color_id++,Grid3:theme_color_id++,Grid4:theme_color_id++,TextPositive:theme_color_id++,TextNegative:theme_color_id++,Text0:theme_color_id++,Text1:theme_color_id++,Text2:theme_color_id++,Text3:theme_color_id++,Text4:theme_color_id++,LineColorNormal:theme_color_id++,LineColorSelected:theme_color_id++,CircleColorFill:theme_color_id++,CircleColorStroke:theme_color_id++};Theme.Font={Default:theme_font_id++};var DarkTheme=create_class(Theme);DarkTheme.prototype.__construct=function(){this._colors=[];if(KlineIns.reverseColor){this._colors[Theme.Color.Positive]="#990e0e";this._colors[Theme.Color.Negative]="#19b34c";this._colors[Theme.Color.PositiveDark]="#3b0e08";this._colors[Theme.Color.NegativeDark]="#004718"}else{this._colors[Theme.Color.Positive]="#19b34c";this._colors[Theme.Color.Negative]="#990e0e";this._colors[Theme.Color.PositiveDark]="#004718";this._colors[Theme.Color.NegativeDark]="#3b0e08"}this._colors[Theme.Color.Unchanged]="#fff";this._colors[Theme.Color.Background]="#0a0a0a";this._colors[Theme.Color.Cursor]="#aaa";this._colors[Theme.Color.RangeMark]="#f9ee30";this._colors[Theme.Color.Indicator0]="#ddd";this._colors[Theme.Color.Indicator1]="#f9ee30";this._colors[Theme.Color.Indicator2]="#f600ff";this._colors[Theme.Color.Indicator3]="#6bf";this._colors[Theme.Color.Indicator4]="#a5cf81";this._colors[Theme.Color.Indicator5]="#e18b89";this._colors[Theme.Color.Grid0]="#333";this._colors[Theme.Color.Grid1]="#444";this._colors[Theme.Color.Grid2]="#666";this._colors[Theme.Color.Grid3]="#888";this._colors[Theme.Color.Grid4]="#aaa";this._colors[Theme.Color.TextPositive]="#1bd357";this._colors[Theme.Color.TextNegative]="#ff6f5e";this._colors[Theme.Color.Text0]="#444";this._colors[Theme.Color.Text1]="#666";this._colors[Theme.Color.Text2]="#888";this._colors[Theme.Color.Text3]="#aaa";this._colors[Theme.Color.Text4]="#ccc";this._colors[Theme.Color.LineColorNormal]="#a6a6a6";this._colors[Theme.Color.LineColorSelected]="#ffffff";this._colors[Theme.Color.CircleColorFill]="#000000";this._colors[Theme.Color.CircleColorStroke]="#ffffff";this._fonts=[];this._fonts[Theme.Font.Default]="12px Tahoma"};var LightTheme=create_class(Theme);LightTheme.prototype.__construct=function(){this._colors=[];if(KlineIns.reverseColor){this._colors[Theme.Color.Positive]="#db5542";this._colors[Theme.Color.Negative]="#53b37b";this._colors[Theme.Color.PositiveDark]="#ffadaa";this._colors[Theme.Color.NegativeDark]="#66d293"}else{this._colors[Theme.Color.Positive]="#53b37b";this._colors[Theme.Color.Negative]="#db5542";this._colors[Theme.Color.PositiveDark]="#66d293";this._colors[Theme.Color.NegativeDark]="#ffadaa"}this._colors[Theme.Color.Unchanged]="#fff";this._colors[Theme.Color.Background]="#fff";this._colors[Theme.Color.Cursor]="#aaa";this._colors[Theme.Color.RangeMark]="#f27935";
this._colors[Theme.Color.Indicator0]="#2fd2b2";this._colors[Theme.Color.Indicator1]="#ffb400";this._colors[Theme.Color.Indicator2]="#e849b9";this._colors[Theme.Color.Indicator3]="#1478c8";this._colors[Theme.Color.Grid0]="#eee";this._colors[Theme.Color.Grid1]="#afb1b3";this._colors[Theme.Color.Grid2]="#ccc";this._colors[Theme.Color.Grid3]="#bbb";this._colors[Theme.Color.Grid4]="#aaa";this._colors[Theme.Color.TextPositive]="#53b37b";this._colors[Theme.Color.TextNegative]="#db5542";this._colors[Theme.Color.Text0]="#ccc";this._colors[Theme.Color.Text1]="#aaa";this._colors[Theme.Color.Text2]="#888";this._colors[Theme.Color.Text3]="#666";this._colors[Theme.Color.Text4]="#444";this._colors[Theme.Color.LineColorNormal]="#8c8c8c";this._colors[Theme.Color.LineColorSelected]="#393c40";this._colors[Theme.Color.CircleColorFill]="#ffffff";this._colors[Theme.Color.CircleColorStroke]="#393c40";this._fonts=[];this._fonts[Theme.Font.Default]="12px Tahoma"};var TemplateMeasuringHandler=create_class();TemplateMeasuringHandler.onMeasuring=function(k,g){var j=g.Width;var h=g.Height;var i=k.getNameObject().getCompAt(2);if(i=="timeline"){k.setMeasuredDimension(j,22)}};var Template=create_class();Template.displayVolume=true;Template.createCandlestickDataSource=function(b){return new MainDataSource(b)};Template.createLiveOrderDataSource=function(b){return new CLiveOrderDataSource(b)};Template.createLiveTradeDataSource=function(b){return new CLiveTradeDataSource(b)};Template.createDataSource=function(h,g,i){var f=ChartManager.getInstance();if(f.getCachedDataSource(g)==null){f.setCachedDataSource(g,i(g))}f.setCurrentDataSource(h,g);f.updateData(h,null)};Template.createTableComps=function(b){Template.createMainChartComps(b);if(Template.displayVolume){Template.createIndicatorChartComps(b,"VOLUME")}Template.createTimelineComps(b)};Template.createMainChartComps=function(s){var l=ChartManager.getInstance();var t=l.getArea(s+".charts");var o=s+".main";var n=o+"Range";var r=new MainArea(o);l.setArea(o,r);t.addArea(r);var m=new MainRangeArea(n);l.setArea(n,m);t.addArea(m);var q=new MainDataProvider(o+".main");l.setDataProvider(q.getName(),q);l.setMainIndicator(s,"MA");var p=new MainRange(o);l.setRange(p.getName(),p);p.setPaddingTop(28);p.setPaddingBottom(12);var u=new MainAreaBackgroundPlotter(o+".background");l.setPlotter(u.getName(),u);u=new CGridPlotter(o+".grid");l.setPlotter(u.getName(),u);u=new CandlestickPlotter(o+".main");l.setPlotter(u.getName(),u);u=new MinMaxPlotter(o+".decoration");l.setPlotter(u.getName(),u);u=new MainInfoPlotter(o+".info");l.setPlotter(u.getName(),u);u=new SelectionPlotter(o+".selection");l.setPlotter(u.getName(),u);u=new CDynamicLinePlotter(o+".tool");l.setPlotter(u.getName(),u);u=new RangeAreaBackgroundPlotter(o+"Range.background");l.setPlotter(u.getName(),u);u=new COrderGraphPlotter(o+"Range.grid");l.setPlotter(u.getName(),u);u=new RangePlotter(o+"Range.main");l.setPlotter(u.getName(),u);u=new RangeSelectionPlotter(o+"Range.selection");l.setPlotter(u.getName(),u);u=new LastClosePlotter(o+"Range.decoration");l.setPlotter(u.getName(),u)};Template.createIndicatorChartComps=function(A,a){var i=ChartManager.getInstance();var B=i.getArea(A+".charts");var w=A+".indic"+B.getNextRowId();var r=w+"Range";var z=new IndicatorArea(w);i.setArea(w,z);B.addArea(z);var u=B.getAreaCount()>>1;var v=ChartSettings.get().charts.areaHeight;if(v.length>u){var t,x;for(x=0;x<u;x++){t=B.getAreaAt(x<<1);t.setTop(0);t.setBottom(v[x])}z.setTop(0);z.setBottom(v[u])}var s=new IndicatorRangeArea(r);i.setArea(r,s);B.addArea(s);var y=new IndicatorDataProvider(w+".secondary");i.setDataProvider(y.getName(),y);if(i.setIndicator(w,a)==false){i.removeIndicator(w);return}var C=new MainAreaBackgroundPlotter(w+".background");i.setPlotter(C.getName(),C);C=new CGridPlotter(w+".grid");i.setPlotter(C.getName(),C);C=new IndicatorPlotter(w+".secondary");i.setPlotter(C.getName(),C);C=new IndicatorInfoPlotter(w+".info");i.setPlotter(C.getName(),C);C=new SelectionPlotter(w+".selection");i.setPlotter(C.getName(),C);C=new RangeAreaBackgroundPlotter(w+"Range.background");i.setPlotter(C.getName(),C);C=new RangePlotter(w+"Range.main");i.setPlotter(C.getName(),C);C=new RangeSelectionPlotter(w+"Range.selection");i.setPlotter(C.getName(),C)};Template.createTimelineComps=function(h){var f=ChartManager.getInstance();var i;var g=new Timeline(h);f.setTimeline(g.getName(),g);i=new TimelineAreaBackgroundPlotter(h+".timeline.background");f.setPlotter(i.getName(),i);i=new TimelinePlotter(h+".timeline.main");f.setPlotter(i.getName(),i);i=new TimelineSelectionPlotter(h+".timeline.selection");f.setPlotter(i.getName(),i)};Template.createLiveOrderComps=function(g){var f=ChartManager.getInstance();var d;d=new BackgroundPlotter(g+".main.background");f.setPlotter(d.getName(),d);d=new CLiveOrderPlotter(g+".main.main");f.setPlotter(d.getName(),d)};Template.createLiveTradeComps=function(g){var f=ChartManager.getInstance();var d;d=new BackgroundPlotter(g+".main.background");f.setPlotter(d.getName(),d);
d=new CLiveTradePlotter(g+".main.main");f.setPlotter(d.getName(),d)};var DefaultTemplate=create_class(Template);DefaultTemplate.loadTemplate=function(m,j){var o=ChartManager.getInstance();var q=ChartSettings.get();var k=(new CName(m)).getCompAt(0);o.unloadTemplate(k);Template.createDataSource(m,j,Template.createCandlestickDataSource);var n=new DockableLayout(k);o.setFrame(n.getName(),n);o.setArea(n.getName(),n);n.setGridColor(Theme.Color.Grid1);var p=new TimelineArea(m+".timeline");o.setArea(p.getName(),p);n.addArea(p);p.setDockStyle(ChartArea.DockStyle.Bottom);p.Measuring.addHandler(p,TemplateMeasuringHandler.onMeasuring);var l=new TableLayout(m+".charts");o.setArea(l.getName(),l);l.setDockStyle(ChartArea.DockStyle.Fill);n.addArea(l);Template.createTableComps(m);o.setThemeName(k,q.theme);return o};var Plotter=create_class(NamedObject);Plotter.prototype.__construct=function(b){Plotter.__super.__construct.call(this,b)};Plotter.isChrome=(navigator.userAgent.toLowerCase().match(/chrome/)!=null);Plotter.drawLine=function(j,g,i,h,k){j.beginPath();j.moveTo((g<<0)+0.5,(i<<0)+0.5);j.lineTo((h<<0)+0.5,(k<<0)+0.5);j.stroke()};Plotter.drawLines=function(i,h){var f,g=h.length;i.beginPath();i.moveTo(h[0].x,h[0].y);for(f=1;f<g;f++){i.lineTo(h[f].x,h[f].y)}if(Plotter.isChrome){i.moveTo(h[0].x,h[0].y);for(f=1;f<g;f++){i.lineTo(h[f].x,h[f].y)}}i.stroke()};Plotter.drawDashedLine=function(z,y,q,A,r,u,s){if(u<2){u=2}var w=A-y;var x=r-q;z.beginPath();if(x==0){var t=(w/u+0.5)<<0;for(var v=0;v<t;v++){z.rect(y,q,s,1);y+=u}z.fill()}else{var t=(Math.sqrt(w*w+x*x)/u+0.5)<<0;w=w/t;x=x/t;var i=w*s/u;var p=x*s/u;for(var v=0;v<t;v++){z.moveTo(y+0.5,q+0.5);z.lineTo(y+0.5+i,q+0.5+p);y+=w;q+=x}z.stroke()}};Plotter.createHorzDashedLine=function(r,q,s,i,n,l){if(n<2){n=2}var p=s-q;var m=(p/n+0.5)<<0;for(var o=0;o<m;o++){r.rect(q,i,l,1);q+=n}};Plotter.createRectangles=function(j,h){j.beginPath();var i,k,g=h.length;for(k=0;k<g;k++){i=h[k];j.rect(i.x,i.y,i.w,i.h)}};Plotter.createPolygon=function(i,h){i.beginPath();i.moveTo(h[0].x+0.5,h[0].y+0.5);var f,g=h.length;for(f=1;f<g;f++){i.lineTo(h[f].x+0.5,h[f].y+0.5)}i.closePath()};Plotter.drawString=function(f,h,i){var g=f.measureText(h).width;if(i.w<g){return false}f.fillText(h,i.x,i.y);i.x+=g;i.w-=g;return true};var BackgroundPlotter=create_class(Plotter);BackgroundPlotter.prototype.__construct=function(b){BackgroundPlotter.__super.__construct.call(this,b);this._color=Theme.Color.Background};BackgroundPlotter.prototype.getColor=function(){return this._color};BackgroundPlotter.prototype.setColor=function(b){this._color=b};BackgroundPlotter.prototype.Draw=function(g){var i=ChartManager.getInstance();var f=i.getArea(this.getAreaName());var h=i.getTheme(this.getFrameName());g.fillStyle=h.getColor(this._color);g.fillRect(f.getLeft(),f.getTop(),f.getWidth(),f.getHeight())};var MainAreaBackgroundPlotter=create_class(BackgroundPlotter);MainAreaBackgroundPlotter.prototype.__construct=function(b){MainAreaBackgroundPlotter.__super.__construct.call(this,b)};MainAreaBackgroundPlotter.prototype.Draw=function(s){var m=ChartManager.getInstance();var t=m.getArea(this.getAreaName());var l=m.getTimeline(this.getDataSourceName());var p=m.getRange(this.getAreaName());var r=m.getTheme(this.getFrameName());var o=t.getRect();if(!t.isChanged()&&!l.isUpdated()&&!p.isUpdated()){var q=l.getFirstIndex();var n=l.getLastIndex()-2;var u=Math.max(q,n);o.X=l.toColumnLeft(u);o.Width=t.getRight()-o.X}s.fillStyle=r.getColor(this._color);s.fillRect(o.X,o.Y,o.Width,o.Height)};var RangeAreaBackgroundPlotter=create_class(BackgroundPlotter);RangeAreaBackgroundPlotter.prototype.__construct=function(b){RangeAreaBackgroundPlotter.__super.__construct.call(this,b)};RangeAreaBackgroundPlotter.prototype.Draw=function(o){var m=ChartManager.getInstance();var k=this.getAreaName();var n=m.getArea(k);var i=m.getRange(k.substring(0,k.lastIndexOf("Range")));var j=i.getNameObject().getCompAt(2)=="main";if(j){}else{if(!n.isChanged()&&!i.isUpdated()){return}}var l=m.getTheme(this.getFrameName());o.fillStyle=l.getColor(this._color);o.fillRect(n.getLeft(),n.getTop(),n.getWidth(),n.getHeight())};var TimelineAreaBackgroundPlotter=create_class(BackgroundPlotter);TimelineAreaBackgroundPlotter.prototype.__construct=function(b){TimelineAreaBackgroundPlotter.__super.__construct.call(this,b)};TimelineAreaBackgroundPlotter.prototype.Draw=function(h){var j=ChartManager.getInstance();var k=j.getArea(this.getAreaName());var g=j.getTimeline(this.getDataSourceName());if(!k.isChanged()&&!g.isUpdated()){return}var i=j.getTheme(this.getFrameName());h.fillStyle=i.getColor(this._color);h.fillRect(k.getLeft(),k.getTop(),k.getWidth(),k.getHeight())};var CGridPlotter=create_class(NamedObject);CGridPlotter.prototype.__construct=function(b){CGridPlotter.__super.__construct.call(this,b)};CGridPlotter.prototype.Draw=function(C){var r=ChartManager.getInstance();var D=r.getArea(this.getAreaName());var n=r.getTimeline(this.getDataSourceName());var v=r.getRange(this.getAreaName());var z=false;
if(!D.isChanged()&&!n.isUpdated()&&!v.isUpdated()){var w=n.getFirstIndex();var s=n.getLastIndex();var E=Math.max(w,s-2);var A=n.toColumnLeft(E);C.save();C.rect(A,D.getTop(),D.getRight()-A,D.getHeight());C.clip();z=true}var x=r.getTheme(this.getFrameName());C.fillStyle=x.getColor(Theme.Color.Grid0);C.beginPath();var y=4,u=1;if(Plotter.isChrome){y=4;u=1}var t=v.getGradations();for(var B in t){Plotter.createHorzDashedLine(C,D.getLeft(),D.getRight(),v.toY(t[B]),y,u)}C.fill();if(z){C.restore()}};var CandlestickPlotter=create_class(NamedObject);CandlestickPlotter.prototype.__construct=function(b){CandlestickPlotter.__super.__construct.call(this,b)};CandlestickPlotter.prototype.Draw=function(ac){var O=ChartManager.getInstance();var J=O.getDataSource(this.getDataSourceName());if(J.getDataCount()<1){return}var H=O.getArea(this.getAreaName());var X=O.getTimeline(this.getDataSourceName());var P=O.getRange(this.getAreaName());if(P.getRange()==0){return}var i=O.getTheme(this.getFrameName());var ae=is_instance(i,DarkTheme);var W=X.getFirstIndex();var S=X.getLastIndex();var Y;if(H.isChanged()||X.isUpdated()||P.isUpdated()){Y=W}else{Y=Math.max(W,S-2)}var G=X.getColumnWidth();var E=X.getItemWidth();var aa=X.toItemLeft(Y);var R=X.toItemCenter(Y);var F=[];var Z=[];var ad=[];var U=[];for(var I=Y;I<S;I++){var N=J.getDataAt(I);var T=P.toY(N.high);var L=P.toY(N.low);var Q=N.open;var K=N.close;if(K>Q){var M=P.toY(K);var V=P.toY(Q);var ab=Math.max(V-M,1);if(ab>1&&E>1&&ae){F.push({x:aa+0.5,y:M+0.5,w:E-1,h:ab-1})}else{Z.push({x:aa,y:M,w:Math.max(E,1),h:Math.max(ab,1)})}if(N.high>K){T=Math.min(T,M-1);Z.push({x:R,y:T,w:1,h:M-T})}if(Q>N.low){L=Math.max(L,V+1);Z.push({x:R,y:V,w:1,h:L-V})}}else{if(K==Q){var M=P.toY(K);ad.push({x:aa,y:M,w:Math.max(E,1),h:1});if(N.high>K){T=Math.min(T,M-1)}if(Q>N.low){L=Math.max(L,M+1)}if(T<L){ad.push({x:R,y:T,w:1,h:L-T})}}else{var M=P.toY(Q);var V=P.toY(K);var ab=Math.max(V-M,1);U.push({x:aa,y:M,w:Math.max(E,1),h:Math.max(ab,1)});if(N.high>Q){T=Math.min(T,M-1)}if(K>N.low){L=Math.max(L,V+1)}if(T<L){U.push({x:R,y:T,w:1,h:L-T})}}}aa+=G;R+=G}if(F.length>0){ac.strokeStyle=i.getColor(Theme.Color.Positive);Plotter.createRectangles(ac,F);ac.stroke()}if(Z.length>0){ac.fillStyle=i.getColor(Theme.Color.Positive);Plotter.createRectangles(ac,Z);ac.fill()}if(ad.length>0){ac.fillStyle=i.getColor(Theme.Color.Negative);Plotter.createRectangles(ac,ad);ac.fill()}if(U.length>0){ac.fillStyle=i.getColor(Theme.Color.Negative);Plotter.createRectangles(ac,U);ac.fill()}};var CandlestickHLCPlotter=create_class(Plotter);CandlestickHLCPlotter.prototype.__construct=function(b){CandlestickHLCPlotter.__super.__construct.call(this,b)};CandlestickHLCPlotter.prototype.Draw=function(ac){var O=ChartManager.getInstance();var J=O.getDataSource(this.getDataSourceName());if(!is_instance(J,MainDataSource)||J.getDataCount()<1){return}var H=O.getArea(this.getAreaName());var X=O.getTimeline(this.getDataSourceName());var P=O.getRange(this.getAreaName());if(P.getRange()==0){return}var i=O.getTheme(this.getFrameName());var ae=is_instance(i,DarkTheme);var W=X.getFirstIndex();var S=X.getLastIndex();var Y;if(H.isChanged()||X.isUpdated()||P.isUpdated()){Y=W}else{Y=Math.max(W,S-2)}var G=X.getColumnWidth();var E=X.getItemWidth();var aa=X.toItemLeft(Y);var R=X.toItemCenter(Y);var F=[];var Z=[];var ad=[];var U=[];for(var I=Y;I<S;I++){var N=J.getDataAt(I);var T=P.toY(N.high);var L=P.toY(N.low);var Q=N.open;if(I>0){Q=J.getDataAt(I-1).close}var K=N.close;if(K>Q){var M=P.toY(K);var V=P.toY(Q);var ab=Math.max(V-M,1);if(ab>1&&E>1&&ae){F.push({x:aa+0.5,y:M+0.5,w:E-1,h:ab-1})}else{Z.push({x:aa,y:M,w:Math.max(E,1),h:Math.max(ab,1)})}if(N.high>K){T=Math.min(T,M-1);Z.push({x:R,y:T,w:1,h:M-T})}if(Q>N.low){L=Math.max(L,V+1);Z.push({x:R,y:V,w:1,h:L-V})}}else{if(K==Q){var M=P.toY(K);ad.push({x:aa,y:M,w:Math.max(E,1),h:1});if(N.high>K){T=Math.min(T,M-1)}if(Q>N.low){L=Math.max(L,M+1)}if(T<L){ad.push({x:R,y:T,w:1,h:L-T})}}else{var M=P.toY(Q);var V=P.toY(K);var ab=Math.max(V-M,1);U.push({x:aa,y:M,w:Math.max(E,1),h:Math.max(ab,1)});if(N.high>Q){T=Math.min(T,M-1)}if(K>N.low){L=Math.max(L,V+1)}if(T<L){U.push({x:R,y:T,w:1,h:L-T})}}}aa+=G;R+=G}if(F.length>0){ac.strokeStyle=i.getColor(Theme.Color.Positive);Plotter.createRectangles(ac,F);ac.stroke()}if(Z.length>0){ac.fillStyle=i.getColor(Theme.Color.Positive);Plotter.createRectangles(ac,Z);ac.fill()}if(ad.length>0){ac.fillStyle=i.getColor(Theme.Color.Negative);Plotter.createRectangles(ac,ad);ac.fill()}if(U.length>0){ac.fillStyle=i.getColor(Theme.Color.Negative);Plotter.createRectangles(ac,U);ac.fill()}};var OHLCPlotter=create_class(Plotter);OHLCPlotter.prototype.__construct=function(b){OHLCPlotter.__super.__construct.call(this,b)};OHLCPlotter.prototype.Draw=function(Z){var M=ChartManager.getInstance();var J=M.getDataSource(this.getDataSourceName());if(!is_instance(J,MainDataSource)||J.getDataCount()<1){return}var G=M.getArea(this.getAreaName());var U=M.getTimeline(this.getDataSourceName());var N=M.getRange(this.getAreaName());if(N.getRange()==0){return
}var y=M.getTheme(this.getFrameName());var T=U.getFirstIndex();var O=U.getLastIndex();var V;if(G.isChanged()||U.isUpdated()||N.isUpdated()){V=T}else{V=Math.max(T,O-2)}var F=U.getColumnWidth();var D=U.getItemWidth()>>1;var X=U.toItemLeft(V);var i=U.toItemCenter(V);var E=X+U.getItemWidth();var W=[];var aa=[];var R=[];for(var H=V;H<O;H++){var L=J.getDataAt(H);var P=N.toY(L.high);var I=N.toY(L.low);var Y=Math.max(I-P,1);if(L.close>L.open){var K=N.toY(L.close);var S=N.toY(L.open);W.push({x:i,y:P,w:1,h:Y});W.push({x:X,y:K,w:D,h:1});W.push({x:i,y:S,w:D,h:1})}else{if(L.close==L.open){var Q=N.toY(L.close);aa.push({x:i,y:P,w:1,h:Y});aa.push({x:X,y:Q,w:D,h:1});aa.push({x:i,y:Q,w:D,h:1})}else{var K=N.toY(L.open);var S=N.toY(L.close);R.push({x:i,y:P,w:1,h:Y});R.push({x:X,y:K,w:D,h:1});R.push({x:i,y:S,w:D,h:1})}}X+=F;i+=F;E+=F}if(W.length>0){Z.fillStyle=y.getColor(Theme.Color.Positive);Plotter.createRectangles(Z,W);Z.fill()}if(aa.length>0){Z.fillStyle=y.getColor(Theme.Color.Negative);Plotter.createRectangles(Z,aa);Z.fill()}if(R.length>0){Z.fillStyle=y.getColor(Theme.Color.Negative);Plotter.createRectangles(Z,R);Z.fill()}};var MainInfoPlotter=create_class(Plotter);MainInfoPlotter.prototype.__construct=function(b){MainInfoPlotter.__super.__construct.call(this,b)};function format_time(b){return(b<10)?"0"+b.toString():b.toString()}MainInfoPlotter.prototype.Draw=function(ac){var N=ChartManager.getInstance();var F=N.getArea(this.getAreaName());var aa=N.getTimeline(this.getDataSourceName());var S=N.getDataSource(this.getDataSourceName());var n=N.getTheme(this.getFrameName());ac.font=n.getFont(Theme.Font.Default);ac.textAlign="left";ac.textBaseline="top";ac.fillStyle=n.getColor(Theme.Color.Text4);var ae={x:F.getLeft()+4,y:F.getTop()+2,w:F.getWidth()-8,h:20};var J=aa.getSelectedIndex();if(J<0){return}var L=S.getDataAt(J);var W=S.getDecimalDigits();var Y=new Date(L.date);var U=Y.getFullYear();var P=format_time(Y.getMonth()+1);var R=format_time(Y.getDate());var Z=format_time(Y.getHours());var T=format_time(Y.getMinutes());var I=N.getLanguage();if(I=="zh-cn"){if(!Plotter.drawString(ac,"时间: "+U+"-"+P+"-"+R+"  "+Z+":"+T,ae)){return}if(!Plotter.drawString(ac,"  开: "+L.open.toFixed(W),ae)){return}if(!Plotter.drawString(ac,"  高: "+L.high.toFixed(W),ae)){return}if(!Plotter.drawString(ac,"  低: "+L.low.toFixed(W),ae)){return}if(!Plotter.drawString(ac,"  收: "+L.close.toFixed(W),ae)){return}}else{if(I=="en-us"){if(!Plotter.drawString(ac,"DATE: "+U+"-"+P+"-"+R+"  "+Z+":"+T,ae)){return}if(!Plotter.drawString(ac,"  O: "+L.open.toFixed(W),ae)){return}if(!Plotter.drawString(ac,"  H: "+L.high.toFixed(W),ae)){return}if(!Plotter.drawString(ac,"  L: "+L.low.toFixed(W),ae)){return}if(!Plotter.drawString(ac,"  C: "+L.close.toFixed(W),ae)){return}}else{if(I=="zh-tw"){if(!Plotter.drawString(ac,"時間: "+U+"-"+P+"-"+R+"  "+Z+":"+T,ae)){return}if(!Plotter.drawString(ac,"  開: "+L.open.toFixed(W),ae)){return}if(!Plotter.drawString(ac,"  高: "+L.high.toFixed(W),ae)){return}if(!Plotter.drawString(ac,"  低: "+L.low.toFixed(W),ae)){return}if(!Plotter.drawString(ac,"  收: "+L.close.toFixed(W),ae)){return}}}}if(J>0){if(I=="zh-cn"){if(!Plotter.drawString(ac,"  涨幅: ",ae)){return}}else{if(I=="en-us"){if(!Plotter.drawString(ac,"  CHANGE: ",ae)){return}}else{if(I=="zh-tw"){if(!Plotter.drawString(ac,"  漲幅: ",ae)){return}}}}var Q=S.getDataAt(J-1);if((L.close-Q.close)/Q.close*100){var X=(L.close-Q.close)/Q.close*100}else{var X=0}if(X>=0){X=" "+X.toFixed(2);ac.fillStyle=n.getColor(Theme.Color.TextPositive)}else{X=X.toFixed(2);ac.fillStyle=n.getColor(Theme.Color.TextNegative)}if(!Plotter.drawString(ac,X,ae)){return}ac.fillStyle=n.getColor(Theme.Color.Text4);if(!Plotter.drawString(ac," %",ae)){return}}if((L.high-L.low)/L.low*100){var ab=(L.high-L.low)/L.low*100}else{var ab=0}if(I=="zh-cn"){if(!Plotter.drawString(ac,"  振幅: "+ab.toFixed(2)+" %",ae)){return}}else{if(I=="en-us"){if(!Plotter.drawString(ac,"  AMPLITUDE: "+ab.toFixed(2)+" %",ae)){return}}else{if(I=="zh-tw"){if(!Plotter.drawString(ac,"  振幅: "+ab.toFixed(2)+" %",ae)){return}}}}var M=N.getDataProvider(this.getAreaName()+".secondary");if(M==undefined){return}var ad=M.getIndicator();var O,H=ad.getOutputCount();for(O=0;O<H;O++){var G=ad.getOutputAt(O);var V=G.execute(J);if(isNaN(V)){continue}var v="  "+G.getName()+": "+V.toFixed(W);var K=G.getColor();if(K===undefined){K=Theme.Color.Indicator0+O}ac.fillStyle=n.getColor(K);if(!Plotter.drawString(ac,v,ae)){return}}};var IndicatorPlotter=create_class(NamedObject);IndicatorPlotter.prototype.__construct=function(b){IndicatorPlotter.__super.__construct.call(this,b)};IndicatorPlotter.prototype.Draw=function(U){var G=ChartManager.getInstance();var v=G.getArea(this.getAreaName());var Q=G.getTimeline(this.getDataSourceName());var L=G.getRange(this.getAreaName());if(L.getRange()==0){return}var K=G.getDataProvider(this.getName());if(!is_instance(K,IndicatorDataProvider)){return}var i=G.getTheme(this.getFrameName());var n=Q.getColumnWidth();var P=Q.getFirstIndex();var O=Q.getLastIndex();var R;
if(v.isChanged()||Q.isUpdated()||L.isUpdated()){R=P}else{R=Math.max(P,O-2)}var T=K.getIndicator();var C,J,I=T.getOutputCount();for(J=0;J<I;J++){C=T.getOutputAt(J);var x=C.getStyle();if(x==OutputStyle.VolumeStick){this.drawVolumeStick(U,i,G.getDataSource(this.getDataSourceName()),R,O,Q.toItemLeft(R),n,Q.getItemWidth(),L)}else{if(x==OutputStyle.MACDStick){this.drawMACDStick(U,i,C,R,O,Q.toItemLeft(R),n,Q.getItemWidth(),L)}else{if(x==OutputStyle.SARPoint){this.drawSARPoint(U,i,C,R,O,Q.toItemCenter(R),n,Q.getItemWidth(),L)}}}}var S=Q.toColumnLeft(R);var H=Q.toItemCenter(R);U.save();U.rect(S,v.getTop(),v.getRight()-S,v.getHeight());U.clip();U.translate(0.5,0.5);for(J=0;J<I;J++){var N=H;C=T.getOutputAt(J);if(C.getStyle()==OutputStyle.Line){var M,D=[];if(R>P){M=C.execute(R-1);if(isNaN(M)==false){D.push({"x":N-n,"y":L.toY(M)})}}for(var E=R;E<O;E++,N+=n){M=C.execute(E);if(isNaN(M)==false){D.push({"x":N,"y":L.toY(M)})}}if(D.length>0){var F=C.getColor();if(F==undefined){F=Theme.Color.Indicator0+J}U.strokeStyle=i.getColor(F);Plotter.drawLines(U,D)}}}U.restore()};IndicatorPlotter.prototype.drawVolumeStick=function(L,v,B,H,E,z,y,w,D){var M=is_instance(v,DarkTheme);var J=z;var F=D.toY(0);var x=[];var I=[];var G=[];for(var A=H;A<E;A++){var i=B.getDataAt(A);var C=D.toY(i.volume);var K=D.toHeight(i.volume);if(i.close>i.open){if(K>1&&w>1&&M){x.push({x:J+0.5,y:C+0.5,w:w-1,h:K-1})}else{I.push({x:J,y:C,w:Math.max(w,1),h:Math.max(K,1)})}}else{if(i.close==i.open){if(A>0&&i.close>=B.getDataAt(A-1).close){if(K>1&&w>1&&M){x.push({x:J+0.5,y:C+0.5,w:w-1,h:K-1})}else{I.push({x:J,y:C,w:Math.max(w,1),h:Math.max(K,1)})}}else{G.push({x:J,y:C,w:Math.max(w,1),h:Math.max(K,1)})}}else{G.push({x:J,y:C,w:Math.max(w,1),h:Math.max(K,1)})}}J+=y}if(x.length>0){L.strokeStyle=v.getColor(Theme.Color.Positive);Plotter.createRectangles(L,x);L.stroke()}if(I.length>0){L.fillStyle=v.getColor(Theme.Color.Positive);Plotter.createRectangles(L,I);L.fill()}if(G.length>0){L.fillStyle=v.getColor(Theme.Color.Negative);Plotter.createRectangles(L,G);L.fill()}};IndicatorPlotter.prototype.drawMACDStick=function(M,w,G,I,F,A,z,x,D){var K=A;var v=D.toY(0);var y=[];var i=[];var J=[];var H=[];var E=(I>0)?G.execute(I-1):NaN;for(var C=I;C<F;C++){var B=G.execute(C);if(B>=0){var L=D.toHeight(B);if((C==0||B>=E)&&L>1&&x>1){y.push({x:K+0.5,y:v-L+0.5,w:x-1,h:L-1})}else{J.push({x:K,y:v-L,w:Math.max(x,1),h:Math.max(L,1)})}}else{var L=D.toHeight(-B);if((C==0||B>=E)&&L>1&&x>1){i.push({x:K+0.5,y:v+0.5,w:x-1,h:L-1})}else{H.push({x:K,y:v,w:Math.max(x,1),h:Math.max(L,1)})}}E=B;K+=z}if(y.length>0){M.strokeStyle=w.getColor(Theme.Color.Positive);Plotter.createRectangles(M,y);M.stroke()}if(i.length>0){M.strokeStyle=w.getColor(Theme.Color.Negative);Plotter.createRectangles(M,i);M.stroke()}if(J.length>0){M.fillStyle=w.getColor(Theme.Color.Positive);Plotter.createRectangles(M,J);M.fill()}if(H.length>0){M.fillStyle=w.getColor(Theme.Color.Negative);Plotter.createRectangles(M,H);M.fill()}};IndicatorPlotter.prototype.drawSARPoint=function(C,y,A,w,i,v,s,u,x){var D=u>>1;if(D<0.5){D=0.5}if(D>4){D=4}var E=v;var r=E+D;var B=2*Math.PI;C.save();C.translate(0.5,0.5);C.strokeStyle=y.getColor(Theme.Color.Indicator3);C.beginPath();for(var z=w;z<i;z++){var t=x.toY(A.execute(z));C.moveTo(r,t);C.arc(E,t,D,0,B);E+=s;r+=s}C.stroke();C.restore()};var IndicatorInfoPlotter=create_class(Plotter);IndicatorInfoPlotter.prototype.__construct=function(b){IndicatorInfoPlotter.__super.__construct.call(this,b)};IndicatorInfoPlotter.prototype.Draw=function(E){var s=ChartManager.getInstance();var F=s.getArea(this.getAreaName());var n=s.getTimeline(this.getDataSourceName());var z=s.getDataProvider(this.getAreaName()+".secondary");var x=s.getTheme(this.getFrameName());E.font=x.getFont(Theme.Font.Default);E.textAlign="left";E.textBaseline="top";E.fillStyle=x.getColor(Theme.Color.Text4);var v={x:F.getLeft()+4,y:F.getTop()+2,w:F.getWidth()-8,h:20};var G=z.getIndicator();var u;switch(G.getParameterCount()){case 0:u=G.getName();break;case 1:u=G.getName()+"("+G.getParameterAt(0).getValue()+")";break;case 2:u=G.getName()+"("+G.getParameterAt(0).getValue()+","+G.getParameterAt(1).getValue()+")";break;case 3:u=G.getName()+"("+G.getParameterAt(0).getValue()+","+G.getParameterAt(1).getValue()+","+G.getParameterAt(2).getValue()+")";break;case 4:u=G.getName()+"("+G.getParameterAt(0).getValue()+","+G.getParameterAt(1).getValue()+","+G.getParameterAt(2).getValue()+","+G.getParameterAt(3).getValue()+")";break;default:return}if(!Plotter.drawString(E,u,v)){return}var w=n.getSelectedIndex();if(w<0){return}var y,t,B,A;var C,D=G.getOutputCount();for(C=0;C<D;C++){y=G.getOutputAt(C);t=y.execute(w);if(isNaN(t)){continue}B="  "+y.getName()+": "+t;A=y.getColor();if(A===undefined){A=Theme.Color.Indicator0+C}E.fillStyle=x.getColor(A);if(!Plotter.drawString(E,B,v)){return}}};var MinMaxPlotter=create_class(NamedObject);MinMaxPlotter.prototype.__construct=function(b){MinMaxPlotter.__super.__construct.call(this,b)};MinMaxPlotter.prototype.Draw=function(t){var m=ChartManager.getInstance();
var r=m.getDataSource(this.getDataSourceName());if(r.getDataCount()<1){return}var l=m.getTimeline(this.getDataSourceName());if(l.getInnerWidth()<l.getColumnWidth()){return}var n=m.getRange(this.getAreaName());if(n.getRange()==0){return}var q=m.getDataProvider(this.getAreaName()+".main");var o=l.getFirstIndex();var u=(o+l.getLastIndex())>>1;var p=m.getTheme(this.getFrameName());t.font=p.getFont(Theme.Font.Default);t.textBaseline="middle";t.fillStyle=p.getColor(Theme.Color.Text4);t.strokeStyle=p.getColor(Theme.Color.Text4);var s=r.getDecimalDigits();this.drawMark(t,q.getMinValue(),s,n.toY(q.getMinValue()),o,u,q.getMinValueIndex(),l);this.drawMark(t,q.getMaxValue(),s,n.toY(q.getMaxValue()),o,u,q.getMaxValueIndex(),l)};MinMaxPlotter.prototype.drawMark=function(v,o,u,p,s,y,r,n){var t,w,x;var q;if(r>y){v.textAlign="right";t=n.toItemCenter(r)-4;w=t-7;x=t-3;q=w-4}else{v.textAlign="left";t=n.toItemCenter(r)+4;w=t+7;x=t+3;q=w+4}Plotter.drawLine(v,t,p,w,p);Plotter.drawLine(v,t,p,x,p+2);Plotter.drawLine(v,t,p,x,p-2);v.fillText(String.fromFloat(o,u),q,p)};var TimelinePlotter=create_class(Plotter);TimelinePlotter.prototype.__construct=function(b){TimelinePlotter.__super.__construct.call(this,b)};TimelinePlotter.TP_MINUTE=60*1000;TimelinePlotter.TP_HOUR=60*TimelinePlotter.TP_MINUTE;TimelinePlotter.TP_DAY=24*TimelinePlotter.TP_HOUR;TimelinePlotter.TIME_INTERVAL=[5*TimelinePlotter.TP_MINUTE,10*TimelinePlotter.TP_MINUTE,15*TimelinePlotter.TP_MINUTE,30*TimelinePlotter.TP_MINUTE,TimelinePlotter.TP_HOUR,2*TimelinePlotter.TP_HOUR,3*TimelinePlotter.TP_HOUR,6*TimelinePlotter.TP_HOUR,12*TimelinePlotter.TP_HOUR,TimelinePlotter.TP_DAY,2*TimelinePlotter.TP_DAY];TimelinePlotter.MonthConvert={1:"Jan.",2:"Feb.",3:"Mar.",4:"Apr.",5:"May.",6:"Jun.",7:"Jul.",8:"Aug.",9:"Sep.",10:"Oct.",11:"Nov.",12:"Dec."};TimelinePlotter.prototype.Draw=function(ah){var K=ChartManager.getInstance();var Y=K.getArea(this.getAreaName());var af=K.getTimeline(this.getDataSourceName());if(!Y.isChanged()&&!af.isUpdated()){return}var Q=K.getDataSource(this.getDataSourceName());if(Q.getDataCount()<2){return}var O=Q.getDataAt(1).date-Q.getDataAt(0).date;var M,m=TimelinePlotter.TIME_INTERVAL.length;for(M=0;M<m;M++){if(O<TimelinePlotter.TIME_INTERVAL[M]){break}}for(;M<m;M++){if(TimelinePlotter.TIME_INTERVAL[M]%O==0){if((TimelinePlotter.TIME_INTERVAL[M]/O)*af.getColumnWidth()>60){break}}}var ac=af.getFirstIndex();var aa=af.getLastIndex();var W=new Date();var ag=W.getTimezoneOffset()*60*1000;var S=K.getTheme(this.getFrameName());ah.font=S.getFont(Theme.Font.Default);ah.textAlign="center";ah.textBaseline="middle";var i=K.getLanguage();var ab=[];var U=Y.getTop();var n=Y.getMiddle();for(var d=ac;d<aa;d++){var L=Q.getDataAt(d).date;var ai=L-ag;var ad=new Date(L);var X=ad.getFullYear();var N=ad.getMonth()+1;var T=ad.getDate();var ae=ad.getHours();var R=ad.getMinutes();var V="";if(M<m){var x=Math.max(TimelinePlotter.TP_DAY,TimelinePlotter.TIME_INTERVAL[M]);if(ai%x==0){if(i=="zh-cn"){V=N.toString()+"月"+T.toString()+"日"}else{if(i=="zh-tw"){V=N.toString()+"月"+T.toString()+"日"}else{if(i=="en-us"){V=TimelinePlotter.MonthConvert[N]+" "+T.toString()}}}ah.fillStyle=S.getColor(Theme.Color.Text4)}else{if(ai%TimelinePlotter.TIME_INTERVAL[M]==0){var P=R.toString();if(R<10){P="0"+P}V=ae.toString()+":"+P;ah.fillStyle=S.getColor(Theme.Color.Text2)}}}else{if(T==1&&(ae<(O/TimelinePlotter.TP_HOUR))){if(N==1){V=X.toString();if(i=="zh-cn"){V+="年"}else{if(i=="zh-tw"){V+="年"}}}else{if(i=="zh-cn"){V=N.toString()+"月"}else{if(i=="zh-tw"){V=N.toString()+"月"}else{if(i=="en-us"){V=TimelinePlotter.MonthConvert[N]}}}}ah.fillStyle=S.getColor(Theme.Color.Text4)}}if(V.length>0){var Z=af.toItemCenter(d);ab.push({x:Z,y:U,w:1,h:4});ah.fillText(V,Z,n)}}if(ab.length>0){ah.fillStyle=S.getColor(Theme.Color.Grid1);Plotter.createRectangles(ah,ab);ah.fill()}};var RangePlotter=create_class(NamedObject);RangePlotter.prototype.__construct=function(b){RangePlotter.__super.__construct.call(this,b)};RangePlotter.prototype.getRequiredWidth=function(f,g){var i=ChartManager.getInstance();var h=i.getTheme(this.getFrameName());f.font=h.getFont(Theme.Font.Default);return f.measureText((Math.floor(g)+0.88).toString()).width+16};RangePlotter.prototype.Draw=function(C){var n=ChartManager.getInstance();var x=this.getAreaName();var D=n.getArea(x);var s=x.substring(0,x.lastIndexOf("Range"));var w=n.getRange(s);if(w.getRange()==0){return}var v=w.getNameObject().getCompAt(2)=="main";if(v){}else{if(!D.isChanged()&&!w.isUpdated()){return}}var t=w.getGradations();if(t.length==0){return}var A=D.getLeft();var r=D.getRight();var E=D.getCenter();var y=n.getTheme(this.getFrameName());C.font=y.getFont(Theme.Font.Default);C.textAlign="center";C.textBaseline="middle";C.fillStyle=y.getColor(Theme.Color.Text2);var z=[];for(var B in t){var u=w.toY(t[B]);z.push({x:A,y:u,w:6,h:1});z.push({x:r-6,y:u,w:6,h:1});C.fillText(String.fromFloat(t[B],2),E,u)}if(z.length>0){C.fillStyle=y.getColor(Theme.Color.Grid1);Plotter.createRectangles(C,z);C.fill()}};var COrderGraphPlotter=create_class(NamedObject);
COrderGraphPlotter.prototype.__construct=function(b){COrderGraphPlotter.__super.__construct.call(this,b)};COrderGraphPlotter.prototype.Draw=function(b){return this._Draw_(b)};COrderGraphPlotter.prototype._Draw_=function(g){if(this.Update()==false){return}if(this.updateData()==false){return}this.m_top=this.m_pArea.getTop();this.m_bottom=this.m_pArea.getBottom();this.m_left=this.m_pArea.getLeft();this.m_right=this.m_pArea.getRight();g.save();g.rect(this.m_left,this.m_top,this.m_right-this.m_left,this.m_bottom-this.m_top);g.clip();var i=ChartManager.getInstance().getChart()._depthData;this.x_offset=0;this.y_offset=0;var f={};var h={};f.x=this.m_left+i.array[this.m_ask_si].amounts*this.m_Step;f.y=this.m_pRange.toY(i.array[this.m_ask_si].rate);h.x=this.m_left+i.array[this.m_bid_si].amounts*this.m_Step;h.y=this.m_pRange.toY(i.array[this.m_bid_si].rate);if(Math.abs(f.y-h.y)<1){this.y_offset=1}this.x_offset=1;this.DrawBackground(g);this.UpdatePoints();this.FillBlack(g);this.DrawGradations(g);this.DrawLine(g);g.restore()};COrderGraphPlotter.prototype.DrawBackground=function(h){h.fillStyle=this.m_pTheme.getColor(Theme.Color.Background);h.fillRect(this.m_left,this.m_top,this.m_right-this.m_left,this.m_bottom-this.m_top);var m=ChartManager.getInstance().getChart()._depthData;if(this.m_mode==0){var j=this.m_pRange.toY(m.array[this.m_ask_si].rate)-this.y_offset;var i=this.m_pRange.toY(m.array[this.m_bid_si].rate)+this.y_offset;var k=h.createLinearGradient(this.m_left,0,this.m_right,0);k.addColorStop(0,this.m_pTheme.getColor(Theme.Color.Background));k.addColorStop(1,this.m_pTheme.getColor(Theme.Color.PositiveDark));h.fillStyle=k;h.fillRect(this.m_left,this.m_top,this.m_right-this.m_left,j-this.m_top);var l=h.createLinearGradient(this.m_left,0,this.m_right,0);l.addColorStop(0,this.m_pTheme.getColor(Theme.Color.Background));l.addColorStop(1,this.m_pTheme.getColor(Theme.Color.NegativeDark));h.fillStyle=l;h.fillRect(this.m_left,i,this.m_right-this.m_left,this.m_bottom-i)}else{if(this.m_mode==1){var k=h.createLinearGradient(this.m_left,0,this.m_right,0);k.addColorStop(0,this.m_pTheme.getColor(Theme.Color.Background));k.addColorStop(1,this.m_pTheme.getColor(Theme.Color.PositiveDark));h.fillStyle=k;h.fillRect(this.m_left,this.m_top,this.m_right-this.m_left,this.m_bottom-this.m_top)}else{if(this.m_mode==2){var l=h.createLinearGradient(this.m_left,0,this.m_right,0);l.addColorStop(0,this.m_pTheme.getColor(Theme.Color.Background));l.addColorStop(1,this.m_pTheme.getColor(Theme.Color.NegativeDark));h.fillStyle=l;h.fillRect(this.m_left,this.m_top,this.m_right-this.m_left,this.m_bottom-this.m_top)}}}};COrderGraphPlotter.prototype.DrawLine=function(c){if(this.m_mode==0||this.m_mode==1){c.strokeStyle=this.m_pTheme.getColor(Theme.Color.Positive);c.beginPath();c.moveTo(Math.floor(this.m_ask_points[0].x)+0.5,Math.floor(this.m_ask_points[0].y)+0.5);for(var d=1;d<this.m_ask_points.length;d++){c.lineTo(Math.floor(this.m_ask_points[d].x)+0.5,Math.floor(this.m_ask_points[d].y)+0.5)}c.stroke()}if(this.m_mode==0||this.m_mode==2){c.strokeStyle=this.m_pTheme.getColor(Theme.Color.Negative);c.beginPath();c.moveTo(this.m_bid_points[0].x+0.5,this.m_bid_points[0].y+0.5);for(var d=1;d<this.m_bid_points.length;d++){c.lineTo(this.m_bid_points[d].x+0.5,this.m_bid_points[d].y+0.5)}c.stroke()}};COrderGraphPlotter.prototype.UpdatePoints=function(){var n=ChartManager.getInstance().getChart()._depthData;this.m_ask_points=[];var m={};m.x=Math.floor(this.m_left);m.y=Math.floor(this.m_pRange.toY(n.array[this.m_ask_si].rate)-this.y_offset);this.m_ask_points.push(m);var i=0;for(var o=this.m_ask_si;o>=this.m_ask_ei;o--){var k={};var l={};if(o==this.m_ask_si){k.x=Math.floor(this.m_left+n.array[o].amounts*this.m_Step+this.x_offset);k.y=Math.floor(this.m_pRange.toY(n.array[o].rate)-this.y_offset);this.m_ask_points.push(k);i=1}else{k.x=Math.floor(this.m_left+n.array[o].amounts*this.m_Step+this.x_offset);k.y=Math.floor(this.m_ask_points[i].y);l.x=Math.floor(k.x);l.y=Math.floor(this.m_pRange.toY(n.array[o].rate)-this.y_offset);this.m_ask_points.push(k);i++;this.m_ask_points.push(l);i++}}this.m_bid_points=[];var q={};q.x=Math.floor(this.m_left);q.y=Math.ceil(this.m_pRange.toY(n.array[this.m_bid_si].rate)+this.y_offset);this.m_bid_points.push(q);var p=0;for(var o=this.m_bid_si;o<=this.m_bid_ei;o++){var k={};var l={};if(o==this.m_bid_si){k.x=Math.floor(this.m_left+n.array[o].amounts*this.m_Step+this.x_offset);k.y=Math.ceil(this.m_pRange.toY(n.array[o].rate)+this.y_offset);this.m_bid_points.push(k);p=1}else{k.x=Math.floor(this.m_left+n.array[o].amounts*this.m_Step+this.x_offset);k.y=Math.ceil(this.m_bid_points[p].y);l.x=Math.floor(k.x);l.y=Math.ceil(this.m_pRange.toY(n.array[o].rate)+this.x_offset);this.m_bid_points.push(k);p++;this.m_bid_points.push(l);p++}}};COrderGraphPlotter.prototype.updateData=function(){var h=ChartManager.getInstance().getChart()._depthData;if(h.array==null){return false}if(h.array.length<=50){return false}var g=this.m_pRange.getOuterMinValue();var f=this.m_pRange.getOuterMaxValue();
this.m_ask_si=h.asks_si;this.m_ask_ei=h.asks_si;for(var i=h.asks_si;i>=h.asks_ei;i--){if(h.array[i].rate<f){this.m_ask_ei=i}else{break}}this.m_bid_si=h.bids_si;this.m_bid_ei=h.bids_si;for(var i=h.bids_si;i<=h.bids_ei;i++){if(h.array[i].rate>g){this.m_bid_ei=i}else{break}}if(this.m_ask_ei==this.m_ask_si){this.m_mode=2}else{if(this.m_bid_ei==this.m_bid_si){this.m_mode=1}else{this.m_mode=0}}this.m_Step=this.m_pArea.getWidth();if(this.m_mode==0){if(this.m_ask_ei==h.asks_ei&&this.m_bid_ei==h.bids_ei){this.m_Step/=Math.min(h.array[this.m_ask_ei].amounts,h.array[this.m_bid_ei].amounts)}else{if(this.m_ask_ei!=h.asks_ei&&this.m_bid_ei==h.bids_ei){this.m_Step/=h.array[this.m_bid_ei].amounts}else{if(this.m_ask_ei==h.asks_ei&&this.m_bid_ei!=h.bids_ei){this.m_Step/=h.array[this.m_ask_ei].amounts}else{if(this.m_ask_ei!=h.asks_ei&&this.m_bid_ei!=h.bids_ei){this.m_Step/=Math.max(h.array[this.m_ask_ei].amounts,h.array[this.m_bid_ei].amounts)}}}}}else{if(this.m_mode==1){this.m_Step/=h.array[this.m_ask_ei].amounts}else{if(this.m_mode==2){this.m_Step/=h.array[this.m_bid_ei].amounts}}}return true};COrderGraphPlotter.prototype.Update=function(){this.m_pMgr=ChartManager.getInstance();var c=this.getAreaName();this.m_pArea=this.m_pMgr.getArea(c);if(this.m_pArea==null){return false}var d=c.substring(0,c.lastIndexOf("Range"));this.m_pRange=this.m_pMgr.getRange(d);if(this.m_pRange==null||this.m_pRange.getRange()==0){return false}this.m_pTheme=this.m_pMgr.getTheme(this.getFrameName());if(this.m_pTheme==null){return false}return true};COrderGraphPlotter.prototype.DrawGradations=function(z){var n=ChartManager.getInstance();var u=this.getAreaName();var A=n.getArea(u);var q=u.substring(0,u.lastIndexOf("Range"));var t=n.getRange(q);if(t.getRange()==0){return}var r=t.getGradations();if(r.length==0){return}var x=A.getLeft();var p=A.getRight();var w=[];for(var y in r){var s=t.toY(r[y]);w.push({x:x,y:s,w:6,h:1});w.push({x:p-6,y:s,w:6,h:1})}if(w.length>0){var v=n.getTheme(this.getFrameName());z.fillStyle=v.getColor(Theme.Color.Grid1);Plotter.createRectangles(z,w);z.fill()}};COrderGraphPlotter.prototype.FillBlack=function(n){var q=this.m_ask_points;var m=this.m_bid_points;var k={};var p={};k.x=this.m_right;k.y=q[0].y;p.x=this.m_right;p.y=q[q.length-1].y;var l={};var i={};l.x=this.m_right;l.y=m[0].y-1;i.x=this.m_right;i.y=m[m.length-1].y;q.unshift(k);q.push(p);m.unshift(l);m.push(i);n.fillStyle=this.m_pTheme.getColor(Theme.Color.Background);n.beginPath();n.moveTo(Math.floor(q[0].x)+0.5,Math.floor(q[0].y)+0.5);for(var o=1;o<q.length;o++){n.lineTo(Math.floor(q[o].x)+0.5,Math.floor(q[o].y)+0.5)}n.fill();n.beginPath();n.moveTo(Math.floor(m[0].x)+0.5,Math.floor(m[0].y)+0.5);for(var o=1;o<m.length;o++){n.lineTo(Math.floor(m[o].x)+0.5,Math.floor(m[o].y)+0.5)}n.fill();q.shift();q.pop();m.shift();m.pop()};COrderGraphPlotter.prototype.DrawTickerGraph=function(s){return;var l=ChartManager.getInstance();var r=l.getDataSource(this.getDataSourceName());var m=r._dataItems[r._dataItems.length-1].close;var t=this.m_left+1;var u=this.m_pRange.toY(m);var n=t+5;var o=u+2.5;var p=t+5;var q=u-2.5;s.fillStyle=this.m_pTheme.getColor(Theme.Color.Mark);s.strokeStyle=this.m_pTheme.getColor(Theme.Color.Mark)};var LastVolumePlotter=create_class(Plotter);LastVolumePlotter.prototype.__construct=function(b){LastVolumePlotter.__super.__construct.call(this,b)};LastVolumePlotter.prototype.Draw=function(x){var o=ChartManager.getInstance();var n=o.getTimeline(this.getDataSourceName());var t=this.getAreaName();var y=o.getArea(t);var q=t.substring(0,t.lastIndexOf("Range"));var s=o.getRange(q);if(s.getRange()==0){return}var w=o.getDataSource(this.getDataSourceName());if(w.getDataCount()<1){return}var u=o.getTheme(this.getFrameName());x.font=u.getFont(Theme.Font.Default);x.textAlign="left";x.textBaseline="middle";x.fillStyle=u.getColor(Theme.Color.RangeMark);x.strokeStyle=u.getColor(Theme.Color.RangeMark);var p=w.getDataAt(w.getDataCount()-1).volume;var r=s.toY(p);var v=y.getLeft()+1;Plotter.drawLine(x,v,r,v+7,r);Plotter.drawLine(x,v,r,v+3,r+2);Plotter.drawLine(x,v,r,v+3,r-2);x.fillText(String.fromFloat(p,2),v+10,r)};var LastClosePlotter=create_class(Plotter);LastClosePlotter.prototype.__construct=function(b){LastClosePlotter.__super.__construct.call(this,b)};LastClosePlotter.prototype.Draw=function(x){var o=ChartManager.getInstance();var n=o.getTimeline(this.getDataSourceName());var t=this.getAreaName();var y=o.getArea(t);var q=t.substring(0,t.lastIndexOf("Range"));var s=o.getRange(q);if(s.getRange()==0){return}var w=o.getDataSource(this.getDataSourceName());if(w.getDataCount()<1){return}var p=w._dataItems[w._dataItems.length-1].close;if(p<=s.getMinValue()||p>=s.getMaxValue()){return}var u=o.getTheme(this.getFrameName());x.font=u.getFont(Theme.Font.Default);x.textAlign="left";x.textBaseline="middle";x.fillStyle=u.getColor(Theme.Color.RangeMark);x.strokeStyle=u.getColor(Theme.Color.RangeMark);var r=s.toY(p);var v=y.getLeft()+1;Plotter.drawLine(x,v,r,v+7,r);Plotter.drawLine(x,v,r,v+3,r+2);
Plotter.drawLine(x,v,r,v+3,r-2);x.fillText(String.fromFloat(p,w.getDecimalDigits()),v+10,r)};var SelectionPlotter=create_class(Plotter);SelectionPlotter.prototype.__construct=function(b){SelectionPlotter.__super.__construct.call(this,b)};SelectionPlotter.prototype.Draw=function(q){var n=ChartManager.getInstance();if(n._drawingTool!=ChartManager.DrawingTool.CrossCursor){return}var o=n.getArea(this.getAreaName());var p=n.getTimeline(this.getDataSourceName());if(p.getSelectedIndex()<0){return}var j=n.getRange(this.getAreaName());var m=n.getTheme(this.getFrameName());q.strokeStyle=m.getColor(Theme.Color.Cursor);var k=p.toItemCenter(p.getSelectedIndex());Plotter.drawLine(q,k,o.getTop()-1,k,o.getBottom());var l=j.getSelectedPosition();if(l>=0){Plotter.drawLine(q,o.getLeft(),l,o.getRight(),l)}};var TimelineSelectionPlotter=create_class(NamedObject);TimelineSelectionPlotter.MonthConvert={1:"Jan.",2:"Feb.",3:"Mar.",4:"Apr.",5:"May.",6:"Jun.",7:"Jul.",8:"Aug.",9:"Sep.",10:"Oct.",11:"Nov.",12:"Dec."};TimelineSelectionPlotter.prototype.__construct=function(b){TimelineSelectionPlotter.__super.__construct.call(this,b)};TimelineSelectionPlotter.prototype.Draw=function(N){var w=ChartManager.getInstance();var C=w.getArea(this.getAreaName());var L=w.getTimeline(this.getDataSourceName());if(L.getSelectedIndex()<0){return}var E=w.getDataSource(this.getDataSourceName());if(!is_instance(E,MainDataSource)){return}var B=w.getTheme(this.getFrameName());var v=w.getLanguage();var H=L.toItemCenter(L.getSelectedIndex());N.fillStyle=B.getColor(Theme.Color.Background);N.fillRect(H-52.5,C.getTop()+2.5,106,18);N.strokeStyle=B.getColor(Theme.Color.Grid3);N.strokeRect(H-52.5,C.getTop()+2.5,106,18);N.font=B.getFont(Theme.Font.Default);N.textAlign="center";N.textBaseline="middle";N.fillStyle=B.getColor(Theme.Color.Text4);var I=new Date(E.getDataAt(L.getSelectedIndex()).date);var y=I.getMonth()+1;var A=I.getDate();var J=I.getHours();var F=I.getMinutes();var x=I.getSeconds();var O=y.toString();var K=A.toString();var D=J.toString();var z=F.toString();var M=x.toString();if(F<10){z="0"+z}if(x<10){M="0"+M}var G="";if(v=="zh-cn"){G=O+"月"+K+"日  "+D+":"+z}else{if(v=="zh-tw"){G=O+"月"+K+"日  "+D+":"+z}else{if(v=="en-us"){G=TimelineSelectionPlotter.MonthConvert[y]+" "+K+"  "+D+":"+z}}}if(KlineIns.range<60000){G+=":"+M}N.fillText(G,H,C.getMiddle())};var RangeSelectionPlotter=create_class(NamedObject);RangeSelectionPlotter.prototype.__construct=function(b){RangeSelectionPlotter.__super.__construct.call(this,b)};RangeSelectionPlotter.prototype.Draw=function(v){var n=ChartManager.getInstance();var s=this.getAreaName();var w=n.getArea(s);var m=n.getTimeline(this.getDataSourceName());if(m.getSelectedIndex()<0){return}var p=s.substring(0,s.lastIndexOf("Range"));var r=n.getRange(p);if(r.getRange()==0||r.getSelectedPosition()<0){return}var o=r.getSelectedValue();if(o==-Number.MAX_VALUE){return}var q=r.getSelectedPosition();Plotter.createPolygon(v,[{"x":w.getLeft(),"y":q},{"x":w.getLeft()+5,"y":q+10},{"x":w.getRight()-3,"y":q+10},{"x":w.getRight()-3,"y":q-10},{"x":w.getLeft()+5,"y":q-10}]);var t=n.getTheme(this.getFrameName());v.fillStyle=t.getColor(Theme.Color.Background);v.fill();v.strokeStyle=t.getColor(Theme.Color.Grid4);v.stroke();v.font=t.getFont(Theme.Font.Default);v.textAlign="center";v.textBaseline="middle";v.fillStyle=t.getColor(Theme.Color.Text3);var u=2;if(r.getNameObject().getCompAt(2)=="main"){u=n.getDataSource(this.getDataSourceName()).getDecimalDigits()}v.fillText(String.fromFloat(o,u),w.getCenter(),q)};var ChartSettings={};ChartSettings.checkVersion=function(){if(ChartSettings._data.ver<2){ChartSettings._data.ver=2;var b=ChartSettings._data.charts;b.period_weight={};b.period_weight["line"]=8;b.period_weight["1min"]=7;b.period_weight["5min"]=6;b.period_weight["15min"]=5;b.period_weight["30min"]=4;b.period_weight["1hour"]=3;b.period_weight["1day"]=2;b.period_weight["1week"]=1;b.period_weight["3min"]=0;b.period_weight["2hour"]=0;b.period_weight["4hour"]=0;b.period_weight["6hour"]=0;b.period_weight["12hour"]=0;b.period_weight["3day"]=0}if(ChartSettings._data.ver<3){ChartSettings._data.ver=3;var b=ChartSettings._data.charts;b.areaHeight=[]}};ChartSettings.get=function(){if(ChartSettings._data==undefined){ChartSettings.init();ChartSettings.load();ChartSettings.checkVersion()}return ChartSettings._data};ChartSettings.init=function(){var r={};var j=new Array("MA","EMA","VOLUME","MACD","KDJ","StochRSI","RSI","DMI","OBV","BOLL","DMA","TRIX","BRAR","VR","EMV","WR","ROC","MTM","PSY");for(var q=0;q<j.length;q++){var i=ChartManager.getInstance().createIndicatorAndRange("",j[q],true);if(i==null){continue}r[j[q]]=[];var v=i.indic.getParameters();for(var s=0;s<v.length;s++){r[j[q]].push(v[s])}}var p="CandleStick";var u="MA";var w=new Array("VOLUME","MACD");var o="15m";var t={};t.chartStyle=p;t.mIndic=u;t.indics=w;t.indicsStatus="open";t.period=o;ChartSettings._data={ver:1,charts:t,indics:r,theme:"Dark"};ChartSettings.checkVersion()};ChartSettings.load=function(){if(document.cookie.length<=0){return
}var g=document.cookie.indexOf("chartSettings=");if(g<0){return}g+="chartSettings=".length;var f=document.cookie.indexOf(";",g);if(f<0){f=document.cookie.length}var d=unescape(document.cookie.substring(g,f));ChartSettings._data=JSON.parse(d)};ChartSettings.save=function(){var b=new Date();b.setDate(b.getDate()+2);document.cookie="chartSettings="+escape(JSON.stringify(ChartSettings._data))+";expires="+b.toGMTString()};var CPoint=create_class(NamedObject);CPoint.state={Hide:0,Show:1,Highlight:2};CPoint.prototype.__construct=function(b){CPoint.__super.__construct.call(this,b);this.pos={index:-1,value:-1};this.state=CPoint.state.Hide};CPoint.prototype.getChartObjects=function(){var f=ChartManager.getInstance();var h=f.getDataSource("frame0.k0");if(h==null||!is_instance(h,MainDataSource)){return null}var i=f.getTimeline("frame0.k0");if(i==null){return null}var g=f.getRange("frame0.k0.main");if(g==null){return null}return{pMgr:f,pCDS:h,pTimeline:i,pRange:g}};CPoint.prototype.setPosXY=function(h,j){var k=this.getChartObjects();var l=k.pTimeline.toIndex(h);var m=k.pRange.toValue(j);var i=this.snapValue(l,m);if(i!=null){m=i}this.setPosIV(l,m)};CPoint.prototype.setPosXYNoSnap=function(h,i){var j=this.getChartObjects();var k=j.pTimeline.toIndex(h);var g=j.pRange.toValue(i);this.setPosIV(k,g)};CPoint.prototype.setPosIV=function(c,d){this.pos={index:c,value:d}};CPoint.prototype.getPosXY=function(){var g=this.getChartObjects();var d=g.pTimeline.toItemCenter(this.pos.index);var f=g.pRange.toY(this.pos.value);return{x:d,y:f}};CPoint.prototype.getPosIV=function(){return{i:this.pos.index,v:this.pos.value}};CPoint.prototype.setState=function(b){this.state=b};CPoint.prototype.getState=function(){return this.state};CPoint.prototype.isSelected=function(f,g){var d=this.getPosXY();if(f<d.x-4||f>d.x+4||g<d.y-4||g>d.y+4){return false}this.setState(CPoint.state.Highlight);return true};CPoint.prototype.snapValue=function(x,C){var B=this.getChartObjects();var D=null;var I=Math.floor(B.pTimeline.getFirstIndex());var G=Math.floor(B.pTimeline.getLastIndex());if(x<I||x>G){return D}var F=B.pRange.toY(C);var H=B.pCDS.getDataAt(x);if(H==null||H==undefined){return D}var w=null;if(x>0){w=B.pCDS.getDataAt(x-1)}else{w=B.pCDS.getDataAt(x)}var J=B.pMgr.getChartStyle(B.pCDS.getFrameName());var A=B.pRange.toY(H.open);var E=B.pRange.toY(H.high);var u=B.pRange.toY(H.low);var z=B.pRange.toY(H.close);if(J==="CandleStickHLC"){A=B.pRange.toY(w.close)}var v=Math.abs(A-F);var y=Math.abs(E-F);var i=Math.abs(u-F);var K=Math.abs(z-F);if(v<=y&&v<=i&&v<=K){if(v<6){D=H.open}}if(y<=v&&y<=i&&y<=K){if(y<6){D=H.high}}if(i<=v&&i<=y&&i<=K){if(i<6){D=H.low}}if(K<=v&&K<=y&&K<=i){if(K<6){D=H.close}}return D};var CToolObject=create_class(NamedObject);CToolObject.state={BeforeDraw:0,Draw:1,AfterDraw:2};CToolObject.prototype.__construct=function(b){CToolObject.__super.__construct.call(this,b);this.drawer=null;this.state=CToolObject.state.BeforeDraw;this.points=[];this.step=0};CToolObject.prototype.getChartObjects=function(){var k=ChartManager.getInstance();var i=k.getDataSource("frame0.k0");if(i==null||!is_instance(i,MainDataSource)){return null}var j=k.getTimeline("frame0.k0");if(j==null){return null}var h=k.getArea("frame0.k0.main");if(h==null){return null}var g=k.getRange("frame0.k0.main");if(g==null){return null}return{pMgr:k,pCDS:i,pTimeline:j,pArea:h,pRange:g}};CToolObject.prototype.isValidMouseXY=function(g,h){var f=this.getChartObjects();var i={left:f.pArea.getLeft(),top:f.pArea.getTop(),right:f.pArea.getRight(),bottom:f.pArea.getBottom()};if(g<i.left||g>i.right||h<i.top||h>i.bottom){return false}return true};CToolObject.prototype.getPlotter=function(){return this.drawer};CToolObject.prototype.setState=function(b){this.state=b};CToolObject.prototype.getState=function(){return this.state};CToolObject.prototype.addPoint=function(b){this.points.push(b)};CToolObject.prototype.getPoint=function(b){return this.points[b]};CToolObject.prototype.acceptMouseMoveEvent=function(d,c){if(this.isValidMouseXY(d,c)==false){return false}if(this.state==CToolObject.state.BeforeDraw){this.setBeforeDrawPos(d,c)}else{if(this.state==CToolObject.state.Draw){this.setDrawPos(d,c)}else{if(this.state==CToolObject.state.AfterDraw){this.setAfterDrawPos(d,c)}}}return true};CToolObject.prototype.acceptMouseDownEvent=function(d,c){if(this.isValidMouseXY(d,c)==false){return false}if(this.state==CToolObject.state.BeforeDraw){this.setDrawPos(d,c);this.setState(CToolObject.state.Draw)}else{if(this.state==CToolObject.state.Draw){this.setAfterDrawPos(d,c);if(this.step==0){this.setState(CToolObject.state.AfterDraw)}}else{if(this.state==CToolObject.state.AfterDraw){if(CToolObject.prototype.isSelected.call(this,d,c)){this.setDrawPos(d,c);this.setState(CToolObject.state.Draw)}else{this.oldx=d;this.oldy=c}}}}return true};CToolObject.prototype.acceptMouseDownMoveEvent=function(s,u){if(this.isValidMouseXY(s,u)==false){return false}if(this.state==CToolObject.state.Draw){this.setDrawPos(s,u)}else{if(this.state==CToolObject.state.AfterDraw){var y=this.getChartObjects();
var x=y.pTimeline.getItemWidth();var w=y.pRange;if(Math.abs(s-this.oldx)<x&&Math.abs(u-this.oldy)==0){return true}var q=y.pTimeline.toIndex(this.oldx);var t=y.pRange.toValue(this.oldy);var p=y.pTimeline.toIndex(s);var r=y.pRange.toValue(u);this.oldx=s;this.oldy=u;var n=p-q;var o=r-t;for(var v in this.points){this.points[v].pos.index+=n;this.points[v].pos.value+=o}}}return true};CToolObject.prototype.acceptMouseUpEvent=function(d,c){if(this.isValidMouseXY(d,c)==false){return false}if(this.state==CToolObject.state.Draw){this.setAfterDrawPos(d,c);if(this.step==0){this.setState(CToolObject.state.AfterDraw)}return true}return false};CToolObject.prototype.setBeforeDrawPos=function(f,g){for(var d in this.points){this.points[d].setPosXY(f,g);this.points[d].setState(CPoint.state.Show)}};CToolObject.prototype.setDrawPos=function(f,g){for(var d in this.points){if(this.points[d].getState()==CPoint.state.Highlight){this.points[d].setPosXY(f,g)}}};CToolObject.prototype.setAfterDrawPos=function(g,h){if(this.step!=0){this.step-=1}for(var f in this.points){this.points[f].setState(CPoint.state.Hide)}if(this.step==0){var i=this.getChartObjects();i.pMgr.setNormalMode()}};CToolObject.prototype.isSelected=function(g,h){var i=false;for(var f in this.points){if(this.points[f].isSelected(g,h)){this.points[f].setState(CPoint.state.Highlight);i=true;break}}if(i==true){this.select();return true}return false};CToolObject.prototype.select=function(){for(var b in this.points){if(this.points[b].getState()==CPoint.state.Hide){this.points[b].setState(CPoint.state.Show)}}};CToolObject.prototype.unselect=function(){for(var b in this.points){if(this.points[b].getState()!=CPoint.state.Hide){this.points[b].setState(CPoint.state.Hide)}}};CToolObject.prototype.calcDistance=function(t,w,y){var E=t.getPosXY().x;var v=t.getPosXY().y;var q=w.getPosXY().x;var x=w.getPosXY().y;var r=y.getPosXY().x;var z=y.getPosXY().y;var B=E-r;var D=v-z;var s=q-r;var u=x-z;var C=Math.abs(B*u-D*s);var A=Math.sqrt(Math.pow((q-E),2)+Math.pow((x-v),2));return C/A};CToolObject.prototype.calcGap=function(D,s,u){var E=D.sx;var w=D.sy;var q=D.ex;var x=D.ey;var r=s;var y=u;var A=E-r;var C=w-y;var t=q-r;var v=x-y;var B=Math.abs(A*v-C*t);var z=Math.sqrt(Math.pow((q-E),2)+Math.pow((x-w),2));return B/z};CToolObject.prototype.isWithRect=function(m,p,q){var l=m.getPosXY().x;var n=m.getPosXY().y;var r=p.getPosXY().x;var s=p.getPosXY().y;var k=q.getPosXY().x;var o=q.getPosXY().y;if(l>r){l+=4;r-=4}else{l-=4;r+=4}if(n>s){n+=4;s-=4}else{n-=4;s+=4}if(l<=k&&r>=k&&n<=o&&s>=o){return true}if(l>=k&&r<=k&&n<=o&&s>=o){return true}if(l<=k&&r>=k&&n>=o&&s<=o){return true}if(l>=k&&r<=k&&n>=o&&s<=o){return true}return false};var CBiToolObject=create_class(CToolObject);CBiToolObject.prototype.__construct=function(b){CBiToolObject.__super.__construct.call(this,b);this.addPoint(new CPoint(b));this.addPoint(new CPoint(b))};CBiToolObject.prototype.setBeforeDrawPos=function(d,c){this.step=1;CBiToolObject.__super.setBeforeDrawPos.call(this,d,c);this.getPoint(0).setState(CPoint.state.Show);this.getPoint(1).setState(CPoint.state.Highlight)};var CTriToolObject=create_class(CToolObject);CTriToolObject.prototype.__construct=function(b){CTriToolObject.__super.__construct.call(this,b);this.addPoint(new CPoint(b));this.addPoint(new CPoint(b));this.addPoint(new CPoint(b))};CTriToolObject.prototype.setBeforeDrawPos=function(d,c){this.step=2;CBiToolObject.__super.setBeforeDrawPos.call(this,d,c);this.getPoint(0).setState(CPoint.state.Show);this.getPoint(1).setState(CPoint.state.Show);this.getPoint(2).setState(CPoint.state.Highlight)};CTriToolObject.prototype.setAfterDrawPos=function(g,h){if(this.step!=0){this.step-=1}if(this.step==0){for(var f in this.points){this.points[f].setState(CPoint.state.Hide)}}else{this.getPoint(0).setState(CPoint.state.Show);this.getPoint(1).setState(CPoint.state.Highlight);this.getPoint(2).setState(CPoint.state.Show)}if(this.step==0){var i=this.getChartObjects();i.pMgr.setNormalMode()}};var CBandLineObject=create_class(CBiToolObject);CBandLineObject.prototype.__construct=function(b){CBandLineObject.__super.__construct.call(this,b);this.drawer=new DrawBandLinesPlotter(b,this)};CBandLineObject.prototype.isSelected=function(c,o){if(CBandLineObject.__super.isSelected.call(this,c,o)==true){return true}var p=new CPoint("frame0.k0");p.setPosXY(c,o);var i=this.getPoint(0).getPosXY().x;var n=this.getPoint(0).getPosXY().y;var q=this.getPoint(1).getPosXY().x;var r=this.getPoint(1).getPosXY().y;var u=[100,87.5,75,62.5,50,37.5,25,12.5,0];for(var s=0;s<u.length;s++){var t=n+(100-u[s])/100*(r-n);if(t<o+4&&t>o-4){this.select();return true}}return false};var CBiParallelLineObject=create_class(CTriToolObject);CBiParallelLineObject.prototype.__construct=function(b){CBiParallelLineObject.__super.__construct.call(this,b);this.drawer=new DrawBiParallelLinesPlotter(b,this)};CBiParallelLineObject.prototype.isSelected=function(r,t){if(CTriParallelLineObject.__super.isSelected.call(this,r,t)==true){return true}var s=this.getPoint(0).getPosXY().x;
var v=this.getPoint(0).getPosXY().y;var A=this.getPoint(1).getPosXY().x;var B=this.getPoint(1).getPosXY().y;var E=this.getPoint(2).getPosXY().x;var q=this.getPoint(2).getPosXY().y;var u={x:s-A,y:v-B};var w={x:s-E,y:v-q};var y={x:u.x+w.x,y:u.y+w.y};var x=s-y.x;var z=v-y.y;var C={sx:s,sy:v,ex:E,ey:q};var D={sx:A,sy:B,ex:x,ey:z};if(this.calcGap(C,r,t)>4&&this.calcGap(D,r,t)>4){return false}return true};var CBiParallelRayLineObject=create_class(CTriToolObject);CBiParallelRayLineObject.prototype.__construct=function(b){CBiParallelRayLineObject.__super.__construct.call(this,b);this.drawer=new DrawBiParallelRayLinesPlotter(b,this)};CBiParallelRayLineObject.prototype.isSelected=function(r,t){if(CTriParallelLineObject.__super.isSelected.call(this,r,t)==true){return true}var s=this.getPoint(0).getPosXY().x;var v=this.getPoint(0).getPosXY().y;var A=this.getPoint(1).getPosXY().x;var B=this.getPoint(1).getPosXY().y;var E=this.getPoint(2).getPosXY().x;var q=this.getPoint(2).getPosXY().y;var u={x:s-A,y:v-B};var w={x:s-E,y:v-q};var y={x:u.x+w.x,y:u.y+w.y};var x=s-y.x;var z=v-y.y;var C={sx:s,sy:v,ex:E,ey:q};var D={sx:A,sy:B,ex:x,ey:z};if((C.ex>C.sx&&r>C.sx-4)||(C.ex<C.sx&&r<C.sx+4)||(D.ex>D.sx&&r>D.sx-4)||(D.ex<D.sx&&r<D.sx+4)){if(this.calcGap(C,r,t)>4&&this.calcGap(D,r,t)>4){return false}}else{return false}this.select();return true};var CFibFansObject=create_class(CBiToolObject);CFibFansObject.prototype.__construct=function(b){CFibFansObject.__super.__construct.call(this,b);this.drawer=new DrawFibFansPlotter(b,this)};CFibFansObject.prototype.isSelected=function(K,L){if(CFibFansObject.__super.isSelected.call(this,K,L)==true){return true}var x=new CPoint("frame0.k0");x.setPosXY(K,L);var F=this.getPoint(0).getPosXY().x;var G=this.getPoint(0).getPosXY().y;var y=this.getPoint(1).getPosXY().x;var B=this.getPoint(1).getPosXY().y;var J=this.getChartObjects();var O={left:J.pArea.getLeft(),top:J.pArea.getTop(),right:J.pArea.getRight(),bottom:J.pArea.getBottom()};var M=[0,38.2,50,61.8];for(var C=0;C<M.length;C++){var E=G+(100-M[C])/100*(B-G);var H={x:F,y:G};var D={x:y,y:E};var N=getRectCrossPt(O,H,D);var a=Math.pow((N[0].x-F),2)+Math.pow((N[0].y-G),2);var b=Math.pow((N[0].x-y),2)+Math.pow((N[0].y-B),2);var I=a>b?{x:N[0].x,y:N[0].y}:{x:N[1].x,y:N[1].y};if(I.x>F&&K<F){continue}if(I.x<F&&K>F){continue}var c=new CPoint("frame0.k0");c.setPosXY(F,G);var i=new CPoint("frame0.k0");i.setPosXY(I.x,I.y);if(this.calcDistance(c,i,x)>4){continue}this.select();return true}return false};var CFibRetraceObject=create_class(CBiToolObject);CFibRetraceObject.prototype.__construct=function(b){CFibRetraceObject.__super.__construct.call(this,b);this.drawer=new DrawFibRetracePlotter(b,this)};CFibRetraceObject.prototype.isSelected=function(c,o){if(CFibRetraceObject.__super.isSelected.call(this,c,o)==true){return true}var p=new CPoint("frame0.k0");p.setPosXY(c,o);var i=this.getPoint(0).getPosXY().x;var n=this.getPoint(0).getPosXY().y;var q=this.getPoint(1).getPosXY().x;var r=this.getPoint(1).getPosXY().y;var u=[100,78.6,61.8,50,38.2,23.6,0];for(var s=0;s<u.length;s++){var t=n+(100-u[s])/100*(r-n);if(t<o+4&&t>o-4){this.select();return true}}return false};var CHoriRayLineObject=create_class(CBiToolObject);CHoriRayLineObject.prototype.__construct=function(b){CHoriRayLineObject.__super.__construct.call(this,b);this.drawer=new DrawHoriRayLinesPlotter(b,this)};CHoriRayLineObject.prototype.setDrawPos=function(d,c){if(this.points[0].getState()==CPoint.state.Highlight){this.points[0].setPosXY(d,c);this.points[1].setPosXYNoSnap(this.points[1].getPosXY().x,this.points[0].getPosXY().y);return}if(this.points[1].getState()==CPoint.state.Highlight){this.points[1].setPosXY(d,c);this.points[0].setPosXYNoSnap(this.points[0].getPosXY().x,this.points[1].getPosXY().y)}};CHoriRayLineObject.prototype.isSelected=function(i,j){if(CHoriRayLineObject.__super.isSelected.call(this,i,j)==true){return true}var k=new CPoint("frame0.k0");k.setPosXY(i,j);var m=this.getPoint(0).getPosXY().y;var l=this.getPoint(0).getPosXY().x;var c=this.getPoint(1).getPosXY().x;if(j>m+4||j<m-4){return false}if(c>l&&i<l-4){return false}if(c<l&&i>l+4){return false}this.select();return true};var CHoriSegLineObject=create_class(CBiToolObject);CHoriSegLineObject.prototype.__construct=function(b){CHoriSegLineObject.__super.__construct.call(this,b);this.drawer=new DrawHoriSegLinesPlotter(b,this)};CHoriSegLineObject.prototype.setDrawPos=function(d,c){if(this.points[0].getState()==CPoint.state.Highlight){this.points[0].setPosXY(d,c);this.points[1].setPosXYNoSnap(this.points[1].getPosXY().x,this.points[0].getPosXY().y);return}if(this.points[1].getState()==CPoint.state.Highlight){this.points[1].setPosXY(d,c);this.points[0].setPosXYNoSnap(this.points[0].getPosXY().x,this.points[1].getPosXY().y)}};CHoriSegLineObject.prototype.isSelected=function(i,j){if(CHoriSegLineObject.__super.isSelected.call(this,i,j)==true){return true}var k=new CPoint("frame0.k0");k.setPosXY(i,j);var m=this.getPoint(0).getPosXY().y;var l=this.getPoint(0).getPosXY().x;
var c=this.getPoint(1).getPosXY().x;if(j>m+4||j<m-4){return false}if(l>c&&(i>l+4||i<c-4)){return false}if(l<c&&(i<l-4||i>c+4)){return false}this.select();return true};var CHoriStraightLineObject=create_class(CBiToolObject);CHoriStraightLineObject.prototype.__construct=function(b){CHoriStraightLineObject.__super.__construct.call(this,b);this.drawer=new DrawHoriStraightLinesPlotter(b,this)};CHoriStraightLineObject.prototype.setDrawPos=function(f,g){for(var d in this.points){this.points[d].setPosXY(f,g)}};CHoriStraightLineObject.prototype.isSelected=function(g,h){if(CHoriStraightLineObject.__super.isSelected.call(this,g,h)==true){return true}var i=new CPoint("frame0.k0");i.setPosXY(g,h);var c=this.getPoint(0).getPosXY().y;if(h>c+4||h<c-4){return false}this.select();return true};var CRayLineObject=create_class(CBiToolObject);CRayLineObject.prototype.__construct=function(b){CRayLineObject.__super.__construct.call(this,b);this.drawer=new DrawRayLinesPlotter(b,this)};CRayLineObject.prototype.isSelected=function(h,i){if(CRayLineObject.__super.isSelected.call(this,h,i)==true){return true}var j=new CPoint("frame0.k0");j.setPosXY(h,i);var k=this.getPoint(0).getPosXY().x;var c=this.getPoint(1).getPosXY().x;if(c>k&&h<k-4){return false}if(c<k&&h>k+4){return false}if(this.calcDistance(this.getPoint(0),this.getPoint(1),j)<4){this.select();return true}return false};var CSegLineObject=create_class(CBiToolObject);CSegLineObject.prototype.__construct=function(b){CSegLineObject.__super.__construct.call(this,b);this.drawer=new DrawSegLinesPlotter(b,this)};CSegLineObject.prototype.isSelected=function(f,g){if(CSegLineObject.__super.isSelected.call(this,f,g)==true){return true}var c=new CPoint("frame0.k0");c.setPosXY(f,g);if(this.isWithRect(this.getPoint(0),this.getPoint(1),c)==false){return false}if(this.calcDistance(this.getPoint(0),this.getPoint(1),c)<4){this.select();return true}return false};var CStraightLineObject=create_class(CBiToolObject);CStraightLineObject.prototype.__construct=function(b){CStraightLineObject.__super.__construct.call(this,b);this.drawer=new DrawStraightLinesPlotter(b,this)};CStraightLineObject.prototype.isSelected=function(f,g){if(CStraightLineObject.__super.isSelected.call(this,f,g)==true){return true}var c=new CPoint("frame0.k0");c.setPosXY(f,g);if(this.calcDistance(this.getPoint(0),this.getPoint(1),c)<4){this.select();return true}return false};var CTriParallelLineObject=create_class(CTriToolObject);CTriParallelLineObject.prototype.__construct=function(b){CTriParallelLineObject.__super.__construct.call(this,b);this.drawer=new DrawTriParallelLinesPlotter(b,this)};CTriParallelLineObject.prototype.isSelected=function(I,K){if(CTriParallelLineObject.__super.isSelected.call(this,I,K)==true){return true}var G=this.getChartObjects();var N=this.getPoint(0).getPosXY().x;var O=this.getPoint(0).getPosXY().y;var D=this.getPoint(1).getPosXY().x;var F=this.getPoint(1).getPosXY().y;var X=this.getPoint(2).getPosXY().x;var H=this.getPoint(2).getPosXY().y;var P={x:N-D,y:O-F};var Q={x:N-X,y:O-H};var R={x:P.x+Q.x,y:P.y+Q.y};var L=N-R.x;var M=O-R.y;var J={sx:N,sy:O,ex:X,ey:H};var x={sx:D,sy:F,ex:L,ey:M};var T={x:N-D,y:O-F};var V={x:X-L,y:H-M};var S={x:D-N,y:F-O};var U={x:L-X,y:M-H};var C=Math.abs(S.x-N);var E=Math.abs(S.y-O);var W=Math.abs(U.x-X);var Y=Math.abs(U.y-H);var y={sx:C,sy:E,ex:W,ey:Y};if(this.calcGap(J,I,K)>4&&this.calcGap(x,I,K)>4&&this.calcGap(y,I,K)>4){return false}this.select();return true};var CVertiStraightLineObject=create_class(CBiToolObject);CVertiStraightLineObject.prototype.__construct=function(b){CVertiStraightLineObject.__super.__construct.call(this,b);this.drawer=new DrawVertiStraightLinesPlotter(b,this)};CVertiStraightLineObject.prototype.setDrawPos=function(f,g){for(var d in this.points){this.points[d].setPosXY(f,g)}};CVertiStraightLineObject.prototype.isSelected=function(g,h){if(CVertiStraightLineObject.__super.isSelected.call(this,g,h)==true){return true}var i=new CPoint("frame0.k0");i.setPosXY(g,h);var c=this.getPoint(0).getPosXY().x;if(g>c+4||g<c-4){return false}this.select();return true};var CPriceLineObject=create_class(CSegLineObject);CPriceLineObject.prototype.__construct=function(b){CPriceLineObject.__super.__construct.call(this,b);this.drawer=new DrawPriceLinesPlotter(b,this)};CPriceLineObject.prototype.setDrawPos=function(f,g){for(var d in this.points){this.points[d].setPosXY(f,g)}};CPriceLineObject.prototype.isSelected=function(j,k){if(CFibRetraceObject.__super.isSelected.call(this,j,k)==true){return true}var l=new CPoint("frame0.k0");l.setPosXY(j,k);var m=this.getPoint(0).getPosXY().x;var n=this.getPoint(0).getPosXY().y;var o=this.getPoint(1).getPosXY().x;var c=this.getPoint(1).getPosXY().y;if(j<m-4){return false}if(k>=n+4||k<=n-4){return false}this.select();return true};var CArrowLineObject=create_class(CSegLineObject);CArrowLineObject.prototype.__construct=function(b){CArrowLineObject.__super.__construct.call(this,b);this.drawer=new DrawArrowLinesPlotter(b,this)};var CToolManager=create_class(NamedObject);
CToolManager.prototype.__construct=function(b){CToolManager.__super.__construct.call(this,b);this.selectedObject=-1;this.toolObjects=[]};CToolManager.prototype.getToolObjectCount=function(){return this.toolObjects.length};CToolManager.prototype.addToolObject=function(b){this.toolObjects.push(b)};CToolManager.prototype.getToolObject=function(b){if(b<this.toolObjects.length&&b>=0){return this.toolObjects[b]}return null};CToolManager.prototype.getCurrentObject=function(){return this.getToolObject(this.getToolObjectCount()-1)};CToolManager.prototype.getSelectedObject=function(){return this.getToolObject(this.selectedObject)};CToolManager.prototype.delCurrentObject=function(){this.toolObjects.splice(this.getToolObjectCount()-1,1)};CToolManager.prototype.delSelectedObject=function(){this.toolObjects.splice(this.selectedObject,1);this.selectedObject=-1};CToolManager.prototype.acceptMouseMoveEvent=function(h,i){if(this.selectedObject==-1){var j=this.toolObjects[this.getToolObjectCount()-1];if(j!=null&&j.getState()!=CToolObject.state.AfterDraw){return j.acceptMouseMoveEvent(h,i)}}else{var k=this.toolObjects[this.selectedObject];if(k.getState()==CToolObject.state.Draw){return k.acceptMouseMoveEvent(h,i)}k.unselect();this.selectedObject=-1}for(var g in this.toolObjects){if(this.toolObjects[g].isSelected(h,i)){this.selectedObject=g;return false}}return false};CToolManager.prototype.acceptMouseDownEvent=function(g,h){this.mouseDownMove=false;if(this.selectedObject==-1){var i=this.toolObjects[this.getToolObjectCount()-1];if(i!=null&&i.getState()!=CToolObject.state.AfterDraw){return i.acceptMouseDownEvent(g,h)}}else{var f=this.toolObjects[this.selectedObject];if(f.getState()!=CToolObject.state.BeforeDraw){return f.acceptMouseDownEvent(g,h)}}return false};CToolManager.prototype.acceptMouseDownMoveEvent=function(h,j){this.mouseDownMove=true;if(this.selectedObject==-1){var k=this.toolObjects[this.getToolObjectCount()-1];if(k!=null&&k.getState()==CToolObject.state.Draw){return k.acceptMouseDownMoveEvent(h,j)}return false}else{var l=this.toolObjects[this.selectedObject];if(l.getState()!=CToolObject.state.BeforeDraw){if(l.acceptMouseDownMoveEvent(h,j)==true){var i=this.toolObjects[this.selectedObject].points;for(var m=0;m<i.length;m++){if(i[m].state==CPoint.state.Highlight||i[m].state==CPoint.state.Show){return true}}}return true}}};CToolManager.prototype.acceptMouseUpEvent=function(g,h){if(this.mouseDownMove==true){if(this.selectedObject==-1){var i=this.toolObjects[this.getToolObjectCount()-1];if(i!=null&&i.getState()==CToolObject.state.Draw){return i.acceptMouseUpEvent(g,h)}return true}else{var f=this.toolObjects[this.selectedObject];if(f.getState()!=CToolObject.state.BeforeDraw){return f.acceptMouseUpEvent(g,h)}}}if(this.selectedObject!=-1){return true}var i=this.toolObjects[this.getToolObjectCount()-1];if(i!=null){if(i.getState()==CToolObject.state.Draw){return true}if(!i.isValidMouseXY(g,h)){return false}if(i.isSelected(g,h)){return true}}return false};var CToolPlotter=create_class(NamedObject);CToolPlotter.prototype.__construct=function(g,h){CToolPlotter.__super.__construct.call(this,g);this.toolObject=h;var i=ChartManager.getInstance();var f=i.getArea("frame0.k0.main");if(f==null){this.areaPos={left:0,top:0,right:0,bottom:0};return}this.areaPos={left:f.getLeft(),top:f.getTop(),right:f.getRight(),bottom:f.getBottom()};this.crossPt={};this.normalSize=4;this.selectedSize=6;this.cursorLen=4;this.cursorGapLen=3;this.theme=ChartManager.getInstance().getTheme(this.getFrameName())};CToolPlotter.prototype.drawCursor=function(b){this.drawCrossCursor(b)};CToolPlotter.prototype.drawCrossCursor=function(k){k.strokeStyle=this.theme.getColor(Theme.Color.LineColorNormal);k.fillStyle=this.theme.getColor(Theme.Color.LineColorNormal);var l=this.toolObject.getPoint(0).getPosXY();if(l==null){return}var m=l.x;var j=l.y;var h=this.cursorLen;var i=this.cursorGapLen;k.fillRect(m,j,1,1);Plotter.drawLine(k,m-h-i,j,m-i,j);Plotter.drawLine(k,m+h+i,j,m+i,j);Plotter.drawLine(k,m,j-h-i,m,j-i);Plotter.drawLine(k,m,j+h+i,m,j+i)};CToolPlotter.prototype.drawCircle=function(k,g,h){var i=g.x;var j=g.y;k.beginPath();k.arc(i,j,h,0,2*Math.PI,false);k.fillStyle=this.theme.getColor(Theme.Color.CircleColorFill);k.fill();k.stroke()};CToolPlotter.prototype.drawCtrlPt=function(c){c.strokeStyle=this.theme.getColor(Theme.Color.CircleColorStroke);for(var d=0;d<this.ctrlPtsNum;d++){this.drawCircle(c,this.ctrlPts[1][d],this.normalSize)}};CToolPlotter.prototype.highlightCtrlPt=function(c){c.strokeStyle=this.theme.getColor(Theme.Color.CircleColorStroke);for(var d=0;d<this.ctrlPtsNum;d++){if(this.toolObject.getPoint(d).getState()==CPoint.state.Highlight){this.drawCircle(c,this.ctrlPts[1][d],this.selectedSize)}}};CToolPlotter.prototype.drawFibRayLines=function(n,k,o){for(var i=0;i<this.fiboFansSequence.length;i++){var j=k.y+(100-this.fiboFansSequence[i])/100*(o.y-k.y);var l={x:k.x,y:k.y};var m={x:o.x,y:j};this.drawRayLines(n,l,m)}};CToolPlotter.prototype.drawRayLines=function(o,k,i){this.getAreaPos();
var m={x:k.x,y:k.y};var n={x:i.x,y:i.y};var l=getRectCrossPt(this.areaPos,m,n);var j;if(i.x==k.x){if(i.y==k.y){j=i}else{j=i.y>k.y?{x:l[1].x,y:l[1].y}:{x:l[0].x,y:l[0].y}}}else{j=i.x>k.x?{x:l[1].x,y:l[1].y}:{x:l[0].x,y:l[0].y}}Plotter.drawLine(o,k.x,k.y,j.x,j.y)};CToolPlotter.prototype.lenBetweenPts=function(c,d){return Math.sqrt(Math.pow((d.x-c.x),2)+Math.pow((d.y-c.y),2))};CToolPlotter.prototype.getCtrlPts=function(){for(var b=0;b<this.ctrlPtsNum;b++){this.ctrlPts[0][b]=this.toolObject.getPoint(b)}};CToolPlotter.prototype.updateCtrlPtPos=function(){for(var b=0;b<this.ctrlPtsNum;b++){this.ctrlPts[1][b]=this.ctrlPts[0][b].getPosXY()}};CToolPlotter.prototype.getAreaPos=function(){var c=ChartManager.getInstance();var d=c.getArea("frame0.k0.main");if(d==null){this.areaPos={left:0,top:0,right:0,bottom:0};return}this.areaPos={left:Math.floor(d.getLeft()),top:Math.floor(d.getTop()),right:Math.floor(d.getRight()),bottom:Math.floor(d.getBottom())}};CToolPlotter.prototype.updateDraw=function(b){b.strokeStyle=this.theme.getColor(Theme.Color.LineColorNormal);this.draw(b);this.drawCtrlPt(b)};CToolPlotter.prototype.finishDraw=function(b){b.strokeStyle=this.theme.getColor(Theme.Color.LineColorNormal);this.draw(b)};CToolPlotter.prototype.highlight=function(b){b.strokeStyle=this.theme.getColor(Theme.Color.LineColorSelected);this.draw(b);this.drawCtrlPt(b);this.highlightCtrlPt(b)};var DrawStraightLinesPlotter=create_class(CToolPlotter);DrawStraightLinesPlotter.prototype.__construct=function(d,c){DrawStraightLinesPlotter.__super.__construct.call(this,d,c);this.toolObject=c;this.ctrlPtsNum=2;this.ctrlPts=new Array(new Array(this.ctrlPtsNum),new Array(2));this.getCtrlPts()};DrawStraightLinesPlotter.prototype.draw=function(b){this.updateCtrlPtPos();this.getAreaPos();this.startPoint=this.ctrlPts[1][0];this.endPoint=this.ctrlPts[1][1];if(this.startPoint.x==this.endPoint.x&&this.startPoint.y==this.endPoint.y){Plotter.drawLine(b,this.areaPos.left,this.startPoint.y,this.areaPos.right,this.startPoint.y)}else{this.crossPt=getRectCrossPt(this.areaPos,this.startPoint,this.endPoint);Plotter.drawLine(b,this.crossPt[0].x,this.crossPt[0].y,this.crossPt[1].x,this.crossPt[1].y)}};var DrawSegLinesPlotter=create_class(CToolPlotter);DrawSegLinesPlotter.prototype.__construct=function(d,c){DrawSegLinesPlotter.__super.__construct.call(this,d,c);this.toolObject=c;this.ctrlPtsNum=2;this.ctrlPts=new Array(new Array(this.ctrlPtsNum),new Array(2));this.getCtrlPts()};DrawSegLinesPlotter.prototype.draw=function(b){this.updateCtrlPtPos();this.startPoint=this.ctrlPts[1][0];this.endPoint=this.ctrlPts[1][1];if(this.startPoint.x==this.endPoint.x&&this.startPoint.y==this.endPoint.y){this.endPoint.x+=1}Plotter.drawLine(b,this.startPoint.x,this.startPoint.y,this.endPoint.x,this.endPoint.y)};var DrawRayLinesPlotter=create_class(CToolPlotter);DrawRayLinesPlotter.prototype.__construct=function(d,c){DrawRayLinesPlotter.__super.__construct.call(this,d);this.toolObject=c;this.ctrlPtsNum=2;this.ctrlPts=new Array(new Array(this.ctrlPtsNum),new Array(2));this.getCtrlPts()};DrawRayLinesPlotter.prototype.draw=function(b){this.updateCtrlPtPos();this.getAreaPos();this.startPoint=this.ctrlPts[1][0];this.endPoint=this.ctrlPts[1][1];if(this.startPoint.x==this.endPoint.x&&this.startPoint.y==this.endPoint.y){this.endPoint.x+=1}this.drawRayLines(b,this.startPoint,this.endPoint)};var DrawArrowLinesPlotter=create_class(CToolPlotter);DrawArrowLinesPlotter.prototype.__construct=function(d,c){DrawArrowLinesPlotter.__super.__construct.call(this,d,c);this.toolObject=c;this.arrowSizeRatio=0.03;this.arrowSize=4;this.crossPt={x:-1,y:-1};this.ctrlPtsNum=2;this.ctrlPts=new Array(new Array(this.ctrlPtsNum),new Array(2));this.getCtrlPts()};DrawArrowLinesPlotter.prototype.drawArrow=function(q,r,n){var p=this.lenBetweenPts(r,n);var k=[n.x-r.x,n.y-r.y];this.crossPt.x=r.x+(1-this.arrowSize/p)*k[0];this.crossPt.y=r.y+(1-this.arrowSize/p)*k[1];var l=[-k[1],k[0]];var s={x:l[0],y:l[1]};var m={x:0,y:0};l[0]=this.arrowSize*s.x/this.lenBetweenPts(s,m);l[1]=this.arrowSize*s.y/this.lenBetweenPts(s,m);var o=[this.crossPt.x+l[0],this.crossPt.y+l[1]];Plotter.drawLine(q,n.x,n.y,o[0],o[1]);o=[this.crossPt.x-l[0],this.crossPt.y-l[1]];Plotter.drawLine(q,n.x,n.y,o[0],o[1])};DrawArrowLinesPlotter.prototype.draw=function(b){this.updateCtrlPtPos();this.startPoint=this.ctrlPts[1][0];this.endPoint=this.ctrlPts[1][1];if(this.startPoint.x==this.endPoint.x&&this.startPoint.y==this.endPoint.y){this.endPoint.x+=1}Plotter.drawLine(b,this.startPoint.x,this.startPoint.y,this.endPoint.x,this.endPoint.y);this.drawArrow(b,this.startPoint,this.endPoint)};var DrawHoriStraightLinesPlotter=create_class(CToolPlotter);DrawHoriStraightLinesPlotter.prototype.__construct=function(d,c){DrawHoriStraightLinesPlotter.__super.__construct.call(this,d);this.toolObject=c;this.ctrlPtsNum=1;this.ctrlPts=new Array(new Array(this.ctrlPtsNum),new Array(2));this.getCtrlPts()};DrawHoriStraightLinesPlotter.prototype.draw=function(b){this.updateCtrlPtPos();this.getAreaPos();
this.startPoint=this.ctrlPts[1][0];Plotter.drawLine(b,this.areaPos.left,this.startPoint.y,this.areaPos.right,this.startPoint.y)};var DrawHoriRayLinesPlotter=create_class(CToolPlotter);DrawHoriRayLinesPlotter.prototype.__construct=function(d,c){DrawHoriRayLinesPlotter.__super.__construct.call(this,d);this.toolObject=c;this.ctrlPtsNum=2;this.ctrlPts=new Array(new Array(this.ctrlPtsNum),new Array(2));this.getCtrlPts()};DrawHoriRayLinesPlotter.prototype.draw=function(d){this.updateCtrlPtPos();this.getAreaPos();this.startPoint=this.ctrlPts[1][0];this.endPoint=this.ctrlPts[1][1];if(this.startPoint.x==this.endPoint.x){Plotter.drawLine(d,this.startPoint.x,this.startPoint.y,this.areaPos.right,this.startPoint.y)}else{var c={x:this.endPoint.x,y:this.startPoint.y};this.drawRayLines(d,this.startPoint,c)}};var DrawHoriSegLinesPlotter=create_class(CToolPlotter);DrawHoriSegLinesPlotter.prototype.__construct=function(d,c){DrawHoriSegLinesPlotter.__super.__construct.call(this,d,c);this.toolObject=c;this.ctrlPtsNum=2;this.ctrlPts=new Array(new Array(this.ctrlPtsNum),new Array(2));this.getCtrlPts()};DrawHoriSegLinesPlotter.prototype.draw=function(b){this.updateCtrlPtPos();this.startPoint=this.ctrlPts[1][0];this.endPoint=this.ctrlPts[1][1];this.endPoint.y=this.startPoint.y;if(this.startPoint.x==this.endPoint.x&&this.startPoint.y==this.endPoint.y){Plotter.drawLine(b,this.startPoint.x,this.startPoint.y,this.endPoint.x+1,this.startPoint.y)}else{Plotter.drawLine(b,this.startPoint.x,this.startPoint.y,this.endPoint.x,this.startPoint.y)}};var DrawVertiStraightLinesPlotter=create_class(CToolPlotter);DrawVertiStraightLinesPlotter.prototype.__construct=function(d,c){DrawVertiStraightLinesPlotter.__super.__construct.call(this,d);this.toolObject=c;this.ctrlPtsNum=1;this.ctrlPts=new Array(new Array(this.ctrlPtsNum),new Array(2));this.getCtrlPts()};DrawVertiStraightLinesPlotter.prototype.draw=function(b){this.updateCtrlPtPos();this.getAreaPos();this.startPoint=this.ctrlPts[1][0];Plotter.drawLine(b,this.startPoint.x,this.areaPos.top,this.startPoint.x,this.areaPos.bottom)};var DrawPriceLinesPlotter=create_class(CToolPlotter);DrawPriceLinesPlotter.prototype.__construct=function(d,c){DrawPriceLinesPlotter.__super.__construct.call(this,d);this.toolObject=c;this.ctrlPtsNum=1;this.ctrlPts=new Array(new Array(this.ctrlPtsNum),new Array(2));this.getCtrlPts()};DrawPriceLinesPlotter.prototype.draw=function(d){d.font="12px Tahoma";d.textAlign="left";d.fillStyle=this.theme.getColor(Theme.Color.LineColorNormal);this.updateCtrlPtPos();this.getAreaPos();this.startPoint=this.ctrlPts[1][0];var c=this.ctrlPts[0][0].getPosIV().v;Plotter.drawLine(d,this.startPoint.x,this.startPoint.y,this.areaPos.right,this.startPoint.y);d.fillText(c.toFixed(2),this.startPoint.x+2,this.startPoint.y-15)};var ParallelLinesPlotter=create_class(CToolPlotter);ParallelLinesPlotter.prototype.__construct=function(d,c){ParallelLinesPlotter.__super.__construct.call(this,d);this.toolObject=c};ParallelLinesPlotter.prototype.getParaPt=function(){var c=[];c[0]=this.endPoint.x-this.startPoint.x;c[1]=this.endPoint.y-this.startPoint.y;var d=[];d[0]=this.paraStartPoint.x-this.startPoint.x;d[1]=this.paraStartPoint.y-this.startPoint.y;this.paraEndPoint={x:-1,y:-1};this.paraEndPoint.x=c[0]+d[0]+this.startPoint.x;this.paraEndPoint.y=c[1]+d[1]+this.startPoint.y};var DrawBiParallelLinesPlotter=create_class(ParallelLinesPlotter);DrawBiParallelLinesPlotter.prototype.__construct=function(d,c){DrawBiParallelLinesPlotter.__super.__construct.call(this,d,c);this.toolObject=c;this.ctrlPtsNum=3;this.ctrlPts=new Array(new Array(this.ctrlPtsNum),new Array(2));this.getCtrlPts()};DrawBiParallelLinesPlotter.prototype.draw=function(b){this.updateCtrlPtPos();this.getAreaPos();this.startPoint=this.ctrlPts[1][0];this.paraStartPoint=this.ctrlPts[1][1];this.endPoint=this.ctrlPts[1][2];this.getParaPt();this.getAreaPos();this.crossPt0=getRectCrossPt(this.areaPos,this.startPoint,this.endPoint);Plotter.drawLine(b,this.crossPt0[0].x,this.crossPt0[0].y,this.crossPt0[1].x,this.crossPt0[1].y);this.crossPt1=getRectCrossPt(this.areaPos,this.paraStartPoint,this.paraEndPoint);Plotter.drawLine(b,this.crossPt1[0].x,this.crossPt1[0].y,this.crossPt1[1].x,this.crossPt1[1].y)};var DrawBiParallelRayLinesPlotter=create_class(ParallelLinesPlotter);DrawBiParallelRayLinesPlotter.prototype.__construct=function(d,c){DrawBiParallelRayLinesPlotter.__super.__construct.call(this,d,c);this.toolObject=c;this.ctrlPtsNum=3;this.ctrlPts=new Array(new Array(this.ctrlPtsNum),new Array(2));this.getCtrlPts()};DrawBiParallelRayLinesPlotter.prototype.draw=function(b){this.updateCtrlPtPos();this.getAreaPos();this.startPoint=this.ctrlPts[1][0];this.paraStartPoint=this.ctrlPts[1][1];this.endPoint=this.ctrlPts[1][2];if(this.startPoint.x==this.endPoint.x&&this.startPoint.y==this.endPoint.y){this.endPoint.x+=1}this.getParaPt();this.drawRayLines(b,this.startPoint,this.endPoint);this.drawRayLines(b,this.paraStartPoint,this.paraEndPoint)};var DrawTriParallelLinesPlotter=create_class(ParallelLinesPlotter);
DrawTriParallelLinesPlotter.prototype.__construct=function(d,c){DrawTriParallelLinesPlotter.__super.__construct.call(this,d,c);this.toolObject=c;this.ctrlPtsNum=3;this.ctrlPts=new Array(new Array(this.ctrlPtsNum),new Array(2));this.getCtrlPts()};DrawTriParallelLinesPlotter.prototype.draw=function(g){this.updateCtrlPtPos();this.getAreaPos();this.startPoint=this.ctrlPts[1][0];this.paraStartPoint=this.ctrlPts[1][1];this.endPoint=this.ctrlPts[1][2];var d=[];d[0]=this.endPoint.x-this.startPoint.x;d[1]=this.endPoint.y-this.startPoint.y;var f=[];f[0]=this.paraStartPoint.x-this.startPoint.x;f[1]=this.paraStartPoint.y-this.startPoint.y;this.para1EndPoint={x:-1,y:-1};this.para2EndPoint={x:-1,y:-1};this.para2StartPoint={x:-1,y:-1};this.para1EndPoint.x=d[0]+f[0]+this.startPoint.x;this.para1EndPoint.y=d[1]+f[1]+this.startPoint.y;this.para2StartPoint.x=this.startPoint.x-f[0];this.para2StartPoint.y=this.startPoint.y-f[1];this.para2EndPoint.x=this.endPoint.x-f[0];this.para2EndPoint.y=this.endPoint.y-f[1];this.getAreaPos();this.crossPt0=getRectCrossPt(this.areaPos,this.startPoint,this.endPoint);Plotter.drawLine(g,this.crossPt0[0].x,this.crossPt0[0].y,this.crossPt0[1].x,this.crossPt0[1].y);this.crossPt1=getRectCrossPt(this.areaPos,this.paraStartPoint,this.para1EndPoint);Plotter.drawLine(g,this.crossPt1[0].x,this.crossPt1[0].y,this.crossPt1[1].x,this.crossPt1[1].y);this.crossPt2=getRectCrossPt(this.areaPos,this.para2StartPoint,this.para2EndPoint);Plotter.drawLine(g,this.crossPt2[0].x,this.crossPt2[0].y,this.crossPt2[1].x,this.crossPt2[1].y)};var BandLinesPlotter=create_class(CToolPlotter);BandLinesPlotter.prototype.__construct=function(d,c){BandLinesPlotter.__super.__construct.call(this,d);this.toolObject=c;this.ctrlPtsNum=2;this.ctrlPts=new Array(new Array(this.ctrlPtsNum),new Array(2));this.getCtrlPts()};BandLinesPlotter.prototype.drawLinesAndInfo=function(n,l,o){n.font="12px Tahoma";n.textAlign="left";n.fillStyle=this.theme.getColor(Theme.Color.LineColorNormal);var k;if(this.toolObject.state==CToolObject.state.Draw){this.startPtValue=this.toolObject.getPoint(0).getPosIV().v;this.endPtValue=this.toolObject.getPoint(1).getPosIV().v}this.getAreaPos();for(var i=0;i<this.fiboSequence.length;i++){var j=l.y+(100-this.fiboSequence[i])/100*(o.y-l.y);if(j>this.areaPos.bottom){continue}var m=this.startPtValue+(100-this.fiboSequence[i])/100*(this.endPtValue-this.startPtValue);Plotter.drawLine(n,this.areaPos.left,j,this.areaPos.right,j);k=this.fiboSequence[i].toFixed(1)+"% "+m.toFixed(1);n.fillText(k,this.areaPos.left+2,j-15)}};BandLinesPlotter.prototype.draw=function(b){this.updateCtrlPtPos();this.getAreaPos();this.startPoint=this.ctrlPts[1][0];this.endPoint=this.ctrlPts[1][1];this.drawLinesAndInfo(b,this.startPoint,this.endPoint)};var DrawFibRetracePlotter=create_class(BandLinesPlotter);DrawFibRetracePlotter.prototype.__construct=function(d,c){DrawFibRetracePlotter.__super.__construct.call(this,d,c);this.toolObject=c;this.fiboSequence=[100,78.6,61.8,50,38.2,23.6,0]};var DrawBandLinesPlotter=create_class(BandLinesPlotter);DrawBandLinesPlotter.prototype.__construct=function(d,c){DrawBandLinesPlotter.__super.__construct.call(this,d,c);this.toolObject=c;this.fiboSequence=[0,12.5,25,37.5,50,62.5,75,87.5,100]};var DrawFibFansPlotter=create_class(CToolPlotter);DrawFibFansPlotter.prototype.__construct=function(d,c){DrawFibFansPlotter.__super.__construct.call(this,d);this.toolObject=c;this.fiboFansSequence=[0,38.2,50,61.8];this.ctrlPtsNum=2;this.ctrlPts=new Array(new Array(this.ctrlPtsNum),new Array(2));this.getCtrlPts()};DrawFibFansPlotter.prototype.drawLinesAndInfo=function(d,g,f){this.drawFibRayLines(d,g,f)};DrawFibFansPlotter.prototype.draw=function(b){this.updateCtrlPtPos();this.getAreaPos();this.startPoint=this.ctrlPts[1][0];this.endPoint=this.ctrlPts[1][1];if(this.startPoint.x==this.endPoint.x&&this.startPoint.y==this.endPoint.y){this.endPoint.x+=1}this.drawLinesAndInfo(b,this.startPoint,this.endPoint)};var CDynamicLinePlotter=create_class(NamedObject);CDynamicLinePlotter.prototype.__construct=function(b){CDynamicLinePlotter.__super.__construct.call(this,b);this.flag=true;this.context=ChartManager.getInstance()._overlayContext};CDynamicLinePlotter.prototype.getAreaPos=function(){var c=ChartManager.getInstance();var d=c.getArea("frame0.k0.main");if(d==null){this.areaPos={left:0,top:0,right:0,bottom:0};return}this.areaPos={left:Math.floor(d.getLeft()),top:Math.floor(d.getTop()),right:Math.floor(d.getRight()),bottom:Math.floor(d.getBottom())}};CDynamicLinePlotter.prototype.Draw=function(i){this.getAreaPos();var m=ChartManager.getInstance();var l=m.getDataSource(this.getDataSourceName());if(l==null||!is_instance(l,MainDataSource)){return}this.context.save();this.context.rect(this.areaPos.left,this.areaPos.top,this.areaPos.right-this.areaPos.left,this.areaPos.bottom-this.areaPos.top);this.context.clip();var q=l.getToolObjectCount();for(var k=0;k<q;k++){var n=l.getToolObject(k);var o=n.getState();switch(o){case CToolObject.state.BeforeDraw:n.getPlotter().theme=ChartManager.getInstance().getTheme(this.getFrameName());
n.getPlotter().drawCursor(this.context);break;case CToolObject.state.Draw:n.getPlotter().theme=ChartManager.getInstance().getTheme(this.getFrameName());n.getPlotter().updateDraw(this.context);break;case CToolObject.state.AfterDraw:n.getPlotter().theme=ChartManager.getInstance().getTheme(this.getFrameName());n.getPlotter().finishDraw(this.context);break;default:break}}var p=l.getSelectToolObjcet();if(p!=null&&p!=CToolObject.state.Draw){p.getPlotter().highlight(this.context)}this.context.restore();return};var scroll=0;$("body").on("click","#sizeIcon",function(){console.log(scroll);KlineIns.isSized=!KlineIns.isSized;if(KlineIns.isSized){console.log($(KlineIns.element).parents("iframe"));$(KlineIns.element).css({position:"fixed",left:"0",right:"0",top:"0",bottom:"0",width:"100%",height:"100%",zIndex:"10000"});scroll=$(window).scrollTop();on_size();$("html,body").css({width:"100%",height:"100%",overflow:"hidden"})}else{$(KlineIns.element).attr("style","");$("html,body").attr("style","");on_size(KlineIns.width,KlineIns.height);$(KlineIns.element).css({visibility:"visible",height:KlineIns.height+"px"});window.scrollTo(0,scroll)}});function KLineMouseEvent(){$(document).ready(function(){function b(){if(navigator.userAgent.indexOf("Firefox")>=0){setTimeout(function(){on_size(KlineIns.width,KlineIns.height)},200)}else{on_size(KlineIns.width,KlineIns.height)}}$("#chart_overlayCanvas").bind("contextmenu",function(a){a.cancelBubble=true;a.returnValue=false;a.preventDefault();a.stopPropagation();return false});$(".chart_container .chart_dropdown .chart_dropdown_t").mouseover(function(){var s=$(".chart_container");var n=$(this);var a=n.next();var r=s.offset().left;var q=n.offset().left;var m=s.width();var d=n.width();var o=a.width();var p=((o-d)/2)<<0;if(q-p<r+4){p=q-r-4}else{if(q+d+p>r+m-4){p+=q+d+p-(r+m-4)+19}else{p+=4}}a.css({"margin-left":-p});n.addClass("chart_dropdown-hover");a.addClass("chart_dropdown-hover")}).mouseout(function(){$(this).next().removeClass("chart_dropdown-hover");$(this).removeClass("chart_dropdown-hover")});$(".chart_dropdown_data").mouseover(function(){$(this).addClass("chart_dropdown-hover");$(this).prev().addClass("chart_dropdown-hover")}).mouseout(function(){$(this).prev().removeClass("chart_dropdown-hover");$(this).removeClass("chart_dropdown-hover")});$("#chart_btn_parameter_settings").click(function(){$("#chart_parameter_settings").addClass("clicked");$(".chart_dropdown_data").removeClass("chart_dropdown-hover");$("#chart_parameter_settings").find("th").each(function(){var i=$(this).html();var a=0;var h=ChartSettings.get();var g=h.indics[i];$(this.nextElementSibling).find("input").each(function(){if(g!=null&&a<g.length){$(this).val(g[a])}a++})})});$("#close_settings").click(function(){$("#chart_parameter_settings").removeClass("clicked")});$(".chart_container .chart_toolbar_tabgroup a").click(function(){switch_period($(this).parent().attr("name"))});$("#chart_toolbar_periods_vert ul a").click(function(){switch_period($(this).parent().attr("name"))});$(".market_chooser ul a").click(function(){switch_symbol($(this).attr("name"))});$("#chart_show_tools").click(function(){if($(this).hasClass("selected")){switch_tools("off")}else{switch_tools("on")}});$("#chart_toolpanel .chart_toolpanel_button").click(function(){$(".chart_dropdown_data").removeClass("chart_dropdown-hover");$("#chart_toolpanel .chart_toolpanel_button").removeClass("selected");$(this).addClass("selected");var a=$(this).children().attr("name");KlineIns.chartMgr.setRunningMode(ChartManager.DrawingTool[a])});$("#chart_show_indicator").click(function(){if($(this).hasClass("selected")){switch_indic("off")}else{switch_indic("on")}});$("#chart_tabbar li a").click(function(){$("#chart_tabbar li a").removeClass("selected");$(this).addClass("selected");var a=$(this).attr("name");var d=ChartSettings.get();d.charts.indics[1]=a;ChartSettings.save();if(Template.displayVolume==false){ChartManager.getInstance().getChart().setIndicator(1,a)}else{ChartManager.getInstance().getChart().setIndicator(2,a)}});$("#chart_select_chart_style a").click(function(){$("#chart_select_chart_style a").removeClass("selected");$(this).addClass("selected");var a=ChartSettings.get();a.charts.chartStyle=$(this)[0].innerHTML;ChartSettings.save();var d=ChartManager.getInstance();d.setChartStyle("frame0.k0",$(this).html());d.redraw()});$("#chart_dropdown_themes li").click(function(){$("#chart_dropdown_themes li a").removeClass("selected");var a=$(this).attr("name");if(a=="chart_themes_dark"){switch_theme("dark")}else{if(a=="chart_themes_light"){switch_theme("light")}}});$("#chart_select_main_indicator a").click(function(){$("#chart_select_main_indicator a").removeClass("selected");$(this).addClass("selected");var a=$(this).attr("name");var g=ChartSettings.get();g.charts.mIndic=a;ChartSettings.save();var f=ChartManager.getInstance();if(!f.setMainIndicator("frame0.k0",a)){f.removeMainIndicator("frame0.k0")}f.redraw()});$("#chart_toolbar_theme a").click(function(){$("#chart_toolbar_theme a").removeClass("selected");
if($(this).attr("name")=="dark"){switch_theme("dark")}else{if($(this).attr("name")=="light"){switch_theme("light")}}});$("#chart_select_theme li a").click(function(){$("#chart_select_theme a").removeClass("selected");if($(this).attr("name")=="dark"){switch_theme("dark")}else{if($(this).attr("name")=="light"){switch_theme("light")}}});$("#chart_enable_tools li a").click(function(){$("#chart_enable_tools a").removeClass("selected");if($(this).attr("name")=="on"){switch_tools("on")}else{if($(this).attr("name")=="off"){switch_tools("off")}}});$("#chart_enable_indicator li a").click(function(){$("#chart_enable_indicator a").removeClass("selected");if($(this).attr("name")=="on"){switch_indic("on")}else{if($(this).attr("name")=="off"){switch_indic("off")}}});$("#chart_language_setting_div li a").click(function(){$("#chart_language_setting_div a").removeClass("selected");if($(this).attr("name")=="zh-cn"){chart_switch_language("zh-cn")}else{if($(this).attr("name")=="en-us"){chart_switch_language("en-us")}else{if($(this).attr("name")=="zh-tw"){chart_switch_language("zh-tw")}}}});$(document).keyup(function(a){if(a.keyCode==46){ChartManager.getInstance().deleteToolObject();ChartManager.getInstance().redraw("OverlayCanvas",false)}});$("#clearCanvas").click(function(){var f=ChartManager.getInstance().getDataSource("frame0.k0");var a=f.getToolObjectCount();for(var g=0;g<a;g++){f.delToolObject()}ChartManager.getInstance().redraw("OverlayCanvas",false)});$("#chart_overlayCanvas").mousemove(function(i){var k=i.target.getBoundingClientRect();var a=i.clientX-k.left;var h=i.clientY-k.top;var j=ChartManager.getInstance();if(KlineIns.buttonDown==true){j.onMouseMove("frame0",a,h,true);j.redraw("All",false)}else{j.onMouseMove("frame0",a,h,false);j.redraw("OverlayCanvas")}}).mouseleave(function(i){var k=i.target.getBoundingClientRect();var a=i.clientX-k.left;var h=i.clientY-k.top;var j=ChartManager.getInstance();j.onMouseLeave("frame0",a,h,false);j.redraw("OverlayCanvas")}).mouseup(function(i){if(i.which!=1){return}KlineIns.buttonDown=false;var k=i.target.getBoundingClientRect();var a=i.clientX-k.left;var h=i.clientY-k.top;var j=ChartManager.getInstance();j.onMouseUp("frame0",a,h);j.redraw("All")}).mousedown(function(h){if(h.which!=1){ChartManager.getInstance().deleteToolObject();ChartManager.getInstance().redraw("OverlayCanvas",false);return}KlineIns.buttonDown=true;var i=h.target.getBoundingClientRect();var a=h.clientX-i.left;var g=h.clientY-i.top;ChartManager.getInstance().onMouseDown("frame0",a,g)});$("#chart_parameter_settings :input").change(function(){var n=$(this).attr("name");var o=0;var l=[];var j=ChartManager.getInstance();$("#chart_parameter_settings :input").each(function(){if($(this).attr("name")==n){if($(this).val()!=""&&$(this).val()!=null&&$(this).val()!=undefined){var c=parseInt($(this).val());l.push(c)}o++}});if(l.length!=0){j.setIndicatorParameters(n,l);var k=j.getIndicatorParameters(n);var a=[];o=0;$("#chart_parameter_settings :input").each(function(){if($(this).attr("name")==n){if($(this).val()!=""&&$(this).val()!=null&&$(this).val()!=undefined){$(this).val(k[o].getValue());a.push(k[o].getValue())}o++}});var m=ChartSettings.get();m.indics[n]=a;ChartSettings.save();j.redraw("All",false)}});$("#chart_parameter_settings button").click(function(){var k=$(this).parents("tr").children("th").html();var a=0;var h=ChartManager.getInstance().getIndicatorParameters(k);var i=[];$(this).parent().prev().children("input").each(function(){if(h!=null&&a<h.length){$(this).val(h[a].getDefaultValue());i.push(h[a].getDefaultValue())}a++});ChartManager.getInstance().setIndicatorParameters(k,i);var j=ChartSettings.get();j.indics[k]=i;ChartSettings.save();ChartManager.getInstance().redraw("All",false)})})}var refresh_counter=0;var refresh_handler=null;function refresh_function(){refresh_counter++;var c=ChartManager.getInstance().getLanguage();if(refresh_counter>3600){var d=new Number(refresh_counter/3600);if(c=="en-us"){$("#chart_updated_time_text").html(d.toFixed(0)+"h")}else{if(c=="zh-tw"){$("#chart_updated_time_text").html(d.toFixed(0)+"小時")}else{$("#chart_updated_time_text").html(d.toFixed(0)+"小时")}}}else{if(refresh_counter>60&&refresh_counter<=3600){var d=new Number(refresh_counter/60);if(c=="en-us"){$("#chart_updated_time_text").html(d.toFixed(0)+"m")}else{if(c=="zh-tw"){$("#chart_updated_time_text").html(d.toFixed(0)+"分鐘")}else{$("#chart_updated_time_text").html(d.toFixed(0)+"分钟")}}}else{if(refresh_counter<=60){if(c=="en-us"){$("#chart_updated_time_text").html(refresh_counter+"s")}else{$("#chart_updated_time_text").html(refresh_counter+"秒")}}}}}function clear_refresh_counter(){window.clearInterval(refresh_handler);refresh_counter=0;var b=ChartManager.getInstance().getLanguage();if(b=="en-us"){$("#chart_updated_time_text").html(refresh_counter+"s")}else{$("#chart_updated_time_text").html(refresh_counter+"秒")}refresh_handler=setInterval(refresh_function,KlineIns.intervalTime)}function RequestData(b){AbortRequest();window.clearTimeout(KlineIns.timer);
if(KlineIns.paused){return}if(b==true){$("#chart_loading").addClass("activated")}if(KlineIns.type=="socket"&&KlineIns.socket){requestOverSocket()}else{requestOverHttp()}}function parseRequestParam(b){return JSON.parse('{"'+decodeURI(b.replace(/&/g,'","').replace(/=/g,'":"'))+'"}')}function requestOverSocket(){if(!KlineIns.socketConnected){if(KlineIns.debug){console.log("DEBUG: socket is not coonnected")}return}if(KlineIns.socketClient&&KlineIns.socketClient.ws.readyState==1){KlineIns.socketClient.send(KlineIns.sendPath,{},JSON.stringify(parseRequestParam(KlineIns.requestParam)));return}if(KlineIns.debug){console.log("DEBUG: socket client is not ready yet ...")}KlineIns.timer=setTimeout(function(){RequestData(true)},1000)}function gapTimeStamp2(){return new Date().getTimezoneOffset()*60000}function dataChange2(k){var h=k.length;var j={success:true,data:{lines:[]}};for(var m=0;m<h;m++){var l=k[m];var i=[];i.push(l.timestamp*1000);i.push(l.popen);i.push(l.high);i.push(l.low);i.push(l.pclose);i.push(l.volume?l.volume:null);j.data.lines.push(i)}console.log(j);return(j)}function requestOverHttp(){if(KlineIns.debug){console.log("DEBUG: "+KlineIns.requestParam)}$(document).ready(KlineIns.G_HTTP_REQUEST=$.ajax({type:"GET",url:KlineIns.url,dataType:"json",timeout:30000,created:Date.now(),beforeSend:function(){this.range=KlineIns.range;this.symbol=KlineIns.symbol},success:function(b){if(KlineIns.G_HTTP_REQUEST){requestSuccessHandler(dataChange2(b))}},error:function(d,g,f){if(KlineIns.debug){console.log(d)}if(d.status==200&&d.readyState==4){return}KlineIns.timer=setTimeout(function(){RequestData(true)},KlineIns.intervalTime);console.log(KlineIns.url);console.log(d)},complete:function(){KlineIns.G_HTTP_REQUEST=null}}))}function requestSuccessHandler(res){if(KlineIns.debug){console.log(res)}if(!res||!res.success){KlineIns.timer=setTimeout(function(){RequestData(true)},KlineIns.intervalTime);return}$("#chart_loading").removeClass("activated");var chart=ChartManager.getInstance().getChart();chart.setTitle();KlineIns.data=eval(res.data);var updateDataRes=KlineIns.chartMgr.updateData("frame0.k0",KlineIns.data.lines);KlineIns.requestParam=setHttpRequestParam(KlineIns.symbol,KlineIns.range,null,KlineIns.chartMgr.getDataSource("frame0.k0").getLastDate());var intervalTime=KlineIns.intervalTime<KlineIns.range?KlineIns.intervalTime:KlineIns.range;if(!updateDataRes){KlineIns.timer=setTimeout(RequestData,intervalTime);return}if(KlineIns.data.trades&&KlineIns.data.trades.length>0){KlineTradeIns.pushTrades(KlineIns.data.trades);KlineTradeIns.klineTradeInit=true}if(KlineIns.data.depths){KlineTradeIns.updateDepth(KlineIns.data.depths)}clear_refresh_counter();KlineIns.timer=setTimeout(TwoSecondThread,intervalTime);ChartManager.getInstance().redraw("All",true)}function AbortRequest(){if(KlineIns.type!="socket"||!KlineIns.socketClient){if(KlineIns.G_HTTP_REQUEST&&KlineIns.G_HTTP_REQUEST.readyState!=4){KlineIns.G_HTTP_REQUEST.abort()}}}function TwoSecondThread(){var b=KlineIns.chartMgr.getDataSource("frame0.k0").getLastDate();if(b==-1){KlineIns.requestParam=setHttpRequestParam(KlineIns.symbol,KlineIns.range,KlineIns.limit,null)}else{KlineIns.requestParam=setHttpRequestParam(KlineIns.symbol,KlineIns.range,null,b.toString())}RequestData()}function readCookie(){ChartSettings.get();ChartSettings.save();var g=ChartSettings.get();ChartManager.getInstance().setChartStyle("frame0.k0",g.charts.chartStyle);var j=g.charts.symbol;if(!KlineIns.init){j=KlineIns.symbol;KlineIns.init=true}KlineIns.symbol=j;switch_symbol_selected(j);var i=g.charts.period;switch_period(i);$("#chart_period_"+i+"_v a").addClass("selected");$("#chart_period_"+i+"_h a").addClass("selected");if(g.charts.indicsStatus=="close"){switch_indic("off")}else{if(g.charts.indicsStatus=="open"){switch_indic("on")}}var h=$("#chart_select_main_indicator");h.find("a").each(function(){if($(this).attr("name")==g.charts.mIndic){$(this).addClass("selected")}});var k=$("#chart_select_chart_style");k.find("a").each(function(){if($(this)[0].innerHTML==g.charts.chartStyle){$(this).addClass("selected")}});ChartManager.getInstance().getChart().setMainIndicator(g.charts.mIndic);ChartManager.getInstance().setThemeName("frame0",g.theme);switch_tools("off");if(g.theme=="Dark"){switch_theme("dark")}else{if(g.theme=="Light"){switch_theme("light")}}chart_switch_language(g.language||"zh-cn")}function setHttpRequestParam(k,g,h,i){var j="symbol="+k+"&range="+g;if(h!=null){j+="&limit="+h}else{j+="&since="+i}if(KlineTradeIns.tradeDate.getTime()!=0){j+="&prevTradeTime="+KlineTradeIns.tradeDate.getTime()}return j}function refreshTemplate(){KlineIns.chartMgr=DefaultTemplate.loadTemplate("frame0.k0","");ChartManager.getInstance().redraw("All",true)}function getRectCrossPt(l,q,n){var r;var k={x:-1,y:-1};var s={x:-1,y:-1};var m=n.x-q.x;var p=n.y-q.y;if(Math.abs(m)<2){k={x:q.x,y:l.top};s={x:n.x,y:l.bottom};r=[k,s];return r}var o=p/m;s.x=l.right;s.y=q.y+(l.right-q.x)*o;k.x=l.left;k.y=q.y+(l.left-q.x)*o;r=[k,s];return r}function chart_switch_language(c){var d=c.replace(/-/,"_");
$("#chart_language_switch_tmp").find("span").each(function(){var b=$(this).attr("name");var g=$(this).attr(d);b="."+b;var a=$(b)[0];if(!a){return}$(b).each(function(){$(this)[0].innerHTML=g})});$("#chart_language_setting_div li a[name='"+c+"']").addClass("selected");ChartManager.getInstance().setLanguage(c);ChartManager.getInstance().getChart().setTitle();var d=ChartSettings.get();d.language=c;ChartSettings.save();KlineIns.onLangChange(c)}function on_size(S,P){var au=S||window.innerWidth;var ac=KlineIns.showTrade?(au-KlineIns.tradeWidth):au;var ap=P||window.innerHeight;var X=$(KlineIns.element);X.css({width:au+"px",height:ap+"px"});var ar=$("#chart_toolbar");var aj=$("#chart_toolpanel");var ai=$("#chart_canvasGroup");var aq=$("#chart_tabbar");var ao=aj[0].style.display!="inline"?false:true;var N=aq[0].style.display!="block"?false:true;var O={};O.x=0;O.y=0;O.w=ac;O.h=29;var h={};h.x=0;h.y=O.h+1;h.w=ao?32:0;h.h=ap-h.y;var Z={};Z.w=ao?ac-(h.w+1):ac;Z.h=N?22:-1;Z.x=ac-Z.w;Z.y=ap-(Z.h+1);var R={};R.x=Z.x;R.y=h.y;R.w=Z.w;R.h=Z.y-h.y;ar.css({left:O.x+"px",top:O.y+"px",width:O.w+"px",height:O.h+"px"});if(ao){aj.css({left:h.x+"px",top:h.y+"px",width:h.w+"px",height:h.h+"px"})}ai.css({left:R.x+"px",top:R.y+"px",width:R.w+"px",height:R.h+"px"});var an=$("#chart_mainCanvas")[0];var T=$("#chart_overlayCanvas")[0];an.width=R.w;an.height=R.h;T.width=R.w;T.height=R.h;if(N){aq.css({left:Z.x+"px",top:Z.y+"px",width:Z.w+"px",height:Z.h+"px"})}var aa=$("#chart_parameter_settings");aa.css({left:(ac-aa.width())>>1,top:(ap-aa.height())>>1});var V=$("#chart_loading");V.css({left:(ac-V.width())>>1,top:(ap-V.height())>>2});var ad=$("#chart_dom_elem_cache");var at=$("#chart_select_theme")[0];var Q=$("#chart_enable_tools")[0];var w=$("#chart_enable_indicator")[0];var ah=$("#chart_toolbar_periods_vert");var af=$("#chart_toolbar_periods_horz")[0];var al=$("#chart_show_indicator")[0];var am=$("#chart_show_tools")[0];var Y=$("#chart_toolbar_theme")[0];var ab=$("#chart_dropdown_settings");var W=ah[0].offsetWidth;var av=W+af.offsetWidth;var ag=av+al.offsetWidth+4;var ak=ag+am.offsetWidth+4;var ae=ak+Y.offsetWidth;var U=ab.find(".chart_dropdown_t")[0].offsetWidth+150;W+=U;av+=U;ag+=U;ak+=U;ae+=U;if(ac<av){ad.append(af)}else{ah.after(af)}if(ac<ag){ad.append(al);w.style.display=""}else{ab.before(al);w.style.display="none"}if(ac<ak){ad.append(am);Q.style.display=""}else{ab.before(am);Q.style.display="none"}if(ac<ae){ad.append(Y);at.style.display=""}else{ab.before(Y);at.style.display="none"}ChartManager.getInstance().redraw("All",true);KlineIns.onResize(au,ap)}function mouseWheel(d,c){ChartManager.getInstance().scale(c>0?1:-1);ChartManager.getInstance().redraw("All",true);return false}function switch_theme(g){$("#chart_toolbar_theme a").removeClass("selected");$("#chart_select_theme a").removeClass("selected");$("#chart_toolbar_theme").find("a").each(function(){if($(this).attr("name")==g){$(this).addClass("selected")}});$("#chart_select_theme a").each(function(){if($(this).attr("name")==g){$(this).addClass("selected")}});$(".chart_container").attr("class","chart_container "+g);$(".marketName_ a").attr("class",g);if(g=="dark"){$(".trade_container").addClass("dark").removeClass("light");ChartManager.getInstance().setThemeName("frame0","Dark");var f=ChartSettings.get();f.theme="Dark";ChartSettings.save()}else{if(g=="light"){$(".trade_container").addClass("light").removeClass("dark");ChartManager.getInstance().setThemeName("frame0","Light");var f=ChartSettings.get();f.theme="Light";ChartSettings.save()}}var a={};a.command="set current theme";a.content=g;$("#chart_output_interface_text").val(JSON.stringify(a));$("#chart_output_interface_submit").submit();window._current_theme_change.raise(g);ChartManager.getInstance().redraw();KlineIns.onThemeChange(g)}function switch_tools(b){$(".chart_dropdown_data").removeClass("chart_dropdown-hover");$("#chart_toolpanel .chart_toolpanel_button").removeClass("selected");$("#chart_enable_tools a").removeClass("selected");if(b=="on"){$("#chart_show_tools").addClass("selected");$("#chart_enable_tools a").each(function(){if($(this).attr("name")=="on"){$(this).addClass("selected")}});$("#chart_toolpanel")[0].style.display="inline";if(ChartManager.getInstance()._drawingTool==ChartManager.DrawingTool.Cursor){$("#chart_Cursor").parent().addClass("selected")}else{if(ChartManager.getInstance()._drawingTool==ChartManager.DrawingTool.CrossCursor){$("#chart_CrossCursor").parent().addClass("selected")}}}else{if(b=="off"){$("#chart_show_tools").removeClass("selected");$("#chart_enable_tools a").each(function(){if($(this).attr("name")=="off"){$(this).addClass("selected")}});$("#chart_toolpanel")[0].style.display="none";ChartManager.getInstance().setRunningMode(ChartManager.getInstance()._beforeDrawingTool);ChartManager.getInstance().redraw("All",true)}}if(KlineIns.isSized){on_size()}else{on_size(KlineIns.width,KlineIns.height)}}function switch_indic(f){$("#chart_enable_indicator a").removeClass("selected");$("#chart_enable_indicator a[name='"+f+"']").addClass("selected");
if(f=="on"){$("#chart_show_indicator").addClass("selected");var d=ChartSettings.get();d.charts.indicsStatus="open";ChartSettings.save();var g=d.charts.indics[1];if(Template.displayVolume==false){ChartManager.getInstance().getChart().setIndicator(2,g)}else{ChartManager.getInstance().getChart().setIndicator(2,g)}$("#chart_tabbar").find("a").each(function(){if($(this).attr("name")==g){$(this).addClass("selected")}});$("#chart_tabbar")[0].style.display="block"}else{if(f=="off"){$("#chart_show_indicator").removeClass("selected");ChartManager.getInstance().getChart().setIndicator(2,"NONE");var d=ChartSettings.get();d.charts.indicsStatus="close";ChartSettings.save();$("#chart_tabbar")[0].style.display="none";$("#chart_tabbar a").removeClass("selected")}}if(KlineIns.isSized){on_size()}else{on_size(KlineIns.width,KlineIns.height)}}function switch_period(f){$(".chart_container .chart_toolbar_tabgroup a").removeClass("selected");$("#chart_toolbar_periods_vert ul a").removeClass("selected");$(".chart_container .chart_toolbar_tabgroup a").each(function(){if($(this).parent().attr("name")==f){$(this).addClass("selected")}});$("#chart_toolbar_periods_vert ul a").each(function(){if($(this).parent().attr("name")==f){$(this).addClass("selected")}});ChartManager.getInstance().showCursor();calcPeriodWeight(f);if(f=="line"){ChartManager.getInstance().getChart().strIsLine=true;ChartManager.getInstance().setChartStyle("frame0.k0","Line");ChartManager.getInstance().getChart().setCurrentPeriod("line");var d=ChartSettings.get();d.charts.period=f;ChartSettings.save();return}ChartManager.getInstance().getChart().strIsLine=false;var g=KlineIns.tagMapPeriod[f];ChartManager.getInstance().setChartStyle("frame0.k0",ChartSettings.get().charts.chartStyle);ChartManager.getInstance().getChart().setCurrentPeriod(g);var d=ChartSettings.get();d.charts.period=f;ChartSettings.save()}function reset(b){KlineIns.symbol=b;if(KlineIns.showTrade){KlineTradeIns.reset(b)}}function switch_symbol_selected(c){reset(c);$(".market_chooser ul a").removeClass("selected");$(".market_chooser ul a[name='"+c+"']").addClass("selected");ChartManager.getInstance().getChart()._symbol=c;var d=ChartSettings.get();d.charts.symbol=c;ChartSettings.save()}function switch_symbol(c){switch_symbol_selected(c);var d=ChartSettings.get();if(d.charts.period=="line"){ChartManager.getInstance().getChart().strIsLine=true;ChartManager.getInstance().setChartStyle("frame0.k0","Line")}else{ChartManager.getInstance().getChart().strIsLine=false;ChartManager.getInstance().setChartStyle("frame0.k0",ChartSettings.get().charts.chartStyle)}ChartManager.getInstance().getChart().setSymbol(c)}function calcPeriodWeight(h){var g=h;if(h!="line"){g=KlineIns.periodMap[KlineIns.tagMapPeriod[h]]}var i=ChartSettings.get().charts.period_weight;for(var f in i){if(i[f]>i[g]){i[f]-=1}}i[g]=8;ChartSettings.save()}function socketConnect(){KlineIns.socketConnected=true;if(!KlineIns.socketClient){if(KlineIns.enableSockjs){var b=new SockJS(KlineIns.url);KlineIns.socketClient=Stomp.over(b)}else{KlineIns.socketClient=Stomp.client(KlineIns.url)}}if(KlineIns.socketClient.ws.readyState==1){console.log("DEBUG: already connected");return}if(!KlineIns.debug){KlineIns.socketClient.debug=null}KlineIns.socketClient.connect({},function(){KlineIns.socketClient.subscribe(KlineIns.subscribePath,function(a){requestSuccessHandler(JSON.parse(a.body))});RequestData(true)},function(){KlineIns.socketClient.disconnect();console.log("DEBUG: reconnect in 5 seconds ...");setTimeout(function(){socketConnect()},5000)})}var template_str="\n"+'<div class="trade_container dark hide">\n'+'        <div class="m_cent">\n'+'            <div class="m_guadan">\n'+'                <div class="symbol-title">\n'+'                    <a class="dark">test</a>\n'+"                    \n"+"                </div>\n"+'                <div id="orderbook">\n'+'                    <div id="asks">\n'+'                        <div class="table"> </div>\n'+"                   </div>\n"+'                   <div id="gasks">\n'+'                        <div class="table"> </div>\n'+"                   </div>\n"+'                   <div id="price" class="green"></div>\n'+'                   <div id="bids">\n'+'                        <div class="table"> </div>\n'+"                    </div>\n"+'                    <div id="gbids">\n'+'                        <div class="table"> </div>\n'+"                    </div>\n"+"                </div>\n"+'                <div id="trades" class="trades">\n'+'                <div class="trades_list"> </div>\n'+"                </div>\n"+"            \n"+"            </div>\n"+"        \n"+"        </div>\n"+"</div>\n"+'<div class="chart_container dark">\n'+'            <div id="chart_dom_elem_cache"></div>\n'+"            <!-- ToolBar -->\n"+'            <div id="chart_toolbar">\n'+'                <div class="chart_toolbar_minisep"></div>\n'+"                <!-- Periods -->\n"+'                <div class="chart_dropdown" id="chart_toolbar_periods_vert">\n'+'                    <div class="chart_dropdown_t"><a class="chart_str_period">周期</a></div>\n'+'                    <div class="chart_dropdown_data" style="margin-left: -58px;">\n'+"                        <table>\n"+"                            <tbody>\n"+"                            <tr>\n"+"                                <td>\n"+"                                    <ul>\n"+'                                        <li id="chart_period_1w_v" style="display:none;" name="1w"><a class="chart_str_period_1w">周线</a></li>\n'+'                                        <li id="chart_period_3d_v" style="display:none;" name="3d"><a class="chart_str_period_3d">3日</a></li>\n'+'                                        <li id="chart_period_1d_v" style="display:none;" name="1d"><a class="chart_str_period_1d">日线</a></li>\n'+'                                        <li id="chart_period_12h_v" style="display:none;" name="12h"><a class="chart_str_period_12h">12小时</a></li>\n'+'                                        <li id="chart_period_6h_v" style="display:none;" name="6h"><a class="chart_str_period_6h">6小时</a></li>\n'+'                                        <li id="chart_period_4h_v" style="display:none;" name="4h"><a class="chart_str_period_4h">4小时</a></li>\n'+'                                        <li id="chart_period_2h_v" style="display:none;" name="2h"><a class="chart_str_period_2h">2小时</a></li>\n'+'                                        <li id="chart_period_1h_v" style="display:none;" name="1h"><a class="chart_str_period_1h">1小时</a></li>\n'+"                                    </ul>\n"+"                                </td>\n"+"                            </tr>\n"+"                            <tr>\n"+"                                <td>\n"+"                                    <ul>\n"+'                                        <li id="chart_period_30m_v" style="display:none;" name="30m"><a class="chart_str_period_30m">30分钟</a></li>\n'+'                                        <li id="chart_period_15m_v" style="display:none;" name="15m"><a class="chart_str_period_15m">15分钟</a></li>\n'+'                                        <li id="chart_period_5m_v" style="display:none;" name="5m"><a class="chart_str_period_5m">5分钟</a></li>\n'+'                                        <li id="chart_period_3m_v" style="display:none;" name="3m"><a class="chart_str_period_3m">3分钟</a></li>\n'+'                                        <li id="chart_period_1m_v" style="display:none;" name="1m"><a class="chart_str_period_1m selected">1分钟</a></li>\n'+'                                        <li id="chart_period_line_v" style="display:none;" name="line"><a class="chart_str_period_line">分时</a>\n'+"                                        </li>\n"+"                                    </ul>\n"+"                                </td>\n"+"                            </tr>\n"+"                            </tbody>\n"+"                        </table>\n"+"                    </div>\n"+"                </div>\n"+'                <div id="chart_toolbar_periods_horz">\n'+'                    <ul class="chart_toolbar_tabgroup" style="padding-left:5px; padding-right:11px;">\n'+'                        <li id="chart_period_1w_h" name="1w" style="display: none;"><a class="chart_str_period_1w">周线</a></li>\n'+'                        <li id="chart_period_3d_h" name="3d" style="display: none;"><a class="chart_str_period_3d">3日</a></li>\n'+'                        <li id="chart_period_1d_h" name="1d" style="display: none;"><a class="chart_str_period_1d">日线</a></li>\n'+'                        <li id="chart_period_12h_h" name="12h" style="display: none;"><a class="chart_str_period_12h">12小时</a></li>\n'+'                        <li id="chart_period_6h_h" name="6h" style="display: none;"><a class="chart_str_period_6h">6小时</a></li>\n'+'                        <li id="chart_period_4h_h" name="4h" style="display: none;"><a class="chart_str_period_4h">4小时</a></li>\n'+'                        <li id="chart_period_2h_h" name="2h" style="display: none;"><a class="chart_str_period_2h">2小时</a></li>\n'+'                        <li id="chart_period_1h_h" name="1h" style="display: none;"><a class="chart_str_period_1h">1小时</a></li>\n'+'                        <li id="chart_period_30m_h" name="30m" style="display: none;"><a class="chart_str_period_30m">30分钟</a></li>\n'+'                        <li id="chart_period_15m_h" name="15m" style="display: none;"><a class="chart_str_period_15m">15分钟</a></li>\n'+'                        <li id="chart_period_5m_h" name="5m" style="display: none;"><a class="chart_str_period_5m">5分钟</a></li>\n'+'                        <li id="chart_period_3m_h" name="3m" style="display: none;"><a class="chart_str_period_3m">3分钟</a></li>\n'+'                        <li id="chart_period_1m_h" name="1m" style="display: none;"><a class="chart_str_period_1m selected">1分钟</a></li>\n'+'                        <li id="chart_period_line_h" name="line" style="display: none;"><a class="chart_str_period_line">分时</a></li>\n'+"                    </ul>\n"+"                </div>\n"+'                <div id="chart_show_indicator" class="chart_toolbar_button chart_str_indicator_cap selected">技术指标</div>\n'+'                <div id="chart_show_tools" class="chart_toolbar_button chart_str_tools_cap">画线工具</div>\n'+'                <div id="chart_toolbar_theme">\n'+'                    <div class="chart_toolbar_label chart_str_theme_cap">主题选择</div>\n'+'                    <a name="dark" class="chart_icon chart_icon_theme_dark selected"></a>\n'+'                    <a name="light" class="chart_icon chart_icon_theme_light"></a>\n'+"                </div>\n"+'                <div class="chart_dropdown" id="chart_dropdown_settings">\n'+'                    <div class="chart_dropdown_t"><a class="chart_str_settings">更多</a></div>\n'+'                    <div class="chart_dropdown_data" style="margin-left: -142px;">\n'+"                        <table>\n"+"                            <tbody>\n"+'                            <tr id="chart_select_main_indicator">\n'+'                                <td class="chart_str_main_indicator">主指标</td>\n'+"                                <td>\n"+"                                    <ul>\n"+'                                        <li><a name="MA" class="selected">MA</a></li>\n'+'                                        <li><a name="EMA" class="">EMA</a></li>\n'+'                                        <li><a name="BOLL" class="">BOLL</a></li>\n'+'                                        <li><a name="SAR" class="">SAR</a></li>\n'+'                                        <li><a name="NONE" class="">None</a></li>\n'+"                                    </ul>\n"+"                                </td>\n"+"                            </tr>\n"+'                            <tr id="chart_select_chart_style">\n'+'                                <td class="chart_str_chart_style">主图样式</td>\n'+"                                <td>\n"+"                                    <ul>\n"+'                                        <li><a class="selected">CandleStick</a></li>\n'+"                                        <li><a>CandleStickHLC</a></li>\n"+'                                        <li><a class="">OHLC</a></li>\n'+"                                    </ul>\n"+"                                </td>\n"+"                            </tr>\n"+'                            <tr id="chart_select_theme" style="display: none;">\n'+'                                <td class="chart_str_theme">主题选择</td>\n'+"                                <td>\n"+"                                    <ul>\n"+"                                        <li>\n"+'                                            <a name="dark" class="chart_icon chart_icon_theme_dark selected"></a>\n'+"                                        </li>\n"+"                                        <li>\n"+'                                            <a name="light" class="chart_icon chart_icon_theme_light"></a>\n'+"                                        </li>\n"+"                                    </ul>\n"+"                                </td>\n"+"                            </tr>\n"+'                            <tr id="chart_enable_tools" style="display: none;">\n'+'                                <td class="chart_str_tools">画线工具</td>\n'+"                                <td>\n"+"                                    <ul>\n"+'                                        <li><a name="on" class="chart_str_on">开启</a></li>\n'+'                                        <li><a name="off" class="chart_str_off selected">关闭</a></li>\n'+"                                    </ul>\n"+"                                </td>\n"+"                            </tr>\n"+'                            <tr id="chart_enable_indicator" style="display: none;">\n'+'                                <td class="chart_str_indicator">技术指标</td>\n'+"                                <td>\n"+"                                    <ul>\n"+'                                        <li><a name="on" class="chart_str_on selected">开启</a></li>\n'+'                                        <li><a name="off" class="chart_str_off">关闭</a></li>\n'+"                                    </ul>\n"+"                                </td>\n"+"                            </tr>\n"+"                            <tr>\n"+"                                <td></td>\n"+"                                <td>\n"+"                                    <ul>\n"+'                                        <li><a id="chart_btn_parameter_settings"\n'+'                                               class="chart_str_indicator_parameters">指标参数设置</a>\n'+"                                        </li>\n"+"                                    </ul>\n"+"                                </td>\n"+"                            </tr>\n"+"                            </tbody>\n"+"                        </table>\n"+"                    </div>\n"+"                </div>\n"+'                <div class="chart_dropdown" id="chart_language_setting_div" style="padding-left: 5px;">\n'+'                    <div class="chart_dropdown_t">\n'+'                        <a class="chart_language_setting">语言(LANG)</a>\n'+"                    </div>\n"+'                    <div class="chart_dropdown_data" style="padding-top: 15px; margin-left: -12px;">\n'+"                        <ul>\n"+'                            <li style="height: 25px;"><a name="zh-cn" class="selected">简体中文(zh-CN)</a></li>\n'+'                            <li style="height: 25px;"><a name="en-us">English(en-US)</a></li>\n'+'                            <li style="height: 25px;"><a name="zh-tw">繁體中文(zh-HK)</a></li>\n'+"                        </ul>\n"+"                    </div>\n"+"                </div>\n"+'                <div id="chart_updated_time">\n'+'                    <div id="sizeIcon" class="chart_BoxSize"></div>\n'+"                </div>\n"+"            </div>\n"+"            <!-- ToolPanel -->\n"+'            <div id="chart_toolpanel">\n'+'                <div class="chart_toolpanel_separator"></div>\n'+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_Cursor" name="Cursor"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_cursor">光标</div>\n'+"                </div>\n"+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_CrossCursor" name="CrossCursor"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_cross_cursor">十字光标</div>\n'+"                </div>\n"+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_SegLine" name="SegLine"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_seg_line">线段</div>\n'+"                </div>\n"+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_StraightLine" name="StraightLine"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_straight_line">直线</div>\n'+"                </div>\n"+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_RayLine" name="RayLine"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_ray_line">射线</div>\n'+"                </div>\n"+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_ArrowLine" name="ArrowLine"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_arrow_line">箭头</div>\n'+"                </div>\n"+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_HoriSegLine" name="HoriSegLine"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_horz_seg_line">水平线段</div>\n'+"                </div>\n"+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_HoriStraightLine" name="HoriStraightLine"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_horz_straight_line">水平直线</div>\n'+"                </div>\n"+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_HoriRayLine" name="HoriRayLine"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_horz_ray_line">水平射线</div>\n'+"                </div>\n"+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_VertiStraightLine" name="VertiStraightLine"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_vert_straight_line">垂直直线</div>\n'+"                </div>\n"+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_PriceLine" name="PriceLine"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_price_line">价格线</div>\n'+"                </div>\n"+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_TriParallelLine" name="TriParallelLine"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_tri_parallel_line">价格通道线</div>\n'+"                </div>\n"+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_BiParallelLine" name="BiParallelLine"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_bi_parallel_line">平行直线</div>\n'+"                </div>\n"+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_BiParallelRayLine" name="BiParallelRayLine"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_bi_parallel_ray">平行射线</div>\n'+"                </div>\n"+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_DrawFibRetrace" name="DrawFibRetrace"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_fib_retrace">斐波纳契回调</div>\n'+"                </div>\n"+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_DrawFibFans" name="DrawFibFans"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_fib_fans">斐波纳契扇形</div>\n'+"                </div>\n"+'                <div style="padding-left: 3px;padding-top: 10px;">\n'+'                    <button style="color: red;" id="clearCanvas" title="Clear All">X</button>\n'+"                </div>\n"+"            </div>\n"+"            <!-- Canvas Group -->\n"+'            <div id="chart_canvasGroup" class="temp">\n'+'                <canvas class="chart_canvas" id="chart_mainCanvas"\n'+'                        style="cursor: default;"></canvas>\n'+'                <canvas class="chart_canvas" id="chart_overlayCanvas"\n'+'                        style="cursor: default;"></canvas>\n'+"            </div>\n"+"            <!-- TabBar -->\n"+'            <div id="chart_tabbar"">\n'+"                <ul>\n"+'                    <li><a name="MACD" class="">MACD</a></li>\n'+'                    <li><a name="KDJ" class="">KDJ</a></li>\n'+'                    <li><a name="StochRSI" class="">StochRSI</a></li>\n'+'                    <li><a name="RSI" class="">RSI</a></li>\n'+'                    <li><a name="DMI" class="">DMI</a></li>\n'+'                    <li><a name="OBV" class="">OBV</a></li>\n'+'                    <li><a name="BOLL" class="">BOLL</a></li>\n'+'                    <li><a name="SAR" class="">SAR</a></li>\n'+'                    <li><a name="DMA" class="">DMA</a></li>\n'+'                    <li><a name="TRIX" class="">TRIX</a></li>\n'+'                    <li><a name="BRAR" class="">BRAR</a></li>\n'+'                    <li><a name="VR" class="">VR</a></li>\n'+'                    <li><a name="EMV" class="">EMV</a></li>\n'+'                    <li><a name="WR" class="">WR</a></li>\n'+'                    <li><a name="ROC" class="">ROC</a></li>\n'+'                    <li><a name="MTM" class="">MTM</a></li>\n'+'                    <li><a name="PSY">PSY</a></li>\n'+"                </ul>\n"+"            </div>\n"+"            <!-- Parameter Settings -->\n"+'            <div id="chart_parameter_settings">\n'+'                <h2 class="chart_str_indicator_parameters">指标参数设置</h2>\n'+"                <table>\n"+"                    <tbody>\n"+"                    <tr>\n"+"                        <th>MA</th>\n"+'                        <td><input name="MA"><input name="MA"><input name="MA"><input name="MA"><br><input\n'+'                                name="MA"><input\n'+'                                name="MA"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                        <th>DMA</th>\n"+'                        <td><input name="DMA"><input name="DMA"><input name="DMA"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                    </tr>\n"+"                    <tr>\n"+"                        <th>EMA</th>\n"+'                        <td><input name="EMA"><input name="EMA"><input name="EMA"><input name="EMA"><br><input\n'+'                                name="EMA"><input name="EMA"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                        <th>TRIX</th>\n"+'                        <td><input name="TRIX"><input name="TRIX"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                    </tr>\n"+"                    <tr>\n"+"                        <th>VOLUME</th>\n"+'                        <td><input name="VOLUME"><input name="VOLUME"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                        <th>BRAR</th>\n"+'                        <td><input name="BRAR"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                    </tr>\n"+"                    <tr>\n"+"                        <th>MACD</th>\n"+'                        <td><input name="MACD"><input name="MACD"><input name="MACD"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                        <th>VR</th>\n"+'                        <td><input name="VR"><input name="VR"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                    </tr>\n"+"                    <tr>\n"+"                        <th>KDJ</th>\n"+'                        <td><input name="KDJ"><input name="KDJ"><input name="KDJ"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                        <th>EMV</th>\n"+'                        <td><input name="EMV"><input name="EMV"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                    </tr>\n"+"                    <tr>\n"+"                        <th>StochRSI</th>\n"+'                        <td><input name="StochRSI"><input name="StochRSI"><input name="StochRSI"><input name="StochRSI">\n'+"                        </td>\n"+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                        <th>WR</th>\n"+'                        <td><input name="WR"><input name="WR"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                    </tr>\n"+"                    <tr>\n"+"                        <th>RSI</th>\n"+'                        <td><input name="RSI"><input name="RSI"><input name="RSI"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                        <th>ROC</th>\n"+'                        <td><input name="ROC"><input name="ROC"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                    </tr>\n"+"                    <tr>\n"+"                        <th>DMI</th>\n"+'                        <td><input name="DMI"><input name="DMI"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                        <th>MTM</th>\n"+'                        <td><input name="MTM"><input name="MTM"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                    </tr>\n"+"                    <tr>\n"+"                        <th>OBV</th>\n"+'                        <td><input name="OBV"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                        <th>PSY</th>\n"+'                        <td><input name="PSY"><input name="PSY"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                    </tr>\n"+"                    <tr>\n"+"                        <th>BOLL</th>\n"+'                        <td><input name="BOLL"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                    </tr>\n"+"                    </tbody>\n"+"                </table>\n"+'                <div id="close_settings"><a class="chart_str_close">关闭</a></div>\n'+"            </div>\n"+"            <!-- Loading -->\n"+'            <div id="chart_loading" class="chart_str_loading">正在读取数据...</div>\n'+"        </div>\n"+'        <div style="display: none" id="chart_language_switch_tmp">\n'+'            <span name="chart_str_period" zh_tw="週期" zh_cn="周期" en_us="TIME"></span>\n'+'            <span name="chart_str_period_line" zh_tw="分時" zh_cn="分时" en_us="Line"></span>\n'+'            <span name="chart_str_period_1m" zh_tw="1分鐘" zh_cn="1分钟" en_us="1m"></span>\n'+'            <span name="chart_str_period_3m" zh_tw="3分鐘" zh_cn="3分钟" en_us="3m"></span>\n'+'            <span name="chart_str_period_5m" zh_tw="5分鐘" zh_cn="5分钟" en_us="5m"></span>\n'+'            <span name="chart_str_period_15m" zh_tw="15分鐘" zh_cn="15分钟" en_us="15m"></span>\n'+'            <span name="chart_str_period_30m" zh_tw="30分鐘" zh_cn="30分钟" en_us="30m"></span>\n'+'            <span name="chart_str_period_1h" zh_tw="1小時" zh_cn="1小时" en_us="1h"></span>\n'+'            <span name="chart_str_period_2h" zh_tw="2小時" zh_cn="2小时" en_us="2h"></span>\n'+'            <span name="chart_str_period_4h" zh_tw="4小時" zh_cn="4小时" en_us="4h"></span>\n'+'            <span name="chart_str_period_6h" zh_tw="6小時" zh_cn="6小时" en_us="6h"></span>\n'+'            <span name="chart_str_period_12h" zh_tw="12小時" zh_cn="12小时" en_us="12h"></span>\n'+'            <span name="chart_str_period_1d" zh_tw="日線" zh_cn="日线" en_us="1d"></span>\n'+'            <span name="chart_str_period_3d" zh_tw="3日" zh_cn="3日" en_us="3d"></span>\n'+'            <span name="chart_str_period_1w" zh_tw="周線" zh_cn="周线" en_us="1w"></span>\n'+"\n"+'            <span name="chart_str_settings" zh_tw="更多" zh_cn="更多" en_us="MORE"></span>\n'+'            <span name="chart_setting_main_indicator" zh_tw="均線設置" zh_cn="均线设置" en_us="Main Indicator"></span>\n'+'            <span name="chart_setting_main_indicator_none" zh_tw="關閉均線" zh_cn="关闭均线" en_us="None"></span>\n'+'            <span name="chart_setting_indicator_parameters" zh_tw="指標參數設置" zh_cn="指标参数设置"\n'+'                  en_us="Indicator Parameters"></span>\n'+"\n"+'            <span name="chart_str_chart_style" zh_tw="主圖樣式" zh_cn="主图样式" en_us="Chart Style"></span>\n'+'            <span name="chart_str_main_indicator" zh_tw="主指標" zh_cn="主指标" en_us="Main Indicator"></span>\n'+'            <span name="chart_str_indicator" zh_tw="技術指標" zh_cn="技术指标" en_us="Indicator"></span>\n'+'            <span name="chart_str_indicator_cap" zh_tw="技術指標" zh_cn="技术指标" en_us="INDICATOR"></span>\n'+'            <span name="chart_str_tools" zh_tw="畫線工具" zh_cn="画线工具" en_us="Tools"></span>\n'+'            <span name="chart_str_tools_cap" zh_tw="畫線工具" zh_cn="画线工具" en_us="TOOLS"></span>\n'+'            <span name="chart_str_theme" zh_tw="主題選擇" zh_cn="主题选择" en_us="Theme"></span>\n'+'            <span name="chart_str_theme_cap" zh_tw="主題選擇" zh_cn="主题选择" en_us="THEME"></span>\n'+"\n"+'            <span name="chart_language_setting" zh_tw="語言(LANG)" zh_cn="语言(LANG)" en_us="LANGUAGE"></span>\n'+'            <span name="chart_exchanges_setting" zh_tw="更多市場" zh_cn="更多市场" en_us="MORE MARKETS"></span>\n'+'            <span name="chart_othercoin_setting" zh_tw="其它市場" zh_cn="其它市场" en_us="OTHER MARKETS"></span>\n'+"\n"+"\n"+'            <span name="chart_str_none" zh_tw="關閉" zh_cn="关闭" en_us="None"></span>\n'+"\n"+'            <span name="chart_str_theme_dark" zh_tw="深色主題" zh_cn="深色主题" en_us="Dark"></span>\n'+'            <span name="chart_str_theme_light" zh_tw="淺色主題" zh_cn="浅色主题" en_us="Light"></span>\n'+"\n"+'            <span name="chart_str_on" zh_tw="開啟" zh_cn="开启" en_us="On"></span>\n'+'            <span name="chart_str_off" zh_tw="關閉" zh_cn="关闭" en_us="Off"></span>\n'+"\n"+'            <span name="chart_str_close" zh_tw="關閉" zh_cn="关闭" en_us="CLOSE"></span>\n'+'            <span name="chart_str_default" zh_tw="默認值" zh_cn="默认值" en_us="default"></span>\n'+"\n"+'            <span name="chart_str_loading" zh_tw="正在讀取數據..." zh_cn="正在读取数据..." en_us="Loading..."></span>\n'+"\n"+'            <span name="chart_str_indicator_parameters" zh_tw="指標參數設置" zh_cn="指标参数设置"\n'+'                  en_us="Indicator Parameters"></span>\n'+"\n"+'            <span name="chart_str_cursor" zh_tw="光標" zh_cn="光标" en_us="Cursor"></span>\n'+'            <span name="chart_str_cross_cursor" zh_tw="十字光標" zh_cn="十字光标" en_us="Cross Cursor"></span>\n'+'            <span name="chart_str_seg_line" zh_tw="線段" zh_cn="线段" en_us="Trend Line"></span>\n'+'            <span name="chart_str_straight_line" zh_tw="直線" zh_cn="直线" en_us="Extended"></span>\n'+'            <span name="chart_str_ray_line" zh_tw="射線" zh_cn="射线" en_us="Ray"></span>\n'+'            <span name="chart_str_arrow_line" zh_tw="箭頭" zh_cn="箭头" en_us="Arrow"></span>\n'+'            <span name="chart_str_horz_seg_line" zh_tw="水平線段" zh_cn="水平线段" en_us="Horizontal Line"></span>\n'+'            <span name="chart_str_horz_straight_line" zh_tw="水平直線" zh_cn="水平直线" en_us="Horizontal Extended"></span>\n'+'            <span name="chart_str_horz_ray_line" zh_tw="水平射線" zh_cn="水平射线" en_us="Horizontal Ray"></span>\n'+'            <span name="chart_str_vert_straight_line" zh_tw="垂直直線" zh_cn="垂直直线" en_us="Vertical Extended"></span>\n'+'            <span name="chart_str_price_line" zh_tw="價格線" zh_cn="价格线" en_us="Price Line"></span>\n'+'            <span name="chart_str_tri_parallel_line" zh_tw="價格通道線" zh_cn="价格通道线" en_us="Parallel Channel"></span>\n'+'            <span name="chart_str_bi_parallel_line" zh_tw="平行直線" zh_cn="平行直线" en_us="Parallel Lines"></span>\n'+'            <span name="chart_str_bi_parallel_ray" zh_tw="平行射線" zh_cn="平行射线" en_us="Parallel Rays"></span>\n'+'            <span name="chart_str_fib_retrace" zh_tw="斐波納契回調" zh_cn="斐波纳契回调" en_us="Fibonacci Retracements"></span>\n'+'            <span name="chart_str_fib_fans" zh_tw="斐波納契扇形" zh_cn="斐波纳契扇形" en_us="Fibonacci Fans"></span>\n'+"\n"+'            <span name="chart_str_updated" zh_tw="更新於" zh_cn="更新于" en_us="Updated"></span>\n'+'            <span name="chart_str_ago" zh_tw="前" zh_cn="前" en_us="ago"></span>\n'+"</div>\n";
function draw(h){KlineIns=h;KlineTradeIns=new KlineTrade();var i=$.parseHTML(template_str);for(var g in KlineIns.ranges){var j=$(i).find('[name="'+KlineIns.ranges[g]+'"]');j.each(function(b,a){$(a).attr("style","display:inline-block")})}$(KlineIns.element).html(i);var k=setInterval(refresh_function,KlineIns.intervalTime);if(KlineIns.type=="socket"){socketConnect()}window._setMarketFrom=function(a){Template.displayVolume=false;refreshTemplate();readCookie();ChartManager.getInstance().getChart().setSymbol(a)};window._set_current_language=function(a){chart_switch_language(a)};window._set_current_depth=function(a){ChartManager.getInstance().getChart().updateDepth(a)};window._set_current_url=function(a){KlineIns.url=a};window._set_current_contract_unit=function(a){ChartManager.getInstance().getChart().setCurrentContractUnit(a)};window._set_money_type=function(a){ChartManager.getInstance().getChart().setCurrentMoneyType(a)};window._set_usd_cny_rate=function(a){ChartManager.getInstance().getChart()._usd_cny_rate=a};window._setCaptureMouseWheelDirectly=function(a){ChartManager.getInstance().setCaptureMouseWheelDirectly(a)};window._current_future_change=new MEvent();window._current_theme_change=new MEvent();KLineMouseEvent();ChartManager.getInstance().bindCanvas("main",document.getElementById("chart_mainCanvas"));ChartManager.getInstance().bindCanvas("overlay",document.getElementById("chart_overlayCanvas"));refreshTemplate();on_size(KlineIns.width,KlineIns.height);readCookie();KlineIns.setTheme(KlineIns.theme);KlineIns.setLanguage(KlineIns.language);$(KlineIns.element).css({visibility:"visible"})}try{module.exports=exports=Kline}catch(e){};