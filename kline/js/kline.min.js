var Kline=function(a){this.element="#kline_container";this.chartMgr=null;this.G_HTTP_REQUEST=null;this.timer=null;this.buttonDown=false;this.init=false;this.requestParam="";this.data={};this.width=1200;this.height=650;this.symbol="";this.symbolName="";this.range=null;this.url="";this.limit=1000;this.type="poll";this.subscribePath="";this.sendPath="";this.socketClient=null;this.intervalTime=5000;this.debug=true;this.language="zh-cn";this.theme="dark";this.ranges=["1w","1d","1h","30m","15m","5m","1m","line"];this.showTrade=true;this.tradeWidth=250;this.socketConnected=false;this.enableSockjs=true;this.reverseColor=false;this.isSized=false;this.paused=false;this.periodMap={"01w":7*86400*1000,"03d":3*86400*1000,"01d":86400*1000,"12h":12*3600*1000,"06h":6*3600*1000,"04h":4*3600*1000,"02h":2*3600*1000,"01h":3600*1000,"30m":30*60*1000,"15m":15*60*1000,"05m":5*60*1000,"03m":3*60*1000,"01m":60*1000,"line":60*1000};this.tagMapPeriod={"1w":"01w","3d":"03d","1d":"01d","12h":"12h","6h":"06h","4h":"04h","2h":"02h","1h":"01h","30m":"30m","15m":"15m","5m":"05m","3m":"03m","1m":"01m","line":"line"};Object.assign(this,a)};Kline.prototype={draw:function(){draw(this)},resize:function(b,a){this.width=b;this.height=a;on_size(this.width,this.height)},setSymbol:function(b,a){KlineIns.symbol=b;KlineIns.symbolName=a;switch_symbol(b);KlineIns.onSymbolChange(b,a)},setTheme:function(a){KlineIns.theme=a;switch_theme(a)},setLanguage:function(a){KlineIns.language=a;chart_switch_language(a)},setShowTrade:function(a){this.showTrade=a;if(a){$(".trade_container").show()}else{$(".trade_container").hide()}on_size(this.width,this.height)},toggleTrade:function(){if(!this.showTrade){this.showTrade=true;$(".trade_container").show()}else{this.showTrade=false;$(".trade_container").hide()}on_size(this.width,this.height)},setIntervalTime:function(a){this.intervalTime=a;if(this.debug){console.log("DEBUG: interval time changed to "+a)}},pause:function(){if(this.debug){console.log("DEBUG: kline paused")}this.paused=true},resend:function(){if(this.debug){console.log("DEBUG: kline continue")}this.paused=false;RequestData(true)},connect:function(){if(this.type!="socket"){if(this.debug){console.log("DEBUG: this is for socket type")}return}socketConnect()},disconnect:function(){if(this.type!="socket"){if(this.debug){console.log("DEBUG: this is for socket type")}return}if(this.socketClient){this.socketClient.disconnect();KlineIns.socketConnected=false}if(this.debug){console.log("DEBUG: socket disconnected")}},onResize:function(b,a){if(this.debug){console.log("DEBUG: chart resized to width: "+b+" height: "+a)}},onLangChange:function(a){if(this.debug){console.log("DEBUG: language changed to "+a)}},onSymbolChange:function(b,a){if(this.debug){console.log("DEBUG: symbol changed to "+b+" "+a)}},onThemeChange:function(a){if(this.debug){console.log("DEBUG: theme changed to : "+a)}},onRangeChange:function(a){if(this.debug){console.log("DEBUG: range changed to "+a)}}};var KlineIns=null;var KlineTrade=function(a){this.browerState=0;this.tradeDate=new Date();this.tradesLimit=20;this.lastDepth=null;this.depthShowSize=15;this.priceDecimalDigits=6;this.amountDecimalDigits=4;this.symbol=null;this.curPrice=null;this.title="";Object.assign(this,a)};KlineTrade.prototype={reset:function(a){this.symbol=a;this.lastDepth=null;this.curPrice=null;this.klineTradeInit=false;$("#trades .trades_list").empty();$("#gasks .table").empty();$("#gbids .table").empty();$("#asks .table").empty();$("#bids .table").empty()},pushTrades:function(m){var k=$("#trades .trades_list");var a="";for(var d=0;d<m.length;d++){var n=m[d];if(d>=m.length-this.tradesLimit){this.tradeDate.setTime(n.time);var b=this.dateFormatTf(this.tradeDate.getHours())+":"+this.dateFormatTf(this.tradeDate.getMinutes())+":"+this.dateFormatTf(this.tradeDate.getSeconds());var f=(n.amount.toFixed(4)+"").split(".");var h=n.price;if(h>1){h=h.toFixed(2)}if(h<1&&h>0.00001){h=h.toFixed(4)}if(h<0.00001){h=h.toFixed(6)}if(this.klineTradeInit){a="<ul class='newul'><li class='tm'>"+b+"</li><li class='pr-"+(n.type=="buy"?"green":"red")+"'>"+h+"</li><li class='vl'>"+f[0]+"<g>"+(f.length>1?"."+f[1]:"")+"</g></li></ul>"+a}else{a="<ul><li class='tm'>"+b+"</li><li class='pr-"+(n.type=="buy"?"green":"red")+"'>"+h+"</li><li class='vl'>"+f[0]+"<g>"+(f.length>1?"."+f[1]:"")+"</g></li></ul>"+a}}}var c=0;var l=this;if(this.klineTradeInit){clearInterval(g);var g=setInterval(function(){var j=m[c];var i=Number(j.price);if(i>1){i=i.toFixed(2)}if(i<1&&i>0.0001){i=i.toFixed(4)}if(i<0.0001){i=i.toFixed(6)}l.curPrice=i;$("div#price").attr("class",j.type=="buy"?"green":"red").text(i);c++;if(c>=m.length){clearInterval(g)}},100)}else{if(m.length>0){var h=Number(m[m.length-1].price);if(h>1){h=h.toFixed(2)}if(h<1&&h>0.0001){h=h.toFixed(4)}if(h<0.0001){h=h.toFixed(6)}l.curPrice=h;$("div#price").attr("class",m[m.length-1].type=="buy"?"green":"red").text(h)}}if(this.klineTradeInit){k.prepend(a)}else{k.append(a)}a=null;k.find("ul.newul").slideDown(1000,function(){$(this).removeClass("newul")});k.find("ul:gt("+(this.tradesLimit-1)+")").remove()},updateDepth:function(f){window._set_current_depth(f);if(!f){return}$("#gasks .table").html(this.getgview(this.getgasks(f.asks)));$("#gbids .table").html(this.getgview(this.getgbids(f.bids)));if(this.lastDepth==null){this.lastDepth={};this.lastDepth.asks=this.getAsks(f.asks,this.depthShowSize);this.depthInit(this.lastDepth.asks,$("#asks .table"));this.lastDepth.bids=this.getBids(f.bids,this.depthShowSize);this.depthInit(this.lastDepth.bids,$("#bids .table"))}else{var b=$("#asks .table");b.find("div.remove").remove();b.find("div.add").removeClass("add");var g=this.getAsks(f.asks,this.depthShowSize);var a=this.lastDepth.asks;this.lastDepth.asks=g;this.asksAndBids(g.slice(0),a,b);var d=$("#bids .table");d.find("div.remove").remove();d.find("div.add").removeClass("add");var h=this.getBids(f.bids,this.depthShowSize);var c=this.lastDepth.bids;this.lastDepth.bids=h;this.asksAndBids(h.slice(0),c,$("#bids .table"))}},depthInit:function(g,j){j.empty();if(g&&g.length>0){var h,b="";for(var f=0;f<g.length;f++){var a=(g[f][0]+"").split(".");var d=this.getPrice(a,h);h=a[0];a=(g[f][1]+"").split(".");var c=this.getAmount(a);b+="<div class='row'><span class='price'>"+d[0]+"<g>"+d[1]+"</g></span> <span class='amount'>"+c[0]+"<g>"+c[1]+"</g></span></div>"}j.append(b);b=null}},asksAndBids:function(b,c,m){for(var g=0;g<c.length;g++){var o=false;for(var d=0;d<b.length;d++){if(c[g][0]==b[d][0]){o=true;if(c[g][1]!=b[d][1]){var a=m.find("div:eq("+g+") .amount");a.addClass(c[g][1]>b[d][1]?"red":"green");var h=this.getAmount((b[d][1]+"").split("."));setTimeout((function(j,i){return function(){j.html(i[0]+"<g>"+i[1]+"</g>");j.removeClass("red").removeClass("green");j=null;i=null}})(a,h),500)}b.splice(d,1);break}}if(!o){m.find("div:eq("+g+")").addClass("remove");c[g][2]=-1}}for(var d=0;d<c.length;d++){for(var g=0;g<b.length;g++){if(b[g][0]>c[d][0]){var l=(b[g][1]+"").split(".");var h=this.getAmount(l);m.find("div:eq("+d+")").before("<div class='row add'><span class='price'></span> <span class='amount'>"+h[0]+"<g>"+h[1]+"</g></span></div>");c.splice(d,0,b[g]);b.splice(g,1);break}}}var k="";for(var g=0;g<b.length;g++){c.push(b[g]);var l=(b[g][1]+"").split(".");var h=this.getAmount(l);k+="<div class='row add'><span class='price'></span> <span class='amount'>"+h[0]+"<g>"+h[1]+"</g></span></div>"}if(k.length>0){m.append(k)}k=null;var n;for(var g=0;g<c.length;g++){var p=m.find("div:eq("+g+")");if(!(c[g].length>=3&&c[g][2]==-1)){var l=(c[g][0]+"").split(".");var f=this.getPrice(l,n);n=l[0];p.find(".price").html(f[0]+"<g>"+f[1]+"</g>")}}b=null;c=null;m.find("div.add").slideDown(800);setTimeout((function(i,j){return function(){i.slideUp(500,function(){$(this).remove()});j.removeClass("add")}})(m.find("div.remove"),m.find("div.add")),1000)},getAsks:function(b,a){if(b.length>a){b.splice(0,b.length-a)}return b},getBids:function(b,a){if(b.length>a){b.splice(a,b.length-1)}return b},getgview:function(c){var d="";var f;for(var b=0;b<c.length;b++){var a=c[b][0].split(".");if(a.length==1||a[0]!=f){d+="<div class='row'><span class='price'>"+c[b][0]+"</span> <span class='amount'>"+c[b][1]+"</span></div>";f=a[0]}else{d+="<div class='row'><span class='price'><h>"+a[0]+".</h>"+a[1]+"</span> <span class='amount'>"+c[b][1]+"</span></div>"}}return d},getgasks:function(k){if(k.length<2){return[]}var l=k[k.length-1][0];var f=k[0][0];var a=f-l;var d=this.getBlock(a,100);var b=Math.abs(Number(Math.log(d)/Math.log(10))).toFixed(0);if(a/d<2){d=d/2;b++}if(d>=1){(b=0)}l=parseInt(l/d)*d;f=parseInt(f/d)*d;var j=[];var h=0;for(var g=k.length-1;g>=0;g--){if(k[g][0]>l){var c=parseInt(h,10);if(c>0){j.unshift([Number(l).toFixed(b),c])}if(l>=f){break}l+=d}h+=k[g][1]}return j},getgbids:function(k){if(k.length<2){return[]}var l=k[k.length-1][0];var f=k[0][0];var a=f-l;var d=this.getBlock(a,100);var b=Math.abs(Number(Math.log(d)/Math.log(10))).toFixed(0);if(a/d<2){d=d/2;b++}if(d>=1){(b=0)}l=parseInt(l/d)*d;f=parseInt(f/d)*d;var j=[];var h=0;for(var g=0;g<k.length;g++){if(k[g][0]<f){var c=parseInt(h,10);if(c>0){j.push([Number(f).toFixed(b),c])}if(f<=l){break}f-=d}h+=k[g][1]}return j},getBlock:function(a,c){if(a>c||a<=0){return c}else{c=c/10;return this.getBlock(a,c)}},getZeros:function(b){var a="";while(b>0){b--;a+="0"}return a},getPrice:function(a,d){var c=a[0];if(d==c){c="<h>"+c+".</h>"}else{c+="."}var b="";if(a.length==1){c+="0";b=this.getZeros(this.priceDecimalDigits-1)}else{c+=a[1];b=this.getZeros(this.priceDecimalDigits-a[1].length)}return[c,b]},getAmount:function(a){var c=a[0];var b="";var d=this.amountDecimalDigits-c.length+1;if(d>0){b=".";if(a.length==1){b+=this.getZeros(d)}else{if(d>a[1].length){b+=a[1]+this.getZeros(d-a[1].length)}else{if(d==a[1].length){b+=a[1]}else{b+=a[1].substring(0,d)}}}}return[c,b]},dateFormatTf:function(a){return(a<10?"0":"")+a},};var KlineTradeIns=null;var classId=0;function create_class(){var l=arguments.length;var g=function(){};var d;if(l){d=arguments[0];for(var a in d.prototype){g.prototype[a]=d.prototype[a]
}}for(var c=1;c<l;c++){var b=arguments[c];var h=b.prototype.__construct;if(h){if(!g.prototype.__featureConstructors){g.prototype.__featureConstructors=[]}g.prototype.__featureConstructors.push(h);delete b.prototype.__construct}for(var a in b.prototype){g.prototype[a]=b.prototype[a]}if(h){b.prototype.__construct=h}}var j=function(){if(this.__construct){this.__construct.apply(this,arguments)}if(this.__featureConstructors){var f=this.__featureConstructors;var k,m=f.length;for(k=0;k<m;k++){f[k].apply(this,arguments)}}};g.prototype.__classId=classId++;if(d!=undefined){j.__super=d.prototype;g.prototype.__super=d}j.prototype=new g();return j}function is_instance(c,a){var b=a.prototype.__classId;if(c.__classId==b){return true}var d=c.__super;while(d!=undefined){if(d.prototype.__classId==b){return true}d=d.prototype.__super}return false}var MEvent=create_class();MEvent.prototype.__construct=function(){this._handlers=[]};MEvent.prototype.addHandler=function(b,a){if(this._indexOf(b,a)<0){this._handlers.push({obj:b,func:a})}};MEvent.prototype.removeHandler=function(c,b){var a=this._indexOf(c,b);if(a>=0){this._handlers.splice(a,1)}};MEvent.prototype.raise=function(f,h){var b=this._handlers;var j,d,k=b.length;for(d=0;d<k;d++){j=b[d];j.func.call(j.obj,f,h)}};MEvent.prototype._indexOf=function(j,g){var b=this._handlers;var h,d,k=b.length;for(d=0;d<k;d++){h=b[d];if(j==h.obj&&g==h.func){return d}}return -1};String.fromFloat=function(a,c){var d=a.toFixed(c);for(var b=d.length-1;b>=0;b--){if(d[b]=="."){return d.substring(0,b)}if(d[b]!="0"){return d.substring(0,b+1)}}};var ExprEnv=create_class();ExprEnv.get=function(){return ExprEnv.inst};ExprEnv.set=function(a){ExprEnv.inst=a};ExprEnv.prototype.getDataSource=function(){return this._ds};ExprEnv.prototype.setDataSource=function(a){return this._ds=a};ExprEnv.prototype.getFirstIndex=function(){return this._firstIndex};ExprEnv.prototype.setFirstIndex=function(a){return this._firstIndex=a};var Expr=create_class();Expr.prototype.__construct=function(){this._rid=0};Expr.prototype.execute=function(a){};Expr.prototype.reserve=function(a,b){};Expr.prototype.clear=function(){};var OpenExpr=create_class(Expr);var HighExpr=create_class(Expr);var LowExpr=create_class(Expr);var CloseExpr=create_class(Expr);var VolumeExpr=create_class(Expr);OpenExpr.prototype.execute=function(a){return ExprEnv.get()._ds.getDataAt(a).open};HighExpr.prototype.execute=function(a){return ExprEnv.get()._ds.getDataAt(a).high};LowExpr.prototype.execute=function(a){return ExprEnv.get()._ds.getDataAt(a).low};CloseExpr.prototype.execute=function(a){return ExprEnv.get()._ds.getDataAt(a).close};VolumeExpr.prototype.execute=function(a){return ExprEnv.get()._ds.getDataAt(a).volume};var ConstExpr=create_class(Expr);ConstExpr.prototype.__construct=function(a){ConstExpr.__super.__construct.call(this);this._value=a};ConstExpr.prototype.execute=function(a){return this._value};var ParameterExpr=create_class(Expr);ParameterExpr.prototype.__construct=function(b,c,d,a){ParameterExpr.__super.__construct.call(this);this._name=b;this._minValue=c;this._maxValue=d;this._value=this._defaultValue=a};ParameterExpr.prototype.execute=function(a){return this._value};ParameterExpr.prototype.getMinValue=function(){return this._minValue};ParameterExpr.prototype.getMaxValue=function(){return this._maxValue};ParameterExpr.prototype.getDefaultValue=function(){return this._defaultValue};ParameterExpr.prototype.getValue=function(){return this._value};ParameterExpr.prototype.setValue=function(a){if(a==0){this._value=0}else{if(a<this._minValue){this._value=this._minValue}else{if(a>this._maxValue){this._value=this._maxValue}else{this._value=a}}}};var OpAExpr=create_class(Expr);var OpABExpr=create_class(Expr);var OpABCExpr=create_class(Expr);var OpABCDExpr=create_class(Expr);OpAExpr.prototype.__construct=function(b){OpAExpr.__super.__construct.call(this);this._exprA=b};OpAExpr.prototype.reserve=function(a,b){if(this._rid<a){this._rid=a;this._exprA.reserve(a,b)}};OpAExpr.prototype.clear=function(){this._exprA.clear()};OpABExpr.prototype.__construct=function(d,c){OpABExpr.__super.__construct.call(this);this._exprA=d;this._exprB=c};OpABExpr.prototype.reserve=function(a,b){if(this._rid<a){this._rid=a;this._exprA.reserve(a,b);this._exprB.reserve(a,b)}};OpABExpr.prototype.clear=function(){this._exprA.clear();this._exprB.clear()};OpABCExpr.prototype.__construct=function(f,d,g){OpABCExpr.__super.__construct.call(this);this._exprA=f;this._exprB=d;this._exprC=g};OpABCExpr.prototype.reserve=function(a,b){if(this._rid<a){this._rid=a;this._exprA.reserve(a,b);this._exprB.reserve(a,b);this._exprC.reserve(a,b)}};OpABCExpr.prototype.clear=function(){this._exprA.clear();this._exprB.clear();this._exprC.clear()};OpABCDExpr.prototype.__construct=function(g,f,i,h){OpABCDExpr.__super.__construct.call(this);this._exprA=g;this._exprB=f;this._exprC=i;this._exprD=h};OpABCDExpr.prototype.reserve=function(a,b){if(this._rid<a){this._rid=a;this._exprA.reserve(a,b);this._exprB.reserve(a,b);this._exprC.reserve(a,b);this._exprD.reserve(a,b)}};OpABCDExpr.prototype.clear=function(){this._exprA.clear();this._exprB.clear();this._exprC.clear();this._exprD.clear()};var NegExpr=create_class(OpAExpr);NegExpr.prototype.__construct=function(b){NegExpr.__super.__construct.call(this,b)};NegExpr.prototype.execute=function(a){return -(this._exprA.execute(a))};var AddExpr=create_class(OpABExpr);var SubExpr=create_class(OpABExpr);var MulExpr=create_class(OpABExpr);var DivExpr=create_class(OpABExpr);AddExpr.prototype.__construct=function(d,c){AddExpr.__super.__construct.call(this,d,c)};SubExpr.prototype.__construct=function(d,c){SubExpr.__super.__construct.call(this,d,c)};MulExpr.prototype.__construct=function(d,c){MulExpr.__super.__construct.call(this,d,c)};DivExpr.prototype.__construct=function(d,c){DivExpr.__super.__construct.call(this,d,c)};AddExpr.prototype.execute=function(a){return this._exprA.execute(a)+this._exprB.execute(a)};SubExpr.prototype.execute=function(a){return this._exprA.execute(a)-this._exprB.execute(a)};MulExpr.prototype.execute=function(a){return this._exprA.execute(a)*this._exprB.execute(a)};DivExpr.prototype.execute=function(f){var d=this._exprA.execute(f);var c=this._exprB.execute(f);if(d==0){return d}if(c==0){return(d>0)?1000000:-1000000}return d/c};var GtExpr=create_class(OpABExpr);var GeExpr=create_class(OpABExpr);var LtExpr=create_class(OpABExpr);var LeExpr=create_class(OpABExpr);var EqExpr=create_class(OpABExpr);GtExpr.prototype.__construct=function(d,c){GtExpr.__super.__construct.call(this,d,c)};GeExpr.prototype.__construct=function(d,c){GeExpr.__super.__construct.call(this,d,c)};LtExpr.prototype.__construct=function(d,c){LtExpr.__super.__construct.call(this,d,c)};LeExpr.prototype.__construct=function(d,c){LeExpr.__super.__construct.call(this,d,c)};EqExpr.prototype.__construct=function(d,c){EqExpr.__super.__construct.call(this,d,c)};GtExpr.prototype.execute=function(a){return this._exprA.execute(a)>this._exprB.execute(a)?1:0};GeExpr.prototype.execute=function(a){return this._exprA.execute(a)>=this._exprB.execute(a)?1:0};LtExpr.prototype.execute=function(a){return this._exprA.execute(a)<this._exprB.execute(a)?1:0};LeExpr.prototype.execute=function(a){return this._exprA.execute(a)<=this._exprB.execute(a)?1:0};EqExpr.prototype.execute=function(a){return this._exprA.execute(a)==this._exprB.execute(a)?1:0};var MaxExpr=create_class(OpABExpr);MaxExpr.prototype.__construct=function(d,c){MaxExpr.__super.__construct.call(this,d,c)};MaxExpr.prototype.execute=function(a){return Math.max(this._exprA.execute(a),this._exprB.execute(a))};var AbsExpr=create_class(OpAExpr);AbsExpr.prototype.__construct=function(b){AbsExpr.__super.__construct.call(this,b)};AbsExpr.prototype.execute=function(a){return Math.abs(this._exprA.execute(a))};var RefExpr=create_class(OpABExpr);RefExpr.prototype.__construct=function(d,c){RefExpr.__super.__construct.call(this,d,c);this._offset=-1};RefExpr.prototype.execute=function(b){if(this._offset<0){this._offset=this._exprB.execute(b);if(this._offset<0){throw"offset < 0"}}b-=this._offset;if(b<0){throw"index < 0"}var a=this._exprA.execute(b);if(isNaN(a)){throw"NaN"}return a};var AndExpr=create_class(OpABExpr);var OrExpr=create_class(OpABExpr);AndExpr.prototype.__construct=function(d,c){AndExpr.__super.__construct.call(this,d,c)};OrExpr.prototype.__construct=function(d,c){OrExpr.__super.__construct.call(this,d,c)};AndExpr.prototype.execute=function(a){return(this._exprA.execute(a)!=0)&&(this._exprB.execute(a)!=0)?1:0};OrExpr.prototype.execute=function(a){return(this._exprA.execute(a)!=0)||(this._exprB.execute(a)!=0)?1:0};var IfExpr=create_class(OpABCExpr);IfExpr.prototype.__construct=function(f,d,g){IfExpr.__super.__construct.call(this,f,d,g)};IfExpr.prototype.execute=function(a){return this._exprA.execute(a)!=0?this._exprB.execute(a):this._exprC.execute(a)};var AssignExpr=create_class(OpAExpr);AssignExpr.prototype.__construct=function(c,b){AssignExpr.__super.__construct.call(this,b);this._name=c;this._buf=[]};AssignExpr.prototype.getName=function(){return this._name};AssignExpr.prototype.execute=function(a){return this._buf[a]};AssignExpr.prototype.assign=function(a){this._buf[a]=this._exprA.execute(a);if(ExprEnv.get()._firstIndex>=0){if(isNaN(this._buf[a])&&!isNaN(this._buf[a-1])){throw this._name+".assign("+a+"): NaN"}}};AssignExpr.prototype.reserve=function(a,b){if(this._rid<a){for(var d=b;d>0;d--){this._buf.push(NaN)}}AssignExpr.__super.reserve.call(this,a,b)};AssignExpr.prototype.clear=function(){AssignExpr.__super.clear.call(this);this._buf=[]};var OutputStyle={None:0,Line:1,VolumeStick:2,MACDStick:3,SARPoint:4};var OutputExpr=create_class(AssignExpr);OutputExpr.prototype.__construct=function(d,b,f,c){OutputExpr.__super.__construct.call(this,d,b);this._style=(f===undefined)?OutputStyle.Line:f;this._color=c};OutputExpr.prototype.getStyle=function(){return this._style};OutputExpr.prototype.getColor=function(){return this._color};var RangeOutputExpr=create_class(OutputExpr);
RangeOutputExpr.prototype.__construct=function(d,b,f,c){RangeOutputExpr.__super.__construct.call(this,d,b,f,c)};RangeOutputExpr.prototype.getName=function(){return this._name+this._exprA.getRange()};var RangeExpr=create_class(OpABExpr);RangeExpr.prototype.__construct=function(d,c){RangeExpr.__super.__construct.call(this,d,c);this._range=-1;this._buf=[]};RangeExpr.prototype.getRange=function(){return this._range};RangeExpr.prototype.initRange=function(){this._range=this._exprB.execute(0)};RangeExpr.prototype.execute=function(a){if(this._range<0){this.initRange()}var c=this._buf[a].resultA=this._exprA.execute(a);var b=this._buf[a].result=this.calcResult(a,c);return b};RangeExpr.prototype.reserve=function(a,b){if(this._rid<a){for(var d=b;d>0;d--){this._buf.push({resultA:NaN,result:NaN})}}RangeExpr.__super.reserve.call(this,a,b)};RangeExpr.prototype.clear=function(){RangeExpr.__super.clear.call(this);this._range=-1;this._buf=[]};var HhvExpr=create_class(RangeExpr);var LlvExpr=create_class(RangeExpr);HhvExpr.prototype.__construct=function(d,c){HhvExpr.__super.__construct.call(this,d,c)};LlvExpr.prototype.__construct=function(d,c){LlvExpr.__super.__construct.call(this,d,c)};HhvExpr.prototype.calcResult=function(b,j){if(this._range==0){return NaN}var f=ExprEnv.get()._firstIndex;if(f<0){return j}if(b>f){var h=this._range;var a=j;var g=b-h+1;var c=Math.max(f,g);for(;c<b;c++){var d=this._buf[c];if(a<d.resultA){a=d.resultA}}return a}else{return j}};LlvExpr.prototype.calcResult=function(b,j){if(this._range==0){return NaN}var f=ExprEnv.get()._firstIndex;if(f<0){return j}if(b>f){var h=this._range;var a=j;var g=b-h+1;var c=Math.max(f,g);for(;c<b;c++){var d=this._buf[c];if(a>d.resultA){a=d.resultA}}return a}else{return j}};var CountExpr=create_class(RangeExpr);CountExpr.prototype.__construct=function(d,c){CountExpr.__super.__construct.call(this,d,c)};CountExpr.prototype.calcResult=function(a,f){if(this._range==0){return NaN}var c=ExprEnv.get()._firstIndex;if(c<0){return 0}if(a>=c){var d=this._range-1;if(d>a-c){d=a-c}var b=0;for(;d>=0;d--){if(this._buf[a-d].resultA!=0){b++}}return b}else{return 0}};var SumExpr=create_class(RangeExpr);SumExpr.prototype.__construct=function(d,c){SumExpr.__super.__construct.call(this,d,c)};SumExpr.prototype.calcResult=function(a,d){var b=ExprEnv.get()._firstIndex;if(b<0){return d}if(a>b){var c=this._range;if(c==0||c>=a+1-b){return this._buf[a-1].result+d}return this._buf[a-1].result+d-this._buf[a-c].resultA}else{return d}};var StdExpr=create_class(RangeExpr);StdExpr.prototype.__construct=function(d,c){StdExpr.__super.__construct.call(this,d,c)};StdExpr.prototype.calcResult=function(b,h){if(this._range==0){return NaN}var a=this._stdBuf[b];var f=ExprEnv.get()._firstIndex;if(f<0){a.resultMA=h;return 0}if(b>f){var g=this._range;if(g>=b+1-f){g=b+1-f;a.resultMA=this._stdBuf[b-1].resultMA*(1-1/g)+(h/g)}else{a.resultMA=this._stdBuf[b-1].resultMA+(h-this._buf[b-g].resultA)/g}var d=0;for(var c=b-g+1;c<=b;c++){d+=Math.pow(this._buf[c].resultA-a.resultMA,2)}return Math.sqrt(d/g)}a.resultMA=h;return 0};StdExpr.prototype.reserve=function(a,b){if(this._rid<a){for(var d=b;d>0;d--){this._stdBuf.push({resultMA:NaN})}}StdExpr.__super.reserve.call(this,a,b)};StdExpr.prototype.clear=function(){StdExpr.__super.clear.call(this);this._stdBuf=[]};var MaExpr=create_class(RangeExpr);MaExpr.prototype.__construct=function(d,c){MaExpr.__super.__construct.call(this,d,c)};MaExpr.prototype.calcResult=function(a,d){if(this._range==0){return NaN}var b=ExprEnv.get()._firstIndex;if(b<0){return d}if(a>b){var c=this._range;if(c>=a+1-b){c=a+1-b;return this._buf[a-1].result*(1-1/c)+(d/c)}return this._buf[a-1].result+(d-this._buf[a-c].resultA)/c}else{return d}};var EmaExpr=create_class(RangeExpr);EmaExpr.prototype.__construct=function(d,c){EmaExpr.__super.__construct.call(this,d,c)};EmaExpr.prototype.initRange=function(){EmaExpr.__super.initRange.call(this);this._alpha=2/(this._range+1)};EmaExpr.prototype.calcResult=function(a,d){if(this._range==0){return NaN}var c=ExprEnv.get()._firstIndex;if(c<0){return d}if(a>c){var b=this._buf[a-1];return this._alpha*(d-b.result)+b.result}return d};var ExpmemaExpr=create_class(EmaExpr);ExpmemaExpr.prototype.__construct=function(d,c){ExpmemaExpr.__super.__construct.call(this,d,c)};ExpmemaExpr.prototype.calcResult=function(a,f){var c=ExprEnv.get()._firstIndex;if(c<0){return f}if(a>c){var d=this._range;var b=this._buf[a-1];if(d>=a+1-c){d=a+1-c;return b.result*(1-1/d)+(f/d)}return this._alpha*(f-b.result)+b.result}return f};var SmaExpr=create_class(RangeExpr);SmaExpr.prototype.__construct=function(f,d,g){SmaExpr.__super.__construct.call(this,f,d);this._exprC=g;this._mul};SmaExpr.prototype.initRange=function(){SmaExpr.__super.initRange.call(this);this._mul=this._exprC.execute(0)};SmaExpr.prototype.calcResult=function(a,d){if(this._range==0){return NaN}var b=ExprEnv.get()._firstIndex;if(b<0){return d}if(a>b){var c=this._range;if(c>a+1-b){c=a+1-b}return((c-1)*this._buf[a-1].result+d*this._mul)/c}return d};var SarExpr=create_class(OpABCDExpr);SarExpr.prototype.__construct=function(g,f,i,h){SarExpr.__super.__construct.call(this,g,f,i,h);this._buf=[];this._range=-1;this._min;this._step;this._max};SarExpr.prototype.execute=function(k){if(this._range<0){this._range=this._exprA.execute(0);this._min=this._exprB.execute(0)/100;this._step=this._exprC.execute(0)/100;this._max=this._exprD.execute(0)/100}var d=this._buf[k];var n=ExprEnv.get();var j=n._firstIndex;if(j<0){d.longPos=true;d.sar=n._ds.getDataAt(k).low;d.ep=n._ds.getDataAt(k).high;d.af=0.02}else{var c=n._ds.getDataAt(k).high;var m=n._ds.getDataAt(k).low;var b=this._buf[k-1];d.sar=b.sar+b.af*(b.ep-b.sar);if(b.longPos){d.longPos=true;if(c>b.ep){d.ep=c;d.af=Math.min(b.af+this._step,this._max)}else{d.ep=b.ep;d.af=b.af}if(d.sar>m){d.longPos=false;var f=k-this._range+1;for(f=Math.max(f,j);f<k;f++){var g=n._ds.getDataAt(f).high;if(c<g){c=g}}d.sar=c;d.ep=m;d.af=0.02}}else{d.longPos=false;if(m<b.ep){d.ep=m;d.af=Math.min(b.af+this._step,this._max)}else{d.ep=b.ep;d.af=b.af}if(d.sar<c){d.longPos=true;var f=k-this._range+1;for(f=Math.max(f,j);f<k;f++){var a=n._ds.getDataAt(f).low;if(m>a){m=a}}d.sar=m;d.ep=c;d.af=0.02}}}return d.sar};SarExpr.prototype.reserve=function(a,b){if(this._rid<a){for(var d=b;d>0;d--){this._buf.push({longPos:true,sar:NaN,ep:NaN,af:NaN})}}SarExpr.__super.reserve.call(this,a,b)};SarExpr.prototype.clear=function(){SarExpr.__super.clear.call(this);this._range=-1};var Indicator=create_class();Indicator.prototype.__construct=function(){this._exprEnv=new ExprEnv();this._rid=0;this._params=[];this._assigns=[];this._outputs=[]};Indicator.prototype.addParameter=function(a){this._params.push(a)};Indicator.prototype.addAssign=function(a){this._assigns.push(a)};Indicator.prototype.addOutput=function(a){this._outputs.push(a)};Indicator.prototype.getParameterCount=function(){return this._params.length};Indicator.prototype.getParameterAt=function(a){return this._params[a]};Indicator.prototype.getOutputCount=function(){return this._outputs.length};Indicator.prototype.getOutputAt=function(a){return this._outputs[a]};Indicator.prototype.clear=function(){this._exprEnv.setFirstIndex(-1);var b,a;a=this._assigns.length;for(b=0;b<a;b++){this._assigns[b].clear()}a=this._outputs.length;for(b=0;b<a;b++){this._outputs[b].clear()}};Indicator.prototype.reserve=function(c){this._rid++;var b,a;a=this._assigns.length;for(b=0;b<a;b++){this._assigns[b].reserve(this._rid,c)}a=this._outputs.length;for(b=0;b<a;b++){this._outputs[b].reserve(this._rid,c)}};Indicator.prototype.execute=function(d,a){if(a<0){return}this._exprEnv.setDataSource(d);ExprEnv.set(this._exprEnv);try{var c,b;b=this._assigns.length;for(c=0;c<b;c++){this._assigns[c].assign(a)}b=this._outputs.length;for(c=0;c<b;c++){this._outputs[c].assign(a)}if(this._exprEnv.getFirstIndex()<0){this._exprEnv.setFirstIndex(a)}}catch(f){if(this._exprEnv.getFirstIndex()>=0){alert(f);throw f}}};Indicator.prototype.getParameters=function(){var c=[];var b,a=this._params.length;for(b=0;b<a;b++){c.push(this._params[b].getValue())}return c};Indicator.prototype.setParameters=function(b){if((b instanceof Array)&&b.length==this._params.length){for(var a in this._params){this._params[a].setValue(b[a])}}};var HLCIndicator=create_class(Indicator);HLCIndicator.prototype.__construct=function(){HLCIndicator.__super.__construct.call(this);var a=new ParameterExpr("M1",2,1000,60);this.addParameter(a);this.addOutput(new OutputExpr("HIGH",new HighExpr(),OutputStyle.None));this.addOutput(new OutputExpr("LOW",new LowExpr(),OutputStyle.None));this.addOutput(new OutputExpr("CLOSE",new CloseExpr(),OutputStyle.Line,Theme.Color.Indicator0));this.addOutput(new RangeOutputExpr("MA",new MaExpr(new CloseExpr(),a),OutputStyle.Line,Theme.Color.Indicator1))};HLCIndicator.prototype.getName=function(){return"CLOSE"};var MAIndicator=create_class(Indicator);MAIndicator.prototype.__construct=function(){MAIndicator.__super.__construct.call(this);var g=new ParameterExpr("M1",2,1000,7);var f=new ParameterExpr("M2",2,1000,30);var d=new ParameterExpr("M3",2,1000,0);var c=new ParameterExpr("M4",2,1000,0);var b=new ParameterExpr("M5",2,1000,0);var a=new ParameterExpr("M6",2,1000,0);this.addParameter(g);this.addParameter(f);this.addParameter(d);this.addParameter(c);this.addParameter(b);this.addParameter(a);this.addOutput(new RangeOutputExpr("MA",new MaExpr(new CloseExpr(),g)));this.addOutput(new RangeOutputExpr("MA",new MaExpr(new CloseExpr(),f)));this.addOutput(new RangeOutputExpr("MA",new MaExpr(new CloseExpr(),d)));this.addOutput(new RangeOutputExpr("MA",new MaExpr(new CloseExpr(),c)));this.addOutput(new RangeOutputExpr("MA",new MaExpr(new CloseExpr(),b)));this.addOutput(new RangeOutputExpr("MA",new MaExpr(new CloseExpr(),a)))};MAIndicator.prototype.getName=function(){return"MA"};var EMAIndicator=create_class(Indicator);EMAIndicator.prototype.__construct=function(){EMAIndicator.__super.__construct.call(this);var g=new ParameterExpr("M1",2,1000,7);var f=new ParameterExpr("M2",2,1000,30);
    var d=new ParameterExpr("M3",2,1000,0);var c=new ParameterExpr("M4",2,1000,0);var b=new ParameterExpr("M5",2,1000,0);var a=new ParameterExpr("M6",2,1000,0);this.addParameter(g);this.addParameter(f);this.addParameter(d);this.addParameter(c);this.addParameter(b);this.addParameter(a);this.addOutput(new RangeOutputExpr("EMA",new EmaExpr(new CloseExpr(),g)));this.addOutput(new RangeOutputExpr("EMA",new EmaExpr(new CloseExpr(),f)));this.addOutput(new RangeOutputExpr("EMA",new EmaExpr(new CloseExpr(),d)));this.addOutput(new RangeOutputExpr("EMA",new EmaExpr(new CloseExpr(),c)));this.addOutput(new RangeOutputExpr("EMA",new EmaExpr(new CloseExpr(),b)));this.addOutput(new RangeOutputExpr("EMA",new EmaExpr(new CloseExpr(),a)))};EMAIndicator.prototype.getName=function(){return"EMA"};var VOLUMEIndicator=create_class(Indicator);VOLUMEIndicator.prototype.__construct=function(){VOLUMEIndicator.__super.__construct.call(this);var c=new ParameterExpr("M1",2,500,5);var a=new ParameterExpr("M2",2,500,10);this.addParameter(c);this.addParameter(a);var b=new OutputExpr("VOLUME",new VolumeExpr(),OutputStyle.VolumeStick,Theme.Color.Text4);this.addOutput(b);this.addOutput(new RangeOutputExpr("MA",new MaExpr(b,c),OutputStyle.Line,Theme.Color.Indicator0));this.addOutput(new RangeOutputExpr("MA",new MaExpr(b,a),OutputStyle.Line,Theme.Color.Indicator1))};VOLUMEIndicator.prototype.getName=function(){return"VOLUME"};var MACDIndicator=create_class(Indicator);MACDIndicator.prototype.__construct=function(){MACDIndicator.__super.__construct.call(this);var c=new ParameterExpr("SHORT",2,200,12);var d=new ParameterExpr("LONG",2,200,26);var a=new ParameterExpr("MID",2,200,9);this.addParameter(c);this.addParameter(d);this.addParameter(a);var b=new OutputExpr("DIF",new SubExpr(new EmaExpr(new CloseExpr(),c),new EmaExpr(new CloseExpr(),d)));this.addOutput(b);var g=new OutputExpr("DEA",new EmaExpr(b,a));this.addOutput(g);var f=new OutputExpr("MACD",new MulExpr(new SubExpr(b,g),new ConstExpr(2)),OutputStyle.MACDStick);this.addOutput(f)};MACDIndicator.prototype.getName=function(){return"MACD"};var DMIIndicator=create_class(Indicator);DMIIndicator.prototype.__construct=function(){DMIIndicator.__super.__construct.call(this);var c=new ParameterExpr("N",2,90,14);var i=new ParameterExpr("MM",2,60,6);this.addParameter(c);this.addParameter(i);var k=new AssignExpr("MTR",new ExpmemaExpr(new MaxExpr(new MaxExpr(new SubExpr(new HighExpr(),new LowExpr()),new AbsExpr(new SubExpr(new HighExpr(),new RefExpr(new CloseExpr(),new ConstExpr(1))))),new AbsExpr(new SubExpr(new RefExpr(new CloseExpr(),new ConstExpr(1)),new LowExpr()))),c));this.addAssign(k);var l=new AssignExpr("HD",new SubExpr(new HighExpr(),new RefExpr(new HighExpr(),new ConstExpr(1))));this.addAssign(l);var d=new AssignExpr("LD",new SubExpr(new RefExpr(new LowExpr(),new ConstExpr(1)),new LowExpr()));this.addAssign(d);var a=new AssignExpr("DMP",new ExpmemaExpr(new IfExpr(new AndExpr(new GtExpr(l,new ConstExpr(0)),new GtExpr(l,d)),l,new ConstExpr(0)),c));this.addAssign(a);var h=new AssignExpr("DMM",new ExpmemaExpr(new IfExpr(new AndExpr(new GtExpr(d,new ConstExpr(0)),new GtExpr(d,l)),d,new ConstExpr(0)),c));this.addAssign(h);var b=new OutputExpr("PDI",new MulExpr(new DivExpr(a,k),new ConstExpr(100)));this.addOutput(b);var j=new OutputExpr("MDI",new MulExpr(new DivExpr(h,k),new ConstExpr(100)));this.addOutput(j);var g=new OutputExpr("ADX",new ExpmemaExpr(new MulExpr(new DivExpr(new AbsExpr(new SubExpr(j,b)),new AddExpr(j,b)),new ConstExpr(100)),i));this.addOutput(g);var f=new OutputExpr("ADXR",new ExpmemaExpr(g,i));this.addOutput(f)};DMIIndicator.prototype.getName=function(){return"DMI"};var DMAIndicator=create_class(Indicator);DMAIndicator.prototype.__construct=function(){DMAIndicator.__super.__construct.call(this);var c=new ParameterExpr("N1",2,60,10);var b=new ParameterExpr("N2",2,250,50);var f=new ParameterExpr("M",2,100,10);this.addParameter(c);this.addParameter(b);this.addParameter(f);var a=new OutputExpr("DIF",new SubExpr(new MaExpr(new CloseExpr(),c),new MaExpr(new CloseExpr(),b)));this.addOutput(a);var d=new OutputExpr("DIFMA",new MaExpr(a,f));this.addOutput(d)};DMAIndicator.prototype.getName=function(){return"DMA"};var TRIXIndicator=create_class(Indicator);TRIXIndicator.prototype.__construct=function(){TRIXIndicator.__super.__construct.call(this);var d=new ParameterExpr("N",2,100,12);var f=new ParameterExpr("M",2,100,9);this.addParameter(d);this.addParameter(f);var c=new AssignExpr("MTR",new EmaExpr(new EmaExpr(new EmaExpr(new CloseExpr(),d),d),d));this.addAssign(c);var b=new OutputExpr("TRIX",new MulExpr(new DivExpr(new SubExpr(c,new RefExpr(c,new ConstExpr(1))),new RefExpr(c,new ConstExpr(1))),new ConstExpr(100)));this.addOutput(b);var a=new OutputExpr("MATRIX",new MaExpr(b,f));this.addOutput(a)};TRIXIndicator.prototype.getName=function(){return"TRIX"};var BRARIndicator=create_class(Indicator);BRARIndicator.prototype.__construct=function(){BRARIndicator.__super.__construct.call(this);var d=new ParameterExpr("N",2,120,26);this.addParameter(d);var c=new AssignExpr("REF_CLOSE_1",new RefExpr(new CloseExpr(),new ConstExpr(1)));this.addAssign(c);var b=new OutputExpr("BR",new MulExpr(new DivExpr(new SumExpr(new MaxExpr(new ConstExpr(0),new SubExpr(new HighExpr(),c)),d),new SumExpr(new MaxExpr(new ConstExpr(0),new SubExpr(c,new LowExpr())),d)),new ConstExpr(100)));this.addOutput(b);var a=new OutputExpr("AR",new MulExpr(new DivExpr(new SumExpr(new SubExpr(new HighExpr(),new OpenExpr()),d),new SumExpr(new SubExpr(new OpenExpr(),new LowExpr()),d)),new ConstExpr(100)));this.addOutput(a)};BRARIndicator.prototype.getName=function(){return"BRAR"};var VRIndicator=create_class(Indicator);VRIndicator.prototype.__construct=function(){VRIndicator.__super.__construct.call(this);var h=new ParameterExpr("N",2,100,26);var i=new ParameterExpr("M",2,100,6);this.addParameter(h);this.addParameter(i);var f=new AssignExpr("REF_CLOSE_1",new RefExpr(new CloseExpr(),new ConstExpr(1)));this.addAssign(f);var d=new AssignExpr("TH",new SumExpr(new IfExpr(new GtExpr(new CloseExpr(),f),new VolumeExpr(),new ConstExpr(0)),h));this.addAssign(d);var b=new AssignExpr("TL",new SumExpr(new IfExpr(new LtExpr(new CloseExpr(),f),new VolumeExpr(),new ConstExpr(0)),h));this.addAssign(b);var g=new AssignExpr("TQ",new SumExpr(new IfExpr(new EqExpr(new CloseExpr(),f),new VolumeExpr(),new ConstExpr(0)),h));this.addAssign(g);var a=new OutputExpr("VR",new MulExpr(new DivExpr(new AddExpr(new MulExpr(d,new ConstExpr(2)),g),new AddExpr(new MulExpr(b,new ConstExpr(2)),g)),new ConstExpr(100)));this.addOutput(a);var c=new OutputExpr("MAVR",new MaExpr(a,i));this.addOutput(c)};VRIndicator.prototype.getName=function(){return"VR"};var OBVIndicator=create_class(Indicator);OBVIndicator.prototype.__construct=function(){OBVIndicator.__super.__construct.call(this);var f=new ParameterExpr("M",2,100,30);this.addParameter(f);var d=new AssignExpr("REF_CLOSE_1",new RefExpr(new CloseExpr(),new ConstExpr(1)));this.addAssign(d);var c=new AssignExpr("VA",new IfExpr(new GtExpr(new CloseExpr(),d),new VolumeExpr(),new NegExpr(new VolumeExpr())));this.addAssign(c);var a=new OutputExpr("OBV",new SumExpr(new IfExpr(new EqExpr(new CloseExpr(),d),new ConstExpr(0),c),new ConstExpr(0)));this.addOutput(a);var b=new OutputExpr("MAOBV",new MaExpr(a,f));this.addOutput(b)};OBVIndicator.prototype.getName=function(){return"OBV"};var EMVIndicator=create_class(Indicator);EMVIndicator.prototype.__construct=function(){EMVIndicator.__super.__construct.call(this);var f=new ParameterExpr("N",2,90,14);var g=new ParameterExpr("M",2,60,9);this.addParameter(f);this.addParameter(g);var d=new AssignExpr("VOLUME",new DivExpr(new MaExpr(new VolumeExpr(),f),new VolumeExpr()));this.addAssign(d);var b=new AssignExpr("MID",new MulExpr(new DivExpr(new SubExpr(new AddExpr(new HighExpr(),new LowExpr()),new RefExpr(new AddExpr(new HighExpr(),new LowExpr()),new ConstExpr(1))),new AddExpr(new HighExpr(),new LowExpr())),new ConstExpr(100)));this.addAssign(b);var a=new OutputExpr("EMV",new MaExpr(new DivExpr(new MulExpr(b,new MulExpr(d,new SubExpr(new HighExpr(),new LowExpr()))),new MaExpr(new SubExpr(new HighExpr(),new LowExpr()),f)),f));this.addOutput(a);var c=new OutputExpr("MAEMV",new MaExpr(a,g));this.addOutput(c)};EMVIndicator.prototype.getName=function(){return"EMV"};var RSIIndicator=create_class(Indicator);RSIIndicator.prototype.__construct=function(){RSIIndicator.__super.__construct.call(this);var f=new ParameterExpr("N1",2,120,6);var b=new ParameterExpr("N2",2,250,12);var a=new ParameterExpr("N3",2,500,24);this.addParameter(f);this.addParameter(b);this.addParameter(a);var d=new AssignExpr("LC",new RefExpr(new CloseExpr(),new ConstExpr(1)));this.addAssign(d);var c=new AssignExpr("CLOSE_LC",new SubExpr(new CloseExpr(),d));this.addAssign(c);this.addOutput(new OutputExpr("RSI1",new MulExpr(new DivExpr(new SmaExpr(new MaxExpr(c,new ConstExpr(0)),f,new ConstExpr(1)),new SmaExpr(new AbsExpr(c),f,new ConstExpr(1))),new ConstExpr(100))));this.addOutput(new OutputExpr("RSI2",new MulExpr(new DivExpr(new SmaExpr(new MaxExpr(c,new ConstExpr(0)),b,new ConstExpr(1)),new SmaExpr(new AbsExpr(c),b,new ConstExpr(1))),new ConstExpr(100))));this.addOutput(new OutputExpr("RSI3",new MulExpr(new DivExpr(new SmaExpr(new MaxExpr(c,new ConstExpr(0)),a,new ConstExpr(1)),new SmaExpr(new AbsExpr(c),a,new ConstExpr(1))),new ConstExpr(100))))};RSIIndicator.prototype.getName=function(){return"RSI"};var WRIndicator=create_class(Indicator);WRIndicator.prototype.__construct=function(){WRIndicator.__super.__construct.call(this);var i=new ParameterExpr("N",2,100,10);var f=new ParameterExpr("N1",2,100,6);this.addParameter(i);this.addParameter(f);var a=new AssignExpr("HHV",new HhvExpr(new HighExpr(),i));this.addAssign(a);var c=new AssignExpr("HHV1",new HhvExpr(new HighExpr(),f));this.addAssign(c);var b=new AssignExpr("LLV",new LlvExpr(new LowExpr(),i));this.addAssign(b);var h=new AssignExpr("LLV1",new LlvExpr(new LowExpr(),f));this.addAssign(h);var g=new OutputExpr("WR1",new MulExpr(new DivExpr(new SubExpr(a,new CloseExpr()),new SubExpr(a,b)),new ConstExpr(100)));
    this.addOutput(g);var d=new OutputExpr("WR2",new MulExpr(new DivExpr(new SubExpr(c,new CloseExpr()),new SubExpr(c,h)),new ConstExpr(100)));this.addOutput(d)};WRIndicator.prototype.getName=function(){return"WR"};var SARIndicator=create_class(Indicator);SARIndicator.prototype.__construct=function(){SARIndicator.__super.__construct.call(this);var d=new ConstExpr(4);var b=new ConstExpr(2);var a=new ConstExpr(2);var c=new ConstExpr(20);this.addOutput(new OutputExpr("SAR",new SarExpr(d,b,a,c),OutputStyle.SARPoint))};SARIndicator.prototype.getName=function(){return"SAR"};var KDJIndicator=create_class(Indicator);KDJIndicator.prototype.__construct=function(){KDJIndicator.__super.__construct.call(this);var g=new ParameterExpr("N",2,90,9);var c=new ParameterExpr("M1",2,30,3);var b=new ParameterExpr("M2",2,30,3);this.addParameter(g);this.addParameter(c);this.addParameter(b);var j=new AssignExpr("HHV",new HhvExpr(new HighExpr(),g));this.addAssign(j);var f=new AssignExpr("LLV",new LlvExpr(new LowExpr(),g));this.addAssign(f);var d=new AssignExpr("RSV",new MulExpr(new DivExpr(new SubExpr(new CloseExpr(),f),new SubExpr(j,f)),new ConstExpr(100)));this.addAssign(d);var h=new OutputExpr("K",new SmaExpr(d,c,new ConstExpr(1)));this.addOutput(h);var a=new OutputExpr("D",new SmaExpr(h,b,new ConstExpr(1)));this.addOutput(a);var i=new OutputExpr("J",new SubExpr(new MulExpr(h,new ConstExpr(3)),new MulExpr(a,new ConstExpr(2))));this.addOutput(i)};KDJIndicator.prototype.getName=function(){return"KDJ"};var ROCIndicator=create_class(Indicator);ROCIndicator.prototype.__construct=function(){ROCIndicator.__super.__construct.call(this);var d=new ParameterExpr("N",2,120,12);var f=new ParameterExpr("M",2,60,6);this.addParameter(d);this.addParameter(f);var a=new AssignExpr("REF_CLOSE_N",new RefExpr(new CloseExpr(),d));this.addAssign(a);var b=new OutputExpr("ROC",new MulExpr(new DivExpr(new SubExpr(new CloseExpr(),a),a),new ConstExpr(100)));this.addOutput(b);var c=new OutputExpr("MAROC",new MaExpr(b,f));this.addOutput(c)};ROCIndicator.prototype.getName=function(){return"ROC"};var MTMIndicator=create_class(Indicator);MTMIndicator.prototype.__construct=function(){MTMIndicator.__super.__construct.call(this);var c=new ParameterExpr("N",2,120,12);var d=new ParameterExpr("M",2,60,6);this.addParameter(c);this.addParameter(d);var b=new OutputExpr("MTM",new SubExpr(new CloseExpr(),new RefExpr(new CloseExpr(),c)));this.addOutput(b);var a=new OutputExpr("MTMMA",new MaExpr(b,d));this.addOutput(a)};MTMIndicator.prototype.getName=function(){return"MTM"};var BOLLIndicator=create_class(Indicator);BOLLIndicator.prototype.__construct=function(){BOLLIndicator.__super.__construct.call(this);var f=new ParameterExpr("N",2,120,20);this.addParameter(f);var d=new AssignExpr("STD_CLOSE_N",new StdExpr(new CloseExpr(),f));this.addAssign(d);var a=new OutputExpr("BOLL",new MaExpr(new CloseExpr(),f));this.addOutput(a);var b=new OutputExpr("UB",new AddExpr(a,new MulExpr(new ConstExpr(2),d)));this.addOutput(b);var c=new OutputExpr("LB",new SubExpr(a,new MulExpr(new ConstExpr(2),d)));this.addOutput(c)};BOLLIndicator.prototype.getName=function(){return"BOLL"};var PSYIndicator=create_class(Indicator);PSYIndicator.prototype.__construct=function(){PSYIndicator.__super.__construct.call(this);var c=new ParameterExpr("N",2,100,12);var d=new ParameterExpr("M",2,100,6);this.addParameter(c);this.addParameter(d);var b=new OutputExpr("PSY",new MulExpr(new DivExpr(new CountExpr(new GtExpr(new CloseExpr(),new RefExpr(new CloseExpr(),new ConstExpr(1))),c),c),new ConstExpr(100)));this.addOutput(b);var a=new OutputExpr("PSYMA",new MaExpr(b,d));this.addOutput(a)};PSYIndicator.prototype.getName=function(){return"PSY"};var STOCHRSIIndicator=create_class(Indicator);STOCHRSIIndicator.prototype.__construct=function(){STOCHRSIIndicator.__super.__construct.call(this);var g=new ParameterExpr("N",3,100,14);var i=new ParameterExpr("M",3,100,14);var a=new ParameterExpr("P1",2,50,3);var h=new ParameterExpr("P2",2,50,3);this.addParameter(g);this.addParameter(i);this.addParameter(a);this.addParameter(h);var f=new AssignExpr("LC",new RefExpr(new CloseExpr(),new ConstExpr(1)));this.addAssign(f);var d=new AssignExpr("CLOSE_LC",new SubExpr(new CloseExpr(),f));this.addAssign(d);var c=new AssignExpr("RSI",new MulExpr(new DivExpr(new SmaExpr(new MaxExpr(d,new ConstExpr(0)),g,new ConstExpr(1)),new SmaExpr(new AbsExpr(d),g,new ConstExpr(1))),new ConstExpr(100)));this.addAssign(c);var b=new OutputExpr("STOCHRSI",new MulExpr(new DivExpr(new MaExpr(new SubExpr(c,new LlvExpr(c,i)),a),new MaExpr(new SubExpr(new HhvExpr(c,i),new LlvExpr(c,i)),a)),new ConstExpr(100)));this.addOutput(b);this.addOutput(new RangeOutputExpr("MA",new MaExpr(b,h)))};STOCHRSIIndicator.prototype.getName=function(){return"StochRSI"};var Chart=create_class();Chart.strPeriod={"zh-cn":{"line":"(分时)","1min":"(1分钟)","5min":"(5分钟)","15min":"(15分钟)","30min":"(30分钟)","1hour":"(1小时)","1day":"(日线)","1week":"(周线)","3min":"(3分钟)","2hour":"(2小时)","4hour":"(4小时)","6hour":"(6小时)","12hour":"(12小时)","3day":"(3天)"},"en-us":{"line":"(Line)","1min":"(1m)","5min":"(5m)","15min":"(15m)","30min":"(30m)","1hour":"(1h)","1day":"(1d)","1week":"(1w)","3min":"(3m)","2hour":"(2h)","4hour":"(4h)","6hour":"(6h)","12hour":"(12h)","3day":"(3d)"},"zh-tw":{"line":"(分時)","1min":"(1分鐘)","5min":"(5分鐘)","15min":"(15分鐘)","30min":"(30分鐘)","1hour":"(1小時)","1day":"(日線)","1week":"(周線)","3min":"(3分鐘)","2hour":"(2小時)","4hour":"(4小時)","6hour":"(6小時)","12hour":"(12小時)","3day":"(3天)"}};Chart.prototype.__construct=function(){this._data=null;this._charStyle="CandleStick";this._depthData={array:null,asks_count:0,bids_count:0,asks_si:0,asks_ei:0,bids_si:0,bids_ei:0};this._range=KlineIns.range;this._symbol=KlineIns.symbol};Chart.prototype.setTitle=function(){var b=ChartManager.getInstance().getLanguage();var a=KlineIns.symbolName;a+=" ";a+=this.strIsLine?Chart.strPeriod[b]["line"]:Chart.strPeriod[b][this._range];a+=(this._contract_unit+"/"+this._money_type).toUpperCase();ChartManager.getInstance().setTitle("frame0.k0",a)};Chart.prototype.setSymbol=function(a){this._symbol=a;this.updateDataAndDisplay()};Chart.prototype.updateDataAndDisplay=function(){KlineIns.symbol=this._symbol;KlineIns.range=this._range;ChartManager.getInstance().setCurrentDataSource("frame0.k0",this._symbol+"."+this._range);ChartManager.getInstance().setNormalMode();var a=KlineIns.chartMgr.getDataSource("frame0.k0").getLastDate();$(".symbol-title>a").text(KlineIns.symbolName);if(a==-1){KlineIns.requestParam=setHttpRequestParam(KlineIns.symbol,KlineIns.range,KlineIns.limit,null);RequestData(true)}else{KlineIns.requestParam=setHttpRequestParam(KlineIns.symbol,KlineIns.range,null,a.toString());RequestData()}ChartManager.getInstance().redraw("All",false)};Chart.prototype.setCurrentContractUnit=function(a){this._contract_unit=a;this.updateDataAndDisplay()};Chart.prototype.setCurrentMoneyType=function(a){this._money_type=a;this.updateDataAndDisplay()};Chart.prototype.setCurrentPeriod=function(a){this._range=KlineIns.periodMap[a];this.updateDataAndDisplay();KlineIns.onRangeChange(this._range)};Chart.prototype.updateDataSource=function(a){this._data=a;ChartManager.getInstance().updateData("frame0.k0",this._data)};Chart.prototype.updateDepth=function(d){if(d==null){this._depthData.array=[];ChartManager.getInstance().redraw("All",false);return}if(!d.asks||!d.bids||d.asks==""||d.bids==""){return}var b=this._depthData;b.array=[];for(var a=0;a<d.asks.length;a++){var c={};c.rate=d.asks[a][0];c.amount=d.asks[a][1];b.array.push(c)}for(var a=0;a<d.bids.length;a++){var c={};c.rate=d.bids[a][0];c.amount=d.bids[a][1];b.array.push(c)}b.asks_count=d.asks.length;b.bids_count=d.bids.length;b.asks_si=b.asks_count-1;b.asks_ei=0;b.bids_si=b.asks_count;b.bids_ei=b.asks_count+b.bids_count-1;for(var a=b.asks_si;a>=b.asks_ei;a--){if(a==b.asks_si){b.array[a].amounts=b.array[a].amount}else{b.array[a].amounts=b.array[a+1].amounts+b.array[a].amount}}for(var a=b.bids_si;a<=b.bids_ei;a++){if(a==b.bids_si){b.array[a].amounts=b.array[a].amount}else{b.array[a].amounts=b.array[a-1].amounts+b.array[a].amount}}ChartManager.getInstance().redraw("All",false)};Chart.prototype.setMainIndicator=function(a){this._mainIndicator=a;if(a=="NONE"){ChartManager.getInstance().removeMainIndicator("frame0.k0")}else{ChartManager.getInstance().setMainIndicator("frame0.k0",a)}ChartManager.getInstance().redraw("All",true)};Chart.prototype.setIndicator=function(b,a){if(a=="NONE"){var b=2;if(Template.displayVolume==false){b=1}var c=ChartManager.getInstance().getIndicatorAreaName("frame0.k0",b);if(c!=""){ChartManager.getInstance().removeIndicator(c)}}else{var b=2;if(Template.displayVolume==false){b=1}var c=ChartManager.getInstance().getIndicatorAreaName("frame0.k0",b);if(c==""){Template.createIndicatorChartComps("frame0.k0",a)}else{ChartManager.getInstance().setIndicator(c,a)}}ChartManager.getInstance().redraw("All",true)};Chart.prototype.addIndicator=function(a){ChartManager.getInstance().addIndicator(a);ChartManager.getInstance().redraw("All",true)};Chart.prototype.removeIndicator=function(a){var b=ChartManager.getInstance().getIndicatorAreaName(2);ChartManager.getInstance().removeIndicator(b);ChartManager.getInstance().redraw("All",true)};var CName=create_class();CName.prototype.__construct=function(a){this._names=[];this._comps=[];if(a instanceof CName){this._names=a._names;this._comps=a._comps}else{var d=a.split(".");var c=d.length-1;if(c>0){this._comps=d;this._names.push(d[0]);for(var b=1;b<=c;b++){this._names.push(this._names[b-1]+"."+d[b])}}else{this._comps.push(a);this._names.push(a)}}};CName.prototype.getCompAt=function(a){if(a>=0&&a<this._comps.length){return this._comps[a]}return""};CName.prototype.getName=function(a){if(a<0){if(this._names.length>0){return this._names[this._names.length-1]}}else{if(a<this._names.length){return this._names[a]}}return""};var NamedObject=create_class();NamedObject.prototype.__construct=function(a){this._name=a;this._nameObj=new CName(a)};NamedObject.prototype.getFrameName=function(){return this._nameObj.getName(0)
};NamedObject.prototype.getDataSourceName=function(){return this._nameObj.getName(1)};NamedObject.prototype.getAreaName=function(){return this._nameObj.getName(2)};NamedObject.prototype.getName=function(){return this._nameObj.getName(-1)};NamedObject.prototype.getNameObject=function(){return this._nameObj};var ChartArea=create_class(NamedObject);ChartArea.prototype.__construct=function(a){ChartArea.__super.__construct.call(this,a);this._left=0;this._top=0;this._right=0;this._bottom=0;this._changed=false;this._highlighted=false;this._pressed=false;this._selected=false;this.Measuring=new MEvent()};ChartArea.DockStyle={Left:0,Top:1,Right:2,Bottom:3,Fill:4};ChartArea.prototype.getDockStyle=function(){return this._dockStyle};ChartArea.prototype.setDockStyle=function(a){this._dockStyle=a};ChartArea.prototype.getLeft=function(){return this._left};ChartArea.prototype.getTop=function(){return this._top};ChartArea.prototype.setTop=function(a){if(this._top!=a){this._top=a;this._changed=true}};ChartArea.prototype.getRight=function(){return this._right};ChartArea.prototype.getBottom=function(){return this._bottom};ChartArea.prototype.setBottom=function(a){if(this._bottom!=a){this._bottom=a;this._changed=true}};ChartArea.prototype.getCenter=function(){return(this._left+this._right)>>1};ChartArea.prototype.getMiddle=function(){return(this._top+this._bottom)>>1};ChartArea.prototype.getWidth=function(){return this._right-this._left};ChartArea.prototype.getHeight=function(){return this._bottom-this._top};ChartArea.prototype.getRect=function(){return{X:this._left,Y:this._top,Width:this._right-this._left,Height:this._bottom-this._top}};ChartArea.prototype.contains=function(a,b){if(a>=this._left&&a<this._right){if(b>=this._top&&b<this._bottom){return[this]}}return null};ChartArea.prototype.getMeasuredWidth=function(){return this._measuredWidth};ChartArea.prototype.getMeasuredHeight=function(){return this._measuredHeight};ChartArea.prototype.setMeasuredDimension=function(b,a){this._measuredWidth=b;this._measuredHeight=a};ChartArea.prototype.measure=function(b,c,a){this._measuredWidth=0;this._measuredHeight=0;this.Measuring.raise(this,{Width:c,Height:a});if(this._measuredWidth==0&&this._measuredHeight==0){this.setMeasuredDimension(c,a)}};ChartArea.prototype.layout=function(f,d,c,a,b){f<<=0;if(this._left!=f){this._left=f;this._changed=true}d<<=0;if(this._top!=d){this._top=d;this._changed=true}c<<=0;if(this._right!=c){this._right=c;this._changed=true}a<<=0;if(this._bottom!=a){this._bottom=a;this._changed=true}if(b){this._changed=true}};ChartArea.prototype.isChanged=function(){return this._changed};ChartArea.prototype.setChanged=function(a){this._changed=a};ChartArea.prototype.isHighlighted=function(){return this._highlighted};ChartArea.prototype.getHighlightedArea=function(){return this._highlighted?this:null};ChartArea.prototype.highlight=function(a){this._highlighted=(this==a);return this._highlighted?this:null};ChartArea.prototype.isPressed=function(){return this._pressed};ChartArea.prototype.setPressed=function(a){this._pressed=a};ChartArea.prototype.isSelected=function(){return this._selected};ChartArea.prototype.getSelectedArea=function(){return this._selected?this:null};ChartArea.prototype.select=function(a){this._selected=(this==a);return this._selected?this:null};ChartArea.prototype.onMouseMove=function(a,b){return null};ChartArea.prototype.onMouseLeave=function(a,b){};ChartArea.prototype.onMouseDown=function(a,b){return null};ChartArea.prototype.onMouseUp=function(a,b){return null};var MainArea=create_class(ChartArea);MainArea.prototype.__construct=function(a){MainArea.__super.__construct.call(this,a);this._dragStarted=false;this._oldX=0;this._oldY=0;this._passMoveEventToToolManager=true};MainArea.prototype.onMouseMove=function(a,c){var b=ChartManager.getInstance();if(b._capturingMouseArea==this){if(this._dragStarted==false){if(Math.abs(this._oldX-a)>1||Math.abs(this._oldY-c)>1){this._dragStarted=true}}}if(this._dragStarted){b.hideCursor();if(b.onToolMouseDrag(this.getFrameName(),a,c)){return this}b.getTimeline(this.getDataSourceName()).move(a-this._oldX);return this}if(this._passMoveEventToToolManager&&b.onToolMouseMove(this.getFrameName(),a,c)){b.hideCursor();return this}switch(b._drawingTool){case ChartManager.DrawingTool.Cursor:b.showCursor();break;case ChartManager.DrawingTool.CrossCursor:if(b.showCrossCursor(this,a,c)){b.hideCursor()}else{b.showCursor()}break;default:b.hideCursor();break}return this};MainArea.prototype.onMouseLeave=function(a,b){this._dragStarted=false;this._passMoveEventToToolManager=true};MainArea.prototype.onMouseDown=function(a,c){var b=ChartManager.getInstance();b.getTimeline(this.getDataSourceName()).startMove();this._oldX=a;this._oldY=c;this._dragStarted=false;if(b.onToolMouseDown(this.getFrameName(),a,c)){this._passMoveEventToToolManager=false}return this};MainArea.prototype.onMouseUp=function(a,d){var c=ChartManager.getInstance();var b=null;if(this._dragStarted){this._dragStarted=false;b=this}if(c.onToolMouseUp(this.getFrameName(),a,d)){b=this}this._passMoveEventToToolManager=true;return b};var IndicatorArea=create_class(ChartArea);IndicatorArea.prototype.__construct=function(a){IndicatorArea.__super.__construct.call(this,a);this._dragStarted=false;this._oldX=0;this._oldY=0};IndicatorArea.prototype.onMouseMove=function(a,c){var b=ChartManager.getInstance();if(b._capturingMouseArea==this){if(this._dragStarted==false){if(this._oldX!=a||this._oldY!=c){this._dragStarted=true}}}if(this._dragStarted){b.hideCursor();b.getTimeline(this.getDataSourceName()).move(a-this._oldX);return this}switch(b._drawingTool){case ChartManager.DrawingTool.CrossCursor:if(b.showCrossCursor(this,a,c)){b.hideCursor()}else{b.showCursor()}break;default:b.showCursor();break}return this};IndicatorArea.prototype.onMouseLeave=function(a,b){this._dragStarted=false};IndicatorArea.prototype.onMouseDown=function(a,c){var b=ChartManager.getInstance();b.getTimeline(this.getDataSourceName()).startMove();this._oldX=a;this._oldY=c;this._dragStarted=false;return this};IndicatorArea.prototype.onMouseUp=function(a,b){if(this._dragStarted){this._dragStarted=false;return this}return null};var MainRangeArea=create_class(ChartArea);MainRangeArea.prototype.__construct=function(a){MainRangeArea.__super.__construct.call(this,a)};MainRangeArea.prototype.onMouseMove=function(a,b){ChartManager.getInstance().showCursor();return this};var IndicatorRangeArea=create_class(ChartArea);IndicatorRangeArea.prototype.__construct=function(a){IndicatorRangeArea.__super.__construct.call(this,a)};IndicatorRangeArea.prototype.onMouseMove=function(a,b){ChartManager.getInstance().showCursor();return this};var TimelineArea=create_class(ChartArea);TimelineArea.prototype.__construct=function(a){TimelineArea.__super.__construct.call(this,a)};TimelineArea.prototype.onMouseMove=function(a,b){ChartManager.getInstance().showCursor();return this};var ChartAreaGroup=create_class(ChartArea);ChartAreaGroup.prototype.__construct=function(a){ChartAreaGroup.__super.__construct.call(this,a);this._areas=[];this._highlightedArea=null;this._selectedArea=null};ChartAreaGroup.prototype.contains=function(b,h){var d;var c,g,f=this._areas.length;for(g=0;g<f;g++){c=this._areas[g];d=c.contains(b,h);if(d!=null){d.push(this);return d}}return ChartAreaGroup.__super.contains(b,h)};ChartAreaGroup.prototype.getAreaCount=function(){return this._areas.length};ChartAreaGroup.prototype.getAreaAt=function(a){if(a<0||a>=this._areas.length){return null}return this._areas[a]};ChartAreaGroup.prototype.addArea=function(a){this._areas.push(a)};ChartAreaGroup.prototype.removeArea=function(c){var b,a=this._areas.length;for(b=0;b<a;b++){if(c==this._areas[b]){this._areas.splice(b);this.setChanged(true);break}}};ChartAreaGroup.prototype.getGridColor=function(){return this._gridColor};ChartAreaGroup.prototype.setGridColor=function(a){this._gridColor=a};ChartAreaGroup.prototype.getHighlightedArea=function(){if(this._highlightedArea!=null){return this._highlightedArea.getHighlightedArea()}return null};ChartAreaGroup.prototype.highlight=function(c){this._highlightedArea=null;var d,b,a=this._areas.length;for(b=0;b<a;b++){d=this._areas[b].highlight(c);if(d!=null){this._highlightedArea=d;return this}}return null};ChartAreaGroup.prototype.getSelectedArea=function(){if(this._selectedArea!=null){return this._selectedArea.getSelectedArea()}return null};ChartAreaGroup.prototype.select=function(c){this._selectedArea=null;var d,b,a=this._areas.length;for(b=0;b<a;b++){d=this._areas[b].select(c);if(d!=null){this._selectedArea=d;return this}}return null};ChartAreaGroup.prototype.onMouseLeave=function(a,d){var c,b=this._areas.length;for(c=0;c<b;c++){this._areas[c].onMouseLeave(a,d)}};ChartAreaGroup.prototype.onMouseUp=function(b,g){var c,f,d=this._areas.length;for(f=0;f<d;f++){c=this._areas[f].onMouseUp(b,g);if(c!=null){return c}}return null};var TableLayout=create_class(ChartAreaGroup);TableLayout.prototype.__construct=function(a){TableLayout.__super.__construct.call(this,a);this._nextRowId=0;this._focusedRowIndex=-1};TableLayout.prototype.getNextRowId=function(){return this._nextRowId++};TableLayout.prototype.measure=function(a,v,o){this.setMeasuredDimension(v,o);var j,q=0,I=0;var y,l;var p=[];var x,w=this._areas.length;for(x=0;x<w;x+=2){j=this._areas[x].getHeight();if(j==0){if(x==0){l=(w+1)>>1;var u=(l*2)+5;var d=((o/u)*2)<<0;y=o;for(x=l-1;x>0;x--){p.unshift(d);y-=d}p.unshift(y);break}else{if(x==2){j=q/3}else{j=q}}}I+=j;q=j;p.push(j)}if(I>0){var K=o/I;l=(w+1)>>1;y=o;for(x=l-1;x>0;x--){p[x]*=K;y-=p[x]}p[0]=y}var H=8;var A=64;var b=Math.min(240,v>>1);var g=A;var J=ChartManager.getInstance();var f=J.getTimeline(this.getDataSourceName());if(f.getFirstIndex()>=0){var m=[];for(g=A;g<b;g+=H){m.push(f.calcFirstIndex(f.calcColumnCount(v-g)))}var z=f.getLastIndex();var r=[".main",".secondary"];var t=new Array(m.length);var D,k;for(D=0,k=0,g=A;D<this._areas.length&&k<m.length;D+=2){var B=this._areas[D];var G=J.getPlotter(B.getName()+"Range.main");
    for(var C in r){var s=J.getDataProvider(B.getName()+r[C]);if(s==undefined){continue}s.calcRange(m,z,t,null);while(k<m.length){var F=G.getRequiredWidth(a,t[k].min);var E=G.getRequiredWidth(a,t[k].max);if(Math.max(F,E)<g){break}k++;g+=H}}}}for(x=1;x<this._areas.length;x+=2){this._areas[x].measure(a,g,p[x>>1])}var c=v-g;for(x=0;x<this._areas.length;x+=2){this._areas[x].measure(a,c,p[x>>1])}};TableLayout.prototype.layout=function(h,l,m,a,d){TableLayout.__super.layout.call(this,h,l,m,a,d);if(this._areas.length<1){return}var f;var c=h+this._areas[0].getMeasuredWidth();var n=l,k;if(!d){d=this.isChanged()}var j,g=this._areas.length;for(j=0;j<g;j++){f=this._areas[j];k=n+f.getMeasuredHeight();f.layout(h,n,c,k,d);j++;f=this._areas[j];f.layout(c,n,this.getRight(),k,d);n=k}this.setChanged(false)};TableLayout.prototype.drawGrid=function(c){if(this._areas.length<1){return}var d=ChartManager.getInstance();var f=d.getTheme(this.getFrameName());c.fillStyle=f.getColor(Theme.Color.Grid1);c.fillRect(this._areas[0].getRight(),this.getTop(),1,this.getHeight());var b,a=this._areas.length-2;for(b=0;b<a;b+=2){c.fillRect(this.getLeft(),this._areas[b].getBottom(),this.getWidth(),1)}if(!d.getCaptureMouseWheelDirectly()){for(b=0,a+=2;b<a;b+=2){if(this._areas[b].isSelected()){c.strokeStyle=f.getColor(Theme.Color.Indicator1);c.strokeRect(this.getLeft()+0.5,this.getTop()+0.5,this.getWidth()-1,this.getHeight()-1);break}}}};TableLayout.prototype.highlight=function(c){this._highlightedArea=null;var d,b,a=this._areas.length;for(b=0;b<a;b++){d=this._areas[b];if(d==c){b&=~1;d=this._areas[b];d.highlight(d);this._highlightedArea=d;b++;d=this._areas[b];d.highlight(null);d.highlight(d)}else{d.highlight(null)}}return this._highlightedArea!=null?this:null};TableLayout.prototype.select=function(c){this._selectedArea=null;var d,b,a=this._areas.length;for(b=0;b<a;b++){d=this._areas[b];if(d==c){b&=~1;d=this._areas[b];d.select(d);this._selectedArea=d;b++;d=this._areas[b];d.select(d)}else{d.select(null)}}return this._selectedArea!=null?this:null};TableLayout.prototype.onMouseMove=function(m,l){if(this._focusedRowIndex>=0){var n=this._areas[this._focusedRowIndex];var f=this._areas[this._focusedRowIndex+2];var g=l-this._oldY;if(g==0){return this}var j=this._oldUpperBottom+g;var h=this._oldLowerTop+g;if(j-n.getTop()>=60&&f.getBottom()-h>=60){n.setBottom(j);f.setTop(h)}return this}var c,a=this._areas.length-2;for(c=0;c<a;c+=2){var k=this._areas[c].getBottom();if(l>=k-4&&l<k+4){ChartManager.getInstance().showCursor("n-resize");return this}}return null};TableLayout.prototype.onMouseLeave=function(a,b){this._focusedRowIndex=-1};TableLayout.prototype.onMouseDown=function(c,g){var f,d=this._areas.length-2;for(f=0;f<d;f+=2){var a=this._areas[f].getBottom();if(g>=a-4&&g<a+4){this._focusedRowIndex=f;this._oldY=g;this._oldUpperBottom=a;this._oldLowerTop=this._areas[f+2].getTop();return this}}return null};TableLayout.prototype.onMouseUp=function(b,f){if(this._focusedRowIndex>=0){this._focusedRowIndex=-1;var d,c=this._areas.length;var a=[];for(d=0;d<c;d+=2){a.push(this._areas[d].getHeight())}ChartSettings.get().charts.areaHeight=a;ChartSettings.save()}return this};var DockableLayout=create_class(ChartAreaGroup);DockableLayout.prototype.__construct=function(a){DockableLayout.__super.__construct.call(this,a)};DockableLayout.prototype.measure=function(c,d,a){DockableLayout.__super.measure.call(this,c,d,a);d=this.getMeasuredWidth();a=this.getMeasuredHeight();for(var b in this._areas){var f=this._areas[b];f.measure(c,d,a);switch(f.getDockStyle()){case ChartArea.DockStyle.left:case ChartArea.DockStyle.Right:d-=f.getMeasuredWidth();break;case ChartArea.DockStyle.Top:case ChartArea.DockStyle.Bottom:a-=f.getMeasuredHeight();break;case ChartArea.DockStyle.Fill:d=0;a=0;break}}};DockableLayout.prototype.layout=function(d,j,l,a,b){DockableLayout.__super.layout.call(this,d,j,l,a,b);d=this.getLeft();j=this.getTop();l=this.getRight();a=this.getBottom();var k,g;if(!b){b=this.isChanged()}for(var f in this._areas){var c=this._areas[f];switch(c.getDockStyle()){case ChartArea.DockStyle.left:k=c.getMeasuredWidth();c.layout(d,j,d+k,a,b);d+=k;break;case ChartArea.DockStyle.Top:g=c.getMeasuredHeight();c.layout(d,j,l,j+g,b);j+=g;break;case ChartArea.DockStyle.Right:k=c.getMeasuredWidth();c.layout(l-k,j,l,a,b);l-=k;break;case ChartArea.DockStyle.Bottom:g=c.getMeasuredHeight();c.layout(d,a-g,l,a,b);a-=g;break;case ChartArea.DockStyle.Fill:c.layout(d,j,l,a,b);d=l;j=a;break}}this.setChanged(false)};DockableLayout.prototype.drawGrid=function(c){var k=ChartManager.getInstance();var f=k.getTheme(this.getFrameName());var d=this.getLeft();var h=this.getTop();var j=this.getRight();var a=this.getBottom();c.fillStyle=f.getColor(this._gridColor);for(var g in this._areas){var b=this._areas[g];switch(b.getDockStyle()){case ChartArea.DockStyle.Left:c.fillRect(b.getRight(),h,1,a-h);d+=b.getWidth();break;case ChartArea.DockStyle.Top:c.fillRect(d,b.getBottom(),j-d,1);h+=b.getHeight();break;case ChartArea.DockStyle.Right:c.fillRect(b.getLeft(),h,1,a-h);j-=b.getWidth();break;case ChartArea.DockStyle.Bottom:c.fillRect(d,b.getTop(),j-d,1);a-=b.getHeight();break}}};var ChartManager=create_class();ChartManager.DrawingTool={Cursor:0,CrossCursor:1,DrawLines:2,DrawFibRetrace:3,DrawFibFans:4,SegLine:5,StraightLine:6,ArrowLine:7,RayLine:8,HoriStraightLine:9,HoriRayLine:10,HoriSegLine:11,VertiStraightLine:12,PriceLine:13,BiParallelLine:14,BiParallelRayLine:15,TriParallelLine:16,BandLine:17};ChartManager._instance=null;ChartManager.getInstance=function(){if(ChartManager._instance==null){ChartManager._instance=new ChartManager()}return ChartManager._instance};ChartManager.prototype.__construct=function(){this._dataSources={};this._dataSourceCache={};this._dataProviders={};this._frames={};this._areas={};this._timelines={};this._ranges={};this._plotters={};this._themes={};this._titles={};this._frameMousePos={};this._dsChartStyle={};this._dragStarted=false;this._oldX=0;this._fakeIndicators={};this._captureMouseWheelDirectly=true;this._chart={};this._chart.defaultFrame=new Chart();this._drawingTool=ChartManager.DrawingTool["CrossCursor"];this._beforeDrawingTool=this._drawingTool;this._language="zh-cn";this._mainCanvas=null;this._overlayCanvas=null;this._mainContext=null;this._overlayContext=null};ChartManager.prototype.redraw=function(a,b){if(a==undefined||b){a="All"}if(a=="All"||a=="MainCanvas"){if(b){this.getFrame("frame0").setChanged(true)}this.layout(this._mainContext,"frame0",0,0,this._mainCanvas.width,this._mainCanvas.height);this.drawMain("frame0",this._mainContext)}if(a=="All"||a=="OverlayCanvas"){this._overlayContext.clearRect(0,0,this._overlayCanvas.width,this._overlayCanvas.height);this.drawOverlay("frame0",this._overlayContext)}};ChartManager.prototype.bindCanvas=function(b,a){if(b=="main"){this._mainCanvas=a;this._mainContext=a.getContext("2d")}else{if(b=="overlay"){this._overlayCanvas=a;this._overlayContext=a.getContext("2d");if(this._captureMouseWheelDirectly){$(this._overlayCanvas).bind("mousewheel",mouseWheel)}}}};ChartManager.prototype.getCaptureMouseWheelDirectly=function(){return this._captureMouseWheelDirectly};ChartManager.prototype.setCaptureMouseWheelDirectly=function(a){this._captureMouseWheelDirectly=a;if(a){$(this._overlayCanvas).bind("mousewheel",mouseWheel)}else{$(this._overlayCanvas).unbind("mousewheel")}};ChartManager.prototype.getChart=function(a){return this._chart["defaultFrame"]};ChartManager.prototype.init=function(){delete this._ranges["frame0.k0.indic1"];delete this._ranges["frame0.k0.indic1Range"];delete this._areas["frame0.k0.indic1"];delete this._areas["frame0.k0.indic1Range"];DefaultTemplate.loadTemplate("frame0.k0","");this.redraw("All",true)};ChartManager.prototype.setCurrentDrawingTool=function(a){this._drawingTool=ChartManager.DrawingTool[a];this.setRunningMode(this._drawingTool)};ChartManager.prototype.getLanguage=function(){return this._language};ChartManager.prototype.setLanguage=function(a){this._language=a};ChartManager.prototype.setThemeName=function(a,b){if(b==undefined){b="Dark"}var c;switch(b){case"Light":c=new LightTheme();break;default:b="Dark";c=new DarkTheme();break}this._themeName=b;this.setTheme(a,c);this.getFrame(a).setChanged(true)};ChartManager.prototype.getChartStyle=function(b){var a=this._dsChartStyle[b];if(a==undefined){return"CandleStick"}return a};ChartManager.prototype.setChartStyle=function(f,c){if(this._dsChartStyle[f]==c){return}var h=f+".main";var b=h+".main";var a=h+".main";var g,d;switch(c){case"CandleStick":case"CandleStickHLC":case"OHLC":g=this.getDataProvider(b);if(g==undefined||!is_instance(g,MainDataProvider)){g=new MainDataProvider(b);this.setDataProvider(b,g);g.updateData()}this.setMainIndicator(f,ChartSettings.get().charts.mIndic);switch(c){case"CandleStick":d=new CandlestickPlotter(a);break;case"CandleStickHLC":d=new CandlestickHLCPlotter(a);break;case"OHLC":d=new OHLCPlotter(a);break}this.setPlotter(a,d);d=new MinMaxPlotter(h+".decoration");this.setPlotter(d.getName(),d);break;case"Line":g=new IndicatorDataProvider(b);this.setDataProvider(g.getName(),g);g.setIndicator(new HLCIndicator());this.removeMainIndicator(f);d=new IndicatorPlotter(a);this.setPlotter(a,d);this.removePlotter(h+".decoration");break}this.getArea(d.getAreaName()).setChanged(true);this._dsChartStyle[f]=c};ChartManager.prototype.setNormalMode=function(){this._drawingTool=this._beforeDrawingTool;$(".chart_dropdown_data").removeClass("chart_dropdown-hover");$("#chart_toolpanel .chart_toolpanel_button").removeClass("selected");$("#chart_CrossCursor").parent().addClass("selected");if(this._drawingTool==ChartManager.DrawingTool.Cursor){this.showCursor();$("#mode a").removeClass("selected");$("#chart_toolpanel .chart_toolpanel_button").removeClass("selected");$("#chart_Cursor").parent().addClass("selected")}else{this.hideCursor()}};ChartManager.prototype.setRunningMode=function(b){var c=this.getDataSource("frame0.k0");var a=c.getCurrentToolObject();if(a!=null&&a.state!=CToolObject.state.AfterDraw){c.delToolObject()
}if(c.getToolObjectCount()>10){this.setNormalMode();return}this._drawingTool=b;if(b==ChartManager.DrawingTool.Cursor){this.showCursor()}else{}switch(b){case ChartManager.DrawingTool.Cursor:this._beforeDrawingTool=b;break;case ChartManager.DrawingTool.ArrowLine:c.addToolObject(new CArrowLineObject("frame0.k0"));break;case ChartManager.DrawingTool.BandLine:c.addToolObject(new CBandLineObject("frame0.k0"));break;case ChartManager.DrawingTool.BiParallelLine:c.addToolObject(new CBiParallelLineObject("frame0.k0"));break;case ChartManager.DrawingTool.BiParallelRayLine:c.addToolObject(new CBiParallelRayLineObject("frame0.k0"));break;case ChartManager.DrawingTool.CrossCursor:this._beforeDrawingTool=b;break;case ChartManager.DrawingTool.DrawFibFans:c.addToolObject(new CFibFansObject("frame0.k0"));break;case ChartManager.DrawingTool.DrawFibRetrace:c.addToolObject(new CFibRetraceObject("frame0.k0"));break;case ChartManager.DrawingTool.DrawLines:c.addToolObject(new CStraightLineObject("frame0.k0"));break;case ChartManager.DrawingTool.HoriRayLine:c.addToolObject(new CHoriRayLineObject("frame0.k0"));break;case ChartManager.DrawingTool.HoriSegLine:c.addToolObject(new CHoriSegLineObject("frame0.k0"));break;case ChartManager.DrawingTool.HoriStraightLine:c.addToolObject(new CHoriStraightLineObject("frame0.k0"));break;case ChartManager.DrawingTool.PriceLine:c.addToolObject(new CPriceLineObject("frame0.k0"));break;case ChartManager.DrawingTool.RayLine:c.addToolObject(new CRayLineObject("frame0.k0"));break;case ChartManager.DrawingTool.SegLine:c.addToolObject(new CSegLineObject("frame0.k0"));break;case ChartManager.DrawingTool.StraightLine:c.addToolObject(new CStraightLineObject("frame0.k0"));break;case ChartManager.DrawingTool.TriParallelLine:c.addToolObject(new CTriParallelLineObject("frame0.k0"));break;case ChartManager.DrawingTool.VertiStraightLine:c.addToolObject(new CVertiStraightLineObject("frame0.k0"));break}};ChartManager.prototype.getTitle=function(a){return this._titles[a]};ChartManager.prototype.setTitle=function(b,a){this._titles[b]=a};ChartManager.prototype.setCurrentDataSource=function(d,a){var b=this.getCachedDataSource(a);if(b!=null){this.setDataSource(d,b,true)}else{var c=this.getDataSource(d);if(c!=null){if(is_instance(c,MainDataSource)){b=new MainDataSource(a)}else{if(is_instance(c,CLiveOrderDataSource)){b=new CLiveOrderDataSource(a)}else{if(is_instance(c,CLiveTradeDataSource)){b=new CLiveTradeDataSource(a)}}}this.setDataSource(d,b,true);this.setCachedDataSource(a,b)}}};ChartManager.prototype.getDataSource=function(a){return this._dataSources[a]};ChartManager.prototype.setDataSource=function(a,b,c){this._dataSources[a]=b;if(c){this.updateData(a,null)}};ChartManager.prototype.getCachedDataSource=function(a){return this._dataSourceCache[a]};ChartManager.prototype.setCachedDataSource=function(a,b){this._dataSourceCache[a]=b};ChartManager.prototype.getDataProvider=function(a){return this._dataProviders[a]};ChartManager.prototype.setDataProvider=function(a,b){this._dataProviders[a]=b};ChartManager.prototype.removeDataProvider=function(a){delete this._dataProviders[a]};ChartManager.prototype.getFrame=function(a){return this._frames[a]};ChartManager.prototype.setFrame=function(a,b){this._frames[a]=b};ChartManager.prototype.removeFrame=function(a){delete this._frames[a]};ChartManager.prototype.getArea=function(a){return this._areas[a]};ChartManager.prototype.setArea=function(a,b){this._areas[a]=b};ChartManager.prototype.removeArea=function(a){delete this._areas[a]};ChartManager.prototype.getTimeline=function(a){return this._timelines[a]};ChartManager.prototype.setTimeline=function(a,b){this._timelines[a]=b};ChartManager.prototype.removeTimeline=function(a){delete this._timelines[a]};ChartManager.prototype.getRange=function(a){return this._ranges[a]};ChartManager.prototype.setRange=function(b,a){this._ranges[b]=a};ChartManager.prototype.removeRange=function(a){delete this._ranges[a]};ChartManager.prototype.getPlotter=function(a){return this._plotters[a]};ChartManager.prototype.setPlotter=function(a,b){this._plotters[a]=b};ChartManager.prototype.removePlotter=function(a){delete this._plotters[a]};ChartManager.prototype.getTheme=function(a){return this._themes[a]};ChartManager.prototype.setTheme=function(a,b){this._themes[a]=b};ChartManager.prototype.getFrameMousePos=function(b,a){if(this._frameMousePos[b]!=undefined){a.x=this._frameMousePos[b].x;a.y=this._frameMousePos[b].y}else{a.x=-1;a.y=-1}};ChartManager.prototype.setFrameMousePos=function(b,c,a){this._frameMousePos[b]={x:c,y:a}};ChartManager.prototype.drawArea=function(c,d,g){var h=d.getNameObject().getCompAt(2);if(h=="timeline"){if(d.getHeight()<20){return}}else{if(d.getHeight()<30){return}}if(d.getWidth()<30){return}h=d.getName();var f;var b,a=g.length;for(b=0;b<a;b++){f=this._plotters[h+g[b]];if(f!=undefined){f.Draw(c)}}};ChartManager.prototype.drawAreaMain=function(a,b){var c=this._dataSources[b.getDataSourceName()];var d;if(c.getDataCount()<1){d=[".background"]}else{d=[".background",".grid",".main",".secondary"]}this.drawArea(a,b,d);b.setChanged(false)};ChartManager.prototype.drawAreaOverlay=function(a,b){var c=this._dataSources[b.getDataSourceName()];var d;if(c.getDataCount()<1){d=[".selection"]}else{d=[".decoration",".selection",".info",".tool"]}this.drawArea(a,b,d)};ChartManager.prototype.drawMain=function(a,c){var g=false;if(!g){for(var d in this._areas){if(this._areas[d].getFrameName()==a&&!is_instance(this._areas[d],ChartAreaGroup)){this.drawAreaMain(c,this._areas[d])}}}var f;for(var b in this._timelines){f=this._timelines[b];if(f.getFrameName()==a){f.setUpdated(false)}}for(var b in this._ranges){f=this._ranges[b];if(f.getFrameName()==a){f.setUpdated(false)}}for(var b in this._areas){f=this._areas[b];if(f.getFrameName()==a){f.setChanged(false)}}};ChartManager.prototype.drawOverlay=function(a,b){for(var d in this._areas){var c=this._areas[d];if(is_instance(c,ChartAreaGroup)){if(c.getFrameName()==a){c.drawGrid(b)}}}for(var d in this._areas){var c=this._areas[d];if(is_instance(c,ChartAreaGroup)==false){if(c.getFrameName()==a){this.drawAreaOverlay(b,c)}}}};ChartManager.prototype.updateData=function(a,h){var d=this.getDataSource(a);if(d==undefined){return}if(h!=null){if(!d.update(h)){return false}if(d.getUpdateMode()==DataSource.UpdateMode.DoNothing){return true}}else{d.setUpdateMode(DataSource.UpdateMode.Refresh)}var k=this.getTimeline(a);if(k!=undefined){k.update()}if(d.getDataCount()<1){return true}var l=[".main",".secondary"];var b,j;for(var c in this._areas){b=this._areas[c];if(is_instance(b,ChartAreaGroup)){continue}if(b.getDataSourceName()!=a){continue}j=b.getName();for(var g=0;g<l.length;g++){var f=this.getDataProvider(j+l[g]);if(f!=undefined){f.updateData()}}}return true};ChartManager.prototype.updateRange=function(a){var d=this.getDataSource(a);if(d.getDataCount()<1){return}var l=[".main",".secondary"];var b,j;for(var c in this._areas){b=this._areas[c];if(is_instance(b,ChartAreaGroup)){continue}if(b.getDataSourceName()!=a){continue}j=b.getName();for(var g=0;g<l.length;g++){var f=this.getDataProvider(j+l[g]);if(f!=undefined){f.updateRange()}}var k=this.getTimeline(a);if(k!=undefined&&k.getMaxItemCount()>0){var h=this.getRange(j);if(h!=undefined){h.update()}}}};ChartManager.prototype.layout=function(b,g,f,i,j,a){var c=this.getFrame(g);c.measure(b,j-f,a-i);c.layout(f,i,j,a);for(var d in this._timelines){var h=this._timelines[d];if(h.getFrameName()==g){h.onLayout()}}for(var d in this._dataSources){if(d.substring(0,g.length)==g){this.updateRange(d)}}};ChartManager.prototype.SelectRange=function(b,g){var c;for(var a in this._ranges){var f=this._ranges[a].getAreaName();var d=b.getName();if(f==d){this._ranges[a].selectAt(g)}else{this._ranges[a].unselect()}}};ChartManager.prototype.scale=function(b){if(this._highlightedFrame==null){return}var a=this._highlightedFrame.getHighlightedArea();if(this.getRange(a.getName())!=undefined){var d=a.getDataSourceName();var c=this.getTimeline(d);if(c!=null){c.scale(b);this.updateRange(d)}}};ChartManager.prototype.showCursor=function(a){if(a===undefined){a="default"}this._mainCanvas.style.cursor=a;this._overlayCanvas.style.cursor=a};ChartManager.prototype.hideCursor=function(){this._mainCanvas.style.cursor="none";this._overlayCanvas.style.cursor="none"};ChartManager.prototype.showCrossCursor=function(b,a,d){var c=this.getRange(b.getName());if(c!=undefined){c.selectAt(d);c=this.getTimeline(b.getDataSourceName());if(c!=undefined){if(c.selectAt(a)){return true}}}return false};ChartManager.prototype.hideCrossCursor=function(a){if(a!=null){for(var c in this._timelines){var b=this._timelines[c];if(b!=a){b.unselect()}}}else{for(var c in this._timelines){this._timelines[c].unselect()}}for(var c in this._ranges){this._ranges[c].unselect()}};ChartManager.prototype.clearHighlight=function(){if(this._highlightedFrame!=null){this._highlightedFrame.highlight(null);this._highlightedFrame=null}};ChartManager.prototype.onToolMouseMove=function(b,a,g){var c=false;b+=".";for(var f in this._dataSources){if(f.indexOf(b)==0){var d=this._dataSources[f];if(is_instance(d,MainDataSource)){if(d.toolManager.acceptMouseMoveEvent(a,g)){c=true}}}}return c};ChartManager.prototype.onToolMouseDown=function(b,a,g){var c=false;b+=".";for(var f in this._dataSources){if(f.indexOf(b)==0){var d=this._dataSources[f];if(is_instance(d,MainDataSource)){if(d.toolManager.acceptMouseDownEvent(a,g)){c=true}}}}return c};ChartManager.prototype.onToolMouseUp=function(b,a,g){var c=false;b+=".";for(var f in this._dataSources){if(f.indexOf(b)==0){var d=this._dataSources[f];if(is_instance(d,MainDataSource)){if(d.toolManager.acceptMouseUpEvent(a,g)){c=true}}}}return c};ChartManager.prototype.onToolMouseDrag=function(b,a,g){var c=false;b+=".";for(var f in this._dataSources){if(f.indexOf(b)==0){var d=this._dataSources[f];if(is_instance(d,MainDataSource)){if(d.toolManager.acceptMouseDownMoveEvent(a,g)){c=true}}}}return c};ChartManager.prototype.onMouseMove=function(g,l,j,h){var c=this.getFrame(g);
    if(c===undefined){return}this.setFrameMousePos(g,l,j);this.hideCrossCursor();if(this._highlightedFrame!=c){this.clearHighlight()}if(this._capturingMouseArea!=null){this._capturingMouseArea.onMouseMove(l,j);return}var b=c.contains(l,j);if(b==null){return}var k,f,d=b.length;for(f=d-1;f>=0;f--){k=b[f];k=k.onMouseMove(l,j);if(k!=null){if(!is_instance(k,ChartAreaGroup)){c.highlight(k);this._highlightedFrame=c}return}}};ChartManager.prototype.onMouseLeave=function(c,a,f,b){var d=this.getFrame(c);if(d==undefined){return}this.setFrameMousePos(c,a,f);this.hideCrossCursor();this.clearHighlight();if(this._capturingMouseArea!=null){this._capturingMouseArea.onMouseLeave(a,f);this._capturingMouseArea=null}this._dragStarted=false};ChartManager.prototype.onMouseDown=function(d,b,k){var j=this.getFrame(d);if(j==undefined){return}var f=j.contains(b,k);if(f==null){return}var c,h,g=f.length;for(h=g-1;h>=0;h--){c=f[h];c=c.onMouseDown(b,k);if(c!=null){this._capturingMouseArea=c;return}}};ChartManager.prototype.onMouseUp=function(b,a,d){var c=this.getFrame(b);if(c==undefined){return}if(this._capturingMouseArea){if(this._capturingMouseArea.onMouseUp(a,d)==null&&this._dragStarted==false){if(this._selectedFrame!=null&&this._selectedFrame!=c){this._selectedFrame.select(null)}if(this._capturingMouseArea.isSelected()){if(!this._captureMouseWheelDirectly){$(this._overlayCanvas).unbind("mousewheel")}c.select(null);this._selectedFrame=null}else{if(this._selectedFrame!=c){if(!this._captureMouseWheelDirectly){$(this._overlayCanvas).bind("mousewheel",mouseWheel)}}c.select(this._capturingMouseArea);this._selectedFrame=c}}this._capturingMouseArea=null;this._dragStarted=false}};ChartManager.prototype.deleteToolObject=function(){var b=this.getDataSource("frame0.k0");var c=b.getSelectToolObjcet();if(c!=null){b.delSelectToolObject()}var a=b.getCurrentToolObject();if(a!=null&&a.getState()!=CToolObject.state.AfterDraw){b.delToolObject()}this.setNormalMode()};ChartManager.prototype.unloadTemplate=function(a){var b=this.getFrame(a);if(b==undefined){return}for(var c in this._dataSources){if(c.match(a+".")){delete this._dataSources[c]}}for(var c in this._dataProviders){if(this._dataProviders[c].getFrameName()==a){delete this._dataProviders[c]}}delete this._frames[a];for(var c in this._areas){if(this._areas[c].getFrameName()==a){delete this._areas[c]}}for(var c in this._timelines){if(this._timelines[c].getFrameName()==a){delete this._timelines[c]}}for(var c in this._ranges){if(this._ranges[c].getFrameName()==a){delete this._ranges[c]}}for(var c in this._plotters){if(this._plotters[c].getFrameName()==a){delete this._plotters[c]}}delete this._themes[a];delete this._frameMousePos[a]};ChartManager.prototype.createIndicatorAndRange=function(f,a,c){var d,b;switch(a){case"MA":d=new MAIndicator();b=new PositiveRange(f);break;case"EMA":d=new EMAIndicator();b=new PositiveRange(f);break;case"VOLUME":d=new VOLUMEIndicator();b=new ZeroBasedPositiveRange(f);break;case"MACD":d=new MACDIndicator();b=new ZeroCenteredRange(f);break;case"DMI":d=new DMIIndicator();b=new PercentageRange(f);break;case"DMA":d=new DMAIndicator();b=new Range(f);break;case"TRIX":d=new TRIXIndicator();b=new Range(f);break;case"BRAR":d=new BRARIndicator();b=new Range(f);break;case"VR":d=new VRIndicator();b=new Range(f);break;case"OBV":d=new OBVIndicator();b=new Range(f);break;case"EMV":d=new EMVIndicator();b=new Range(f);break;case"RSI":d=new RSIIndicator();b=new PercentageRange(f);break;case"WR":d=new WRIndicator();b=new PercentageRange(f);break;case"SAR":d=new SARIndicator();b=new PositiveRange(f);break;case"KDJ":d=new KDJIndicator();b=new PercentageRange(f);break;case"ROC":d=new ROCIndicator();b=new Range(f);break;case"MTM":d=new MTMIndicator();b=new Range(f);break;case"BOLL":d=new BOLLIndicator();b=new Range(f);break;case"PSY":d=new PSYIndicator();b=new Range(f);break;case"StochRSI":d=new STOCHRSIIndicator();b=new PercentageRange(f);break;default:return null}if(!c){d.setParameters(ChartSettings.get().indics[a])}return{"indic":d,"range":b}};ChartManager.prototype.setMainIndicator=function(f,a){var i=f+".main";var h=this.getDataProvider(i+".main");if(h==undefined||!is_instance(h,MainDataProvider)){return false}var g;switch(a){case"MA":g=new MAIndicator();break;case"EMA":g=new EMAIndicator();break;case"BOLL":g=new BOLLIndicator();break;case"SAR":g=new SARIndicator();break;default:return false}g.setParameters(ChartSettings.get().indics[a]);var c=i+".secondary";var b=this.getDataProvider(c);if(b==undefined){b=new IndicatorDataProvider(c);this.setDataProvider(b.getName(),b)}b.setIndicator(g);var d=this.getPlotter(c);if(d==undefined){d=new IndicatorPlotter(c);this.setPlotter(d.getName(),d)}this.getArea(i).setChanged(true);return true};ChartManager.prototype.setIndicator=function(i,a){var d=this.getArea(i);if(d==undefined||d.getNameObject().getCompAt(2)=="main"){return false}var h=this.getDataProvider(i+".secondary");if(h==undefined||!is_instance(h,IndicatorDataProvider)){return false}var c=this.createIndicatorAndRange(i,a);if(c==null){return false}var g=c.indic;var b=c.range;this.removeDataProvider(i+".main");this.removePlotter(i+".main");this.removeRange(i);this.removePlotter(i+"Range.decoration");h.setIndicator(g);this.setRange(i,b);b.setPaddingTop(20);b.setPaddingBottom(4);b.setMinInterval(20);if(is_instance(g,VOLUMEIndicator)){var f=new LastVolumePlotter(i+"Range.decoration");this.setPlotter(f.getName(),f)}else{if(is_instance(g,BOLLIndicator)||is_instance(g,SARIndicator)){var h=new MainDataProvider(i+".main");this.setDataProvider(h.getName(),h);h.updateData();var f=new OHLCPlotter(i+".main");this.setPlotter(f.getName(),f)}}return true};ChartManager.prototype.removeMainIndicator=function(c){var d=c+".main";var b=d+".secondary";var a=this.getDataProvider(b);if(a==undefined||!is_instance(a,IndicatorDataProvider)){return}this.removeDataProvider(b);this.removePlotter(b);this.getArea(d).setChanged(true)};ChartManager.prototype.removeIndicator=function(h){var b=this.getArea(h);if(b==undefined||b.getNameObject().getCompAt(2)=="main"){return}var g=this.getDataProvider(h+".secondary");if(g==undefined||!is_instance(g,IndicatorDataProvider)){return}var c=h+"Range";var a=this.getArea(c);if(a==undefined){return}var f=this.getArea(b.getDataSourceName()+".charts");if(f==undefined){return}f.removeArea(b);this.removeArea(h);f.removeArea(a);this.removeArea(c);for(var d in this._dataProviders){if(this._dataProviders[d].getAreaName()==h){this.removeDataProvider(d)}}for(var d in this._ranges){if(this._ranges[d].getAreaName()==h){this.removeRange(d)}}for(var d in this._plotters){if(this._plotters[d].getAreaName()==h){this.removePlotter(d)}}for(var d in this._plotters){if(this._plotters[d].getAreaName()==c){this.removePlotter(d)}}};ChartManager.prototype.getIndicatorParameters=function(a){var g=this._fakeIndicators[a];if(g==undefined){var b=this.createIndicatorAndRange("",a);if(b==null){return null}this._fakeIndicators[a]=g=b.indic}var f=[];var d,c=g.getParameterCount();for(d=0;d<c;d++){f.push(g.getParameterAt(d))}return f};ChartManager.prototype.setIndicatorParameters=function(a,c){var g,f;for(g in this._dataProviders){var d=this._dataProviders[g];if(is_instance(d,IndicatorDataProvider)==false){continue}f=d.getIndicator();if(f.getName()==a){f.setParameters(c);d.refresh();this.getArea(d.getAreaName()).setChanged(true)}}f=this._fakeIndicators[a];if(f==undefined){var b=this.createIndicatorAndRange("",a,true);if(b==null){return}this._fakeIndicators[a]=f=b.indic}f.setParameters(c)};ChartManager.prototype.getIndicatorAreaName=function(c,a){var d=this.getArea(c+".charts");var b=d.getAreaCount()>>1;if(a<0||a>=b){return""}return d.getAreaAt(a<<1).getName()};var Timeline=create_class(NamedObject);Timeline._ItemWidth=[1,3,3,5,5,7,9,11,13,15,17,19,21,23,25,27,29];Timeline._SpaceWidth=[1,1,2,2,3,3,3,3,3,3,5,5,5,5,7,7,7];Timeline.PADDING_LEFT=4;Timeline.PADDING_RIGHT=8;Timeline.prototype.__construct=function(a){Timeline.__super.__construct.call(this,a);this._updated=false;this._innerLeft=0;this._innerWidth=0;this._firstColumnLeft=0;this._scale=3;this._lastScale=-1;this._maxItemCount=0;this._maxIndex=0;this._firstIndex=-1;this._selectedIndex=-1;this._savedFirstIndex=-1};Timeline.prototype.isLatestShown=function(){return this.getLastIndex()==this._maxIndex};Timeline.prototype.isUpdated=function(){return this._updated};Timeline.prototype.setUpdated=function(a){this._updated=a};Timeline.prototype.getItemWidth=function(){return Timeline._ItemWidth[this._scale]};Timeline.prototype.getSpaceWidth=function(){return Timeline._SpaceWidth[this._scale]};Timeline.prototype.getColumnWidth=function(){return this.getSpaceWidth()+this.getItemWidth()};Timeline.prototype.getInnerWidth=function(){return this._innerWidth};Timeline.prototype.getItemLeftOffset=function(){return this.getSpaceWidth()};Timeline.prototype.getItemCenterOffset=function(){return this.getSpaceWidth()+(this.getItemWidth()>>1)};Timeline.prototype.getFirstColumnLeft=function(){return this._firstColumnLeft};Timeline.prototype.getMaxItemCount=function(){return this._maxItemCount};Timeline.prototype.getFirstIndex=function(){return this._firstIndex};Timeline.prototype.getLastIndex=function(){return Math.min(this._firstIndex+this._maxItemCount,this._maxIndex)};Timeline.prototype.getSelectedIndex=function(){return this._selectedIndex};Timeline.prototype.getMaxIndex=function(){return this._maxIndex};Timeline.prototype.calcColumnCount=function(a){return Math.floor(a/this.getColumnWidth())<<0};Timeline.prototype.calcFirstColumnLeft=function(a){return this._innerLeft+this._innerWidth-(this.getColumnWidth()*a)};Timeline.prototype.calcFirstIndexAlignRight=function(c,a,b){return Math.max(0,c+Math.max(a,1)-Math.max(b,1))};Timeline.prototype.calcFirstIndex=function(a){return this.validateFirstIndex(this.calcFirstIndexAlignRight(this._firstIndex,this._maxItemCount,a),a)};Timeline.prototype.updateMaxItemCount=function(){var a=this.calcColumnCount(this._innerWidth);var c;if(this._maxItemCount<1){c=this.calcFirstIndex(a)
}else{if(this._lastScale==this._scale){c=this.validateFirstIndex(this._firstIndex-(a-this._maxItemCount))}else{var b=(this._selectedIndex>=0)?this._selectedIndex:this.getLastIndex()-1;c=this.validateFirstIndex(b-Math.round((b-this._firstIndex)*a/this._maxItemCount))}}this._lastScale=this._scale;if(this._firstIndex!=c){if(this._selectedIndex==this._firstIndex){this._selectedIndex=c}this._firstIndex=c;this._updated=true}if(this._maxItemCount!=a){this._maxItemCount=a;this._updated=true}this._firstColumnLeft=this.calcFirstColumnLeft(a)};Timeline.prototype.validateFirstIndex=function(a,c){if(this._maxIndex<1){return -1}if(a<0){return 0}var b=Math.max(0,this._maxIndex-1);if(a>b){return b}return a};Timeline.prototype.validateSelectedIndex=function(){if(this._selectedIndex<this._firstIndex){this._selectedIndex=-1}else{if(this._selectedIndex>=this.getLastIndex()){this._selectedIndex=-1}}};Timeline.prototype.onLayout=function(){var c=ChartManager.getInstance();var b=c.getArea(this.getDataSourceName()+".main");if(b!=null){this._innerLeft=b.getLeft()+Timeline.PADDING_LEFT;var a=Math.max(0,b.getWidth()-(Timeline.PADDING_LEFT+Timeline.PADDING_RIGHT));if(this._innerWidth!=a){this._innerWidth=a;this.updateMaxItemCount()}}};Timeline.prototype.toIndex=function(a){return this._firstIndex+this.calcColumnCount(a-this._firstColumnLeft)};Timeline.prototype.toColumnLeft=function(a){return this._firstColumnLeft+(this.getColumnWidth()*(a-this._firstIndex))};Timeline.prototype.toItemLeft=function(a){return this.toColumnLeft(a)+this.getItemLeftOffset()};Timeline.prototype.toItemCenter=function(a){return this.toColumnLeft(a)+this.getItemCenterOffset()};Timeline.prototype.selectAt=function(a){this._selectedIndex=this.toIndex(a);this.validateSelectedIndex();return(this._selectedIndex>=0)};Timeline.prototype.unselect=function(){this._selectedIndex=-1};Timeline.prototype.update=function(){var c=ChartManager.getInstance();var b=c.getDataSource(this.getDataSourceName());var d=this._maxIndex;this._maxIndex=b.getDataCount();switch(b.getUpdateMode()){case DataSource.UpdateMode.Refresh:if(this._maxIndex<1){this._firstIndex=-1}else{this._firstIndex=Math.max(this._maxIndex-this._maxItemCount,0)}this._selectedIndex=-1;this._updated=true;break;case DataSource.UpdateMode.Append:var f=this.getLastIndex();var a=b.getErasedCount();if(f<d){if(a>0){this._firstIndex=Math.max(this._firstIndex-a,0);if(this._selectedIndex>=0){this._selectedIndex-=a;this.validateSelectedIndex()}this._updated=true}}else{if(f==d){this._firstIndex+=(this._maxIndex-d);if(this._selectedIndex>=0){this._selectedIndex-=a;this.validateSelectedIndex()}this._updated=true}}break}};Timeline.prototype.move=function(a){if(this.isLatestShown()){ChartManager.getInstance().getArea(this.getDataSourceName()+".mainRange").setChanged(true)}this._firstIndex=this.validateFirstIndex(this._savedFirstIndex-this.calcColumnCount(a),this._maxItemCount);this._updated=true;if(this._selectedIndex>=0){this.validateSelectedIndex()}};Timeline.prototype.startMove=function(){this._savedFirstIndex=this._firstIndex};Timeline.prototype.scale=function(a){this._scale+=a;if(this._scale<0){this._scale=0}else{if(this._scale>=Timeline._ItemWidth.length){this._scale=Timeline._ItemWidth.length-1}}this.updateMaxItemCount();if(this._selectedIndex>=0){this.validateSelectedIndex()}};var Range=create_class(NamedObject);Range.prototype.__construct=function(a){Range.__super.__construct.call(this,a);this._updated=true;this._minValue=Number.MAX_VALUE;this._maxValue=-Number.MAX_VALUE;this._outerMinValue=Number.MAX_VALUE;this._outerMaxValue=-Number.MAX_VALUE;this._ratio=0;this._top=0;this._bottom=0;this._paddingTop=0;this._paddingBottom=0;this._minInterval=36;this._selectedPosition=-1;this._selectedValue=-Number.MAX_VALUE;this._gradations=[]};Range.prototype.isUpdated=function(){return this._updated};Range.prototype.setUpdated=function(a){this._updated=a};Range.prototype.getMinValue=function(){return this._minValue};Range.prototype.getMaxValue=function(){return this._maxValue};Range.prototype.getRange=function(){return this._maxValue-this._minValue};Range.prototype.getOuterMinValue=function(){return this._outerMinValue};Range.prototype.getOuterMaxValue=function(){return this._outerMaxValue};Range.prototype.getOuterRange=function(){return this._outerMaxValue-this._outerMinValue};Range.prototype.getHeight=function(){return Math.max(0,this._bottom-this._top)};Range.prototype.getGradations=function(){return this._gradations};Range.prototype.getMinInterval=function(){return this._minInterval};Range.prototype.setMinInterval=function(a){this._minInterval=a};Range.prototype.getSelectedPosition=function(){if(this._selectedPosition>=0){return this._selectedPosition}if(this._selectedValue>-Number.MAX_VALUE){return this.toY(this._selectedValue)}return -1};Range.prototype.getSelectedValue=function(){if(this._selectedValue>-Number.MAX_VALUE){return this._selectedValue}var b=ChartManager.getInstance();var a=b.getArea(this.getAreaName());if(a==null){return -Number.MAX_VALUE}if(this._selectedPosition<a.getTop()+12||this._selectedPosition>=a.getBottom()-4){return -Number.MAX_VALUE}return this.toValue(this._selectedPosition)};Range.prototype.setPaddingTop=function(a){this._paddingTop=a};Range.prototype.setPaddingBottom=function(a){this._paddingBottom=a};Range.prototype.toValue=function(a){return this._maxValue-(a-this._top)/this._ratio};Range.prototype.toY=function(a){if(this._ratio>0){return this._top+Math.floor((this._maxValue-a)*this._ratio+0.5)}return this._top};Range.prototype.toHeight=function(a){return Math.floor(a*this._ratio+1.5)};Range.prototype.update=function(){var c=Number.MAX_VALUE;var a=-Number.MAX_VALUE;var f=ChartManager.getInstance();var h,g=[".main",".secondary"];for(var b=0;b<g.length;b++){h=f.getDataProvider(this.getName()+g[b]);if(h!=null){c=Math.min(c,h.getMinValue());a=Math.max(a,h.getMaxValue())}}var d={"min":c,"max":a};this.preSetRange(d);this.setRange(d.min,d.max)};Range.prototype.select=function(a){this._selectedValue=a;this._selectedPosition=-1};Range.prototype.selectAt=function(a){this._selectedPosition=a;this._selectedValue=-Number.MAX_VALUE};Range.prototype.unselect=function(){this._selectedPosition=-1;this._selectedValue=-Number.MAX_VALUE};Range.prototype.preSetRange=function(a){if(a.min==a.max){a.min=-1;a.max=1}};Range.prototype.setRange=function(d,g){var c=ChartManager.getInstance();var b=c.getArea(this.getAreaName());if(this._minValue==d&&this._maxValue==g&&!b.isChanged()){return}this._updated=true;this._minValue=d;this._maxValue=g;this._gradations=[];var f=b.getTop()+this._paddingTop;var a=b.getBottom()-(this._paddingBottom+1);if(f>=a){this._minValue=this._maxValue;return}this._top=f;this._bottom=a;if(this._maxValue>this._minValue){this._ratio=(a-f)/(this._maxValue-this._minValue)}else{this._ratio=1}this._outerMinValue=this.toValue(b.getBottom());this._outerMaxValue=this.toValue(b.getTop());this.updateGradations()};Range.prototype.calcInterval=function(){var f=this.getHeight();var g=this.getMinInterval();if((f/g)<=1){g=f>>1}var j=this.getRange();var b=0;while(b>-2&&Math.floor(j)<j){j*=10;b--}var a,k;for(;;b++){k=Math.pow(10,b);a=k;if(this.toHeight(a)>g){break}a=2*k;if(this.toHeight(a)>g){break}a=5*k;if(this.toHeight(a)>g){break}}return a};Range.prototype.updateGradations=function(){this._gradations=[];var b=this.calcInterval();if(b<=0){return}var a=Math.floor(this.getMaxValue()/b)*b;do{this._gradations.push(a);a-=b}while(a>this.getMinValue())};var PositiveRange=create_class(Range);PositiveRange.prototype.__construct=function(a){PositiveRange.__super.__construct.call(this,a)};PositiveRange.prototype.preSetRange=function(a){if(a.min<0){a.min=0}if(a.max<0){a.max=0}};var ZeroBasedPositiveRange=create_class(Range);ZeroBasedPositiveRange.prototype.__construct=function(a){ZeroBasedPositiveRange.__super.__construct.call(this,a)};ZeroBasedPositiveRange.prototype.preSetRange=function(a){a.min=0;if(a.max<0){a.max=0}};var MainRange=create_class(Range);MainRange.prototype.__construct=function(a){MainRange.__super.__construct.call(this,a)};MainRange.prototype.preSetRange=function(f){var n=ChartManager.getInstance();var o=n.getTimeline(this.getDataSourceName());var b=o.getMaxIndex()-o.getLastIndex();if(b<25){var g=n.getDataSource(this.getDataSourceName());var i=g.getDataAt(g.getDataCount()-1);var j=((f.max-f.min)/4)*(1-(b/25));f.min=Math.min(f.min,Math.max(i.low-j,0));f.max=Math.max(f.max,i.high+j)}if(f.min>0){var l=f.max/f.min;if(l<1.016){var h=(f.max+f.min)/2;var k=(l-1)*1.5;f.max=h*(1+k);f.min=h*(1-k)}else{if(l<1.048){var h=(f.max+f.min)/2;f.max=h*1.024;f.min=h*0.976}}}if(f.min<0){f.min=0}if(f.max<0){f.max=0}};var ZeroCenteredRange=create_class(Range);ZeroCenteredRange.prototype.__construct=function(a){ZeroCenteredRange.__super.__construct.call(this,a)};ZeroCenteredRange.prototype.calcInterval=function(d){var b=this.getMinInterval();if(d.getHeight()/b<2){return 0}var c=this.getRange();var a;for(a=3;;a+=2){if(this.toHeight(c/a)<=b){break}}a-=2;return c/a};ZeroCenteredRange.prototype.updateGradations=function(){this._gradations=[];var d=ChartManager.getInstance();var c=d.getArea(this.getAreaName());var b=this.calcInterval(c);if(b<=0){return}var a=b/2;do{this._gradations.push(a);this._gradations.push(-a);a+=b}while(a<=this.getMaxValue())};ZeroCenteredRange.prototype.preSetRange=function(b){var a=Math.max(Math.abs(b.min),Math.abs(b.max));b.min=-a;b.max=a};var PercentageRange=create_class(Range);PercentageRange.prototype.__construct=function(a){PercentageRange.__super.__construct.call(this,a)};PercentageRange.prototype.updateGradations=function(){this._gradations=[];var f=ChartManager.getInstance();var d=f.getArea(this.getAreaName());var b=10;var c=Math.floor(this.toHeight(b));if((c<<2)>d.getHeight()){return}var a=Math.ceil(this.getMinValue()/b)*b;if(a==0){a=0}if((c<<2)<24){if((c<<1)<8){return}do{if(a==20||a==80){this._gradations.push(a)}a+=b}while(a<this.getMaxValue())}else{do{if(c<8){if(a==20||a==50||a==80){this._gradations.push(a)}}else{if(a==0||a==20||a==50||a==80||a==100){this._gradations.push(a)
}}a+=b}while(a<this.getMaxValue())}};var DataSource=create_class(NamedObject);DataSource.prototype.__construct=function(a){DataSource.__super.__construct.call(this,a)};DataSource.UpdateMode={DoNothing:0,Refresh:1,Update:2,Append:3};DataSource.prototype.getUpdateMode=function(){return this._updateMode};DataSource.prototype.setUpdateMode=function(a){this._updateMode=a};DataSource.prototype.getCacheSize=function(){return 0};DataSource.prototype.getDataCount=function(){return 0};var MainDataSource=create_class(DataSource);MainDataSource.prototype.__construct=function(a){MainDataSource.__super.__construct.call(this,a);this._erasedCount=0;this._dataItems=[];this._decimalDigits=0;this.toolManager=new CToolManager(a)};MainDataSource.prototype.getCacheSize=function(){return this._dataItems.length};MainDataSource.prototype.getDataCount=function(){return this._dataItems.length};MainDataSource.prototype.getUpdatedCount=function(){return this._updatedCount};MainDataSource.prototype.getAppendedCount=function(){return this._appendedCount};MainDataSource.prototype.getErasedCount=function(){return this._erasedCount};MainDataSource.prototype.getDecimalDigits=function(){return this._decimalDigits};MainDataSource.prototype.calcDecimalDigits=function(a){var c=""+a;var b=c.indexOf(".");if(b<0){return 0}return(c.length-1)-b};MainDataSource.prototype.getLastDate=function(){var a=this.getDataCount();if(a<1){return -1}return this.getDataAt(a-1).date};MainDataSource.prototype.getDataAt=function(a){return this._dataItems[a]};MainDataSource.prototype.update=function(c){this._updatedCount=0;this._appendedCount=0;this._erasedCount=0;var h=this._dataItems.length;if(h>0){var g=h-1;var l=this._dataItems[g];var j,f,b=c.length;for(f=0;f<b;f++){j=c[f];if(j[0]==l.date){if(l.open==j[1]&&l.high==j[2]&&l.low==j[3]&&l.close==j[4]&&l.volume==j[5]){this.setUpdateMode(DataSource.UpdateMode.DoNothing)}else{this.setUpdateMode(DataSource.UpdateMode.Update);this._dataItems[g]={date:j[0],open:j[1],high:j[2],low:j[3],close:j[4],volume:j[5]};this._updatedCount++}f++;if(f<b){this.setUpdateMode(DataSource.UpdateMode.Append);for(;f<b;f++,this._appendedCount++){j=c[f];this._dataItems.push({date:j[0],open:j[1],high:j[2],low:j[3],close:j[4],volume:j[5]})}}return true}}if(b<KlineIns.limit){this.setUpdateMode(DataSource.UpdateMode.DoNothing);return false}}this.setUpdateMode(DataSource.UpdateMode.Refresh);this._dataItems=[];var k,a,j,f,b=c.length;for(f=0;f<b;f++){j=c[f];for(a=1;a<=4;a++){k=this.calcDecimalDigits(j[a]);if(this._decimalDigits<k){this._decimalDigits=k}}this._dataItems.push({date:j[0],open:j[1],high:j[2],low:j[3],close:j[4],volume:j[5]})}return true};MainDataSource.prototype.select=function(a){this.toolManager.selecedObject=a};MainDataSource.prototype.unselect=function(){this.toolManager.selecedObject=-1};MainDataSource.prototype.addToolObject=function(a){this.toolManager.addToolObject(a)};MainDataSource.prototype.delToolObject=function(){this.toolManager.delCurrentObject()};MainDataSource.prototype.getToolObject=function(a){return this.toolManager.getToolObject(a)};MainDataSource.prototype.getToolObjectCount=function(){return this.toolManager.toolObjects.length};MainDataSource.prototype.getCurrentToolObject=function(){return this.toolManager.getCurrentObject()};MainDataSource.prototype.getSelectToolObjcet=function(){return this.toolManager.getSelectedObject()};MainDataSource.prototype.delSelectToolObject=function(){this.toolManager.delSelectedObject()};var DataProvider=create_class(NamedObject);DataProvider.prototype.__construct=function(a){DataProvider.__super.__construct.call(this,a);this._minValue=0;this._maxValue=0;this._minValueIndex=-1;this._maxValueIndex=-1};DataProvider.prototype.getMinValue=function(){return this._minValue};DataProvider.prototype.getMaxValue=function(){return this._maxValue};DataProvider.prototype.getMinValueIndex=function(){return this._minValueIndex};DataProvider.prototype.getMaxValueIndex=function(){return this._maxValueIndex};DataProvider.prototype.calcRange=function(m,j,d,k){var f=Number.MAX_VALUE;var o=-Number.MAX_VALUE;var l=-1;var b=-1;var c={};var g=j-1;var a=m.length-1;for(;a>=0;a--){var h=m[a];if(g<h){d[a]={"min":f,"max":o}}else{for(;g>=h;g--){if(this.getMinMaxAt(g,c)==false){continue}if(f>c.min){f=c.min;l=g}if(o<c.max){o=c.max;b=g}}d[a]={"min":f,"max":o}}if(k!=null){k[a]={"minIndex":l,"maxIndex":b}}}};DataProvider.prototype.updateRange=function(){var f=ChartManager.getInstance();var c=f.getTimeline(this.getDataSourceName());var b=[c.getFirstIndex()];var d=[{}];var a=[{}];this.calcRange(b,c.getLastIndex(),d,a);this._minValue=d[0].min;this._maxValue=d[0].max;this._minValueIndex=a[0].minIndex;this._maxValueIndex=a[0].maxIndex};var MainDataProvider=create_class(DataProvider);MainDataProvider.prototype.__construct=function(a){MainDataProvider.__super.__construct.call(this,a);this._candlestickDS=null};MainDataProvider.prototype.updateData=function(){var b=ChartManager.getInstance();var a=b.getDataSource(this.getDataSourceName());if(!is_instance(a,MainDataSource)){return}this._candlestickDS=a};MainDataProvider.prototype.getMinMaxAt=function(a,b){var c=this._candlestickDS.getDataAt(a);b.min=c.low;b.max=c.high;return true};var IndicatorDataProvider=create_class(DataProvider);IndicatorDataProvider.prototype.getIndicator=function(){return this._indicator};IndicatorDataProvider.prototype.setIndicator=function(a){this._indicator=a;this.refresh()};IndicatorDataProvider.prototype.refresh=function(){var d=ChartManager.getInstance();var c=d.getDataSource(this.getDataSourceName());if(c.getDataCount()<1){return}var f=this._indicator;var a,b=c.getDataCount();f.clear();f.reserve(b);for(a=0;a<b;a++){f.execute(c,a)}};IndicatorDataProvider.prototype.updateData=function(){var f=ChartManager.getInstance();var d=f.getDataSource(this.getDataSourceName());if(d.getDataCount()<1){return}var h=this._indicator;var g=d.getUpdateMode();switch(g){case DataSource.UpdateMode.Refresh:this.refresh();break;case DataSource.UpdateMode.Append:h.reserve(d.getAppendedCount());case DataSource.UpdateMode.Update:var b,c=d.getDataCount();var a=d.getUpdatedCount()+d.getAppendedCount();for(b=c-a;b<c;b++){h.execute(d,b)}break}};IndicatorDataProvider.prototype.getMinMaxAt=function(b,g){g.min=Number.MAX_VALUE;g.max=-Number.MAX_VALUE;var a,f=false;var d,c=this._indicator.getOutputCount();for(d=0;d<c;d++){a=this._indicator.getOutputAt(d).execute(b);if(isNaN(a)==false){f=true;if(g.min>a){g.min=a}if(g.max<a){g.max=a}}}return f};var theme_color_id=0;var theme_font_id=0;var Theme=create_class();Theme.prototype.getColor=function(a){return this._colors[a]};Theme.prototype.getFont=function(a){return this._fonts[a]};Theme.Color={Positive:theme_color_id++,Negative:theme_color_id++,PositiveDark:theme_color_id++,NegativeDark:theme_color_id++,Unchanged:theme_color_id++,Background:theme_color_id++,Cursor:theme_color_id++,RangeMark:theme_color_id++,Indicator0:theme_color_id++,Indicator1:theme_color_id++,Indicator2:theme_color_id++,Indicator3:theme_color_id++,Indicator4:theme_color_id++,Indicator5:theme_color_id++,Grid0:theme_color_id++,Grid1:theme_color_id++,Grid2:theme_color_id++,Grid3:theme_color_id++,Grid4:theme_color_id++,TextPositive:theme_color_id++,TextNegative:theme_color_id++,Text0:theme_color_id++,Text1:theme_color_id++,Text2:theme_color_id++,Text3:theme_color_id++,Text4:theme_color_id++,LineColorNormal:theme_color_id++,LineColorSelected:theme_color_id++,CircleColorFill:theme_color_id++,CircleColorStroke:theme_color_id++};Theme.Font={Default:theme_font_id++};var DarkTheme=create_class(Theme);DarkTheme.prototype.__construct=function(){this._colors=[];if(KlineIns.reverseColor){this._colors[Theme.Color.Positive]="#990e0e";this._colors[Theme.Color.Negative]="#19b34c";this._colors[Theme.Color.PositiveDark]="#3b0e08";this._colors[Theme.Color.NegativeDark]="#004718"}else{this._colors[Theme.Color.Positive]="#19b34c";this._colors[Theme.Color.Negative]="#990e0e";this._colors[Theme.Color.PositiveDark]="#004718";this._colors[Theme.Color.NegativeDark]="#3b0e08"}this._colors[Theme.Color.Unchanged]="#fff";this._colors[Theme.Color.Background]="#0a0a0a";this._colors[Theme.Color.Cursor]="#aaa";this._colors[Theme.Color.RangeMark]="#f9ee30";this._colors[Theme.Color.Indicator0]="#ddd";this._colors[Theme.Color.Indicator1]="#f9ee30";this._colors[Theme.Color.Indicator2]="#f600ff";this._colors[Theme.Color.Indicator3]="#6bf";this._colors[Theme.Color.Indicator4]="#a5cf81";this._colors[Theme.Color.Indicator5]="#e18b89";this._colors[Theme.Color.Grid0]="#333";this._colors[Theme.Color.Grid1]="#444";this._colors[Theme.Color.Grid2]="#666";this._colors[Theme.Color.Grid3]="#888";this._colors[Theme.Color.Grid4]="#aaa";this._colors[Theme.Color.TextPositive]="#1bd357";this._colors[Theme.Color.TextNegative]="#ff6f5e";this._colors[Theme.Color.Text0]="#444";this._colors[Theme.Color.Text1]="#666";this._colors[Theme.Color.Text2]="#888";this._colors[Theme.Color.Text3]="#aaa";this._colors[Theme.Color.Text4]="#ccc";this._colors[Theme.Color.LineColorNormal]="#a6a6a6";this._colors[Theme.Color.LineColorSelected]="#ffffff";this._colors[Theme.Color.CircleColorFill]="#000000";this._colors[Theme.Color.CircleColorStroke]="#ffffff";this._fonts=[];this._fonts[Theme.Font.Default]="12px Tahoma"};var LightTheme=create_class(Theme);LightTheme.prototype.__construct=function(){this._colors=[];if(KlineIns.reverseColor){this._colors[Theme.Color.Positive]="#db5542";this._colors[Theme.Color.Negative]="#53b37b";this._colors[Theme.Color.PositiveDark]="#ffadaa";this._colors[Theme.Color.NegativeDark]="#66d293"}else{this._colors[Theme.Color.Positive]="#53b37b";this._colors[Theme.Color.Negative]="#db5542";this._colors[Theme.Color.PositiveDark]="#66d293";this._colors[Theme.Color.NegativeDark]="#ffadaa"}this._colors[Theme.Color.Unchanged]="#fff";this._colors[Theme.Color.Background]="#fff";this._colors[Theme.Color.Cursor]="#aaa";this._colors[Theme.Color.RangeMark]="#f27935";this._colors[Theme.Color.Indicator0]="#2fd2b2";this._colors[Theme.Color.Indicator1]="#ffb400";
    this._colors[Theme.Color.Indicator2]="#e849b9";this._colors[Theme.Color.Indicator3]="#1478c8";this._colors[Theme.Color.Grid0]="#eee";this._colors[Theme.Color.Grid1]="#afb1b3";this._colors[Theme.Color.Grid2]="#ccc";this._colors[Theme.Color.Grid3]="#bbb";this._colors[Theme.Color.Grid4]="#aaa";this._colors[Theme.Color.TextPositive]="#53b37b";this._colors[Theme.Color.TextNegative]="#db5542";this._colors[Theme.Color.Text0]="#ccc";this._colors[Theme.Color.Text1]="#aaa";this._colors[Theme.Color.Text2]="#888";this._colors[Theme.Color.Text3]="#666";this._colors[Theme.Color.Text4]="#444";this._colors[Theme.Color.LineColorNormal]="#8c8c8c";this._colors[Theme.Color.LineColorSelected]="#393c40";this._colors[Theme.Color.CircleColorFill]="#ffffff";this._colors[Theme.Color.CircleColorStroke]="#393c40";this._fonts=[];this._fonts[Theme.Font.Default]="12px Tahoma"};var TemplateMeasuringHandler=create_class();TemplateMeasuringHandler.onMeasuring=function(c,b){var d=b.Width;var a=b.Height;var f=c.getNameObject().getCompAt(2);if(f=="timeline"){c.setMeasuredDimension(d,22)}};var Template=create_class();Template.displayVolume=false;Template.createCandlestickDataSource=function(a){return new MainDataSource(a)};Template.createLiveOrderDataSource=function(a){return new CLiveOrderDataSource(a)};Template.createLiveTradeDataSource=function(a){return new CLiveTradeDataSource(a)};Template.createDataSource=function(d,a,c){var b=ChartManager.getInstance();if(b.getCachedDataSource(a)==null){b.setCachedDataSource(a,c(a))}b.setCurrentDataSource(d,a);b.updateData(d,null)};Template.createTableComps=function(a){Template.createMainChartComps(a);if(Template.displayVolume){Template.createIndicatorChartComps(a,"VOLUME")}Template.createTimelineComps(a)};Template.createMainChartComps=function(c){var k=ChartManager.getInstance();var b=k.getArea(c+".charts");var h=c+".main";var i=h+"Range";var d=new MainArea(h);k.setArea(h,d);b.addArea(d);var j=new MainRangeArea(i);k.setArea(i,j);b.addArea(j);var f=new MainDataProvider(h+".main");k.setDataProvider(f.getName(),f);k.setMainIndicator(c,"MA");var g=new MainRange(h);k.setRange(g.getName(),g);g.setPaddingTop(28);g.setPaddingBottom(12);var a=new MainAreaBackgroundPlotter(h+".background");k.setPlotter(a.getName(),a);a=new CGridPlotter(h+".grid");k.setPlotter(a.getName(),a);a=new CandlestickPlotter(h+".main");k.setPlotter(a.getName(),a);a=new MinMaxPlotter(h+".decoration");k.setPlotter(a.getName(),a);a=new MainInfoPlotter(h+".info");k.setPlotter(a.getName(),a);a=new SelectionPlotter(h+".selection");k.setPlotter(a.getName(),a);a=new CDynamicLinePlotter(h+".tool");k.setPlotter(a.getName(),a);a=new RangeAreaBackgroundPlotter(h+"Range.background");k.setPlotter(a.getName(),a);a=new COrderGraphPlotter(h+"Range.grid");k.setPlotter(a.getName(),a);a=new RangePlotter(h+"Range.main");k.setPlotter(a.getName(),a);a=new RangeSelectionPlotter(h+"Range.selection");k.setPlotter(a.getName(),a);a=new LastClosePlotter(h+"Range.decoration");k.setPlotter(a.getName(),a)};Template.createIndicatorChartComps=function(d,q){var p=ChartManager.getInstance();var c=p.getArea(d+".charts");var j=d+".indic"+c.getNextRowId();var o=j+"Range";var f=new IndicatorArea(j);p.setArea(j,f);c.addArea(f);var l=c.getAreaCount()>>1;var k=ChartSettings.get().charts.areaHeight;if(k.length>l){var m,h;for(h=0;h<l;h++){m=c.getAreaAt(h<<1);m.setTop(0);m.setBottom(k[h])}f.setTop(0);f.setBottom(k[l])}var n=new IndicatorRangeArea(o);p.setArea(o,n);c.addArea(n);var g=new IndicatorDataProvider(j+".secondary");p.setDataProvider(g.getName(),g);if(p.setIndicator(j,q)==false){p.removeIndicator(j);return}var b=new MainAreaBackgroundPlotter(j+".background");p.setPlotter(b.getName(),b);b=new CGridPlotter(j+".grid");p.setPlotter(b.getName(),b);b=new IndicatorPlotter(j+".secondary");p.setPlotter(b.getName(),b);b=new IndicatorInfoPlotter(j+".info");p.setPlotter(b.getName(),b);b=new SelectionPlotter(j+".selection");p.setPlotter(b.getName(),b);b=new RangeAreaBackgroundPlotter(j+"Range.background");p.setPlotter(b.getName(),b);b=new RangePlotter(j+"Range.main");p.setPlotter(b.getName(),b);b=new RangeSelectionPlotter(j+"Range.selection");p.setPlotter(b.getName(),b)};Template.createTimelineComps=function(d){var b=ChartManager.getInstance();var c;var a=new Timeline(d);b.setTimeline(a.getName(),a);c=new TimelineAreaBackgroundPlotter(d+".timeline.background");b.setPlotter(c.getName(),c);c=new TimelinePlotter(d+".timeline.main");b.setPlotter(c.getName(),c);c=new TimelineSelectionPlotter(d+".timeline.selection");b.setPlotter(c.getName(),c)};Template.createLiveOrderComps=function(c){var a=ChartManager.getInstance();var b;b=new BackgroundPlotter(c+".main.background");a.setPlotter(b.getName(),b);b=new CLiveOrderPlotter(c+".main.main");a.setPlotter(b.getName(),b)};Template.createLiveTradeComps=function(c){var a=ChartManager.getInstance();var b;b=new BackgroundPlotter(c+".main.background");a.setPlotter(b.getName(),b);b=new CLiveTradePlotter(c+".main.main");a.setPlotter(b.getName(),b)};var DefaultTemplate=create_class(Template);DefaultTemplate.loadTemplate=function(h,b){var f=ChartManager.getInstance();var c=ChartSettings.get();var a=(new CName(h)).getCompAt(0);f.unloadTemplate(a);Template.createDataSource(h,b,Template.createCandlestickDataSource);var g=new DockableLayout(a);f.setFrame(g.getName(),g);f.setArea(g.getName(),g);g.setGridColor(Theme.Color.Grid1);var d=new TimelineArea(h+".timeline");f.setArea(d.getName(),d);g.addArea(d);d.setDockStyle(ChartArea.DockStyle.Bottom);d.Measuring.addHandler(d,TemplateMeasuringHandler.onMeasuring);var i=new TableLayout(h+".charts");f.setArea(i.getName(),i);i.setDockStyle(ChartArea.DockStyle.Fill);g.addArea(i);Template.createTableComps(h);f.setThemeName(a,c.theme);return f};var Plotter=create_class(NamedObject);Plotter.prototype.__construct=function(a){Plotter.__super.__construct.call(this,a)};Plotter.isChrome=(navigator.userAgent.toLowerCase().match(/chrome/)!=null);Plotter.drawLine=function(d,b,f,a,c){d.beginPath();d.moveTo((b<<0)+0.5,(f<<0)+0.5);d.lineTo((a<<0)+0.5,(c<<0)+0.5);d.stroke()};Plotter.drawLines=function(c,d){var b,a=d.length;c.beginPath();c.moveTo(d[0].x,d[0].y);for(b=1;b<a;b++){c.lineTo(d[b].x,d[b].y)}if(Plotter.isChrome){c.moveTo(d[0].x,d[0].y);for(b=1;b<a;b++){c.lineTo(d[b].x,d[b].y)}}c.stroke()};Plotter.drawDashedLine=function(b,c,m,a,l,h,k){if(h<2){h=2}var f=a-c;var d=l-m;b.beginPath();if(d==0){var j=(f/h+0.5)<<0;for(var g=0;g<j;g++){b.rect(c,m,k,1);c+=h}b.fill()}else{var j=(Math.sqrt(f*f+d*d)/h+0.5)<<0;f=f/j;d=d/j;var o=f*k/h;var n=d*k/h;for(var g=0;g<j;g++){b.moveTo(c+0.5,m+0.5);b.lineTo(c+0.5+o,m+0.5+n);c+=f;m+=d}b.stroke()}};Plotter.createHorzDashedLine=function(b,c,a,k,g,j){if(g<2){g=2}var d=a-c;var h=(d/g+0.5)<<0;for(var f=0;f<h;f++){b.rect(c,k,j,1);c+=g}};Plotter.createRectangles=function(d,a){d.beginPath();var f,c,b=a.length;for(c=0;c<b;c++){f=a[c];d.rect(f.x,f.y,f.w,f.h)}};Plotter.createPolygon=function(c,d){c.beginPath();c.moveTo(d[0].x+0.5,d[0].y+0.5);var b,a=d.length;for(b=1;b<a;b++){c.lineTo(d[b].x+0.5,d[b].y+0.5)}c.closePath()};Plotter.drawString=function(b,d,c){var a=b.measureText(d).width;if(c.w<a){return false}b.fillText(d,c.x,c.y);c.x+=a;c.w-=a;return true};var BackgroundPlotter=create_class(Plotter);BackgroundPlotter.prototype.__construct=function(a){BackgroundPlotter.__super.__construct.call(this,a);this._color=Theme.Color.Background};BackgroundPlotter.prototype.getColor=function(){return this._color};BackgroundPlotter.prototype.setColor=function(a){this._color=a};BackgroundPlotter.prototype.Draw=function(a){var c=ChartManager.getInstance();var b=c.getArea(this.getAreaName());var d=c.getTheme(this.getFrameName());a.fillStyle=d.getColor(this._color);a.fillRect(b.getLeft(),b.getTop(),b.getWidth(),b.getHeight())};var MainAreaBackgroundPlotter=create_class(BackgroundPlotter);MainAreaBackgroundPlotter.prototype.__construct=function(a){MainAreaBackgroundPlotter.__super.__construct.call(this,a)};MainAreaBackgroundPlotter.prototype.Draw=function(c){var j=ChartManager.getInstance();var b=j.getArea(this.getAreaName());var k=j.getTimeline(this.getDataSourceName());var g=j.getRange(this.getAreaName());var d=j.getTheme(this.getFrameName());var h=b.getRect();if(!b.isChanged()&&!k.isUpdated()&&!g.isUpdated()){var f=k.getFirstIndex();var i=k.getLastIndex()-2;var a=Math.max(f,i);h.X=k.toColumnLeft(a);h.Width=b.getRight()-h.X}c.fillStyle=d.getColor(this._color);c.fillRect(h.X,h.Y,h.Width,h.Height)};var RangeAreaBackgroundPlotter=create_class(BackgroundPlotter);RangeAreaBackgroundPlotter.prototype.__construct=function(a){RangeAreaBackgroundPlotter.__super.__construct.call(this,a)};RangeAreaBackgroundPlotter.prototype.Draw=function(c){var f=ChartManager.getInstance();var h=this.getAreaName();var d=f.getArea(h);var b=f.getRange(h.substring(0,h.lastIndexOf("Range")));var a=b.getNameObject().getCompAt(2)=="main";if(a){}else{if(!d.isChanged()&&!b.isUpdated()){return}}var g=f.getTheme(this.getFrameName());c.fillStyle=g.getColor(this._color);c.fillRect(d.getLeft(),d.getTop(),d.getWidth(),d.getHeight())};var TimelineAreaBackgroundPlotter=create_class(BackgroundPlotter);TimelineAreaBackgroundPlotter.prototype.__construct=function(a){TimelineAreaBackgroundPlotter.__super.__construct.call(this,a)};TimelineAreaBackgroundPlotter.prototype.Draw=function(a){var d=ChartManager.getInstance();var c=d.getArea(this.getAreaName());var b=d.getTimeline(this.getDataSourceName());if(!c.isChanged()&&!b.isUpdated()){return}var f=d.getTheme(this.getFrameName());a.fillStyle=f.getColor(this._color);a.fillRect(c.getLeft(),c.getTop(),c.getWidth(),c.getHeight())};var CGridPlotter=create_class(NamedObject);CGridPlotter.prototype.__construct=function(a){CGridPlotter.__super.__construct.call(this,a)};CGridPlotter.prototype.Draw=function(c){var p=ChartManager.getInstance();var b=p.getArea(this.getAreaName());var q=p.getTimeline(this.getDataSourceName());var k=p.getRange(this.getAreaName());var g=false;if(!b.isChanged()&&!q.isUpdated()&&!k.isUpdated()){var j=q.getFirstIndex();var o=q.getLastIndex();
    var a=Math.max(j,o-2);var f=q.toColumnLeft(a);c.save();c.rect(f,b.getTop(),b.getRight()-f,b.getHeight());c.clip();g=true}var i=p.getTheme(this.getFrameName());c.fillStyle=i.getColor(Theme.Color.Grid0);c.beginPath();var h=4,l=1;if(Plotter.isChrome){h=4;l=1}var m=k.getGradations();for(var d in m){Plotter.createHorzDashedLine(c,b.getLeft(),b.getRight(),k.toY(m[d]),h,l)}c.fill();if(g){c.restore()}};var CandlestickPlotter=create_class(NamedObject);CandlestickPlotter.prototype.__construct=function(a){CandlestickPlotter.__super.__construct.call(this,a)};CandlestickPlotter.prototype.Draw=function(c){var B=ChartManager.getInstance();var t=B.getDataSource(this.getDataSourceName());if(t.getDataCount()<1){return}var v=B.getArea(this.getAreaName());var j=B.getTimeline(this.getDataSourceName());var q=B.getRange(this.getAreaName());if(q.getRange()==0){return}var z=B.getTheme(this.getFrameName());var a=is_instance(z,DarkTheme);var k=j.getFirstIndex();var o=j.getLastIndex();var h;if(v.isChanged()||j.isUpdated()||q.isUpdated()){h=k}else{h=Math.max(k,o-2)}var w=j.getColumnWidth();var y=j.getItemWidth();var f=j.toItemLeft(h);var A=j.toItemCenter(h);var x=[];var g=[];var b=[];var m=[];for(var u=h;u<o;u++){var C=t.getDataAt(u);var n=q.toY(C.high);var D=q.toY(C.low);var p=C.open;var s=C.close;if(s>p){var r=q.toY(s);var l=q.toY(p);var d=Math.max(l-r,1);if(d>1&&y>1&&a){x.push({x:f+0.5,y:r+0.5,w:y-1,h:d-1})}else{g.push({x:f,y:r,w:Math.max(y,1),h:Math.max(d,1)})}if(C.high>s){n=Math.min(n,r-1);g.push({x:A,y:n,w:1,h:r-n})}if(p>C.low){D=Math.max(D,l+1);g.push({x:A,y:l,w:1,h:D-l})}}else{if(s==p){var r=q.toY(s);b.push({x:f,y:r,w:Math.max(y,1),h:1});if(C.high>s){n=Math.min(n,r-1)}if(p>C.low){D=Math.max(D,r+1)}if(n<D){b.push({x:A,y:n,w:1,h:D-n})}}else{var r=q.toY(p);var l=q.toY(s);var d=Math.max(l-r,1);m.push({x:f,y:r,w:Math.max(y,1),h:Math.max(d,1)});if(C.high>p){n=Math.min(n,r-1)}if(s>C.low){D=Math.max(D,l+1)}if(n<D){m.push({x:A,y:n,w:1,h:D-n})}}}f+=w;A+=w}if(x.length>0){c.strokeStyle=z.getColor(Theme.Color.Positive);Plotter.createRectangles(c,x);c.stroke()}if(g.length>0){c.fillStyle=z.getColor(Theme.Color.Positive);Plotter.createRectangles(c,g);c.fill()}if(b.length>0){c.fillStyle=z.getColor(Theme.Color.Negative);Plotter.createRectangles(c,b);c.fill()}if(m.length>0){c.fillStyle=z.getColor(Theme.Color.Negative);Plotter.createRectangles(c,m);c.fill()}};var CandlestickHLCPlotter=create_class(Plotter);CandlestickHLCPlotter.prototype.__construct=function(a){CandlestickHLCPlotter.__super.__construct.call(this,a)};CandlestickHLCPlotter.prototype.Draw=function(c){var B=ChartManager.getInstance();var t=B.getDataSource(this.getDataSourceName());if(!is_instance(t,MainDataSource)||t.getDataCount()<1){return}var v=B.getArea(this.getAreaName());var j=B.getTimeline(this.getDataSourceName());var q=B.getRange(this.getAreaName());if(q.getRange()==0){return}var z=B.getTheme(this.getFrameName());var a=is_instance(z,DarkTheme);var k=j.getFirstIndex();var o=j.getLastIndex();var h;if(v.isChanged()||j.isUpdated()||q.isUpdated()){h=k}else{h=Math.max(k,o-2)}var w=j.getColumnWidth();var y=j.getItemWidth();var f=j.toItemLeft(h);var A=j.toItemCenter(h);var x=[];var g=[];var b=[];var m=[];for(var u=h;u<o;u++){var C=t.getDataAt(u);var n=q.toY(C.high);var D=q.toY(C.low);var p=C.open;if(u>0){p=t.getDataAt(u-1).close}var s=C.close;if(s>p){var r=q.toY(s);var l=q.toY(p);var d=Math.max(l-r,1);if(d>1&&y>1&&a){x.push({x:f+0.5,y:r+0.5,w:y-1,h:d-1})}else{g.push({x:f,y:r,w:Math.max(y,1),h:Math.max(d,1)})}if(C.high>s){n=Math.min(n,r-1);g.push({x:A,y:n,w:1,h:r-n})}if(p>C.low){D=Math.max(D,l+1);g.push({x:A,y:l,w:1,h:D-l})}}else{if(s==p){var r=q.toY(s);b.push({x:f,y:r,w:Math.max(y,1),h:1});if(C.high>s){n=Math.min(n,r-1)}if(p>C.low){D=Math.max(D,r+1)}if(n<D){b.push({x:A,y:n,w:1,h:D-n})}}else{var r=q.toY(p);var l=q.toY(s);var d=Math.max(l-r,1);m.push({x:f,y:r,w:Math.max(y,1),h:Math.max(d,1)});if(C.high>p){n=Math.min(n,r-1)}if(s>C.low){D=Math.max(D,l+1)}if(n<D){m.push({x:A,y:n,w:1,h:D-n})}}}f+=w;A+=w}if(x.length>0){c.strokeStyle=z.getColor(Theme.Color.Positive);Plotter.createRectangles(c,x);c.stroke()}if(g.length>0){c.fillStyle=z.getColor(Theme.Color.Positive);Plotter.createRectangles(c,g);c.fill()}if(b.length>0){c.fillStyle=z.getColor(Theme.Color.Negative);Plotter.createRectangles(c,b);c.fill()}if(m.length>0){c.fillStyle=z.getColor(Theme.Color.Negative);Plotter.createRectangles(c,m);c.fill()}};var OHLCPlotter=create_class(Plotter);OHLCPlotter.prototype.__construct=function(a){OHLCPlotter.__super.__construct.call(this,a)};OHLCPlotter.prototype.Draw=function(b){var A=ChartManager.getInstance();var r=A.getDataSource(this.getDataSourceName());if(!is_instance(r,MainDataSource)||r.getDataCount()<1){return}var t=A.getArea(this.getAreaName());var h=A.getTimeline(this.getDataSourceName());var p=A.getRange(this.getAreaName());if(p.getRange()==0){return}var x=A.getTheme(this.getFrameName());var j=h.getFirstIndex();var o=h.getLastIndex();var g;if(t.isChanged()||h.isUpdated()||p.isUpdated()){g=j}else{g=Math.max(j,o-2)}var u=h.getColumnWidth();var w=h.getItemWidth()>>1;var d=h.toItemLeft(g);var z=h.toItemCenter(g);var v=d+h.getItemWidth();var f=[];var a=[];var l=[];for(var s=g;s<o;s++){var B=r.getDataAt(s);var n=p.toY(B.high);var C=p.toY(B.low);var c=Math.max(C-n,1);if(B.close>B.open){var q=p.toY(B.close);var k=p.toY(B.open);f.push({x:z,y:n,w:1,h:c});f.push({x:d,y:q,w:w,h:1});f.push({x:z,y:k,w:w,h:1})}else{if(B.close==B.open){var m=p.toY(B.close);a.push({x:z,y:n,w:1,h:c});a.push({x:d,y:m,w:w,h:1});a.push({x:z,y:m,w:w,h:1})}else{var q=p.toY(B.open);var k=p.toY(B.close);l.push({x:z,y:n,w:1,h:c});l.push({x:d,y:q,w:w,h:1});l.push({x:z,y:k,w:w,h:1})}}d+=u;z+=u;v+=u}if(f.length>0){b.fillStyle=x.getColor(Theme.Color.Positive);Plotter.createRectangles(b,f);b.fill()}if(a.length>0){b.fillStyle=x.getColor(Theme.Color.Negative);Plotter.createRectangles(b,a);b.fill()}if(l.length>0){b.fillStyle=x.getColor(Theme.Color.Negative);Plotter.createRectangles(b,l);b.fill()}};var MainInfoPlotter=create_class(Plotter);MainInfoPlotter.prototype.__construct=function(a){MainInfoPlotter.__super.__construct.call(this,a)};function format_time(a){return(a<10)?"0"+a.toString():a.toString()}MainInfoPlotter.prototype.Draw=function(c){var C=ChartManager.getInstance();var x=C.getArea(this.getAreaName());var f=C.getTimeline(this.getDataSourceName());var o=C.getDataSource(this.getDataSourceName());var z=C.getTheme(this.getFrameName());c.font=z.getFont(Theme.Font.Default);c.textAlign="left";c.textBaseline="top";c.fillStyle=z.getColor(Theme.Color.Text4);var a={x:x.getLeft()+4,y:x.getTop()+2,w:x.getWidth()-8,h:20};var t=f.getSelectedIndex();if(t<0){return}var D=o.getDataAt(t);var j=o.getDecimalDigits();var h=new Date(D.date);var l=h.getFullYear();var B=format_time(h.getMonth()+1);var A=format_time(h.getDate());var g=format_time(h.getHours());var m=format_time(h.getMinutes());var E=C.getLanguage();if(E=="zh-cn"){if(!Plotter.drawString(c,"时间: "+l+"-"+B+"-"+A+"  "+g+":"+m,a)){return}if(!Plotter.drawString(c,"  开: "+D.open.toFixed(j),a)){return}if(!Plotter.drawString(c,"  高: "+D.high.toFixed(j),a)){return}if(!Plotter.drawString(c,"  低: "+D.low.toFixed(j),a)){return}if(!Plotter.drawString(c,"  收: "+D.close.toFixed(j),a)){return}}else{if(E=="en-us"){if(!Plotter.drawString(c,"DATE: "+l+"-"+B+"-"+A+"  "+g+":"+m,a)){return}if(!Plotter.drawString(c,"  O: "+D.open.toFixed(j),a)){return}if(!Plotter.drawString(c,"  H: "+D.high.toFixed(j),a)){return}if(!Plotter.drawString(c,"  L: "+D.low.toFixed(j),a)){return}if(!Plotter.drawString(c,"  C: "+D.close.toFixed(j),a)){return}}else{if(E=="zh-tw"){if(!Plotter.drawString(c,"時間: "+l+"-"+B+"-"+A+"  "+g+":"+m,a)){return}if(!Plotter.drawString(c,"  開: "+D.open.toFixed(j),a)){return}if(!Plotter.drawString(c,"  高: "+D.high.toFixed(j),a)){return}if(!Plotter.drawString(c,"  低: "+D.low.toFixed(j),a)){return}if(!Plotter.drawString(c,"  收: "+D.close.toFixed(j),a)){return}}}}if(t>0){if(E=="zh-cn"){if(!Plotter.drawString(c,"  涨幅: ",a)){return}}else{if(E=="en-us"){if(!Plotter.drawString(c,"  CHANGE: ",a)){return}}else{if(E=="zh-tw"){if(!Plotter.drawString(c,"  漲幅: ",a)){return}}}}var p=o.getDataAt(t-1);if((D.close-p.close)/p.close*100){var i=(D.close-p.close)/p.close*100}else{var i=0}if(i>=0){i=" "+i.toFixed(2);c.fillStyle=z.getColor(Theme.Color.TextPositive)}else{i=i.toFixed(2);c.fillStyle=z.getColor(Theme.Color.TextNegative)}if(!Plotter.drawString(c,i,a)){return}c.fillStyle=z.getColor(Theme.Color.Text4);if(!Plotter.drawString(c," %",a)){return}}if((D.high-D.low)/D.low*100){var d=(D.high-D.low)/D.low*100}else{var d=0}if(E=="zh-cn"){if(!Plotter.drawString(c,"  振幅: "+d.toFixed(2)+" %",a)){return}}else{if(E=="en-us"){if(!Plotter.drawString(c,"  AMPLITUDE: "+d.toFixed(2)+" %",a)){return}}else{if(E=="zh-tw"){if(!Plotter.drawString(c,"  振幅: "+d.toFixed(2)+" %",a)){return}}}}var r=C.getDataProvider(this.getAreaName()+".secondary");if(r==undefined){return}var b=r.getIndicator();var q,u=b.getOutputCount();for(q=0;q<u;q++){var w=b.getOutputAt(q);var k=w.execute(t);if(isNaN(k)){continue}var y="  "+w.getName()+": "+k.toFixed(j);var s=w.getColor();if(s===undefined){s=Theme.Color.Indicator0+q}c.fillStyle=z.getColor(s);if(!Plotter.drawString(c,y,a)){return}}};var IndicatorPlotter=create_class(NamedObject);IndicatorPlotter.prototype.__construct=function(a){IndicatorPlotter.__super.__construct.call(this,a)};IndicatorPlotter.prototype.Draw=function(a){var B=ChartManager.getInstance();var w=B.getArea(this.getAreaName());var f=B.getTimeline(this.getDataSourceName());var l=B.getRange(this.getAreaName());if(l.getRange()==0){return}var m=B.getDataProvider(this.getName());if(!is_instance(m,IndicatorDataProvider)){return}var z=B.getTheme(this.getFrameName());var y=f.getColumnWidth();var g=f.getFirstIndex();var h=f.getLastIndex();var d;if(w.isChanged()||f.isUpdated()||l.isUpdated()){d=g}else{d=Math.max(g,h-2)}var b=m.getIndicator();var t,o,p=b.getOutputCount();for(o=0;o<p;o++){t=b.getOutputAt(o);var u=t.getStyle();if(u==OutputStyle.VolumeStick){this.drawVolumeStick(a,z,B.getDataSource(this.getDataSourceName()),d,h,f.toItemLeft(d),y,f.getItemWidth(),l)
}else{if(u==OutputStyle.MACDStick){this.drawMACDStick(a,z,t,d,h,f.toItemLeft(d),y,f.getItemWidth(),l)}else{if(u==OutputStyle.SARPoint){this.drawSARPoint(a,z,t,d,h,f.toItemCenter(d),y,f.getItemWidth(),l)}}}}var c=f.toColumnLeft(d);var A=f.toItemCenter(d);a.save();a.rect(c,w.getTop(),w.getRight()-c,w.getHeight());a.clip();a.translate(0.5,0.5);for(o=0;o<p;o++){var j=A;t=b.getOutputAt(o);if(t.getStyle()==OutputStyle.Line){var k,s=[];if(d>g){k=t.execute(d-1);if(isNaN(k)==false){s.push({"x":j-y,"y":l.toY(k)})}}for(var r=d;r<h;r++,j+=y){k=t.execute(r);if(isNaN(k)==false){s.push({"x":j,"y":l.toY(k)})}}if(s.length>0){var q=t.getColor();if(q==undefined){q=Theme.Color.Indicator0+o}a.strokeStyle=z.getColor(q);Plotter.drawLines(a,s)}}}a.restore()};IndicatorPlotter.prototype.drawVolumeStick=function(b,t,n,g,k,p,q,s,l){var a=is_instance(t,DarkTheme);var d=p;var j=l.toY(0);var r=[];var f=[];var h=[];for(var o=g;o<k;o++){var u=n.getDataAt(o);var m=l.toY(u.volume);var c=l.toHeight(u.volume);if(u.close>u.open){if(c>1&&s>1&&a){r.push({x:d+0.5,y:m+0.5,w:s-1,h:c-1})}else{f.push({x:d,y:m,w:Math.max(s,1),h:Math.max(c,1)})}}else{if(u.close==u.open){if(o>0&&u.close>=n.getDataAt(o-1).close){if(c>1&&s>1&&a){r.push({x:d+0.5,y:m+0.5,w:s-1,h:c-1})}else{f.push({x:d,y:m,w:Math.max(s,1),h:Math.max(c,1)})}}else{h.push({x:d,y:m,w:Math.max(s,1),h:Math.max(c,1)})}}else{h.push({x:d,y:m,w:Math.max(s,1),h:Math.max(c,1)})}}d+=q}if(r.length>0){b.strokeStyle=t.getColor(Theme.Color.Positive);Plotter.createRectangles(b,r);b.stroke()}if(f.length>0){b.fillStyle=t.getColor(Theme.Color.Positive);Plotter.createRectangles(b,f);b.fill()}if(h.length>0){b.fillStyle=t.getColor(Theme.Color.Negative);Plotter.createRectangles(b,h);b.fill()}};IndicatorPlotter.prototype.drawMACDStick=function(a,s,h,f,j,o,p,r,l){var c=o;var t=l.toY(0);var q=[];var u=[];var d=[];var g=[];var k=(f>0)?h.execute(f-1):NaN;for(var m=f;m<j;m++){var n=h.execute(m);if(n>=0){var b=l.toHeight(n);if((m==0||n>=k)&&b>1&&r>1){q.push({x:c+0.5,y:t-b+0.5,w:r-1,h:b-1})}else{d.push({x:c,y:t-b,w:Math.max(r,1),h:Math.max(b,1)})}}else{var b=l.toHeight(-n);if((m==0||n>=k)&&b>1&&r>1){u.push({x:c+0.5,y:t+0.5,w:r-1,h:b-1})}else{g.push({x:c,y:t,w:Math.max(r,1),h:Math.max(b,1)})}}k=n;c+=p}if(q.length>0){a.strokeStyle=s.getColor(Theme.Color.Positive);Plotter.createRectangles(a,q);a.stroke()}if(u.length>0){a.strokeStyle=s.getColor(Theme.Color.Negative);Plotter.createRectangles(a,u);a.stroke()}if(d.length>0){a.fillStyle=s.getColor(Theme.Color.Positive);Plotter.createRectangles(a,d);a.fill()}if(g.length>0){a.fillStyle=s.getColor(Theme.Color.Negative);Plotter.createRectangles(a,g);a.fill()}};IndicatorPlotter.prototype.drawSARPoint=function(c,h,f,k,q,l,o,m,j){var b=m>>1;if(b<0.5){b=0.5}if(b>4){b=4}var a=l;var p=a+b;var d=2*Math.PI;c.save();c.translate(0.5,0.5);c.strokeStyle=h.getColor(Theme.Color.Indicator3);c.beginPath();for(var g=k;g<q;g++){var n=j.toY(f.execute(g));c.moveTo(p,n);c.arc(a,n,b,0,d);a+=o;p+=o}c.stroke();c.restore()};var IndicatorInfoPlotter=create_class(Plotter);IndicatorInfoPlotter.prototype.__construct=function(a){IndicatorInfoPlotter.__super.__construct.call(this,a)};IndicatorInfoPlotter.prototype.Draw=function(c){var q=ChartManager.getInstance();var b=q.getArea(this.getAreaName());var r=q.getTimeline(this.getDataSourceName());var i=q.getDataProvider(this.getAreaName()+".secondary");var k=q.getTheme(this.getFrameName());c.font=k.getFont(Theme.Font.Default);c.textAlign="left";c.textBaseline="top";c.fillStyle=k.getColor(Theme.Color.Text4);var m={x:b.getLeft()+4,y:b.getTop()+2,w:b.getWidth()-8,h:20};var a=i.getIndicator();var o;switch(a.getParameterCount()){case 0:o=a.getName();break;case 1:o=a.getName()+"("+a.getParameterAt(0).getValue()+")";break;case 2:o=a.getName()+"("+a.getParameterAt(0).getValue()+","+a.getParameterAt(1).getValue()+")";break;case 3:o=a.getName()+"("+a.getParameterAt(0).getValue()+","+a.getParameterAt(1).getValue()+","+a.getParameterAt(2).getValue()+")";break;case 4:o=a.getName()+"("+a.getParameterAt(0).getValue()+","+a.getParameterAt(1).getValue()+","+a.getParameterAt(2).getValue()+","+a.getParameterAt(3).getValue()+")";break;default:return}if(!Plotter.drawString(c,o,m)){return}var l=r.getSelectedIndex();if(l<0){return}var j,p,g,h;var f,d=a.getOutputCount();for(f=0;f<d;f++){j=a.getOutputAt(f);p=j.execute(l);if(isNaN(p)){continue}g="  "+j.getName()+": "+p;h=j.getColor();if(h===undefined){h=Theme.Color.Indicator0+f}c.fillStyle=k.getColor(h);if(!Plotter.drawString(c,g,m)){return}}};var MinMaxPlotter=create_class(NamedObject);MinMaxPlotter.prototype.__construct=function(a){MinMaxPlotter.__super.__construct.call(this,a)};MinMaxPlotter.prototype.Draw=function(b){var j=ChartManager.getInstance();var d=j.getDataSource(this.getDataSourceName());if(d.getDataCount()<1){return}var k=j.getTimeline(this.getDataSourceName());if(k.getInnerWidth()<k.getColumnWidth()){return}var i=j.getRange(this.getAreaName());if(i.getRange()==0){return}var f=j.getDataProvider(this.getAreaName()+".main");var h=k.getFirstIndex();var a=(h+k.getLastIndex())>>1;var g=j.getTheme(this.getFrameName());b.font=g.getFont(Theme.Font.Default);b.textBaseline="middle";b.fillStyle=g.getColor(Theme.Color.Text4);b.strokeStyle=g.getColor(Theme.Color.Text4);var c=d.getDecimalDigits();this.drawMark(b,f.getMinValue(),c,i.toY(f.getMinValue()),h,a,f.getMinValueIndex(),k);this.drawMark(b,f.getMaxValue(),c,i.toY(f.getMaxValue()),h,a,f.getMaxValueIndex(),k)};MinMaxPlotter.prototype.drawMark=function(d,l,f,k,h,a,i,m){var g,c,b;var j;if(i>a){d.textAlign="right";g=m.toItemCenter(i)-4;c=g-7;b=g-3;j=c-4}else{d.textAlign="left";g=m.toItemCenter(i)+4;c=g+7;b=g+3;j=c+4}Plotter.drawLine(d,g,k,c,k);Plotter.drawLine(d,g,k,b,k+2);Plotter.drawLine(d,g,k,b,k-2);d.fillText(String.fromFloat(l,f),j,k)};var TimelinePlotter=create_class(Plotter);TimelinePlotter.prototype.__construct=function(a){TimelinePlotter.__super.__construct.call(this,a)};TimelinePlotter.TP_MINUTE=60*1000;TimelinePlotter.TP_HOUR=60*TimelinePlotter.TP_MINUTE;TimelinePlotter.TP_DAY=24*TimelinePlotter.TP_HOUR;TimelinePlotter.TIME_INTERVAL=[5*TimelinePlotter.TP_MINUTE,10*TimelinePlotter.TP_MINUTE,15*TimelinePlotter.TP_MINUTE,30*TimelinePlotter.TP_MINUTE,TimelinePlotter.TP_HOUR,2*TimelinePlotter.TP_HOUR,3*TimelinePlotter.TP_HOUR,6*TimelinePlotter.TP_HOUR,12*TimelinePlotter.TP_HOUR,TimelinePlotter.TP_DAY,2*TimelinePlotter.TP_DAY];TimelinePlotter.MonthConvert={1:"Jan.",2:"Feb.",3:"Mar.",4:"Apr.",5:"May.",6:"Jun.",7:"Jul.",8:"Aug.",9:"Sep.",10:"Oct.",11:"Nov.",12:"Dec."};TimelinePlotter.prototype.Draw=function(b){var H=ChartManager.getInstance();var A=H.getArea(this.getAreaName());var f=H.getTimeline(this.getDataSourceName());if(!A.isChanged()&&!f.isUpdated()){return}var t=H.getDataSource(this.getDataSourceName());if(t.getDataCount()<2){return}var u=t.getDataAt(1).date-t.getDataAt(0).date;var v,y=TimelinePlotter.TIME_INTERVAL.length;for(v=0;v<y;v++){if(u<TimelinePlotter.TIME_INTERVAL[v]){break}}for(;v<y;v++){if(TimelinePlotter.TIME_INTERVAL[v]%u==0){if((TimelinePlotter.TIME_INTERVAL[v]/u)*f.getColumnWidth()>60){break}}}var j=f.getFirstIndex();var l=f.getLastIndex();var B=new Date();var c=B.getTimezoneOffset()*60*1000;var D=H.getTheme(this.getFrameName());b.font=D.getFont(Theme.Font.Default);b.textAlign="center";b.textBaseline="middle";var J=H.getLanguage();var k=[];var r=A.getTop();var I=A.getMiddle();for(var z=j;z<l;z++){var G=t.getDataAt(z).date;var a=G-c;var h=new Date(G);var p=h.getFullYear();var F=h.getMonth()+1;var C=h.getDate();var g=h.getHours();var s=h.getMinutes();var q="";if(v<y){var w=Math.max(TimelinePlotter.TP_DAY,TimelinePlotter.TIME_INTERVAL[v]);if(a%w==0){if(J=="zh-cn"){q=F.toString()+"月"+C.toString()+"日"}else{if(J=="zh-tw"){q=F.toString()+"月"+C.toString()+"日"}else{if(J=="en-us"){q=TimelinePlotter.MonthConvert[F]+" "+C.toString()}}}b.fillStyle=D.getColor(Theme.Color.Text4)}else{if(a%TimelinePlotter.TIME_INTERVAL[v]==0){var E=s.toString();if(s<10){E="0"+E}q=g.toString()+":"+E;b.fillStyle=D.getColor(Theme.Color.Text2)}}}else{if(C==1&&(g<(u/TimelinePlotter.TP_HOUR))){if(F==1){q=p.toString();if(J=="zh-cn"){q+="年"}else{if(J=="zh-tw"){q+="年"}}}else{if(J=="zh-cn"){q=F.toString()+"月"}else{if(J=="zh-tw"){q=F.toString()+"月"}else{if(J=="en-us"){q=TimelinePlotter.MonthConvert[F]}}}}b.fillStyle=D.getColor(Theme.Color.Text4)}}if(q.length>0){var o=f.toItemCenter(z);k.push({x:o,y:r,w:1,h:4});b.fillText(q,o,I)}}if(k.length>0){b.fillStyle=D.getColor(Theme.Color.Grid1);Plotter.createRectangles(b,k);b.fill()}};var RangePlotter=create_class(NamedObject);RangePlotter.prototype.__construct=function(a){RangePlotter.__super.__construct.call(this,a)};RangePlotter.prototype.getRequiredWidth=function(b,a){var c=ChartManager.getInstance();var d=c.getTheme(this.getFrameName());b.font=d.getFont(Theme.Font.Default);return b.measureText((Math.floor(a)+0.88).toString()).width+16};RangePlotter.prototype.Draw=function(c){var q=ChartManager.getInstance();var i=this.getAreaName();var b=q.getArea(i);var o=i.substring(0,i.lastIndexOf("Range"));var j=q.getRange(o);if(j.getRange()==0){return}var k=j.getNameObject().getCompAt(2)=="main";if(k){}else{if(!b.isChanged()&&!j.isUpdated()){return}}var m=j.getGradations();if(m.length==0){return}var f=b.getLeft();var p=b.getRight();var a=b.getCenter();var h=q.getTheme(this.getFrameName());c.font=h.getFont(Theme.Font.Default);c.textAlign="center";c.textBaseline="middle";c.fillStyle=h.getColor(Theme.Color.Text2);var g=[];for(var d in m){var l=j.toY(m[d]);g.push({x:f,y:l,w:6,h:1});g.push({x:p-6,y:l,w:6,h:1});c.fillText(String.fromFloat(m[d],2),a,l)}if(g.length>0){c.fillStyle=h.getColor(Theme.Color.Grid1);Plotter.createRectangles(c,g);c.fill()}};var COrderGraphPlotter=create_class(NamedObject);COrderGraphPlotter.prototype.__construct=function(a){COrderGraphPlotter.__super.__construct.call(this,a)};COrderGraphPlotter.prototype.Draw=function(a){return this._Draw_(a)};COrderGraphPlotter.prototype._Draw_=function(a){if(this.Update()==false){return}if(this.updateData()==false){return}this.m_top=this.m_pArea.getTop();
    this.m_bottom=this.m_pArea.getBottom();this.m_left=this.m_pArea.getLeft();this.m_right=this.m_pArea.getRight();a.save();a.rect(this.m_left,this.m_top,this.m_right-this.m_left,this.m_bottom-this.m_top);a.clip();var c=ChartManager.getInstance().getChart()._depthData;this.x_offset=0;this.y_offset=0;var b={};var d={};b.x=this.m_left+c.array[this.m_ask_si].amounts*this.m_Step;b.y=this.m_pRange.toY(c.array[this.m_ask_si].rate);d.x=this.m_left+c.array[this.m_bid_si].amounts*this.m_Step;d.y=this.m_pRange.toY(c.array[this.m_bid_si].rate);if(Math.abs(b.y-d.y)<1){this.y_offset=1}this.x_offset=1;this.DrawBackground(a);this.UpdatePoints();this.FillBlack(a);this.DrawGradations(a);this.DrawLine(a);a.restore()};COrderGraphPlotter.prototype.DrawBackground=function(b){b.fillStyle=this.m_pTheme.getColor(Theme.Color.Background);b.fillRect(this.m_left,this.m_top,this.m_right-this.m_left,this.m_bottom-this.m_top);var c=ChartManager.getInstance().getChart()._depthData;if(this.m_mode==0){var g=this.m_pRange.toY(c.array[this.m_ask_si].rate)-this.y_offset;var a=this.m_pRange.toY(c.array[this.m_bid_si].rate)+this.y_offset;var f=b.createLinearGradient(this.m_left,0,this.m_right,0);f.addColorStop(0,this.m_pTheme.getColor(Theme.Color.Background));f.addColorStop(1,this.m_pTheme.getColor(Theme.Color.PositiveDark));b.fillStyle=f;b.fillRect(this.m_left,this.m_top,this.m_right-this.m_left,g-this.m_top);var d=b.createLinearGradient(this.m_left,0,this.m_right,0);d.addColorStop(0,this.m_pTheme.getColor(Theme.Color.Background));d.addColorStop(1,this.m_pTheme.getColor(Theme.Color.NegativeDark));b.fillStyle=d;b.fillRect(this.m_left,a,this.m_right-this.m_left,this.m_bottom-a)}else{if(this.m_mode==1){var f=b.createLinearGradient(this.m_left,0,this.m_right,0);f.addColorStop(0,this.m_pTheme.getColor(Theme.Color.Background));f.addColorStop(1,this.m_pTheme.getColor(Theme.Color.PositiveDark));b.fillStyle=f;b.fillRect(this.m_left,this.m_top,this.m_right-this.m_left,this.m_bottom-this.m_top)}else{if(this.m_mode==2){var d=b.createLinearGradient(this.m_left,0,this.m_right,0);d.addColorStop(0,this.m_pTheme.getColor(Theme.Color.Background));d.addColorStop(1,this.m_pTheme.getColor(Theme.Color.NegativeDark));b.fillStyle=d;b.fillRect(this.m_left,this.m_top,this.m_right-this.m_left,this.m_bottom-this.m_top)}}}};COrderGraphPlotter.prototype.DrawLine=function(b){if(this.m_mode==0||this.m_mode==1){b.strokeStyle=this.m_pTheme.getColor(Theme.Color.Positive);b.beginPath();b.moveTo(Math.floor(this.m_ask_points[0].x)+0.5,Math.floor(this.m_ask_points[0].y)+0.5);for(var a=1;a<this.m_ask_points.length;a++){b.lineTo(Math.floor(this.m_ask_points[a].x)+0.5,Math.floor(this.m_ask_points[a].y)+0.5)}b.stroke()}if(this.m_mode==0||this.m_mode==2){b.strokeStyle=this.m_pTheme.getColor(Theme.Color.Negative);b.beginPath();b.moveTo(this.m_bid_points[0].x+0.5,this.m_bid_points[0].y+0.5);for(var a=1;a<this.m_bid_points.length;a++){b.lineTo(this.m_bid_points[a].x+0.5,this.m_bid_points[a].y+0.5)}b.stroke()}};COrderGraphPlotter.prototype.UpdatePoints=function(){var g=ChartManager.getInstance().getChart()._depthData;this.m_ask_points=[];var h={};h.x=Math.floor(this.m_left);h.y=Math.floor(this.m_pRange.toY(g.array[this.m_ask_si].rate)-this.y_offset);this.m_ask_points.push(h);var b=0;for(var f=this.m_ask_si;f>=this.m_ask_ei;f--){var a={};var j={};if(f==this.m_ask_si){a.x=Math.floor(this.m_left+g.array[f].amounts*this.m_Step+this.x_offset);a.y=Math.floor(this.m_pRange.toY(g.array[f].rate)-this.y_offset);this.m_ask_points.push(a);b=1}else{a.x=Math.floor(this.m_left+g.array[f].amounts*this.m_Step+this.x_offset);a.y=Math.floor(this.m_ask_points[b].y);j.x=Math.floor(a.x);j.y=Math.floor(this.m_pRange.toY(g.array[f].rate)-this.y_offset);this.m_ask_points.push(a);b++;this.m_ask_points.push(j);b++}}this.m_bid_points=[];var c={};c.x=Math.floor(this.m_left);c.y=Math.ceil(this.m_pRange.toY(g.array[this.m_bid_si].rate)+this.y_offset);this.m_bid_points.push(c);var d=0;for(var f=this.m_bid_si;f<=this.m_bid_ei;f++){var a={};var j={};if(f==this.m_bid_si){a.x=Math.floor(this.m_left+g.array[f].amounts*this.m_Step+this.x_offset);a.y=Math.ceil(this.m_pRange.toY(g.array[f].rate)+this.y_offset);this.m_bid_points.push(a);d=1}else{a.x=Math.floor(this.m_left+g.array[f].amounts*this.m_Step+this.x_offset);a.y=Math.ceil(this.m_bid_points[d].y);j.x=Math.floor(a.x);j.y=Math.ceil(this.m_pRange.toY(g.array[f].rate)+this.x_offset);this.m_bid_points.push(a);d++;this.m_bid_points.push(j);d++}}};COrderGraphPlotter.prototype.updateData=function(){var d=ChartManager.getInstance().getChart()._depthData;if(d.array==null){return false}if(d.array.length<=50){return false}var a=this.m_pRange.getOuterMinValue();var b=this.m_pRange.getOuterMaxValue();this.m_ask_si=d.asks_si;this.m_ask_ei=d.asks_si;for(var c=d.asks_si;c>=d.asks_ei;c--){if(d.array[c].rate<b){this.m_ask_ei=c}else{break}}this.m_bid_si=d.bids_si;this.m_bid_ei=d.bids_si;for(var c=d.bids_si;c<=d.bids_ei;c++){if(d.array[c].rate>a){this.m_bid_ei=c}else{break}}if(this.m_ask_ei==this.m_ask_si){this.m_mode=2}else{if(this.m_bid_ei==this.m_bid_si){this.m_mode=1}else{this.m_mode=0}}this.m_Step=this.m_pArea.getWidth();if(this.m_mode==0){if(this.m_ask_ei==d.asks_ei&&this.m_bid_ei==d.bids_ei){this.m_Step/=Math.min(d.array[this.m_ask_ei].amounts,d.array[this.m_bid_ei].amounts)}else{if(this.m_ask_ei!=d.asks_ei&&this.m_bid_ei==d.bids_ei){this.m_Step/=d.array[this.m_bid_ei].amounts}else{if(this.m_ask_ei==d.asks_ei&&this.m_bid_ei!=d.bids_ei){this.m_Step/=d.array[this.m_ask_ei].amounts}else{if(this.m_ask_ei!=d.asks_ei&&this.m_bid_ei!=d.bids_ei){this.m_Step/=Math.max(d.array[this.m_ask_ei].amounts,d.array[this.m_bid_ei].amounts)}}}}}else{if(this.m_mode==1){this.m_Step/=d.array[this.m_ask_ei].amounts}else{if(this.m_mode==2){this.m_Step/=d.array[this.m_bid_ei].amounts}}}return true};COrderGraphPlotter.prototype.Update=function(){this.m_pMgr=ChartManager.getInstance();var b=this.getAreaName();this.m_pArea=this.m_pMgr.getArea(b);if(this.m_pArea==null){return false}var a=b.substring(0,b.lastIndexOf("Range"));this.m_pRange=this.m_pMgr.getRange(a);if(this.m_pRange==null||this.m_pRange.getRange()==0){return false}this.m_pTheme=this.m_pMgr.getTheme(this.getFrameName());if(this.m_pTheme==null){return false}return true};COrderGraphPlotter.prototype.DrawGradations=function(b){var o=ChartManager.getInstance();var h=this.getAreaName();var a=o.getArea(h);var l=h.substring(0,h.lastIndexOf("Range"));var i=o.getRange(l);if(i.getRange()==0){return}var k=i.getGradations();if(k.length==0){return}var d=a.getLeft();var m=a.getRight();var f=[];for(var c in k){var j=i.toY(k[c]);f.push({x:d,y:j,w:6,h:1});f.push({x:m-6,y:j,w:6,h:1})}if(f.length>0){var g=o.getTheme(this.getFrameName());b.fillStyle=g.getColor(Theme.Color.Grid1);Plotter.createRectangles(b,f);b.fill()}};COrderGraphPlotter.prototype.FillBlack=function(g){var c=this.m_ask_points;var h=this.m_bid_points;var a={};var d={};a.x=this.m_right;a.y=c[0].y;d.x=this.m_right;d.y=c[c.length-1].y;var j={};var b={};j.x=this.m_right;j.y=h[0].y-1;b.x=this.m_right;b.y=h[h.length-1].y;c.unshift(a);c.push(d);h.unshift(j);h.push(b);g.fillStyle=this.m_pTheme.getColor(Theme.Color.Background);g.beginPath();g.moveTo(Math.floor(c[0].x)+0.5,Math.floor(c[0].y)+0.5);for(var f=1;f<c.length;f++){g.lineTo(Math.floor(c[f].x)+0.5,Math.floor(c[f].y)+0.5)}g.fill();g.beginPath();g.moveTo(Math.floor(h[0].x)+0.5,Math.floor(h[0].y)+0.5);for(var f=1;f<h.length;f++){g.lineTo(Math.floor(h[f].x)+0.5,Math.floor(h[f].y)+0.5)}g.fill();c.shift();c.pop();h.shift();h.pop()};COrderGraphPlotter.prototype.DrawTickerGraph=function(c){return;var k=ChartManager.getInstance();var d=k.getDataSource(this.getDataSourceName());var j=d._dataItems[d._dataItems.length-1].close;var b=this.m_left+1;var a=this.m_pRange.toY(j);var i=b+5;var h=a+2.5;var g=b+5;var f=a-2.5;c.fillStyle=this.m_pTheme.getColor(Theme.Color.Mark);c.strokeStyle=this.m_pTheme.getColor(Theme.Color.Mark)};var LastVolumePlotter=create_class(Plotter);LastVolumePlotter.prototype.__construct=function(a){LastVolumePlotter.__super.__construct.call(this,a)};LastVolumePlotter.prototype.Draw=function(b){var l=ChartManager.getInstance();var m=l.getTimeline(this.getDataSourceName());var g=this.getAreaName();var a=l.getArea(g);var j=g.substring(0,g.lastIndexOf("Range"));var h=l.getRange(j);if(h.getRange()==0){return}var c=l.getDataSource(this.getDataSourceName());if(c.getDataCount()<1){return}var f=l.getTheme(this.getFrameName());b.font=f.getFont(Theme.Font.Default);b.textAlign="left";b.textBaseline="middle";b.fillStyle=f.getColor(Theme.Color.RangeMark);b.strokeStyle=f.getColor(Theme.Color.RangeMark);var k=c.getDataAt(c.getDataCount()-1).volume;var i=h.toY(k);var d=a.getLeft()+1;Plotter.drawLine(b,d,i,d+7,i);Plotter.drawLine(b,d,i,d+3,i+2);Plotter.drawLine(b,d,i,d+3,i-2);b.fillText(String.fromFloat(k,2),d+10,i)};var LastClosePlotter=create_class(Plotter);LastClosePlotter.prototype.__construct=function(a){LastClosePlotter.__super.__construct.call(this,a)};LastClosePlotter.prototype.Draw=function(b){var l=ChartManager.getInstance();var m=l.getTimeline(this.getDataSourceName());var g=this.getAreaName();var a=l.getArea(g);var j=g.substring(0,g.lastIndexOf("Range"));var h=l.getRange(j);if(h.getRange()==0){return}var c=l.getDataSource(this.getDataSourceName());if(c.getDataCount()<1){return}var k=c._dataItems[c._dataItems.length-1].close;if(k<=h.getMinValue()||k>=h.getMaxValue()){return}var f=l.getTheme(this.getFrameName());b.font=f.getFont(Theme.Font.Default);b.textAlign="left";b.textBaseline="middle";b.fillStyle=f.getColor(Theme.Color.RangeMark);b.strokeStyle=f.getColor(Theme.Color.RangeMark);var i=h.toY(k);var d=a.getLeft()+1;Plotter.drawLine(b,d,i,d+7,i);Plotter.drawLine(b,d,i,d+3,i+2);Plotter.drawLine(b,d,i,d+3,i-2);b.fillText(String.fromFloat(k,c.getDecimalDigits()),d+10,i)};var SelectionPlotter=create_class(Plotter);SelectionPlotter.prototype.__construct=function(a){SelectionPlotter.__super.__construct.call(this,a)};SelectionPlotter.prototype.Draw=function(c){var g=ChartManager.getInstance();
    if(g._drawingTool!=ChartManager.DrawingTool.CrossCursor){return}var f=g.getArea(this.getAreaName());var d=g.getTimeline(this.getDataSourceName());if(d.getSelectedIndex()<0){return}var b=g.getRange(this.getAreaName());var h=g.getTheme(this.getFrameName());c.strokeStyle=h.getColor(Theme.Color.Cursor);var a=d.toItemCenter(d.getSelectedIndex());Plotter.drawLine(c,a,f.getTop()-1,a,f.getBottom());var i=b.getSelectedPosition();if(i>=0){Plotter.drawLine(c,f.getLeft(),i,f.getRight(),i)}};var TimelineSelectionPlotter=create_class(NamedObject);TimelineSelectionPlotter.MonthConvert={1:"Jan.",2:"Feb.",3:"Mar.",4:"Apr.",5:"May.",6:"Jun.",7:"Jul.",8:"Aug.",9:"Sep.",10:"Oct.",11:"Nov.",12:"Dec."};TimelineSelectionPlotter.prototype.__construct=function(a){TimelineSelectionPlotter.__super.__construct.call(this,a)};TimelineSelectionPlotter.prototype.Draw=function(b){var t=ChartManager.getInstance();var n=t.getArea(this.getAreaName());var d=t.getTimeline(this.getDataSourceName());if(d.getSelectedIndex()<0){return}var l=t.getDataSource(this.getDataSourceName());if(!is_instance(l,MainDataSource)){return}var o=t.getTheme(this.getFrameName());var u=t.getLanguage();var i=d.toItemCenter(d.getSelectedIndex());b.fillStyle=o.getColor(Theme.Color.Background);b.fillRect(i-52.5,n.getTop()+2.5,106,18);b.strokeStyle=o.getColor(Theme.Color.Grid3);b.strokeRect(i-52.5,n.getTop()+2.5,106,18);b.font=o.getFont(Theme.Font.Default);b.textAlign="center";b.textBaseline="middle";b.fillStyle=o.getColor(Theme.Color.Text4);var h=new Date(l.getDataAt(d.getSelectedIndex()).date);var r=h.getMonth()+1;var p=h.getDate();var g=h.getHours();var k=h.getMinutes();var s=h.getSeconds();var a=r.toString();var f=p.toString();var m=g.toString();var q=k.toString();var c=s.toString();if(k<10){q="0"+q}if(s<10){c="0"+c}var j="";if(u=="zh-cn"){j=a+"月"+f+"日  "+m+":"+q}else{if(u=="zh-tw"){j=a+"月"+f+"日  "+m+":"+q}else{if(u=="en-us"){j=TimelineSelectionPlotter.MonthConvert[r]+" "+f+"  "+m+":"+q}}}if(KlineIns.range<60000){j+=":"+c}b.fillText(j,i,n.getMiddle())};var RangeSelectionPlotter=create_class(NamedObject);RangeSelectionPlotter.prototype.__construct=function(a){RangeSelectionPlotter.__super.__construct.call(this,a)};RangeSelectionPlotter.prototype.Draw=function(b){var k=ChartManager.getInstance();var f=this.getAreaName();var a=k.getArea(f);var l=k.getTimeline(this.getDataSourceName());if(l.getSelectedIndex()<0){return}var i=f.substring(0,f.lastIndexOf("Range"));var g=k.getRange(i);if(g.getRange()==0||g.getSelectedPosition()<0){return}var j=g.getSelectedValue();if(j==-Number.MAX_VALUE){return}var h=g.getSelectedPosition();Plotter.createPolygon(b,[{"x":a.getLeft(),"y":h},{"x":a.getLeft()+5,"y":h+10},{"x":a.getRight()-3,"y":h+10},{"x":a.getRight()-3,"y":h-10},{"x":a.getLeft()+5,"y":h-10}]);var d=k.getTheme(this.getFrameName());b.fillStyle=d.getColor(Theme.Color.Background);b.fill();b.strokeStyle=d.getColor(Theme.Color.Grid4);b.stroke();b.font=d.getFont(Theme.Font.Default);b.textAlign="center";b.textBaseline="middle";b.fillStyle=d.getColor(Theme.Color.Text3);var c=2;if(g.getNameObject().getCompAt(2)=="main"){c=k.getDataSource(this.getDataSourceName()).getDecimalDigits()}b.fillText(String.fromFloat(j,c),a.getCenter(),h)};var ChartSettings={};ChartSettings.checkVersion=function(){if(ChartSettings._data.ver<2){ChartSettings._data.ver=2;var a=ChartSettings._data.charts;a.period_weight={};a.period_weight["line"]=8;a.period_weight["1min"]=7;a.period_weight["5min"]=6;a.period_weight["15min"]=5;a.period_weight["30min"]=4;a.period_weight["1hour"]=3;a.period_weight["1day"]=2;a.period_weight["1week"]=1;a.period_weight["3min"]=0;a.period_weight["2hour"]=0;a.period_weight["4hour"]=0;a.period_weight["6hour"]=0;a.period_weight["12hour"]=0;a.period_weight["3day"]=0}if(ChartSettings._data.ver<3){ChartSettings._data.ver=3;var a=ChartSettings._data.charts;a.areaHeight=[]}};ChartSettings.get=function(){if(ChartSettings._data==undefined){ChartSettings.init();ChartSettings.load();ChartSettings.checkVersion()}return ChartSettings._data};ChartSettings.init=function(){var g={};var m=new Array("MA","EMA","VOLUME","MACD","KDJ","StochRSI","RSI","DMI","OBV","BOLL","DMA","TRIX","BRAR","VR","EMV","WR","ROC","MTM","PSY");for(var h=0;h<m.length;h++){var n=ChartManager.getInstance().createIndicatorAndRange("",m[h],true);if(n==null){continue}g[m[h]]=[];var b=n.indic.getParameters();for(var f=0;f<b.length;f++){g[m[h]].push(b[f])}}var k="CandleStick";var c="MA";var a=new Array("VOLUME","MACD");var l="15m";var d={};d.chartStyle=k;d.mIndic=c;d.indics=a;d.indicsStatus="open";d.period=l;ChartSettings._data={ver:1,charts:d,indics:g,theme:"Dark"};ChartSettings.checkVersion()};ChartSettings.load=function(){if(document.cookie.length<=0){return}var c=document.cookie.indexOf("chartSettings=");if(c<0){return}c+="chartSettings=".length;var a=document.cookie.indexOf(";",c);if(a<0){a=document.cookie.length}var b=unescape(document.cookie.substring(c,a));ChartSettings._data=JSON.parse(b)};ChartSettings.save=function(){var a=new Date();a.setDate(a.getDate()+2);document.cookie="chartSettings="+escape(JSON.stringify(ChartSettings._data))+";expires="+a.toGMTString()};var CPoint=create_class(NamedObject);CPoint.state={Hide:0,Show:1,Highlight:2};CPoint.prototype.__construct=function(a){CPoint.__super.__construct.call(this,a);this.pos={index:-1,value:-1};this.state=CPoint.state.Hide};CPoint.prototype.getChartObjects=function(){var b=ChartManager.getInstance();var d=b.getDataSource("frame0.k0");if(d==null||!is_instance(d,MainDataSource)){return null}var c=b.getTimeline("frame0.k0");if(c==null){return null}var a=b.getRange("frame0.k0.main");if(a==null){return null}return{pMgr:b,pCDS:d,pTimeline:c,pRange:a}};CPoint.prototype.setPosXY=function(b,g){var f=this.getChartObjects();var d=f.pTimeline.toIndex(b);var c=f.pRange.toValue(g);var a=this.snapValue(d,c);if(a!=null){c=a}this.setPosIV(d,c)};CPoint.prototype.setPosXYNoSnap=function(a,f){var d=this.getChartObjects();var c=d.pTimeline.toIndex(a);var b=d.pRange.toValue(f);this.setPosIV(c,b)};CPoint.prototype.setPosIV=function(b,a){this.pos={index:b,value:a}};CPoint.prototype.getPosXY=function(){var c=this.getChartObjects();var b=c.pTimeline.toItemCenter(this.pos.index);var a=c.pRange.toY(this.pos.value);return{x:b,y:a}};CPoint.prototype.getPosIV=function(){return{i:this.pos.index,v:this.pos.value}};CPoint.prototype.setState=function(a){this.state=a};CPoint.prototype.getState=function(){return this.state};CPoint.prototype.isSelected=function(a,c){var b=this.getPosXY();if(a<b.x-4||a>b.x+4||c<b.y-4||c>b.y+4){return false}this.setState(CPoint.state.Highlight);return true};CPoint.prototype.snapValue=function(p,k){var l=this.getChartObjects();var j=null;var c=Math.floor(l.pTimeline.getFirstIndex());var f=Math.floor(l.pTimeline.getLastIndex());if(p<c||p>f){return j}var g=l.pRange.toY(k);var d=l.pCDS.getDataAt(p);if(d==null||d==undefined){return j}var q=null;if(p>0){q=l.pCDS.getDataAt(p-1)}else{q=l.pCDS.getDataAt(p)}var b=l.pMgr.getChartStyle(l.pCDS.getFrameName());var m=l.pRange.toY(d.open);var h=l.pRange.toY(d.high);var s=l.pRange.toY(d.low);var n=l.pRange.toY(d.close);if(b==="CandleStickHLC"){m=l.pRange.toY(q.close)}var r=Math.abs(m-g);var o=Math.abs(h-g);var t=Math.abs(s-g);var a=Math.abs(n-g);if(r<=o&&r<=t&&r<=a){if(r<6){j=d.open}}if(o<=r&&o<=t&&o<=a){if(o<6){j=d.high}}if(t<=r&&t<=o&&t<=a){if(t<6){j=d.low}}if(a<=r&&a<=o&&a<=t){if(a<6){j=d.close}}return j};var CToolObject=create_class(NamedObject);CToolObject.state={BeforeDraw:0,Draw:1,AfterDraw:2};CToolObject.prototype.__construct=function(a){CToolObject.__super.__construct.call(this,a);this.drawer=null;this.state=CToolObject.state.BeforeDraw;this.points=[];this.step=0};CToolObject.prototype.getChartObjects=function(){var c=ChartManager.getInstance();var f=c.getDataSource("frame0.k0");if(f==null||!is_instance(f,MainDataSource)){return null}var d=c.getTimeline("frame0.k0");if(d==null){return null}var a=c.getArea("frame0.k0.main");if(a==null){return null}var b=c.getRange("frame0.k0.main");if(b==null){return null}return{pMgr:c,pCDS:f,pTimeline:d,pArea:a,pRange:b}};CToolObject.prototype.isValidMouseXY=function(a,d){var b=this.getChartObjects();var c={left:b.pArea.getLeft(),top:b.pArea.getTop(),right:b.pArea.getRight(),bottom:b.pArea.getBottom()};if(a<c.left||a>c.right||d<c.top||d>c.bottom){return false}return true};CToolObject.prototype.getPlotter=function(){return this.drawer};CToolObject.prototype.setState=function(a){this.state=a};CToolObject.prototype.getState=function(){return this.state};CToolObject.prototype.addPoint=function(a){this.points.push(a)};CToolObject.prototype.getPoint=function(a){return this.points[a]};CToolObject.prototype.acceptMouseMoveEvent=function(a,b){if(this.isValidMouseXY(a,b)==false){return false}if(this.state==CToolObject.state.BeforeDraw){this.setBeforeDrawPos(a,b)}else{if(this.state==CToolObject.state.Draw){this.setDrawPos(a,b)}else{if(this.state==CToolObject.state.AfterDraw){this.setAfterDrawPos(a,b)}}}return true};CToolObject.prototype.acceptMouseDownEvent=function(a,b){if(this.isValidMouseXY(a,b)==false){return false}if(this.state==CToolObject.state.BeforeDraw){this.setDrawPos(a,b);this.setState(CToolObject.state.Draw)}else{if(this.state==CToolObject.state.Draw){this.setAfterDrawPos(a,b);if(this.step==0){this.setState(CToolObject.state.AfterDraw)}}else{if(this.state==CToolObject.state.AfterDraw){if(CToolObject.prototype.isSelected.call(this,a,b)){this.setDrawPos(a,b);this.setState(CToolObject.state.Draw)}else{this.oldx=a;this.oldy=b}}}}return true};CToolObject.prototype.acceptMouseDownMoveEvent=function(h,f){if(this.isValidMouseXY(h,f)==false){return false}if(this.state==CToolObject.state.Draw){this.setDrawPos(h,f)}else{if(this.state==CToolObject.state.AfterDraw){var a=this.getChartObjects();var b=a.pTimeline.getItemWidth();var c=a.pRange;if(Math.abs(h-this.oldx)<b&&Math.abs(f-this.oldy)==0){return true}var j=a.pTimeline.toIndex(this.oldx);var g=a.pRange.toValue(this.oldy);var k=a.pTimeline.toIndex(h);var i=a.pRange.toValue(f);
    this.oldx=h;this.oldy=f;var m=k-j;var l=i-g;for(var d in this.points){this.points[d].pos.index+=m;this.points[d].pos.value+=l}}}return true};CToolObject.prototype.acceptMouseUpEvent=function(a,b){if(this.isValidMouseXY(a,b)==false){return false}if(this.state==CToolObject.state.Draw){this.setAfterDrawPos(a,b);if(this.step==0){this.setState(CToolObject.state.AfterDraw)}return true}return false};CToolObject.prototype.setBeforeDrawPos=function(a,c){for(var b in this.points){this.points[b].setPosXY(a,c);this.points[b].setState(CPoint.state.Show)}};CToolObject.prototype.setDrawPos=function(a,c){for(var b in this.points){if(this.points[b].getState()==CPoint.state.Highlight){this.points[b].setPosXY(a,c)}}};CToolObject.prototype.setAfterDrawPos=function(a,d){if(this.step!=0){this.step-=1}for(var b in this.points){this.points[b].setState(CPoint.state.Hide)}if(this.step==0){var c=this.getChartObjects();c.pMgr.setNormalMode()}};CToolObject.prototype.isSelected=function(a,d){var c=false;for(var b in this.points){if(this.points[b].isSelected(a,d)){this.points[b].setState(CPoint.state.Highlight);c=true;break}}if(c==true){this.select();return true}return false};CToolObject.prototype.select=function(){for(var a in this.points){if(this.points[a].getState()==CPoint.state.Hide){this.points[a].setState(CPoint.state.Show)}}};CToolObject.prototype.unselect=function(){for(var a in this.points){if(this.points[a].getState()!=CPoint.state.Hide){this.points[a].setState(CPoint.state.Hide)}}};CToolObject.prototype.calcDistance=function(m,j,h){var a=m.getPosXY().x;var k=m.getPosXY().y;var p=j.getPosXY().x;var i=j.getPosXY().y;var o=h.getPosXY().x;var g=h.getPosXY().y;var d=a-o;var b=k-g;var n=p-o;var l=i-g;var c=Math.abs(d*l-b*n);var f=Math.sqrt(Math.pow((p-a),2)+Math.pow((i-k),2));return c/f};CToolObject.prototype.calcGap=function(b,n,l){var a=b.sx;var j=b.sy;var p=b.ex;var i=b.ey;var o=n;var h=l;var f=a-o;var c=j-h;var m=p-o;var k=i-h;var d=Math.abs(f*k-c*m);var g=Math.sqrt(Math.pow((p-a),2)+Math.pow((i-j),2));return d/g};CToolObject.prototype.isWithRect=function(h,d,c){var i=h.getPosXY().x;var g=h.getPosXY().y;var b=d.getPosXY().x;var a=d.getPosXY().y;var j=c.getPosXY().x;var f=c.getPosXY().y;if(i>b){i+=4;b-=4}else{i-=4;b+=4}if(g>a){g+=4;a-=4}else{g-=4;a+=4}if(i<=j&&b>=j&&g<=f&&a>=f){return true}if(i>=j&&b<=j&&g<=f&&a>=f){return true}if(i<=j&&b>=j&&g>=f&&a<=f){return true}if(i>=j&&b<=j&&g>=f&&a<=f){return true}return false};var CBiToolObject=create_class(CToolObject);CBiToolObject.prototype.__construct=function(a){CBiToolObject.__super.__construct.call(this,a);this.addPoint(new CPoint(a));this.addPoint(new CPoint(a))};CBiToolObject.prototype.setBeforeDrawPos=function(a,b){this.step=1;CBiToolObject.__super.setBeforeDrawPos.call(this,a,b);this.getPoint(0).setState(CPoint.state.Show);this.getPoint(1).setState(CPoint.state.Highlight)};var CTriToolObject=create_class(CToolObject);CTriToolObject.prototype.__construct=function(a){CTriToolObject.__super.__construct.call(this,a);this.addPoint(new CPoint(a));this.addPoint(new CPoint(a));this.addPoint(new CPoint(a))};CTriToolObject.prototype.setBeforeDrawPos=function(a,b){this.step=2;CBiToolObject.__super.setBeforeDrawPos.call(this,a,b);this.getPoint(0).setState(CPoint.state.Show);this.getPoint(1).setState(CPoint.state.Show);this.getPoint(2).setState(CPoint.state.Highlight)};CTriToolObject.prototype.setAfterDrawPos=function(a,d){if(this.step!=0){this.step-=1}if(this.step==0){for(var b in this.points){this.points[b].setState(CPoint.state.Hide)}}else{this.getPoint(0).setState(CPoint.state.Show);this.getPoint(1).setState(CPoint.state.Highlight);this.getPoint(2).setState(CPoint.state.Show)}if(this.step==0){var c=this.getChartObjects();c.pMgr.setNormalMode()}};var CBandLineObject=create_class(CBiToolObject);CBandLineObject.prototype.__construct=function(a){CBandLineObject.__super.__construct.call(this,a);this.drawer=new DrawBandLinesPlotter(a,this)};CBandLineObject.prototype.isSelected=function(m,j){if(CBandLineObject.__super.isSelected.call(this,m,j)==true){return true}var h=new CPoint("frame0.k0");h.setPosXY(m,j);var l=this.getPoint(0).getPosXY().x;var k=this.getPoint(0).getPosXY().y;var g=this.getPoint(1).getPosXY().x;var f=this.getPoint(1).getPosXY().y;var a=[100,87.5,75,62.5,50,37.5,25,12.5,0];for(var d=0;d<a.length;d++){var b=k+(100-a[d])/100*(f-k);if(b<j+4&&b>j-4){this.select();return true}}return false};var CBiParallelLineObject=create_class(CTriToolObject);CBiParallelLineObject.prototype.__construct=function(a){CBiParallelLineObject.__super.__construct.call(this,a);this.drawer=new DrawBiParallelLinesPlotter(a,this)};CBiParallelLineObject.prototype.isSelected=function(o,m){if(CTriParallelLineObject.__super.isSelected.call(this,o,m)==true){return true}var n=this.getPoint(0).getPosXY().x;var k=this.getPoint(0).getPosXY().y;var f=this.getPoint(1).getPosXY().x;var d=this.getPoint(1).getPosXY().y;var a=this.getPoint(2).getPosXY().x;var p=this.getPoint(2).getPosXY().y;var l={x:n-f,y:k-d};var j={x:n-a,y:k-p};var h={x:l.x+j.x,y:l.y+j.y};var i=n-h.x;var g=k-h.y;var c={sx:n,sy:k,ex:a,ey:p};var b={sx:f,sy:d,ex:i,ey:g};if(this.calcGap(c,o,m)>4&&this.calcGap(b,o,m)>4){return false}return true};var CBiParallelRayLineObject=create_class(CTriToolObject);CBiParallelRayLineObject.prototype.__construct=function(a){CBiParallelRayLineObject.__super.__construct.call(this,a);this.drawer=new DrawBiParallelRayLinesPlotter(a,this)};CBiParallelRayLineObject.prototype.isSelected=function(o,m){if(CTriParallelLineObject.__super.isSelected.call(this,o,m)==true){return true}var n=this.getPoint(0).getPosXY().x;var k=this.getPoint(0).getPosXY().y;var f=this.getPoint(1).getPosXY().x;var d=this.getPoint(1).getPosXY().y;var a=this.getPoint(2).getPosXY().x;var p=this.getPoint(2).getPosXY().y;var l={x:n-f,y:k-d};var j={x:n-a,y:k-p};var h={x:l.x+j.x,y:l.y+j.y};var i=n-h.x;var g=k-h.y;var c={sx:n,sy:k,ex:a,ey:p};var b={sx:f,sy:d,ex:i,ey:g};if((c.ex>c.sx&&o>c.sx-4)||(c.ex<c.sx&&o<c.sx+4)||(b.ex>b.sx&&o>b.sx-4)||(b.ex<b.sx&&o<b.sx+4)){if(this.calcGap(c,o,m)>4&&this.calcGap(b,o,m)>4){return false}}else{return false}this.select();return true};var CFibFansObject=create_class(CBiToolObject);CFibFansObject.prototype.__construct=function(a){CFibFansObject.__super.__construct.call(this,a);this.drawer=new DrawFibFansPlotter(a,this)};CFibFansObject.prototype.isSelected=function(j,h){if(CFibFansObject.__super.isSelected.call(this,j,h)==true){return true}var t=new CPoint("frame0.k0");t.setPosXY(j,h);var o=this.getPoint(0).getPosXY().x;var n=this.getPoint(0).getPosXY().y;var s=this.getPoint(1).getPosXY().x;var r=this.getPoint(1).getPosXY().y;var k=this.getChartObjects();var d={left:k.pArea.getLeft(),top:k.pArea.getTop(),right:k.pArea.getRight(),bottom:k.pArea.getBottom()};var g=[0,38.2,50,61.8];for(var q=0;q<g.length;q++){var p=n+(100-g[q])/100*(r-n);var m={x:o,y:n};var A={x:s,y:p};var f=getRectCrossPt(d,m,A);var z=Math.pow((f[0].x-o),2)+Math.pow((f[0].y-n),2);var w=Math.pow((f[0].x-s),2)+Math.pow((f[0].y-r),2);var l=z>w?{x:f[0].x,y:f[0].y}:{x:f[1].x,y:f[1].y};if(l.x>o&&j<o){continue}if(l.x<o&&j>o){continue}var v=new CPoint("frame0.k0");v.setPosXY(o,n);var u=new CPoint("frame0.k0");u.setPosXY(l.x,l.y);if(this.calcDistance(v,u,t)>4){continue}this.select();return true}return false};var CFibRetraceObject=create_class(CBiToolObject);CFibRetraceObject.prototype.__construct=function(a){CFibRetraceObject.__super.__construct.call(this,a);this.drawer=new DrawFibRetracePlotter(a,this)};CFibRetraceObject.prototype.isSelected=function(m,j){if(CFibRetraceObject.__super.isSelected.call(this,m,j)==true){return true}var h=new CPoint("frame0.k0");h.setPosXY(m,j);var l=this.getPoint(0).getPosXY().x;var k=this.getPoint(0).getPosXY().y;var g=this.getPoint(1).getPosXY().x;var f=this.getPoint(1).getPosXY().y;var a=[100,78.6,61.8,50,38.2,23.6,0];for(var d=0;d<a.length;d++){var b=k+(100-a[d])/100*(f-k);if(b<j+4&&b>j-4){this.select();return true}}return false};var CHoriRayLineObject=create_class(CBiToolObject);CHoriRayLineObject.prototype.__construct=function(a){CHoriRayLineObject.__super.__construct.call(this,a);this.drawer=new DrawHoriRayLinesPlotter(a,this)};CHoriRayLineObject.prototype.setDrawPos=function(a,b){if(this.points[0].getState()==CPoint.state.Highlight){this.points[0].setPosXY(a,b);this.points[1].setPosXYNoSnap(this.points[1].getPosXY().x,this.points[0].getPosXY().y);return}if(this.points[1].getState()==CPoint.state.Highlight){this.points[1].setPosXY(a,b);this.points[0].setPosXYNoSnap(this.points[0].getPosXY().x,this.points[1].getPosXY().y)}};CHoriRayLineObject.prototype.isSelected=function(a,h){if(CHoriRayLineObject.__super.isSelected.call(this,a,h)==true){return true}var g=new CPoint("frame0.k0");g.setPosXY(a,h);var d=this.getPoint(0).getPosXY().y;var f=this.getPoint(0).getPosXY().x;var b=this.getPoint(1).getPosXY().x;if(h>d+4||h<d-4){return false}if(b>f&&a<f-4){return false}if(b<f&&a>f+4){return false}this.select();return true};var CHoriSegLineObject=create_class(CBiToolObject);CHoriSegLineObject.prototype.__construct=function(a){CHoriSegLineObject.__super.__construct.call(this,a);this.drawer=new DrawHoriSegLinesPlotter(a,this)};CHoriSegLineObject.prototype.setDrawPos=function(a,b){if(this.points[0].getState()==CPoint.state.Highlight){this.points[0].setPosXY(a,b);this.points[1].setPosXYNoSnap(this.points[1].getPosXY().x,this.points[0].getPosXY().y);return}if(this.points[1].getState()==CPoint.state.Highlight){this.points[1].setPosXY(a,b);this.points[0].setPosXYNoSnap(this.points[0].getPosXY().x,this.points[1].getPosXY().y)}};CHoriSegLineObject.prototype.isSelected=function(a,h){if(CHoriSegLineObject.__super.isSelected.call(this,a,h)==true){return true}var g=new CPoint("frame0.k0");g.setPosXY(a,h);var d=this.getPoint(0).getPosXY().y;var f=this.getPoint(0).getPosXY().x;var b=this.getPoint(1).getPosXY().x;if(h>d+4||h<d-4){return false}if(f>b&&(a>f+4||a<b-4)){return false}if(f<b&&(a<f-4||a>b+4)){return false}this.select();return true};var CHoriStraightLineObject=create_class(CBiToolObject);
CHoriStraightLineObject.prototype.__construct=function(a){CHoriStraightLineObject.__super.__construct.call(this,a);this.drawer=new DrawHoriStraightLinesPlotter(a,this)};CHoriStraightLineObject.prototype.setDrawPos=function(a,c){for(var b in this.points){this.points[b].setPosXY(a,c)}};CHoriStraightLineObject.prototype.isSelected=function(a,f){if(CHoriStraightLineObject.__super.isSelected.call(this,a,f)==true){return true}var d=new CPoint("frame0.k0");d.setPosXY(a,f);var b=this.getPoint(0).getPosXY().y;if(f>b+4||f<b-4){return false}this.select();return true};var CRayLineObject=create_class(CBiToolObject);CRayLineObject.prototype.__construct=function(a){CRayLineObject.__super.__construct.call(this,a);this.drawer=new DrawRayLinesPlotter(a,this)};CRayLineObject.prototype.isSelected=function(a,g){if(CRayLineObject.__super.isSelected.call(this,a,g)==true){return true}var f=new CPoint("frame0.k0");f.setPosXY(a,g);var d=this.getPoint(0).getPosXY().x;var b=this.getPoint(1).getPosXY().x;if(b>d&&a<d-4){return false}if(b<d&&a>d+4){return false}if(this.calcDistance(this.getPoint(0),this.getPoint(1),f)<4){this.select();return true}return false};var CSegLineObject=create_class(CBiToolObject);CSegLineObject.prototype.__construct=function(a){CSegLineObject.__super.__construct.call(this,a);this.drawer=new DrawSegLinesPlotter(a,this)};CSegLineObject.prototype.isSelected=function(a,d){if(CSegLineObject.__super.isSelected.call(this,a,d)==true){return true}var b=new CPoint("frame0.k0");b.setPosXY(a,d);if(this.isWithRect(this.getPoint(0),this.getPoint(1),b)==false){return false}if(this.calcDistance(this.getPoint(0),this.getPoint(1),b)<4){this.select();return true}return false};var CStraightLineObject=create_class(CBiToolObject);CStraightLineObject.prototype.__construct=function(a){CStraightLineObject.__super.__construct.call(this,a);this.drawer=new DrawStraightLinesPlotter(a,this)};CStraightLineObject.prototype.isSelected=function(a,d){if(CStraightLineObject.__super.isSelected.call(this,a,d)==true){return true}var b=new CPoint("frame0.k0");b.setPosXY(a,d);if(this.calcDistance(this.getPoint(0),this.getPoint(1),b)<4){this.select();return true}return false};var CTriParallelLineObject=create_class(CTriToolObject);CTriParallelLineObject.prototype.__construct=function(a){CTriParallelLineObject.__super.__construct.call(this,a);this.drawer=new DrawTriParallelLinesPlotter(a,this)};CTriParallelLineObject.prototype.isSelected=function(q,p){if(CTriParallelLineObject.__super.isSelected.call(this,q,p)==true){return true}var r=this.getChartObjects();var m=this.getPoint(0).getPosXY().x;var l=this.getPoint(0).getPosXY().y;var u=this.getPoint(1).getPosXY().x;var s=this.getPoint(1).getPosXY().y;var b=this.getPoint(2).getPosXY().x;var B=this.getPoint(2).getPosXY().y;var k={x:m-u,y:l-s};var j={x:m-b,y:l-B};var i={x:k.x+j.x,y:k.y+j.y};var o=m-i.x;var n=l-i.y;var A={sx:m,sy:l,ex:b,ey:B};var z={sx:u,sy:s,ex:o,ey:n};var g={x:m-u,y:l-s};var d={x:b-o,y:B-n};var h={x:u-m,y:s-l};var f={x:o-b,y:n-B};var v=Math.abs(h.x-m);var t=Math.abs(h.y-l);var c=Math.abs(f.x-b);var a=Math.abs(f.y-B);var w={sx:v,sy:t,ex:c,ey:a};if(this.calcGap(A,q,p)>4&&this.calcGap(z,q,p)>4&&this.calcGap(w,q,p)>4){return false}this.select();return true};var CVertiStraightLineObject=create_class(CBiToolObject);CVertiStraightLineObject.prototype.__construct=function(a){CVertiStraightLineObject.__super.__construct.call(this,a);this.drawer=new DrawVertiStraightLinesPlotter(a,this)};CVertiStraightLineObject.prototype.setDrawPos=function(a,c){for(var b in this.points){this.points[b].setPosXY(a,c)}};CVertiStraightLineObject.prototype.isSelected=function(a,f){if(CVertiStraightLineObject.__super.isSelected.call(this,a,f)==true){return true}var d=new CPoint("frame0.k0");d.setPosXY(a,f);var b=this.getPoint(0).getPosXY().x;if(a>b+4||a<b-4){return false}this.select();return true};var CPriceLineObject=create_class(CSegLineObject);CPriceLineObject.prototype.__construct=function(a){CPriceLineObject.__super.__construct.call(this,a);this.drawer=new DrawPriceLinesPlotter(a,this)};CPriceLineObject.prototype.setDrawPos=function(a,c){for(var b in this.points){this.points[b].setPosXY(a,c)}};CPriceLineObject.prototype.isSelected=function(a,i){if(CFibRetraceObject.__super.isSelected.call(this,a,i)==true){return true}var h=new CPoint("frame0.k0");h.setPosXY(a,i);var g=this.getPoint(0).getPosXY().x;var f=this.getPoint(0).getPosXY().y;var d=this.getPoint(1).getPosXY().x;var b=this.getPoint(1).getPosXY().y;if(a<g-4){return false}if(i>=f+4||i<=f-4){return false}this.select();return true};var CArrowLineObject=create_class(CSegLineObject);CArrowLineObject.prototype.__construct=function(a){CArrowLineObject.__super.__construct.call(this,a);this.drawer=new DrawArrowLinesPlotter(a,this)};var CToolManager=create_class(NamedObject);CToolManager.prototype.__construct=function(a){CToolManager.__super.__construct.call(this,a);this.selectedObject=-1;this.toolObjects=[]};CToolManager.prototype.getToolObjectCount=function(){return this.toolObjects.length};CToolManager.prototype.addToolObject=function(a){this.toolObjects.push(a)};CToolManager.prototype.getToolObject=function(a){if(a<this.toolObjects.length&&a>=0){return this.toolObjects[a]}return null};CToolManager.prototype.getCurrentObject=function(){return this.getToolObject(this.getToolObjectCount()-1)};CToolManager.prototype.getSelectedObject=function(){return this.getToolObject(this.selectedObject)};CToolManager.prototype.delCurrentObject=function(){this.toolObjects.splice(this.getToolObjectCount()-1,1)};CToolManager.prototype.delSelectedObject=function(){this.toolObjects.splice(this.selectedObject,1);this.selectedObject=-1};CToolManager.prototype.acceptMouseMoveEvent=function(a,f){if(this.selectedObject==-1){var d=this.toolObjects[this.getToolObjectCount()-1];if(d!=null&&d.getState()!=CToolObject.state.AfterDraw){return d.acceptMouseMoveEvent(a,f)}}else{var c=this.toolObjects[this.selectedObject];if(c.getState()==CToolObject.state.Draw){return c.acceptMouseMoveEvent(a,f)}c.unselect();this.selectedObject=-1}for(var b in this.toolObjects){if(this.toolObjects[b].isSelected(a,f)){this.selectedObject=b;return false}}return false};CToolManager.prototype.acceptMouseDownEvent=function(a,d){this.mouseDownMove=false;if(this.selectedObject==-1){var c=this.toolObjects[this.getToolObjectCount()-1];if(c!=null&&c.getState()!=CToolObject.state.AfterDraw){return c.acceptMouseDownEvent(a,d)}}else{var b=this.toolObjects[this.selectedObject];if(b.getState()!=CToolObject.state.BeforeDraw){return b.acceptMouseDownEvent(a,d)}}return false};CToolManager.prototype.acceptMouseDownMoveEvent=function(b,g){this.mouseDownMove=true;if(this.selectedObject==-1){var f=this.toolObjects[this.getToolObjectCount()-1];if(f!=null&&f.getState()==CToolObject.state.Draw){return f.acceptMouseDownMoveEvent(b,g)}return false}else{var d=this.toolObjects[this.selectedObject];if(d.getState()!=CToolObject.state.BeforeDraw){if(d.acceptMouseDownMoveEvent(b,g)==true){var a=this.toolObjects[this.selectedObject].points;for(var c=0;c<a.length;c++){if(a[c].state==CPoint.state.Highlight||a[c].state==CPoint.state.Show){return true}}}return true}}};CToolManager.prototype.acceptMouseUpEvent=function(a,d){if(this.mouseDownMove==true){if(this.selectedObject==-1){var c=this.toolObjects[this.getToolObjectCount()-1];if(c!=null&&c.getState()==CToolObject.state.Draw){return c.acceptMouseUpEvent(a,d)}return true}else{var b=this.toolObjects[this.selectedObject];if(b.getState()!=CToolObject.state.BeforeDraw){return b.acceptMouseUpEvent(a,d)}}}if(this.selectedObject!=-1){return true}var c=this.toolObjects[this.getToolObjectCount()-1];if(c!=null){if(c.getState()==CToolObject.state.Draw){return true}if(!c.isValidMouseXY(a,d)){return false}if(c.isSelected(a,d)){return true}}return false};var CToolPlotter=create_class(NamedObject);CToolPlotter.prototype.__construct=function(a,d){CToolPlotter.__super.__construct.call(this,a);this.toolObject=d;var c=ChartManager.getInstance();var b=c.getArea("frame0.k0.main");if(b==null){this.areaPos={left:0,top:0,right:0,bottom:0};return}this.areaPos={left:b.getLeft(),top:b.getTop(),right:b.getRight(),bottom:b.getBottom()};this.crossPt={};this.normalSize=4;this.selectedSize=6;this.cursorLen=4;this.cursorGapLen=3;this.theme=ChartManager.getInstance().getTheme(this.getFrameName())};CToolPlotter.prototype.drawCursor=function(a){this.drawCrossCursor(a)};CToolPlotter.prototype.drawCrossCursor=function(f){f.strokeStyle=this.theme.getColor(Theme.Color.LineColorNormal);f.fillStyle=this.theme.getColor(Theme.Color.LineColorNormal);var d=this.toolObject.getPoint(0).getPosXY();if(d==null){return}var c=d.x;var g=d.y;var b=this.cursorLen;var a=this.cursorGapLen;f.fillRect(c,g,1,1);Plotter.drawLine(f,c-b-a,g,c-a,g);Plotter.drawLine(f,c+b+a,g,c+a,g);Plotter.drawLine(f,c,g-b-a,c,g-a);Plotter.drawLine(f,c,g+b+a,c,g+a)};CToolPlotter.prototype.drawCircle=function(c,b,a){var f=b.x;var d=b.y;c.beginPath();c.arc(f,d,a,0,2*Math.PI,false);c.fillStyle=this.theme.getColor(Theme.Color.CircleColorFill);c.fill();c.stroke()};CToolPlotter.prototype.drawCtrlPt=function(b){b.strokeStyle=this.theme.getColor(Theme.Color.CircleColorStroke);for(var a=0;a<this.ctrlPtsNum;a++){this.drawCircle(b,this.ctrlPts[1][a],this.normalSize)}};CToolPlotter.prototype.highlightCtrlPt=function(b){b.strokeStyle=this.theme.getColor(Theme.Color.CircleColorStroke);for(var a=0;a<this.ctrlPtsNum;a++){if(this.toolObject.getPoint(a).getState()==CPoint.state.Highlight){this.drawCircle(b,this.ctrlPts[1][a],this.selectedSize)}}};CToolPlotter.prototype.drawFibRayLines=function(d,h,c){for(var b=0;b<this.fiboFansSequence.length;b++){var a=h.y+(100-this.fiboFansSequence[b])/100*(c.y-h.y);var g={x:h.x,y:h.y};var f={x:c.x,y:a};this.drawRayLines(d,g,f)}};CToolPlotter.prototype.drawRayLines=function(c,h,b){this.getAreaPos();var f={x:h.x,y:h.y};var d={x:b.x,y:b.y};var g=getRectCrossPt(this.areaPos,f,d);var a;if(b.x==h.x){if(b.y==h.y){a=b}else{a=b.y>h.y?{x:g[1].x,y:g[1].y}:{x:g[0].x,y:g[0].y}}}else{a=b.x>h.x?{x:g[1].x,y:g[1].y}:{x:g[0].x,y:g[0].y}
}Plotter.drawLine(c,h.x,h.y,a.x,a.y)};CToolPlotter.prototype.lenBetweenPts=function(b,a){return Math.sqrt(Math.pow((a.x-b.x),2)+Math.pow((a.y-b.y),2))};CToolPlotter.prototype.getCtrlPts=function(){for(var a=0;a<this.ctrlPtsNum;a++){this.ctrlPts[0][a]=this.toolObject.getPoint(a)}};CToolPlotter.prototype.updateCtrlPtPos=function(){for(var a=0;a<this.ctrlPtsNum;a++){this.ctrlPts[1][a]=this.ctrlPts[0][a].getPosXY()}};CToolPlotter.prototype.getAreaPos=function(){var b=ChartManager.getInstance();var a=b.getArea("frame0.k0.main");if(a==null){this.areaPos={left:0,top:0,right:0,bottom:0};return}this.areaPos={left:Math.floor(a.getLeft()),top:Math.floor(a.getTop()),right:Math.floor(a.getRight()),bottom:Math.floor(a.getBottom())}};CToolPlotter.prototype.updateDraw=function(a){a.strokeStyle=this.theme.getColor(Theme.Color.LineColorNormal);this.draw(a);this.drawCtrlPt(a)};CToolPlotter.prototype.finishDraw=function(a){a.strokeStyle=this.theme.getColor(Theme.Color.LineColorNormal);this.draw(a)};CToolPlotter.prototype.highlight=function(a){a.strokeStyle=this.theme.getColor(Theme.Color.LineColorSelected);this.draw(a);this.drawCtrlPt(a);this.highlightCtrlPt(a)};var DrawStraightLinesPlotter=create_class(CToolPlotter);DrawStraightLinesPlotter.prototype.__construct=function(a,b){DrawStraightLinesPlotter.__super.__construct.call(this,a,b);this.toolObject=b;this.ctrlPtsNum=2;this.ctrlPts=new Array(new Array(this.ctrlPtsNum),new Array(2));this.getCtrlPts()};DrawStraightLinesPlotter.prototype.draw=function(a){this.updateCtrlPtPos();this.getAreaPos();this.startPoint=this.ctrlPts[1][0];this.endPoint=this.ctrlPts[1][1];if(this.startPoint.x==this.endPoint.x&&this.startPoint.y==this.endPoint.y){Plotter.drawLine(a,this.areaPos.left,this.startPoint.y,this.areaPos.right,this.startPoint.y)}else{this.crossPt=getRectCrossPt(this.areaPos,this.startPoint,this.endPoint);Plotter.drawLine(a,this.crossPt[0].x,this.crossPt[0].y,this.crossPt[1].x,this.crossPt[1].y)}};var DrawSegLinesPlotter=create_class(CToolPlotter);DrawSegLinesPlotter.prototype.__construct=function(a,b){DrawSegLinesPlotter.__super.__construct.call(this,a,b);this.toolObject=b;this.ctrlPtsNum=2;this.ctrlPts=new Array(new Array(this.ctrlPtsNum),new Array(2));this.getCtrlPts()};DrawSegLinesPlotter.prototype.draw=function(a){this.updateCtrlPtPos();this.startPoint=this.ctrlPts[1][0];this.endPoint=this.ctrlPts[1][1];if(this.startPoint.x==this.endPoint.x&&this.startPoint.y==this.endPoint.y){this.endPoint.x+=1}Plotter.drawLine(a,this.startPoint.x,this.startPoint.y,this.endPoint.x,this.endPoint.y)};var DrawRayLinesPlotter=create_class(CToolPlotter);DrawRayLinesPlotter.prototype.__construct=function(a,b){DrawRayLinesPlotter.__super.__construct.call(this,a);this.toolObject=b;this.ctrlPtsNum=2;this.ctrlPts=new Array(new Array(this.ctrlPtsNum),new Array(2));this.getCtrlPts()};DrawRayLinesPlotter.prototype.draw=function(a){this.updateCtrlPtPos();this.getAreaPos();this.startPoint=this.ctrlPts[1][0];this.endPoint=this.ctrlPts[1][1];if(this.startPoint.x==this.endPoint.x&&this.startPoint.y==this.endPoint.y){this.endPoint.x+=1}this.drawRayLines(a,this.startPoint,this.endPoint)};var DrawArrowLinesPlotter=create_class(CToolPlotter);DrawArrowLinesPlotter.prototype.__construct=function(a,b){DrawArrowLinesPlotter.__super.__construct.call(this,a,b);this.toolObject=b;this.arrowSizeRatio=0.03;this.arrowSize=4;this.crossPt={x:-1,y:-1};this.ctrlPtsNum=2;this.ctrlPts=new Array(new Array(this.ctrlPtsNum),new Array(2));this.getCtrlPts()};DrawArrowLinesPlotter.prototype.drawArrow=function(c,b,g){var d=this.lenBetweenPts(b,g);var j=[g.x-b.x,g.y-b.y];this.crossPt.x=b.x+(1-this.arrowSize/d)*j[0];this.crossPt.y=b.y+(1-this.arrowSize/d)*j[1];var i=[-j[1],j[0]];var a={x:i[0],y:i[1]};var h={x:0,y:0};i[0]=this.arrowSize*a.x/this.lenBetweenPts(a,h);i[1]=this.arrowSize*a.y/this.lenBetweenPts(a,h);var f=[this.crossPt.x+i[0],this.crossPt.y+i[1]];Plotter.drawLine(c,g.x,g.y,f[0],f[1]);f=[this.crossPt.x-i[0],this.crossPt.y-i[1]];Plotter.drawLine(c,g.x,g.y,f[0],f[1])};DrawArrowLinesPlotter.prototype.draw=function(a){this.updateCtrlPtPos();this.startPoint=this.ctrlPts[1][0];this.endPoint=this.ctrlPts[1][1];if(this.startPoint.x==this.endPoint.x&&this.startPoint.y==this.endPoint.y){this.endPoint.x+=1}Plotter.drawLine(a,this.startPoint.x,this.startPoint.y,this.endPoint.x,this.endPoint.y);this.drawArrow(a,this.startPoint,this.endPoint)};var DrawHoriStraightLinesPlotter=create_class(CToolPlotter);DrawHoriStraightLinesPlotter.prototype.__construct=function(a,b){DrawHoriStraightLinesPlotter.__super.__construct.call(this,a);this.toolObject=b;this.ctrlPtsNum=1;this.ctrlPts=new Array(new Array(this.ctrlPtsNum),new Array(2));this.getCtrlPts()};DrawHoriStraightLinesPlotter.prototype.draw=function(a){this.updateCtrlPtPos();this.getAreaPos();this.startPoint=this.ctrlPts[1][0];Plotter.drawLine(a,this.areaPos.left,this.startPoint.y,this.areaPos.right,this.startPoint.y)};var DrawHoriRayLinesPlotter=create_class(CToolPlotter);DrawHoriRayLinesPlotter.prototype.__construct=function(a,b){DrawHoriRayLinesPlotter.__super.__construct.call(this,a);this.toolObject=b;this.ctrlPtsNum=2;this.ctrlPts=new Array(new Array(this.ctrlPtsNum),new Array(2));this.getCtrlPts()};DrawHoriRayLinesPlotter.prototype.draw=function(a){this.updateCtrlPtPos();this.getAreaPos();this.startPoint=this.ctrlPts[1][0];this.endPoint=this.ctrlPts[1][1];if(this.startPoint.x==this.endPoint.x){Plotter.drawLine(a,this.startPoint.x,this.startPoint.y,this.areaPos.right,this.startPoint.y)}else{var b={x:this.endPoint.x,y:this.startPoint.y};this.drawRayLines(a,this.startPoint,b)}};var DrawHoriSegLinesPlotter=create_class(CToolPlotter);DrawHoriSegLinesPlotter.prototype.__construct=function(a,b){DrawHoriSegLinesPlotter.__super.__construct.call(this,a,b);this.toolObject=b;this.ctrlPtsNum=2;this.ctrlPts=new Array(new Array(this.ctrlPtsNum),new Array(2));this.getCtrlPts()};DrawHoriSegLinesPlotter.prototype.draw=function(a){this.updateCtrlPtPos();this.startPoint=this.ctrlPts[1][0];this.endPoint=this.ctrlPts[1][1];this.endPoint.y=this.startPoint.y;if(this.startPoint.x==this.endPoint.x&&this.startPoint.y==this.endPoint.y){Plotter.drawLine(a,this.startPoint.x,this.startPoint.y,this.endPoint.x+1,this.startPoint.y)}else{Plotter.drawLine(a,this.startPoint.x,this.startPoint.y,this.endPoint.x,this.startPoint.y)}};var DrawVertiStraightLinesPlotter=create_class(CToolPlotter);DrawVertiStraightLinesPlotter.prototype.__construct=function(a,b){DrawVertiStraightLinesPlotter.__super.__construct.call(this,a);this.toolObject=b;this.ctrlPtsNum=1;this.ctrlPts=new Array(new Array(this.ctrlPtsNum),new Array(2));this.getCtrlPts()};DrawVertiStraightLinesPlotter.prototype.draw=function(a){this.updateCtrlPtPos();this.getAreaPos();this.startPoint=this.ctrlPts[1][0];Plotter.drawLine(a,this.startPoint.x,this.areaPos.top,this.startPoint.x,this.areaPos.bottom)};var DrawPriceLinesPlotter=create_class(CToolPlotter);DrawPriceLinesPlotter.prototype.__construct=function(a,b){DrawPriceLinesPlotter.__super.__construct.call(this,a);this.toolObject=b;this.ctrlPtsNum=1;this.ctrlPts=new Array(new Array(this.ctrlPtsNum),new Array(2));this.getCtrlPts()};DrawPriceLinesPlotter.prototype.draw=function(a){a.font="12px Tahoma";a.textAlign="left";a.fillStyle=this.theme.getColor(Theme.Color.LineColorNormal);this.updateCtrlPtPos();this.getAreaPos();this.startPoint=this.ctrlPts[1][0];var b=this.ctrlPts[0][0].getPosIV().v;Plotter.drawLine(a,this.startPoint.x,this.startPoint.y,this.areaPos.right,this.startPoint.y);a.fillText(b.toFixed(2),this.startPoint.x+2,this.startPoint.y-15)};var ParallelLinesPlotter=create_class(CToolPlotter);ParallelLinesPlotter.prototype.__construct=function(a,b){ParallelLinesPlotter.__super.__construct.call(this,a);this.toolObject=b};ParallelLinesPlotter.prototype.getParaPt=function(){var b=[];b[0]=this.endPoint.x-this.startPoint.x;b[1]=this.endPoint.y-this.startPoint.y;var a=[];a[0]=this.paraStartPoint.x-this.startPoint.x;a[1]=this.paraStartPoint.y-this.startPoint.y;this.paraEndPoint={x:-1,y:-1};this.paraEndPoint.x=b[0]+a[0]+this.startPoint.x;this.paraEndPoint.y=b[1]+a[1]+this.startPoint.y};var DrawBiParallelLinesPlotter=create_class(ParallelLinesPlotter);DrawBiParallelLinesPlotter.prototype.__construct=function(a,b){DrawBiParallelLinesPlotter.__super.__construct.call(this,a,b);this.toolObject=b;this.ctrlPtsNum=3;this.ctrlPts=new Array(new Array(this.ctrlPtsNum),new Array(2));this.getCtrlPts()};DrawBiParallelLinesPlotter.prototype.draw=function(a){this.updateCtrlPtPos();this.getAreaPos();this.startPoint=this.ctrlPts[1][0];this.paraStartPoint=this.ctrlPts[1][1];this.endPoint=this.ctrlPts[1][2];this.getParaPt();this.getAreaPos();this.crossPt0=getRectCrossPt(this.areaPos,this.startPoint,this.endPoint);Plotter.drawLine(a,this.crossPt0[0].x,this.crossPt0[0].y,this.crossPt0[1].x,this.crossPt0[1].y);this.crossPt1=getRectCrossPt(this.areaPos,this.paraStartPoint,this.paraEndPoint);Plotter.drawLine(a,this.crossPt1[0].x,this.crossPt1[0].y,this.crossPt1[1].x,this.crossPt1[1].y)};var DrawBiParallelRayLinesPlotter=create_class(ParallelLinesPlotter);DrawBiParallelRayLinesPlotter.prototype.__construct=function(a,b){DrawBiParallelRayLinesPlotter.__super.__construct.call(this,a,b);this.toolObject=b;this.ctrlPtsNum=3;this.ctrlPts=new Array(new Array(this.ctrlPtsNum),new Array(2));this.getCtrlPts()};DrawBiParallelRayLinesPlotter.prototype.draw=function(a){this.updateCtrlPtPos();this.getAreaPos();this.startPoint=this.ctrlPts[1][0];this.paraStartPoint=this.ctrlPts[1][1];this.endPoint=this.ctrlPts[1][2];if(this.startPoint.x==this.endPoint.x&&this.startPoint.y==this.endPoint.y){this.endPoint.x+=1}this.getParaPt();this.drawRayLines(a,this.startPoint,this.endPoint);this.drawRayLines(a,this.paraStartPoint,this.paraEndPoint)};var DrawTriParallelLinesPlotter=create_class(ParallelLinesPlotter);DrawTriParallelLinesPlotter.prototype.__construct=function(a,b){DrawTriParallelLinesPlotter.__super.__construct.call(this,a,b);this.toolObject=b;this.ctrlPtsNum=3;this.ctrlPts=new Array(new Array(this.ctrlPtsNum),new Array(2));
    this.getCtrlPts()};DrawTriParallelLinesPlotter.prototype.draw=function(c){this.updateCtrlPtPos();this.getAreaPos();this.startPoint=this.ctrlPts[1][0];this.paraStartPoint=this.ctrlPts[1][1];this.endPoint=this.ctrlPts[1][2];var b=[];b[0]=this.endPoint.x-this.startPoint.x;b[1]=this.endPoint.y-this.startPoint.y;var a=[];a[0]=this.paraStartPoint.x-this.startPoint.x;a[1]=this.paraStartPoint.y-this.startPoint.y;this.para1EndPoint={x:-1,y:-1};this.para2EndPoint={x:-1,y:-1};this.para2StartPoint={x:-1,y:-1};this.para1EndPoint.x=b[0]+a[0]+this.startPoint.x;this.para1EndPoint.y=b[1]+a[1]+this.startPoint.y;this.para2StartPoint.x=this.startPoint.x-a[0];this.para2StartPoint.y=this.startPoint.y-a[1];this.para2EndPoint.x=this.endPoint.x-a[0];this.para2EndPoint.y=this.endPoint.y-a[1];this.getAreaPos();this.crossPt0=getRectCrossPt(this.areaPos,this.startPoint,this.endPoint);Plotter.drawLine(c,this.crossPt0[0].x,this.crossPt0[0].y,this.crossPt0[1].x,this.crossPt0[1].y);this.crossPt1=getRectCrossPt(this.areaPos,this.paraStartPoint,this.para1EndPoint);Plotter.drawLine(c,this.crossPt1[0].x,this.crossPt1[0].y,this.crossPt1[1].x,this.crossPt1[1].y);this.crossPt2=getRectCrossPt(this.areaPos,this.para2StartPoint,this.para2EndPoint);Plotter.drawLine(c,this.crossPt2[0].x,this.crossPt2[0].y,this.crossPt2[1].x,this.crossPt2[1].y)};var BandLinesPlotter=create_class(CToolPlotter);BandLinesPlotter.prototype.__construct=function(a,b){BandLinesPlotter.__super.__construct.call(this,a);this.toolObject=b;this.ctrlPtsNum=2;this.ctrlPts=new Array(new Array(this.ctrlPtsNum),new Array(2));this.getCtrlPts()};BandLinesPlotter.prototype.drawLinesAndInfo=function(d,g,c){d.font="12px Tahoma";d.textAlign="left";d.fillStyle=this.theme.getColor(Theme.Color.LineColorNormal);var h;if(this.toolObject.state==CToolObject.state.Draw){this.startPtValue=this.toolObject.getPoint(0).getPosIV().v;this.endPtValue=this.toolObject.getPoint(1).getPosIV().v}this.getAreaPos();for(var b=0;b<this.fiboSequence.length;b++){var a=g.y+(100-this.fiboSequence[b])/100*(c.y-g.y);if(a>this.areaPos.bottom){continue}var f=this.startPtValue+(100-this.fiboSequence[b])/100*(this.endPtValue-this.startPtValue);Plotter.drawLine(d,this.areaPos.left,a,this.areaPos.right,a);h=this.fiboSequence[b].toFixed(1)+"% "+f.toFixed(1);d.fillText(h,this.areaPos.left+2,a-15)}};BandLinesPlotter.prototype.draw=function(a){this.updateCtrlPtPos();this.getAreaPos();this.startPoint=this.ctrlPts[1][0];this.endPoint=this.ctrlPts[1][1];this.drawLinesAndInfo(a,this.startPoint,this.endPoint)};var DrawFibRetracePlotter=create_class(BandLinesPlotter);DrawFibRetracePlotter.prototype.__construct=function(a,b){DrawFibRetracePlotter.__super.__construct.call(this,a,b);this.toolObject=b;this.fiboSequence=[100,78.6,61.8,50,38.2,23.6,0]};var DrawBandLinesPlotter=create_class(BandLinesPlotter);DrawBandLinesPlotter.prototype.__construct=function(a,b){DrawBandLinesPlotter.__super.__construct.call(this,a,b);this.toolObject=b;this.fiboSequence=[0,12.5,25,37.5,50,62.5,75,87.5,100]};var DrawFibFansPlotter=create_class(CToolPlotter);DrawFibFansPlotter.prototype.__construct=function(a,b){DrawFibFansPlotter.__super.__construct.call(this,a);this.toolObject=b;this.fiboFansSequence=[0,38.2,50,61.8];this.ctrlPtsNum=2;this.ctrlPts=new Array(new Array(this.ctrlPtsNum),new Array(2));this.getCtrlPts()};DrawFibFansPlotter.prototype.drawLinesAndInfo=function(b,c,a){this.drawFibRayLines(b,c,a)};DrawFibFansPlotter.prototype.draw=function(a){this.updateCtrlPtPos();this.getAreaPos();this.startPoint=this.ctrlPts[1][0];this.endPoint=this.ctrlPts[1][1];if(this.startPoint.x==this.endPoint.x&&this.startPoint.y==this.endPoint.y){this.endPoint.x+=1}this.drawLinesAndInfo(a,this.startPoint,this.endPoint)};var CDynamicLinePlotter=create_class(NamedObject);CDynamicLinePlotter.prototype.__construct=function(a){CDynamicLinePlotter.__super.__construct.call(this,a);this.flag=true;this.context=ChartManager.getInstance()._overlayContext};CDynamicLinePlotter.prototype.getAreaPos=function(){var b=ChartManager.getInstance();var a=b.getArea("frame0.k0.main");if(a==null){this.areaPos={left:0,top:0,right:0,bottom:0};return}this.areaPos={left:Math.floor(a.getLeft()),top:Math.floor(a.getTop()),right:Math.floor(a.getRight()),bottom:Math.floor(a.getBottom())}};CDynamicLinePlotter.prototype.Draw=function(b){this.getAreaPos();var h=ChartManager.getInstance();var j=h.getDataSource(this.getDataSourceName());if(j==null||!is_instance(j,MainDataSource)){return}this.context.save();this.context.rect(this.areaPos.left,this.areaPos.top,this.areaPos.right-this.areaPos.left,this.areaPos.bottom-this.areaPos.top);this.context.clip();var c=j.getToolObjectCount();for(var a=0;a<c;a++){var g=j.getToolObject(a);var f=g.getState();switch(f){case CToolObject.state.BeforeDraw:g.getPlotter().theme=ChartManager.getInstance().getTheme(this.getFrameName());g.getPlotter().drawCursor(this.context);break;case CToolObject.state.Draw:g.getPlotter().theme=ChartManager.getInstance().getTheme(this.getFrameName());g.getPlotter().updateDraw(this.context);break;case CToolObject.state.AfterDraw:g.getPlotter().theme=ChartManager.getInstance().getTheme(this.getFrameName());g.getPlotter().finishDraw(this.context);break;default:break}}var d=j.getSelectToolObjcet();if(d!=null&&d!=CToolObject.state.Draw){d.getPlotter().highlight(this.context)}this.context.restore();return};var scroll=0;$("body").on("click","#sizeIcon",function(){console.log(scroll);KlineIns.isSized=!KlineIns.isSized;if(KlineIns.isSized){console.log($(KlineIns.element).parents("iframe"));$(KlineIns.element).css({position:"fixed",left:"0",right:"0",top:"0",bottom:"0",width:"100%",height:"100%",zIndex:"10000"});scroll=$(window).scrollTop();on_size();$("html,body").css({width:"100%",height:"100%",overflow:"hidden"})}else{$(KlineIns.element).attr("style","");$("html,body").attr("style","");on_size(KlineIns.width,KlineIns.height);$(KlineIns.element).css({visibility:"visible",height:KlineIns.height+"px"});window.scrollTo(0,scroll)}});function KLineMouseEvent(){$(document).ready(function(){function a(){if(navigator.userAgent.indexOf("Firefox")>=0){setTimeout(function(){on_size(KlineIns.width,KlineIns.height)},200)}else{on_size(KlineIns.width,KlineIns.height)}}$("#chart_overlayCanvas").bind("contextmenu",function(b){b.cancelBubble=true;b.returnValue=false;b.preventDefault();b.stopPropagation();return false});$(".chart_container .chart_dropdown .chart_dropdown_t").mouseover(function(){var b=$(".chart_container");var i=$(this);var l=i.next();var c=b.offset().left;var f=i.offset().left;var j=b.width();var k=i.width();var h=l.width();var g=((h-k)/2)<<0;if(f-g<c+4){g=f-c-4}else{if(f+k+g>c+j-4){g+=f+k+g-(c+j-4)+19}else{g+=4}}l.css({"margin-left":-g});i.addClass("chart_dropdown-hover");l.addClass("chart_dropdown-hover")}).mouseout(function(){$(this).next().removeClass("chart_dropdown-hover");$(this).removeClass("chart_dropdown-hover")});$(".chart_dropdown_data").mouseover(function(){$(this).addClass("chart_dropdown-hover");$(this).prev().addClass("chart_dropdown-hover")}).mouseout(function(){$(this).prev().removeClass("chart_dropdown-hover");$(this).removeClass("chart_dropdown-hover")});$("#chart_btn_parameter_settings").click(function(){$("#chart_parameter_settings").addClass("clicked");$(".chart_dropdown_data").removeClass("chart_dropdown-hover");$("#chart_parameter_settings").find("th").each(function(){var c=$(this).html();var b=0;var d=ChartSettings.get();var f=d.indics[c];$(this.nextElementSibling).find("input").each(function(){if(f!=null&&b<f.length){$(this).val(f[b])}b++})})});$("#close_settings").click(function(){$("#chart_parameter_settings").removeClass("clicked")});$(".chart_container .chart_toolbar_tabgroup a").click(function(){switch_period($(this).parent().attr("name"))});$("#chart_toolbar_periods_vert ul a").click(function(){switch_period($(this).parent().attr("name"))});$(".market_chooser ul a").click(function(){switch_symbol($(this).attr("name"))});$("#chart_show_tools").click(function(){if($(this).hasClass("selected")){switch_tools("off")}else{switch_tools("on")}});$("#chart_toolpanel .chart_toolpanel_button").click(function(){$(".chart_dropdown_data").removeClass("chart_dropdown-hover");$("#chart_toolpanel .chart_toolpanel_button").removeClass("selected");$(this).addClass("selected");var b=$(this).children().attr("name");KlineIns.chartMgr.setRunningMode(ChartManager.DrawingTool[b])});$("#chart_show_indicator").click(function(){if($(this).hasClass("selected")){switch_indic("off")}else{switch_indic("on")}});$("#chart_tabbar li a").click(function(){$("#chart_tabbar li a").removeClass("selected");$(this).addClass("selected");var b=$(this).attr("name");var c=ChartSettings.get();c.charts.indics[1]=b;ChartSettings.save();if(Template.displayVolume==false){ChartManager.getInstance().getChart().setIndicator(1,b)}else{ChartManager.getInstance().getChart().setIndicator(2,b)}});$("#chart_select_chart_style a").click(function(){$("#chart_select_chart_style a").removeClass("selected");$(this).addClass("selected");var b=ChartSettings.get();b.charts.chartStyle=$(this)[0].innerHTML;ChartSettings.save();var c=ChartManager.getInstance();c.setChartStyle("frame0.k0",$(this).html());c.redraw()});$("#chart_dropdown_themes li").click(function(){$("#chart_dropdown_themes li a").removeClass("selected");var b=$(this).attr("name");if(b=="chart_themes_dark"){switch_theme("dark")}else{if(b=="chart_themes_light"){switch_theme("light")}}});$("#chart_select_main_indicator a").click(function(){$("#chart_select_main_indicator a").removeClass("selected");$(this).addClass("selected");var b=$(this).attr("name");var c=ChartSettings.get();c.charts.mIndic=b;ChartSettings.save();var d=ChartManager.getInstance();if(!d.setMainIndicator("frame0.k0",b)){d.removeMainIndicator("frame0.k0")}d.redraw()});$("#chart_toolbar_theme a").click(function(){$("#chart_toolbar_theme a").removeClass("selected");if($(this).attr("name")=="dark"){switch_theme("dark")}else{if($(this).attr("name")=="light"){switch_theme("light")
}}});$("#chart_select_theme li a").click(function(){$("#chart_select_theme a").removeClass("selected");if($(this).attr("name")=="dark"){switch_theme("dark")}else{if($(this).attr("name")=="light"){switch_theme("light")}}});$("#chart_enable_tools li a").click(function(){$("#chart_enable_tools a").removeClass("selected");if($(this).attr("name")=="on"){switch_tools("on")}else{if($(this).attr("name")=="off"){switch_tools("off")}}});$("#chart_enable_indicator li a").click(function(){$("#chart_enable_indicator a").removeClass("selected");if($(this).attr("name")=="on"){switch_indic("on")}else{if($(this).attr("name")=="off"){switch_indic("off")}}});$("#chart_language_setting_div li a").click(function(){$("#chart_language_setting_div a").removeClass("selected");if($(this).attr("name")=="zh-cn"){chart_switch_language("zh-cn")}else{if($(this).attr("name")=="en-us"){chart_switch_language("en-us")}else{if($(this).attr("name")=="zh-tw"){chart_switch_language("zh-tw")}}}});$(document).keyup(function(b){if(b.keyCode==46){ChartManager.getInstance().deleteToolObject();ChartManager.getInstance().redraw("OverlayCanvas",false)}});$("#clearCanvas").click(function(){var d=ChartManager.getInstance().getDataSource("frame0.k0");var b=d.getToolObjectCount();for(var c=0;c<b;c++){d.delToolObject()}ChartManager.getInstance().redraw("OverlayCanvas",false)});$("#chart_overlayCanvas").mousemove(function(f){var c=f.target.getBoundingClientRect();var b=f.clientX-c.left;var g=f.clientY-c.top;var d=ChartManager.getInstance();if(KlineIns.buttonDown==true){d.onMouseMove("frame0",b,g,true);d.redraw("All",false)}else{d.onMouseMove("frame0",b,g,false);d.redraw("OverlayCanvas")}}).mouseleave(function(f){var c=f.target.getBoundingClientRect();var b=f.clientX-c.left;var g=f.clientY-c.top;var d=ChartManager.getInstance();d.onMouseLeave("frame0",b,g,false);d.redraw("OverlayCanvas")}).mouseup(function(f){if(f.which!=1){return}KlineIns.buttonDown=false;var c=f.target.getBoundingClientRect();var b=f.clientX-c.left;var g=f.clientY-c.top;var d=ChartManager.getInstance();d.onMouseUp("frame0",b,g);d.redraw("All")}).mousedown(function(d){if(d.which!=1){ChartManager.getInstance().deleteToolObject();ChartManager.getInstance().redraw("OverlayCanvas",false);return}KlineIns.buttonDown=true;var c=d.target.getBoundingClientRect();var b=d.clientX-c.left;var f=d.clientY-c.top;ChartManager.getInstance().onMouseDown("frame0",b,f)});$("#chart_parameter_settings :input").change(function(){var d=$(this).attr("name");var c=0;var g=[];var i=ChartManager.getInstance();$("#chart_parameter_settings :input").each(function(){if($(this).attr("name")==d){if($(this).val()!=""&&$(this).val()!=null&&$(this).val()!=undefined){var j=parseInt($(this).val());g.push(j)}c++}});if(g.length!=0){i.setIndicatorParameters(d,g);var h=i.getIndicatorParameters(d);var b=[];c=0;$("#chart_parameter_settings :input").each(function(){if($(this).attr("name")==d){if($(this).val()!=""&&$(this).val()!=null&&$(this).val()!=undefined){$(this).val(h[c].getValue());b.push(h[c].getValue())}c++}});var f=ChartSettings.get();f.indics[d]=b;ChartSettings.save();i.redraw("All",false)}});$("#chart_parameter_settings button").click(function(){var c=$(this).parents("tr").children("th").html();var b=0;var g=ChartManager.getInstance().getIndicatorParameters(c);var f=[];$(this).parent().prev().children("input").each(function(){if(g!=null&&b<g.length){$(this).val(g[b].getDefaultValue());f.push(g[b].getDefaultValue())}b++});ChartManager.getInstance().setIndicatorParameters(c,f);var d=ChartSettings.get();d.indics[c]=f;ChartSettings.save();ChartManager.getInstance().redraw("All",false)})})}var refresh_counter=0;var refresh_handler=null;function refresh_function(){refresh_counter++;var b=ChartManager.getInstance().getLanguage();if(refresh_counter>3600){var a=new Number(refresh_counter/3600);if(b=="en-us"){$("#chart_updated_time_text").html(a.toFixed(0)+"h")}else{if(b=="zh-tw"){$("#chart_updated_time_text").html(a.toFixed(0)+"小時")}else{$("#chart_updated_time_text").html(a.toFixed(0)+"小时")}}}else{if(refresh_counter>60&&refresh_counter<=3600){var a=new Number(refresh_counter/60);if(b=="en-us"){$("#chart_updated_time_text").html(a.toFixed(0)+"m")}else{if(b=="zh-tw"){$("#chart_updated_time_text").html(a.toFixed(0)+"分鐘")}else{$("#chart_updated_time_text").html(a.toFixed(0)+"分钟")}}}else{if(refresh_counter<=60){if(b=="en-us"){$("#chart_updated_time_text").html(refresh_counter+"s")}else{$("#chart_updated_time_text").html(refresh_counter+"秒")}}}}}function clear_refresh_counter(){window.clearInterval(refresh_handler);refresh_counter=0;var a=ChartManager.getInstance().getLanguage();if(a=="en-us"){$("#chart_updated_time_text").html(refresh_counter+"s")}else{$("#chart_updated_time_text").html(refresh_counter+"秒")}refresh_handler=setInterval(refresh_function,KlineIns.intervalTime)}function RequestData(a){AbortRequest();window.clearTimeout(KlineIns.timer);if(KlineIns.paused){return}if(a==true){$("#chart_loading").addClass("activated")}if(KlineIns.type=="socket"&&KlineIns.socket){requestOverSocket()}else{requestOverHttp()}}function parseRequestParam(a){return JSON.parse('{"'+decodeURI(a.replace(/&/g,'","').replace(/=/g,'":"'))+'"}')}function requestOverSocket(){if(!KlineIns.socketConnected){if(KlineIns.debug){console.log("DEBUG: socket is not coonnected")}return}if(KlineIns.socketClient&&KlineIns.socketClient.ws.readyState==1){KlineIns.socketClient.send(KlineIns.sendPath,{},JSON.stringify(parseRequestParam(KlineIns.requestParam)));return}if(KlineIns.debug){console.log("DEBUG: socket client is not ready yet ...")}KlineIns.timer=setTimeout(function(){RequestData(true)},1000)}function gapTimeStamp2(){return new Date().getTimezoneOffset()*60000}function dataChange2(g){var c=gapTimeStamp2();var b=g.length;var h={success:true,data:{lines:[]}};for(var d=0;d<b;d++){var f=g[d];var a=[];a.push(f.timestamp*1000-c);a.push(f.popen);a.push(f.high);a.push(f.low);a.push(f.pclose);a.push(null);h.data.lines.push(a)}return(h)}function requestOverHttp(){if(KlineIns.debug){console.log("DEBUG: "+KlineIns.requestParam)}$(document).ready(KlineIns.G_HTTP_REQUEST=$.ajax({type:"GET",url:KlineIns.url,dataType:"json",timeout:30000,created:Date.now(),beforeSend:function(){this.range=KlineIns.range;this.symbol=KlineIns.symbol},success:function(a){if(KlineIns.G_HTTP_REQUEST){requestSuccessHandler(dataChange2(a))}},error:function(b,c,a){if(KlineIns.debug){console.log(b)}if(b.status==200&&b.readyState==4){return}KlineIns.timer=setTimeout(function(){RequestData(true)},KlineIns.intervalTime);console.log(KlineIns.url);console.log(b)},complete:function(){KlineIns.G_HTTP_REQUEST=null}}))}function requestSuccessHandler(res){if(KlineIns.debug){console.log(res)}if(!res||!res.success){KlineIns.timer=setTimeout(function(){RequestData(true)},KlineIns.intervalTime);return}$("#chart_loading").removeClass("activated");var chart=ChartManager.getInstance().getChart();chart.setTitle();KlineIns.data=eval(res.data);var updateDataRes=KlineIns.chartMgr.updateData("frame0.k0",KlineIns.data.lines);KlineIns.requestParam=setHttpRequestParam(KlineIns.symbol,KlineIns.range,null,KlineIns.chartMgr.getDataSource("frame0.k0").getLastDate());var intervalTime=KlineIns.intervalTime<KlineIns.range?KlineIns.intervalTime:KlineIns.range;if(!updateDataRes){KlineIns.timer=setTimeout(RequestData,intervalTime);return}if(KlineIns.data.trades&&KlineIns.data.trades.length>0){KlineTradeIns.pushTrades(KlineIns.data.trades);KlineTradeIns.klineTradeInit=true}if(KlineIns.data.depths){KlineTradeIns.updateDepth(KlineIns.data.depths)}clear_refresh_counter();KlineIns.timer=setTimeout(TwoSecondThread,intervalTime);ChartManager.getInstance().redraw("All",true)}function AbortRequest(){if(KlineIns.type!="socket"||!KlineIns.socketClient){if(KlineIns.G_HTTP_REQUEST&&KlineIns.G_HTTP_REQUEST.readyState!=4){KlineIns.G_HTTP_REQUEST.abort()}}}function TwoSecondThread(){var a=KlineIns.chartMgr.getDataSource("frame0.k0").getLastDate();if(a==-1){KlineIns.requestParam=setHttpRequestParam(KlineIns.symbol,KlineIns.range,KlineIns.limit,null)}else{KlineIns.requestParam=setHttpRequestParam(KlineIns.symbol,KlineIns.range,null,a.toString())}RequestData()}function readCookie(){ChartSettings.get();ChartSettings.save();var b=ChartSettings.get();ChartManager.getInstance().setChartStyle("frame0.k0",b.charts.chartStyle);var d=b.charts.symbol;if(!KlineIns.init){d=KlineIns.symbol;KlineIns.init=true}KlineIns.symbol=d;switch_symbol_selected(d);var f=b.charts.period;switch_period(f);$("#chart_period_"+f+"_v a").addClass("selected");$("#chart_period_"+f+"_h a").addClass("selected");if(b.charts.indicsStatus=="close"){switch_indic("off")}else{if(b.charts.indicsStatus=="open"){switch_indic("on")}}var a=$("#chart_select_main_indicator");a.find("a").each(function(){if($(this).attr("name")==b.charts.mIndic){$(this).addClass("selected")}});var c=$("#chart_select_chart_style");c.find("a").each(function(){if($(this)[0].innerHTML==b.charts.chartStyle){$(this).addClass("selected")}});ChartManager.getInstance().getChart().setMainIndicator(b.charts.mIndic);ChartManager.getInstance().setThemeName("frame0",b.theme);switch_tools("off");if(b.theme=="Dark"){switch_theme("dark")}else{if(b.theme=="Light"){switch_theme("light")}}chart_switch_language(b.language||"zh-cn")}function setHttpRequestParam(c,b,a,f){var d="symbol="+c+"&range="+b;if(a!=null){d+="&limit="+a}else{d+="&since="+f}if(KlineTradeIns.tradeDate.getTime()!=0){d+="&prevTradeTime="+KlineTradeIns.tradeDate.getTime()}return d}function refreshTemplate(){KlineIns.chartMgr=DefaultTemplate.loadTemplate("frame0.k0","");ChartManager.getInstance().redraw("All",true)}function getRectCrossPt(i,c,g){var b;var j={x:-1,y:-1};var a={x:-1,y:-1};var h=g.x-c.x;var d=g.y-c.y;if(Math.abs(h)<2){j={x:c.x,y:i.top};a={x:g.x,y:i.bottom};b=[j,a];return b}var f=d/h;a.x=i.right;a.y=c.y+(i.right-c.x)*f;j.x=i.left;j.y=c.y+(i.left-c.x)*f;b=[j,a];return b}function chart_switch_language(b){var a=b.replace(/-/,"_");$("#chart_language_switch_tmp").find("span").each(function(){var d=$(this).attr("name");
    var c=$(this).attr(a);d="."+d;var f=$(d)[0];if(!f){return}$(d).each(function(){$(this)[0].innerHTML=c})});$("#chart_language_setting_div li a[name='"+b+"']").addClass("selected");ChartManager.getInstance().setLanguage(b);ChartManager.getInstance().getChart().setTitle();var a=ChartSettings.get();a.language=b;ChartSettings.save();KlineIns.onLangChange(b)}function on_size(F,I){var b=F||window.innerWidth;var u=KlineIns.showTrade?(b-KlineIns.tradeWidth):b;var g=I||window.innerHeight;var A=$(KlineIns.element);A.css({width:b+"px",height:g+"px"});var d=$("#chart_toolbar");var n=$("#chart_toolpanel");var o=$("#chart_canvasGroup");var f=$("#chart_tabbar");var i=n[0].style.display!="inline"?false:true;var K=f[0].style.display!="block"?false:true;var J={};J.x=0;J.y=0;J.w=u;J.h=29;var M={};M.x=0;M.y=J.h+1;M.w=i?32:0;M.h=g-M.y;var y={};y.w=i?u-(M.w+1):u;y.h=K?22:-1;y.x=u-y.w;y.y=g-(y.h+1);var G={};G.x=y.x;G.y=M.y;G.w=y.w;G.h=y.y-M.y;d.css({left:J.x+"px",top:J.y+"px",width:J.w+"px",height:J.h+"px"});if(i){n.css({left:M.x+"px",top:M.y+"px",width:M.w+"px",height:M.h+"px"})}o.css({left:G.x+"px",top:G.y+"px",width:G.w+"px",height:G.h+"px"});var j=$("#chart_mainCanvas")[0];var E=$("#chart_overlayCanvas")[0];j.width=G.w;j.height=G.h;E.width=G.w;E.height=G.h;if(K){f.css({left:y.x+"px",top:y.y+"px",width:y.w+"px",height:y.h+"px"})}var x=$("#chart_parameter_settings");x.css({left:(u-x.width())>>1,top:(g-x.height())>>1});var C=$("#chart_loading");C.css({left:(u-C.width())>>1,top:(g-C.height())>>2});var t=$("#chart_dom_elem_cache");var c=$("#chart_select_theme")[0];var H=$("#chart_enable_tools")[0];var L=$("#chart_enable_indicator")[0];var p=$("#chart_toolbar_periods_vert");var r=$("#chart_toolbar_periods_horz")[0];var l=$("#chart_show_indicator")[0];var k=$("#chart_show_tools")[0];var z=$("#chart_toolbar_theme")[0];var v=$("#chart_dropdown_settings");var B=p[0].offsetWidth;var a=B+r.offsetWidth;var q=a+l.offsetWidth+4;var m=q+k.offsetWidth+4;var s=m+z.offsetWidth;var D=v.find(".chart_dropdown_t")[0].offsetWidth+150;B+=D;a+=D;q+=D;m+=D;s+=D;if(u<a){t.append(r)}else{p.after(r)}if(u<q){t.append(l);L.style.display=""}else{v.before(l);L.style.display="none"}if(u<m){t.append(k);H.style.display=""}else{v.before(k);H.style.display="none"}if(u<s){t.append(z);c.style.display=""}else{v.before(z);c.style.display="none"}ChartManager.getInstance().redraw("All",true);KlineIns.onResize(b,g)}function mouseWheel(a,b){ChartManager.getInstance().scale(b>0?1:-1);ChartManager.getInstance().redraw("All",true);return false}function switch_theme(c){$("#chart_toolbar_theme a").removeClass("selected");$("#chart_select_theme a").removeClass("selected");$("#chart_toolbar_theme").find("a").each(function(){if($(this).attr("name")==c){$(this).addClass("selected")}});$("#chart_select_theme a").each(function(){if($(this).attr("name")==c){$(this).addClass("selected")}});$(".chart_container").attr("class","chart_container "+c);$(".marketName_ a").attr("class",c);if(c=="dark"){$(".trade_container").addClass("dark").removeClass("light");ChartManager.getInstance().setThemeName("frame0","Dark");var d=ChartSettings.get();d.theme="Dark";ChartSettings.save()}else{if(c=="light"){$(".trade_container").addClass("light").removeClass("dark");ChartManager.getInstance().setThemeName("frame0","Light");var d=ChartSettings.get();d.theme="Light";ChartSettings.save()}}var b={};b.command="set current theme";b.content=c;$("#chart_output_interface_text").val(JSON.stringify(b));$("#chart_output_interface_submit").submit();window._current_theme_change.raise(c);ChartManager.getInstance().redraw();KlineIns.onThemeChange(c)}function switch_tools(a){$(".chart_dropdown_data").removeClass("chart_dropdown-hover");$("#chart_toolpanel .chart_toolpanel_button").removeClass("selected");$("#chart_enable_tools a").removeClass("selected");if(a=="on"){$("#chart_show_tools").addClass("selected");$("#chart_enable_tools a").each(function(){if($(this).attr("name")=="on"){$(this).addClass("selected")}});$("#chart_toolpanel")[0].style.display="inline";if(ChartManager.getInstance()._drawingTool==ChartManager.DrawingTool.Cursor){$("#chart_Cursor").parent().addClass("selected")}else{if(ChartManager.getInstance()._drawingTool==ChartManager.DrawingTool.CrossCursor){$("#chart_CrossCursor").parent().addClass("selected")}}}else{if(a=="off"){$("#chart_show_tools").removeClass("selected");$("#chart_enable_tools a").each(function(){if($(this).attr("name")=="off"){$(this).addClass("selected")}});$("#chart_toolpanel")[0].style.display="none";ChartManager.getInstance().setRunningMode(ChartManager.getInstance()._beforeDrawingTool);ChartManager.getInstance().redraw("All",true)}}if(KlineIns.isSized){on_size()}else{on_size(KlineIns.width,KlineIns.height)}}function switch_indic(a){$("#chart_enable_indicator a").removeClass("selected");$("#chart_enable_indicator a[name='"+a+"']").addClass("selected");if(a=="on"){$("#chart_show_indicator").addClass("selected");var b=ChartSettings.get();b.charts.indicsStatus="open";ChartSettings.save();var c=b.charts.indics[1];if(Template.displayVolume==false){ChartManager.getInstance().getChart().setIndicator(2,c)}else{ChartManager.getInstance().getChart().setIndicator(2,c)}$("#chart_tabbar").find("a").each(function(){if($(this).attr("name")==c){$(this).addClass("selected")}});$("#chart_tabbar")[0].style.display="block"}else{if(a=="off"){$("#chart_show_indicator").removeClass("selected");ChartManager.getInstance().getChart().setIndicator(2,"NONE");var b=ChartSettings.get();b.charts.indicsStatus="close";ChartSettings.save();$("#chart_tabbar")[0].style.display="none";$("#chart_tabbar a").removeClass("selected")}}if(KlineIns.isSized){on_size()}else{on_size(KlineIns.width,KlineIns.height)}}function switch_period(a){$(".chart_container .chart_toolbar_tabgroup a").removeClass("selected");$("#chart_toolbar_periods_vert ul a").removeClass("selected");$(".chart_container .chart_toolbar_tabgroup a").each(function(){if($(this).parent().attr("name")==a){$(this).addClass("selected")}});$("#chart_toolbar_periods_vert ul a").each(function(){if($(this).parent().attr("name")==a){$(this).addClass("selected")}});ChartManager.getInstance().showCursor();calcPeriodWeight(a);if(a=="line"){ChartManager.getInstance().getChart().strIsLine=true;ChartManager.getInstance().setChartStyle("frame0.k0","Line");ChartManager.getInstance().getChart().setCurrentPeriod("line");var b=ChartSettings.get();b.charts.period=a;ChartSettings.save();return}ChartManager.getInstance().getChart().strIsLine=false;var c=KlineIns.tagMapPeriod[a];ChartManager.getInstance().setChartStyle("frame0.k0",ChartSettings.get().charts.chartStyle);ChartManager.getInstance().getChart().setCurrentPeriod(c);var b=ChartSettings.get();b.charts.period=a;ChartSettings.save()}function reset(a){KlineIns.symbol=a;if(KlineIns.showTrade){KlineTradeIns.reset(a)}}function switch_symbol_selected(b){reset(b);$(".market_chooser ul a").removeClass("selected");$(".market_chooser ul a[name='"+b+"']").addClass("selected");ChartManager.getInstance().getChart()._symbol=b;var a=ChartSettings.get();a.charts.symbol=b;ChartSettings.save()}function switch_symbol(b){switch_symbol_selected(b);var a=ChartSettings.get();if(a.charts.period=="line"){ChartManager.getInstance().getChart().strIsLine=true;ChartManager.getInstance().setChartStyle("frame0.k0","Line")}else{ChartManager.getInstance().getChart().strIsLine=false;ChartManager.getInstance().setChartStyle("frame0.k0",ChartSettings.get().charts.chartStyle)}ChartManager.getInstance().getChart().setSymbol(b)}function calcPeriodWeight(d){var a=d;if(d!="line"){a=KlineIns.periodMap[KlineIns.tagMapPeriod[d]]}var c=ChartSettings.get().charts.period_weight;for(var b in c){if(c[b]>c[a]){c[b]-=1}}c[a]=8;ChartSettings.save()}function socketConnect(){KlineIns.socketConnected=true;if(!KlineIns.socketClient){if(KlineIns.enableSockjs){var a=new SockJS(KlineIns.url);KlineIns.socketClient=Stomp.over(a)}else{KlineIns.socketClient=Stomp.client(KlineIns.url)}}if(KlineIns.socketClient.ws.readyState==1){console.log("DEBUG: already connected");return}if(!KlineIns.debug){KlineIns.socketClient.debug=null}KlineIns.socketClient.connect({},function(){KlineIns.socketClient.subscribe(KlineIns.subscribePath,function(b){requestSuccessHandler(JSON.parse(b.body))});RequestData(true)},function(){KlineIns.socketClient.disconnect();console.log("DEBUG: reconnect in 5 seconds ...");setTimeout(function(){socketConnect()},5000)})}var template_str="\n"+'<div class="trade_container dark hide">\n'+'        <div class="m_cent">\n'+'            <div class="m_guadan">\n'+'                <div class="symbol-title">\n'+'                    <a class="dark">test</a>\n'+"                    \n"+"                </div>\n"+'                <div id="orderbook">\n'+'                    <div id="asks">\n'+'                        <div class="table"> </div>\n'+"                   </div>\n"+'                   <div id="gasks">\n'+'                        <div class="table"> </div>\n'+"                   </div>\n"+'                   <div id="price" class="green"></div>\n'+'                   <div id="bids">\n'+'                        <div class="table"> </div>\n'+"                    </div>\n"+'                    <div id="gbids">\n'+'                        <div class="table"> </div>\n'+"                    </div>\n"+"                </div>\n"+'                <div id="trades" class="trades">\n'+'                <div class="trades_list"> </div>\n'+"                </div>\n"+"            \n"+"            </div>\n"+"        \n"+"        </div>\n"+"</div>\n"+'<div class="chart_container dark">\n'+'            <div id="chart_dom_elem_cache"></div>\n'+"            <!-- ToolBar -->\n"+'            <div id="chart_toolbar">\n'+'                <div class="chart_toolbar_minisep"></div>\n'+"                <!-- Periods -->\n"+'                <div class="chart_dropdown" id="chart_toolbar_periods_vert">\n'+'                    <div class="chart_dropdown_t"><a class="chart_str_period">周期</a></div>\n'+'                    <div class="chart_dropdown_data" style="margin-left: -58px;">\n'+"                        <table>\n"+"                            <tbody>\n"+"                            <tr>\n"+"                                <td>\n"+"                                    <ul>\n"+'                                        <li id="chart_period_1w_v" style="display:none;" name="1w"><a class="chart_str_period_1w">周线</a></li>\n'+'                                        <li id="chart_period_3d_v" style="display:none;" name="3d"><a class="chart_str_period_3d">3日</a></li>\n'+'                                        <li id="chart_period_1d_v" style="display:none;" name="1d"><a class="chart_str_period_1d">日线</a></li>\n'+'                                        <li id="chart_period_12h_v" style="display:none;" name="12h"><a class="chart_str_period_12h">12小时</a></li>\n'+'                                        <li id="chart_period_6h_v" style="display:none;" name="6h"><a class="chart_str_period_6h">6小时</a></li>\n'+'                                        <li id="chart_period_4h_v" style="display:none;" name="4h"><a class="chart_str_period_4h">4小时</a></li>\n'+'                                        <li id="chart_period_2h_v" style="display:none;" name="2h"><a class="chart_str_period_2h">2小时</a></li>\n'+'                                        <li id="chart_period_1h_v" style="display:none;" name="1h"><a class="chart_str_period_1h">1小时</a></li>\n'+"                                    </ul>\n"+"                                </td>\n"+"                            </tr>\n"+"                            <tr>\n"+"                                <td>\n"+"                                    <ul>\n"+'                                        <li id="chart_period_30m_v" style="display:none;" name="30m"><a class="chart_str_period_30m">30分钟</a></li>\n'+'                                        <li id="chart_period_15m_v" style="display:none;" name="15m"><a class="chart_str_period_15m">15分钟</a></li>\n'+'                                        <li id="chart_period_5m_v" style="display:none;" name="5m"><a class="chart_str_period_5m">5分钟</a></li>\n'+'                                        <li id="chart_period_3m_v" style="display:none;" name="3m"><a class="chart_str_period_3m">3分钟</a></li>\n'+'                                        <li id="chart_period_1m_v" style="display:none;" name="1m"><a class="chart_str_period_1m selected">1分钟</a></li>\n'+'                                        <li id="chart_period_line_v" style="display:none;" name="line"><a class="chart_str_period_line">分时</a>\n'+"                                        </li>\n"+"                                    </ul>\n"+"                                </td>\n"+"                            </tr>\n"+"                            </tbody>\n"+"                        </table>\n"+"                    </div>\n"+"                </div>\n"+'                <div id="chart_toolbar_periods_horz">\n'+'                    <ul class="chart_toolbar_tabgroup" style="padding-left:5px; padding-right:11px;">\n'+'                        <li id="chart_period_1w_h" name="1w" style="display: none;"><a class="chart_str_period_1w">周线</a></li>\n'+'                        <li id="chart_period_3d_h" name="3d" style="display: none;"><a class="chart_str_period_3d">3日</a></li>\n'+'                        <li id="chart_period_1d_h" name="1d" style="display: none;"><a class="chart_str_period_1d">日线</a></li>\n'+'                        <li id="chart_period_12h_h" name="12h" style="display: none;"><a class="chart_str_period_12h">12小时</a></li>\n'+'                        <li id="chart_period_6h_h" name="6h" style="display: none;"><a class="chart_str_period_6h">6小时</a></li>\n'+'                        <li id="chart_period_4h_h" name="4h" style="display: none;"><a class="chart_str_period_4h">4小时</a></li>\n'+'                        <li id="chart_period_2h_h" name="2h" style="display: none;"><a class="chart_str_period_2h">2小时</a></li>\n'+'                        <li id="chart_period_1h_h" name="1h" style="display: none;"><a class="chart_str_period_1h">1小时</a></li>\n'+'                        <li id="chart_period_30m_h" name="30m" style="display: none;"><a class="chart_str_period_30m">30分钟</a></li>\n'+'                        <li id="chart_period_15m_h" name="15m" style="display: none;"><a class="chart_str_period_15m">15分钟</a></li>\n'+'                        <li id="chart_period_5m_h" name="5m" style="display: none;"><a class="chart_str_period_5m">5分钟</a></li>\n'+'                        <li id="chart_period_3m_h" name="3m" style="display: none;"><a class="chart_str_period_3m">3分钟</a></li>\n'+'                        <li id="chart_period_1m_h" name="1m" style="display: none;"><a class="chart_str_period_1m selected">1分钟</a></li>\n'+'                        <li id="chart_period_line_h" name="line" style="display: none;"><a class="chart_str_period_line">分时</a></li>\n'+"                    </ul>\n"+"                </div>\n"+'                <div id="chart_show_indicator" class="chart_toolbar_button chart_str_indicator_cap selected">技术指标</div>\n'+'                <div id="chart_show_tools" class="chart_toolbar_button chart_str_tools_cap">画线工具</div>\n'+'                <div id="chart_toolbar_theme">\n'+'                    <div class="chart_toolbar_label chart_str_theme_cap">主题选择</div>\n'+'                    <a name="dark" class="chart_icon chart_icon_theme_dark selected"></a>\n'+'                    <a name="light" class="chart_icon chart_icon_theme_light"></a>\n'+"                </div>\n"+'                <div class="chart_dropdown" id="chart_dropdown_settings">\n'+'                    <div class="chart_dropdown_t"><a class="chart_str_settings">更多</a></div>\n'+'                    <div class="chart_dropdown_data" style="margin-left: -142px;">\n'+"                        <table>\n"+"                            <tbody>\n"+'                            <tr id="chart_select_main_indicator">\n'+'                                <td class="chart_str_main_indicator">主指标</td>\n'+"                                <td>\n"+"                                    <ul>\n"+'                                        <li><a name="MA" class="selected">MA</a></li>\n'+'                                        <li><a name="EMA" class="">EMA</a></li>\n'+'                                        <li><a name="BOLL" class="">BOLL</a></li>\n'+'                                        <li><a name="SAR" class="">SAR</a></li>\n'+'                                        <li><a name="NONE" class="">None</a></li>\n'+"                                    </ul>\n"+"                                </td>\n"+"                            </tr>\n"+'                            <tr id="chart_select_chart_style">\n'+'                                <td class="chart_str_chart_style">主图样式</td>\n'+"                                <td>\n"+"                                    <ul>\n"+'                                        <li><a class="selected">CandleStick</a></li>\n'+"                                        <li><a>CandleStickHLC</a></li>\n"+'                                        <li><a class="">OHLC</a></li>\n'+"                                    </ul>\n"+"                                </td>\n"+"                            </tr>\n"+'                            <tr id="chart_select_theme" style="display: none;">\n'+'                                <td class="chart_str_theme">主题选择</td>\n'+"                                <td>\n"+"                                    <ul>\n"+"                                        <li>\n"+'                                            <a name="dark" class="chart_icon chart_icon_theme_dark selected"></a>\n'+"                                        </li>\n"+"                                        <li>\n"+'                                            <a name="light" class="chart_icon chart_icon_theme_light"></a>\n'+"                                        </li>\n"+"                                    </ul>\n"+"                                </td>\n"+"                            </tr>\n"+'                            <tr id="chart_enable_tools" style="display: none;">\n'+'                                <td class="chart_str_tools">画线工具</td>\n'+"                                <td>\n"+"                                    <ul>\n"+'                                        <li><a name="on" class="chart_str_on">开启</a></li>\n'+'                                        <li><a name="off" class="chart_str_off selected">关闭</a></li>\n'+"                                    </ul>\n"+"                                </td>\n"+"                            </tr>\n"+'                            <tr id="chart_enable_indicator" style="display: none;">\n'+'                                <td class="chart_str_indicator">技术指标</td>\n'+"                                <td>\n"+"                                    <ul>\n"+'                                        <li><a name="on" class="chart_str_on selected">开启</a></li>\n'+'                                        <li><a name="off" class="chart_str_off">关闭</a></li>\n'+"                                    </ul>\n"+"                                </td>\n"+"                            </tr>\n"+"                            <tr>\n"+"                                <td></td>\n"+"                                <td>\n"+"                                    <ul>\n"+'                                        <li><a id="chart_btn_parameter_settings"\n'+'                                               class="chart_str_indicator_parameters">指标参数设置</a>\n'+"                                        </li>\n"+"                                    </ul>\n"+"                                </td>\n"+"                            </tr>\n"+"                            </tbody>\n"+"                        </table>\n"+"                    </div>\n"+"                </div>\n"+'                <div class="chart_dropdown" id="chart_language_setting_div" style="padding-left: 5px;">\n'+'                    <div class="chart_dropdown_t">\n'+'                        <a class="chart_language_setting">语言(LANG)</a>\n'+"                    </div>\n"+'                    <div class="chart_dropdown_data" style="padding-top: 15px; margin-left: -12px;">\n'+"                        <ul>\n"+'                            <li style="height: 25px;"><a name="zh-cn" class="selected">简体中文(zh-CN)</a></li>\n'+'                            <li style="height: 25px;"><a name="en-us">English(en-US)</a></li>\n'+'                            <li style="height: 25px;"><a name="zh-tw">繁體中文(zh-HK)</a></li>\n'+"                        </ul>\n"+"                    </div>\n"+"                </div>\n"+'                <div id="chart_updated_time">\n'+'                    <div id="sizeIcon" class="chart_BoxSize"></div>\n'+"                </div>\n"+"            </div>\n"+"            <!-- ToolPanel -->\n"+'            <div id="chart_toolpanel">\n'+'                <div class="chart_toolpanel_separator"></div>\n'+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_Cursor" name="Cursor"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_cursor">光标</div>\n'+"                </div>\n"+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_CrossCursor" name="CrossCursor"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_cross_cursor">十字光标</div>\n'+"                </div>\n"+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_SegLine" name="SegLine"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_seg_line">线段</div>\n'+"                </div>\n"+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_StraightLine" name="StraightLine"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_straight_line">直线</div>\n'+"                </div>\n"+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_RayLine" name="RayLine"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_ray_line">射线</div>\n'+"                </div>\n"+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_ArrowLine" name="ArrowLine"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_arrow_line">箭头</div>\n'+"                </div>\n"+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_HoriSegLine" name="HoriSegLine"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_horz_seg_line">水平线段</div>\n'+"                </div>\n"+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_HoriStraightLine" name="HoriStraightLine"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_horz_straight_line">水平直线</div>\n'+"                </div>\n"+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_HoriRayLine" name="HoriRayLine"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_horz_ray_line">水平射线</div>\n'+"                </div>\n"+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_VertiStraightLine" name="VertiStraightLine"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_vert_straight_line">垂直直线</div>\n'+"                </div>\n"+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_PriceLine" name="PriceLine"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_price_line">价格线</div>\n'+"                </div>\n"+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_TriParallelLine" name="TriParallelLine"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_tri_parallel_line">价格通道线</div>\n'+"                </div>\n"+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_BiParallelLine" name="BiParallelLine"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_bi_parallel_line">平行直线</div>\n'+"                </div>\n"+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_BiParallelRayLine" name="BiParallelRayLine"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_bi_parallel_ray">平行射线</div>\n'+"                </div>\n"+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_DrawFibRetrace" name="DrawFibRetrace"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_fib_retrace">斐波纳契回调</div>\n'+"                </div>\n"+'                <div class="chart_toolpanel_button">\n'+'                    <div class="chart_toolpanel_icon" id="chart_DrawFibFans" name="DrawFibFans"></div>\n'+'                    <div class="chart_toolpanel_tip chart_str_fib_fans">斐波纳契扇形</div>\n'+"                </div>\n"+'                <div style="padding-left: 3px;padding-top: 10px;">\n'+'                    <button style="color: red;" id="clearCanvas" title="Clear All">X</button>\n'+"                </div>\n"+"            </div>\n"+"            <!-- Canvas Group -->\n"+'            <div id="chart_canvasGroup" class="temp">\n'+'                <canvas class="chart_canvas" id="chart_mainCanvas"\n'+'                        style="cursor: default;"></canvas>\n'+'                <canvas class="chart_canvas" id="chart_overlayCanvas"\n'+'                        style="cursor: default;"></canvas>\n'+"            </div>\n"+"            <!-- TabBar -->\n"+'            <div id="chart_tabbar"">\n'+"                <ul>\n"+'                    <li><a name="MACD" class="">MACD</a></li>\n'+'                    <li><a name="KDJ" class="">KDJ</a></li>\n'+'                    <li><a name="StochRSI" class="">StochRSI</a></li>\n'+'                    <li><a name="RSI" class="">RSI</a></li>\n'+'                    <li><a name="DMI" class="">DMI</a></li>\n'+'                    <li><a name="OBV" class="">OBV</a></li>\n'+'                    <li><a name="BOLL" class="">BOLL</a></li>\n'+'                    <li><a name="SAR" class="">SAR</a></li>\n'+'                    <li><a name="DMA" class="">DMA</a></li>\n'+'                    <li><a name="TRIX" class="">TRIX</a></li>\n'+'                    <li><a name="BRAR" class="">BRAR</a></li>\n'+'                    <li><a name="VR" class="">VR</a></li>\n'+'                    <li><a name="EMV" class="">EMV</a></li>\n'+'                    <li><a name="WR" class="">WR</a></li>\n'+'                    <li><a name="ROC" class="">ROC</a></li>\n'+'                    <li><a name="MTM" class="">MTM</a></li>\n'+'                    <li><a name="PSY">PSY</a></li>\n'+"                </ul>\n"+"            </div>\n"+"            <!-- Parameter Settings -->\n"+'            <div id="chart_parameter_settings">\n'+'                <h2 class="chart_str_indicator_parameters">指标参数设置</h2>\n'+"                <table>\n"+"                    <tbody>\n"+"                    <tr>\n"+"                        <th>MA</th>\n"+'                        <td><input name="MA"><input name="MA"><input name="MA"><input name="MA"><br><input\n'+'                                name="MA"><input\n'+'                                name="MA"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                        <th>DMA</th>\n"+'                        <td><input name="DMA"><input name="DMA"><input name="DMA"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                    </tr>\n"+"                    <tr>\n"+"                        <th>EMA</th>\n"+'                        <td><input name="EMA"><input name="EMA"><input name="EMA"><input name="EMA"><br><input\n'+'                                name="EMA"><input name="EMA"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                        <th>TRIX</th>\n"+'                        <td><input name="TRIX"><input name="TRIX"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                    </tr>\n"+"                    <tr>\n"+"                        <th>VOLUME</th>\n"+'                        <td><input name="VOLUME"><input name="VOLUME"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                        <th>BRAR</th>\n"+'                        <td><input name="BRAR"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                    </tr>\n"+"                    <tr>\n"+"                        <th>MACD</th>\n"+'                        <td><input name="MACD"><input name="MACD"><input name="MACD"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                        <th>VR</th>\n"+'                        <td><input name="VR"><input name="VR"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                    </tr>\n"+"                    <tr>\n"+"                        <th>KDJ</th>\n"+'                        <td><input name="KDJ"><input name="KDJ"><input name="KDJ"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                        <th>EMV</th>\n"+'                        <td><input name="EMV"><input name="EMV"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                    </tr>\n"+"                    <tr>\n"+"                        <th>StochRSI</th>\n"+'                        <td><input name="StochRSI"><input name="StochRSI"><input name="StochRSI"><input name="StochRSI">\n'+"                        </td>\n"+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                        <th>WR</th>\n"+'                        <td><input name="WR"><input name="WR"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                    </tr>\n"+"                    <tr>\n"+"                        <th>RSI</th>\n"+'                        <td><input name="RSI"><input name="RSI"><input name="RSI"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                        <th>ROC</th>\n"+'                        <td><input name="ROC"><input name="ROC"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                    </tr>\n"+"                    <tr>\n"+"                        <th>DMI</th>\n"+'                        <td><input name="DMI"><input name="DMI"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                        <th>MTM</th>\n"+'                        <td><input name="MTM"><input name="MTM"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                    </tr>\n"+"                    <tr>\n"+"                        <th>OBV</th>\n"+'                        <td><input name="OBV"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                        <th>PSY</th>\n"+'                        <td><input name="PSY"><input name="PSY"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                    </tr>\n"+"                    <tr>\n"+"                        <th>BOLL</th>\n"+'                        <td><input name="BOLL"></td>\n'+"                        <td>\n"+'                            <button class="chart_str_default">默认值</button>\n'+"                        </td>\n"+"                    </tr>\n"+"                    </tbody>\n"+"                </table>\n"+'                <div id="close_settings"><a class="chart_str_close">关闭</a></div>\n'+"            </div>\n"+"            <!-- Loading -->\n"+'            <div id="chart_loading" class="chart_str_loading">正在读取数据...</div>\n'+"        </div>\n"+'        <div style="display: none" id="chart_language_switch_tmp">\n'+'            <span name="chart_str_period" zh_tw="週期" zh_cn="周期" en_us="TIME"></span>\n'+'            <span name="chart_str_period_line" zh_tw="分時" zh_cn="分时" en_us="Line"></span>\n'+'            <span name="chart_str_period_1m" zh_tw="1分鐘" zh_cn="1分钟" en_us="1m"></span>\n'+'            <span name="chart_str_period_3m" zh_tw="3分鐘" zh_cn="3分钟" en_us="3m"></span>\n'+'            <span name="chart_str_period_5m" zh_tw="5分鐘" zh_cn="5分钟" en_us="5m"></span>\n'+'            <span name="chart_str_period_15m" zh_tw="15分鐘" zh_cn="15分钟" en_us="15m"></span>\n'+'            <span name="chart_str_period_30m" zh_tw="30分鐘" zh_cn="30分钟" en_us="30m"></span>\n'+'            <span name="chart_str_period_1h" zh_tw="1小時" zh_cn="1小时" en_us="1h"></span>\n'+'            <span name="chart_str_period_2h" zh_tw="2小時" zh_cn="2小时" en_us="2h"></span>\n'+'            <span name="chart_str_period_4h" zh_tw="4小時" zh_cn="4小时" en_us="4h"></span>\n'+'            <span name="chart_str_period_6h" zh_tw="6小時" zh_cn="6小时" en_us="6h"></span>\n'+'            <span name="chart_str_period_12h" zh_tw="12小時" zh_cn="12小时" en_us="12h"></span>\n'+'            <span name="chart_str_period_1d" zh_tw="日線" zh_cn="日线" en_us="1d"></span>\n'+'            <span name="chart_str_period_3d" zh_tw="3日" zh_cn="3日" en_us="3d"></span>\n'+'            <span name="chart_str_period_1w" zh_tw="周線" zh_cn="周线" en_us="1w"></span>\n'+"\n"+'            <span name="chart_str_settings" zh_tw="更多" zh_cn="更多" en_us="MORE"></span>\n'+'            <span name="chart_setting_main_indicator" zh_tw="均線設置" zh_cn="均线设置" en_us="Main Indicator"></span>\n'+'            <span name="chart_setting_main_indicator_none" zh_tw="關閉均線" zh_cn="关闭均线" en_us="None"></span>\n'+'            <span name="chart_setting_indicator_parameters" zh_tw="指標參數設置" zh_cn="指标参数设置"\n'+'                  en_us="Indicator Parameters"></span>\n'+"\n"+'            <span name="chart_str_chart_style" zh_tw="主圖樣式" zh_cn="主图样式" en_us="Chart Style"></span>\n'+'            <span name="chart_str_main_indicator" zh_tw="主指標" zh_cn="主指标" en_us="Main Indicator"></span>\n'+'            <span name="chart_str_indicator" zh_tw="技術指標" zh_cn="技术指标" en_us="Indicator"></span>\n'+'            <span name="chart_str_indicator_cap" zh_tw="技術指標" zh_cn="技术指标" en_us="INDICATOR"></span>\n'+'            <span name="chart_str_tools" zh_tw="畫線工具" zh_cn="画线工具" en_us="Tools"></span>\n'+'            <span name="chart_str_tools_cap" zh_tw="畫線工具" zh_cn="画线工具" en_us="TOOLS"></span>\n'+'            <span name="chart_str_theme" zh_tw="主題選擇" zh_cn="主题选择" en_us="Theme"></span>\n'+'            <span name="chart_str_theme_cap" zh_tw="主題選擇" zh_cn="主题选择" en_us="THEME"></span>\n'+"\n"+'            <span name="chart_language_setting" zh_tw="語言(LANG)" zh_cn="语言(LANG)" en_us="LANGUAGE"></span>\n'+'            <span name="chart_exchanges_setting" zh_tw="更多市場" zh_cn="更多市场" en_us="MORE MARKETS"></span>\n'+'            <span name="chart_othercoin_setting" zh_tw="其它市場" zh_cn="其它市场" en_us="OTHER MARKETS"></span>\n'+"\n"+"\n"+'            <span name="chart_str_none" zh_tw="關閉" zh_cn="关闭" en_us="None"></span>\n'+"\n"+'            <span name="chart_str_theme_dark" zh_tw="深色主題" zh_cn="深色主题" en_us="Dark"></span>\n'+'            <span name="chart_str_theme_light" zh_tw="淺色主題" zh_cn="浅色主题" en_us="Light"></span>\n'+"\n"+'            <span name="chart_str_on" zh_tw="開啟" zh_cn="开启" en_us="On"></span>\n'+'            <span name="chart_str_off" zh_tw="關閉" zh_cn="关闭" en_us="Off"></span>\n'+"\n"+'            <span name="chart_str_close" zh_tw="關閉" zh_cn="关闭" en_us="CLOSE"></span>\n'+'            <span name="chart_str_default" zh_tw="默認值" zh_cn="默认值" en_us="default"></span>\n'+"\n"+'            <span name="chart_str_loading" zh_tw="正在讀取數據..." zh_cn="正在读取数据..." en_us="Loading..."></span>\n'+"\n"+'            <span name="chart_str_indicator_parameters" zh_tw="指標參數設置" zh_cn="指标参数设置"\n'+'                  en_us="Indicator Parameters"></span>\n'+"\n"+'            <span name="chart_str_cursor" zh_tw="光標" zh_cn="光标" en_us="Cursor"></span>\n'+'            <span name="chart_str_cross_cursor" zh_tw="十字光標" zh_cn="十字光标" en_us="Cross Cursor"></span>\n'+'            <span name="chart_str_seg_line" zh_tw="線段" zh_cn="线段" en_us="Trend Line"></span>\n'+'            <span name="chart_str_straight_line" zh_tw="直線" zh_cn="直线" en_us="Extended"></span>\n'+'            <span name="chart_str_ray_line" zh_tw="射線" zh_cn="射线" en_us="Ray"></span>\n'+'            <span name="chart_str_arrow_line" zh_tw="箭頭" zh_cn="箭头" en_us="Arrow"></span>\n'+'            <span name="chart_str_horz_seg_line" zh_tw="水平線段" zh_cn="水平线段" en_us="Horizontal Line"></span>\n'+'            <span name="chart_str_horz_straight_line" zh_tw="水平直線" zh_cn="水平直线" en_us="Horizontal Extended"></span>\n'+'            <span name="chart_str_horz_ray_line" zh_tw="水平射線" zh_cn="水平射线" en_us="Horizontal Ray"></span>\n'+'            <span name="chart_str_vert_straight_line" zh_tw="垂直直線" zh_cn="垂直直线" en_us="Vertical Extended"></span>\n'+'            <span name="chart_str_price_line" zh_tw="價格線" zh_cn="价格线" en_us="Price Line"></span>\n'+'            <span name="chart_str_tri_parallel_line" zh_tw="價格通道線" zh_cn="价格通道线" en_us="Parallel Channel"></span>\n'+'            <span name="chart_str_bi_parallel_line" zh_tw="平行直線" zh_cn="平行直线" en_us="Parallel Lines"></span>\n'+'            <span name="chart_str_bi_parallel_ray" zh_tw="平行射線" zh_cn="平行射线" en_us="Parallel Rays"></span>\n'+'            <span name="chart_str_fib_retrace" zh_tw="斐波納契回調" zh_cn="斐波纳契回调" en_us="Fibonacci Retracements"></span>\n'+'            <span name="chart_str_fib_fans" zh_tw="斐波納契扇形" zh_cn="斐波纳契扇形" en_us="Fibonacci Fans"></span>\n'+"\n"+'            <span name="chart_str_updated" zh_tw="更新於" zh_cn="更新于" en_us="Updated"></span>\n'+'            <span name="chart_str_ago" zh_tw="前" zh_cn="前" en_us="ago"></span>\n'+"</div>\n";
function draw(a){KlineIns=a;KlineTradeIns=new KlineTrade();var f=$.parseHTML(template_str);for(var b in KlineIns.ranges){var d=$(f).find('[name="'+KlineIns.ranges[b]+'"]');d.each(function(g,h){$(h).attr("style","display:inline-block")})}$(KlineIns.element).html(f);var c=setInterval(refresh_function,KlineIns.intervalTime);if(KlineIns.type=="socket"){socketConnect()}window._setMarketFrom=function(g){Template.displayVolume=false;refreshTemplate();readCookie();ChartManager.getInstance().getChart().setSymbol(g)};window._set_current_language=function(g){chart_switch_language(g)};window._set_current_depth=function(g){ChartManager.getInstance().getChart().updateDepth(g)};window._set_current_url=function(g){KlineIns.url=g};window._set_current_contract_unit=function(g){ChartManager.getInstance().getChart().setCurrentContractUnit(g)};window._set_money_type=function(g){ChartManager.getInstance().getChart().setCurrentMoneyType(g)};window._set_usd_cny_rate=function(g){ChartManager.getInstance().getChart()._usd_cny_rate=g};window._setCaptureMouseWheelDirectly=function(g){ChartManager.getInstance().setCaptureMouseWheelDirectly(g)};window._current_future_change=new MEvent();window._current_theme_change=new MEvent();KLineMouseEvent();ChartManager.getInstance().bindCanvas("main",document.getElementById("chart_mainCanvas"));ChartManager.getInstance().bindCanvas("overlay",document.getElementById("chart_overlayCanvas"));refreshTemplate();on_size(KlineIns.width,KlineIns.height);readCookie();KlineIns.setTheme(KlineIns.theme);KlineIns.setLanguage(KlineIns.language);$(KlineIns.element).css({visibility:"visible"})}try{module.exports=exports=Kline}catch(e){};
